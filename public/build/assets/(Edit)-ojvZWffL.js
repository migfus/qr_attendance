import{B as xl}from"./BasicCard-ClXIXozC.js";import{d as Ia,p as Rn,q as bl,f as Ln,o as Ds,w as $e,b as me,u as Be,Y as wl,e as te,s as In,G as Cl,ab as Sl,V as Tl,v as xi,J as Ni,ak as Ol,_ as Bn,x as kl,S as Dl,aQ as Nn,W as bi,r as we,k as jl,a7 as Ml,I as Al,c as wi,g as Vn,ag as El,t as Mt,ad as _s,i as Pl}from"./app-BOkKnMk8.js";import{_ as Fl}from"./LayersCard.vue_vue_type_script_setup_true_lang-Dl7JeaZ_.js";import{_ as Rl}from"./FilesCard.vue_vue_type_script_setup_true_lang-cnT4gixl.js";import{_ as Ll}from"./ShortcutCard.vue_vue_type_script_setup_true_lang-CBk89Atz.js";import{_ as Il}from"./ToolsCard.vue_vue_type_script_setup_true_lang-BRtgdZ-r.js";import{Q as Bl,t as Nl}from"./qrcode.vue.esm-DhVb-LSs.js";import{_ as Vl}from"./Unedited.vue_vue_type_script_setup_true_lang-B_PPEncA.js";import{r as zl}from"./SparklesIcon-Dzomtyg1.js";import{r as Wl}from"./ArrowUpIcon-DZ4CZCY0.js";import"./ToolContent.vue_vue_type_script_setup_true_lang-BiQNBYfV.js";import"./ArrowDownIcon-BPnPHX1P.js";import"./CheckIcon-C5b3kr33.js";import"./Square2StackIcon-Cc__3gcb.js";import"./ToolInput.vue_vue_type_script_setup_true_lang-D4lntKHo.js";import"./AppTextArea.vue_vue_type_script_setup_true_lang-Bn83_HaO.js";import"./TrashIcon-CpbmzRkx.js";import"./ArrowLeftIcon-ad8tfL7s.js";import"./CircleStackIcon-DUEEmQGZ.js";import"./ArrowDownOnSquareIcon-Cj4hYOxG.js";import"./WrenchIcon-sxk0xklf.js";function m(n,e,t){return(e=(function(s){var r=(function(i,a){if(typeof i!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var l=o.call(i,a);if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(i)})(s,"string");return typeof r=="symbol"?r:r+""})(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function zn(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);e&&(s=s.filter((function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable}))),t.push.apply(t,s)}return t}function v(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?zn(Object(t),!0).forEach((function(s){m(n,s,t[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):zn(Object(t)).forEach((function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(t,s))}))}return n}function Q(n,e){if(n==null)return{};var t,s,r=(function(a,o){if(a==null)return{};var l={};for(var c in a)if({}.hasOwnProperty.call(a,c)){if(o.indexOf(c)>=0)continue;l[c]=a[c]}return l})(n,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(s=0;s<i.length;s++)t=i[s],e.indexOf(t)>=0||{}.propertyIsEnumerable.call(n,t)&&(r[t]=n[t])}return r}function rt(n,e){return e||(e=n.slice(0)),Object.freeze(Object.defineProperties(n,{raw:{value:Object.freeze(e)}}))}class Wn{constructor(){m(this,"browserShadowBlurConstant",1),m(this,"DPI",96),m(this,"devicePixelRatio",typeof window<"u"?window.devicePixelRatio:1),m(this,"perfLimitSizeTotal",2097152),m(this,"maxCacheSideLimit",4096),m(this,"minCacheSideLimit",256),m(this,"disableStyleCopyPaste",!1),m(this,"enableGLFiltering",!0),m(this,"textureSize",4096),m(this,"forceGLPutImageData",!1),m(this,"cachesBoundsOfCurve",!1),m(this,"fontPaths",{}),m(this,"NUM_FRACTION_DIGITS",4)}}const U=new class extends Wn{constructor(n){super(),this.configure(n)}configure(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.assign(this,n)}addFonts(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fontPaths=v(v({},this.fontPaths),n)}removeFonts(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach((n=>{delete this.fontPaths[n]}))}clearFonts(){this.fontPaths={}}restoreDefaults(n){const e=new Wn,t=n?.reduce(((s,r)=>(s[r]=e[r],s)),{})||e;this.configure(t)}},Ct=function(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];return console[n]("fabric",...t)};class Je extends Error{constructor(e,t){super("fabric: ".concat(e),t)}}class Xl extends Je{constructor(e){super("".concat(e," 'options.signal' is in 'aborted' state"))}}class Yl{}class Ul extends Yl{testPrecision(e,t){const s="precision ".concat(t,` float;
void main(){}`),r=e.createShader(e.FRAGMENT_SHADER);return!!r&&(e.shaderSource(r,s),e.compileShader(r),!!e.getShaderParameter(r,e.COMPILE_STATUS))}queryWebGL(e){const t=e.getContext("webgl");t&&(this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.GLPrecision=["highp","mediump","lowp"].find((s=>this.testPrecision(t,s))),t.getExtension("WEBGL_lose_context").loseContext(),Ct("log","WebGL: max texture size ".concat(this.maxTextureSize)))}isSupported(e){return!!this.maxTextureSize&&this.maxTextureSize>=e}}const Gl={};let Xn;const tt=()=>Xn||(Xn={document,window,isTouchSupported:"ontouchstart"in window||"ontouchstart"in document||window&&window.navigator&&window.navigator.maxTouchPoints>0,WebGLProbe:new Ul,dispose(){},copyPasteData:Gl}),os=()=>tt().document,ri=()=>tt().window,Ba=()=>{var n;return Math.max((n=U.devicePixelRatio)!==null&&n!==void 0?n:ri().devicePixelRatio,1)},js=new class{constructor(){m(this,"charWidthsCache",{}),m(this,"boundsOfCurveCache",{})}getFontCache(n){let{fontFamily:e,fontStyle:t,fontWeight:s}=n;e=e.toLowerCase(),this.charWidthsCache[e]||(this.charWidthsCache[e]={});const r=this.charWidthsCache[e],i="".concat(t.toLowerCase(),"_").concat((s+"").toLowerCase());return r[i]||(r[i]={}),r[i]}clearFontCache(n){(n=(n||"").toLowerCase())?this.charWidthsCache[n]&&delete this.charWidthsCache[n]:this.charWidthsCache={}}limitDimsByArea(n){const{perfLimitSizeTotal:e}=U,t=Math.sqrt(e*n);return[Math.floor(t),Math.floor(e/t)]}},Vi="6.7.1";function Mr(){}const tr=Math.PI/2,Ir=2*Math.PI,hn=Math.PI/180,_e=Object.freeze([1,0,0,1,0,0]),un=16,bt=.4477152502,z="center",H="left",Se="top",zi="bottom",se="right",Te="none",dn=/\r?\n/,Na="moving",ii="scaling",Va="rotating",gn="rotate",za="skewing",Ps="resizing",Hl="modifyPoly",Zl="modifyPath",Br="changed",ni="scale",ke="scaleX",Ee="scaleY",ls="skewX",cs="skewY",le="fill",Oe="stroke",Nr="modified",Ut="json",Ci="svg",A=new class{constructor(){this[Ut]=new Map,this[Ci]=new Map}has(n){return this[Ut].has(n)}getClass(n){const e=this[Ut].get(n);if(!e)throw new Je("No class registered for ".concat(n));return e}setClass(n,e){e?this[Ut].set(e,n):(this[Ut].set(n.type,n),this[Ut].set(n.type.toLowerCase(),n))}getSVGClass(n){return this[Ci].get(n)}setSVGClass(n,e){this[Ci].set(e??n.type.toLowerCase(),n)}},Vr=new class extends Array{remove(n){const e=this.indexOf(n);e>-1&&this.splice(e,1)}cancelAll(){const n=this.splice(0);return n.forEach((e=>e.abort())),n}cancelByCanvas(n){if(!n)return[];const e=this.filter((t=>{var s;return t.target===n||typeof t.target=="object"&&((s=t.target)===null||s===void 0?void 0:s.canvas)===n}));return e.forEach((t=>t.abort())),e}cancelByTarget(n){if(!n)return[];const e=this.filter((t=>t.target===n));return e.forEach((t=>t.abort())),e}};class $l{constructor(){m(this,"__eventListeners",{})}on(e,t){if(this.__eventListeners||(this.__eventListeners={}),typeof e=="object")return Object.entries(e).forEach((s=>{let[r,i]=s;this.on(r,i)})),()=>this.off(e);if(t){const s=e;return this.__eventListeners[s]||(this.__eventListeners[s]=[]),this.__eventListeners[s].push(t),()=>this.off(s,t)}return()=>!1}once(e,t){if(typeof e=="object"){const s=[];return Object.entries(e).forEach((r=>{let[i,a]=r;s.push(this.once(i,a))})),()=>s.forEach((r=>r()))}if(t){const s=this.on(e,(function(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];t.call(this,...i),s()}));return s}return()=>!1}_removeEventListener(e,t){if(this.__eventListeners[e])if(t){const s=this.__eventListeners[e],r=s.indexOf(t);r>-1&&s.splice(r,1)}else this.__eventListeners[e]=[]}off(e,t){if(this.__eventListeners)if(e===void 0)for(const s in this.__eventListeners)this._removeEventListener(s);else typeof e=="object"?Object.entries(e).forEach((s=>{let[r,i]=s;this._removeEventListener(r,i)})):this._removeEventListener(e,t)}fire(e,t){var s;if(!this.__eventListeners)return;const r=(s=this.__eventListeners[e])===null||s===void 0?void 0:s.concat();if(r)for(let i=0;i<r.length;i++)r[i].call(this,t||{})}}const Ht=(n,e)=>{const t=n.indexOf(e);return t!==-1&&n.splice(t,1),n},gt=n=>{if(n===0)return 1;switch(Math.abs(n)/tr){case 1:case 3:return 0;case 2:return-1}return Math.cos(n)},ft=n=>{if(n===0)return 0;const e=n/tr,t=Math.sign(n);switch(e){case 1:return t;case 2:return 0;case 3:return-t}return Math.sin(n)};class _{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;typeof e=="object"?(this.x=e.x,this.y=e.y):(this.x=e,this.y=t)}add(e){return new _(this.x+e.x,this.y+e.y)}addEquals(e){return this.x+=e.x,this.y+=e.y,this}scalarAdd(e){return new _(this.x+e,this.y+e)}scalarAddEquals(e){return this.x+=e,this.y+=e,this}subtract(e){return new _(this.x-e.x,this.y-e.y)}subtractEquals(e){return this.x-=e.x,this.y-=e.y,this}scalarSubtract(e){return new _(this.x-e,this.y-e)}scalarSubtractEquals(e){return this.x-=e,this.y-=e,this}multiply(e){return new _(this.x*e.x,this.y*e.y)}scalarMultiply(e){return new _(this.x*e,this.y*e)}scalarMultiplyEquals(e){return this.x*=e,this.y*=e,this}divide(e){return new _(this.x/e.x,this.y/e.y)}scalarDivide(e){return new _(this.x/e,this.y/e)}scalarDivideEquals(e){return this.x/=e,this.y/=e,this}eq(e){return this.x===e.x&&this.y===e.y}lt(e){return this.x<e.x&&this.y<e.y}lte(e){return this.x<=e.x&&this.y<=e.y}gt(e){return this.x>e.x&&this.y>e.y}gte(e){return this.x>=e.x&&this.y>=e.y}lerp(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5;return t=Math.max(Math.min(1,t),0),new _(this.x+(e.x-this.x)*t,this.y+(e.y-this.y)*t)}distanceFrom(e){const t=this.x-e.x,s=this.y-e.y;return Math.sqrt(t*t+s*s)}midPointFrom(e){return this.lerp(e)}min(e){return new _(Math.min(this.x,e.x),Math.min(this.y,e.y))}max(e){return new _(Math.max(this.x,e.x),Math.max(this.y,e.y))}toString(){return"".concat(this.x,",").concat(this.y)}setXY(e,t){return this.x=e,this.y=t,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setFromPoint(e){return this.x=e.x,this.y=e.y,this}swap(e){const t=this.x,s=this.y;this.x=e.x,this.y=e.y,e.x=t,e.y=s}clone(){return new _(this.x,this.y)}rotate(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:fn;const s=ft(e),r=gt(e),i=this.subtract(t);return new _(i.x*r-i.y*s,i.x*s+i.y*r).add(t)}transform(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new _(e[0]*this.x+e[2]*this.y+(t?0:e[4]),e[1]*this.x+e[3]*this.y+(t?0:e[5]))}}const fn=new _(0,0),Ar=n=>!!n&&Array.isArray(n._objects);function Wa(n){class e extends n{constructor(){super(...arguments),m(this,"_objects",[])}_onObjectAdded(s){}_onObjectRemoved(s){}_onStackOrderChanged(s){}add(){for(var s=arguments.length,r=new Array(s),i=0;i<s;i++)r[i]=arguments[i];const a=this._objects.push(...r);return r.forEach((o=>this._onObjectAdded(o))),a}insertAt(s){for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return this._objects.splice(s,0,...i),i.forEach((o=>this._onObjectAdded(o))),this._objects.length}remove(){const s=this._objects,r=[];for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return a.forEach((l=>{const c=s.indexOf(l);c!==-1&&(s.splice(c,1),r.push(l),this._onObjectRemoved(l))})),r}forEachObject(s){this.getObjects().forEach(((r,i,a)=>s(r,i,a)))}getObjects(){for(var s=arguments.length,r=new Array(s),i=0;i<s;i++)r[i]=arguments[i];return r.length===0?[...this._objects]:this._objects.filter((a=>a.isType(...r)))}item(s){return this._objects[s]}isEmpty(){return this._objects.length===0}size(){return this._objects.length}contains(s,r){return!!this._objects.includes(s)||!!r&&this._objects.some((i=>i instanceof e&&i.contains(s,!0)))}complexity(){return this._objects.reduce(((s,r)=>s+=r.complexity?r.complexity():0),0)}sendObjectToBack(s){return!(!s||s===this._objects[0])&&(Ht(this._objects,s),this._objects.unshift(s),this._onStackOrderChanged(s),!0)}bringObjectToFront(s){return!(!s||s===this._objects[this._objects.length-1])&&(Ht(this._objects,s),this._objects.push(s),this._onStackOrderChanged(s),!0)}sendObjectBackwards(s,r){if(!s)return!1;const i=this._objects.indexOf(s);if(i!==0){const a=this.findNewLowerIndex(s,i,r);return Ht(this._objects,s),this._objects.splice(a,0,s),this._onStackOrderChanged(s),!0}return!1}bringObjectForward(s,r){if(!s)return!1;const i=this._objects.indexOf(s);if(i!==this._objects.length-1){const a=this.findNewUpperIndex(s,i,r);return Ht(this._objects,s),this._objects.splice(a,0,s),this._onStackOrderChanged(s),!0}return!1}moveObjectTo(s,r){return s!==this._objects[r]&&(Ht(this._objects,s),this._objects.splice(r,0,s),this._onStackOrderChanged(s),!0)}findNewLowerIndex(s,r,i){let a;if(i){a=r;for(let o=r-1;o>=0;--o)if(s.isOverlapping(this._objects[o])){a=o;break}}else a=r-1;return a}findNewUpperIndex(s,r,i){let a;if(i){a=r;for(let o=r+1;o<this._objects.length;++o)if(s.isOverlapping(this._objects[o])){a=o;break}}else a=r+1;return a}collectObjects(s){let{left:r,top:i,width:a,height:o}=s,{includeIntersecting:l=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const c=[],h=new _(r,i),d=h.add(new _(a,o));for(let u=this._objects.length-1;u>=0;u--){const g=this._objects[u];g.selectable&&g.visible&&(l&&g.intersectsWithRect(h,d)||g.isContainedWithinRect(h,d)||l&&g.containsPoint(h)||l&&g.containsPoint(d))&&c.push(g)}return c}}return e}class Xa extends $l{_setOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};for(const t in e)this.set(t,e[t])}_setObject(e){for(const t in e)this._set(t,e[t])}set(e,t){return typeof e=="object"?this._setObject(e):this._set(e,t),this}_set(e,t){this[e]=t}toggle(e){const t=this.get(e);return typeof t=="boolean"&&this.set(e,!t),this}get(e){return this[e]}}function Er(n){return ri().requestAnimationFrame(n)}function ql(n){return ri().cancelAnimationFrame(n)}let Kl=0;const St=()=>Kl++,pt=()=>{const n=os().createElement("canvas");if(!n||n.getContext===void 0)throw new Je("Failed to create `canvas` element");return n},Jl=()=>os().createElement("img"),Pe=n=>{const e=pt();return e.width=n.width,e.height=n.height,e},Ya=(n,e,t)=>n.toDataURL("image/".concat(e),t),Ua=(n,e,t)=>new Promise(((s,r)=>{n.toBlob(s,"image/".concat(e),t)})),re=n=>n*hn,mt=n=>n/hn,Ql=n=>n.every(((e,t)=>e===_e[t])),Ce=(n,e,t)=>new _(n).transform(e,t),ze=n=>{const e=1/(n[0]*n[3]-n[1]*n[2]),t=[e*n[3],-e*n[1],-e*n[2],e*n[0],0,0],{x:s,y:r}=new _(n[4],n[5]).transform(t,!0);return t[4]=-s,t[5]=-r,t},pe=(n,e,t)=>[n[0]*e[0]+n[2]*e[1],n[1]*e[0]+n[3]*e[1],n[0]*e[2]+n[2]*e[3],n[1]*e[2]+n[3]*e[3],t?0:n[0]*e[4]+n[2]*e[5]+n[4],t?0:n[1]*e[4]+n[3]*e[5]+n[5]],pn=(n,e)=>n.reduceRight(((t,s)=>s&&t?pe(s,t,e):s||t),void 0)||_e.concat(),Ga=n=>{let[e,t]=n;return Math.atan2(t,e)},zr=n=>{const e=Ga(n),t=Math.pow(n[0],2)+Math.pow(n[1],2),s=Math.sqrt(t),r=(n[0]*n[3]-n[2]*n[1])/s,i=Math.atan2(n[0]*n[2]+n[1]*n[3],t);return{angle:mt(e),scaleX:s,scaleY:r,skewX:mt(i),skewY:0,translateX:n[4]||0,translateY:n[5]||0}},sr=function(n){return[1,0,0,1,n,arguments.length>1&&arguments[1]!==void 0?arguments[1]:0]};function hs(){let{angle:n=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{x:e=0,y:t=0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=re(n),r=gt(s),i=ft(s);return[r,i,-i,r,e?e-(r*e-i*t):0,t?t-(i*e+r*t):0]}const mn=function(n){return[n,0,0,arguments.length>1&&arguments[1]!==void 0?arguments[1]:n,0,0]},Ha=n=>Math.tan(re(n)),Za=n=>[1,0,Ha(n),1,0,0],$a=n=>[1,Ha(n),0,1,0,0],ai=n=>{let{scaleX:e=1,scaleY:t=1,flipX:s=!1,flipY:r=!1,skewX:i=0,skewY:a=0}=n,o=mn(s?-e:e,r?-t:t);return i&&(o=pe(o,Za(i),!0)),a&&(o=pe(o,$a(a),!0)),o},ec=n=>{const{translateX:e=0,translateY:t=0,angle:s=0}=n;let r=sr(e,t);s&&(r=pe(r,hs({angle:s})));const i=ai(n);return Ql(i)||(r=pe(r,i)),r},Pr=function(n){let{signal:e,crossOrigin:t=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((function(s,r){if(e&&e.aborted)return r(new Xl("loadImage"));const i=Jl();let a;e&&(a=function(l){i.src="",r(l)},e.addEventListener("abort",a,{once:!0}));const o=function(){i.onload=i.onerror=null,a&&e?.removeEventListener("abort",a),s(i)};n?(i.onload=o,i.onerror=function(){a&&e?.removeEventListener("abort",a),r(new Je("Error loading ".concat(i.src)))},t&&(i.crossOrigin=t),i.src=n):o()}))},Fs=function(n){let{signal:e,reviver:t=Mr}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise(((s,r)=>{const i=[];e&&e.addEventListener("abort",r,{once:!0}),Promise.all(n.map((a=>A.getClass(a.type).fromObject(a,{signal:e}).then((o=>(t(a,o),i.push(o),o)))))).then(s).catch((a=>{i.forEach((o=>{o.dispose&&o.dispose()})),r(a)})).finally((()=>{e&&e.removeEventListener("abort",r)}))}))},oi=function(n){let{signal:e}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise(((t,s)=>{const r=[];e&&e.addEventListener("abort",s,{once:!0});const i=Object.values(n).map((o=>o&&o.type&&A.has(o.type)?Fs([o],{signal:e}).then((l=>{let[c]=l;return r.push(c),c})):o)),a=Object.keys(n);Promise.all(i).then((o=>o.reduce(((l,c,h)=>(l[a[h]]=c,l)),{}))).then(t).catch((o=>{r.forEach((l=>{l.dispose&&l.dispose()})),s(o)})).finally((()=>{e&&e.removeEventListener("abort",s)}))}))},us=function(n){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:[]).reduce(((e,t)=>(t in n&&(e[t]=n[t]),e)),{})},vn=(n,e)=>Object.keys(n).reduce(((t,s)=>(e(n[s],s,n)&&(t[s]=n[s]),t)),{}),J=(n,e)=>parseFloat(Number(n).toFixed(e)),Rs=n=>"matrix("+n.map((e=>J(e,U.NUM_FRACTION_DIGITS))).join(" ")+")",Ae=n=>!!n&&n.toLive!==void 0,Yn=n=>!!n&&typeof n.toObject=="function",Un=n=>!!n&&n.offsetX!==void 0&&"source"in n,At=n=>!!n&&"multiSelectionStacking"in n;function qa(n){const e=n&&Ve(n);let t=0,s=0;if(!n||!e)return{left:t,top:s};let r=n;const i=e.documentElement,a=e.body||{scrollLeft:0,scrollTop:0};for(;r&&(r.parentNode||r.host)&&(r=r.parentNode||r.host,r===e?(t=a.scrollLeft||i.scrollLeft||0,s=a.scrollTop||i.scrollTop||0):(t+=r.scrollLeft||0,s+=r.scrollTop||0),r.nodeType!==1||r.style.position!=="fixed"););return{left:t,top:s}}const Ve=n=>n.ownerDocument||null,Ka=n=>{var e;return((e=n.ownerDocument)===null||e===void 0?void 0:e.defaultView)||null},Ja=function(n,e,t){let{width:s,height:r}=t,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;n.width=s,n.height=r,i>1&&(n.setAttribute("width",(s*i).toString()),n.setAttribute("height",(r*i).toString()),e.scale(i,i))},Wi=(n,e)=>{let{width:t,height:s}=e;t&&(n.style.width=typeof t=="number"?"".concat(t,"px"):t),s&&(n.style.height=typeof s=="number"?"".concat(s,"px"):s)};function Gn(n){return n.onselectstart!==void 0&&(n.onselectstart=()=>!1),n.style.userSelect=Te,n}class Qa{constructor(e){m(this,"_originalCanvasStyle",void 0),m(this,"lower",void 0);const t=this.createLowerCanvas(e);this.lower={el:t,ctx:t.getContext("2d")}}createLowerCanvas(e){const t=(s=e)&&s.getContext!==void 0?e:e&&os().getElementById(e)||pt();var s;if(t.hasAttribute("data-fabric"))throw new Je("Trying to initialize a canvas that has already been initialized. Did you forget to dispose the canvas?");return this._originalCanvasStyle=t.style.cssText,t.setAttribute("data-fabric","main"),t.classList.add("lower-canvas"),t}cleanupDOM(e){let{width:t,height:s}=e;const{el:r}=this.lower;r.classList.remove("lower-canvas"),r.removeAttribute("data-fabric"),r.setAttribute("width","".concat(t)),r.setAttribute("height","".concat(s)),r.style.cssText=this._originalCanvasStyle||"",this._originalCanvasStyle=void 0}setDimensions(e,t){const{el:s,ctx:r}=this.lower;Ja(s,r,e,t)}setCSSDimensions(e){Wi(this.lower.el,e)}calcOffset(){return(function(e){var t;const s=e&&Ve(e),r={left:0,top:0};if(!s)return r;const i=((t=Ka(e))===null||t===void 0?void 0:t.getComputedStyle(e,null))||{};r.left+=parseInt(i.borderLeftWidth,10)||0,r.top+=parseInt(i.borderTopWidth,10)||0,r.left+=parseInt(i.paddingLeft,10)||0,r.top+=parseInt(i.paddingTop,10)||0;let a={left:0,top:0};const o=s.documentElement;e.getBoundingClientRect!==void 0&&(a=e.getBoundingClientRect());const l=qa(e);return{left:a.left+l.left-(o.clientLeft||0)+r.left,top:a.top+l.top-(o.clientTop||0)+r.top}})(this.lower.el)}dispose(){tt().dispose(this.lower.el),delete this.lower}}const tc={backgroundVpt:!0,backgroundColor:"",overlayVpt:!0,overlayColor:"",includeDefaultValues:!0,svgViewportTransformation:!0,renderOnAddRemove:!0,skipOffscreen:!0,enableRetinaScaling:!0,imageSmoothingEnabled:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,viewportTransform:[..._e]};class rr extends Wa(Xa){get lowerCanvasEl(){var e;return(e=this.elements.lower)===null||e===void 0?void 0:e.el}get contextContainer(){var e;return(e=this.elements.lower)===null||e===void 0?void 0:e.ctx}static getDefaults(){return rr.ownDefaults}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,this.constructor.getDefaults()),this.set(t),this.initElements(e),this._setDimensionsImpl({width:this.width||this.elements.lower.el.width||0,height:this.height||this.elements.lower.el.height||0}),this.skipControlsDrawing=!1,this.viewportTransform=[...this.viewportTransform],this.calcViewportBoundaries()}initElements(e){this.elements=new Qa(e)}add(){const e=super.add(...arguments);return arguments.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),e}insertAt(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];const i=super.insertAt(e,...s);return s.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),i}remove(){const e=super.remove(...arguments);return e.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),e}_onObjectAdded(e){e.canvas&&e.canvas!==this&&(Ct("warn",`Canvas is trying to add an object that belongs to a different canvas.
Resulting to default behavior: removing object from previous canvas and adding to new canvas`),e.canvas.remove(e)),e._set("canvas",this),e.setCoords(),this.fire("object:added",{target:e}),e.fire("added",{target:this})}_onObjectRemoved(e){e._set("canvas",void 0),this.fire("object:removed",{target:e}),e.fire("removed",{target:this})}_onStackOrderChanged(){this.renderOnAddRemove&&this.requestRenderAll()}getRetinaScaling(){return this.enableRetinaScaling?Ba():1}calcOffset(){return this._offset=this.elements.calcOffset()}getWidth(){return this.width}getHeight(){return this.height}setWidth(e,t){return this.setDimensions({width:e},t)}setHeight(e,t){return this.setDimensions({height:e},t)}_setDimensionsImpl(e){let{cssOnly:t=!1,backstoreOnly:s=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t){const r=v({width:this.width,height:this.height},e);this.elements.setDimensions(r,this.getRetinaScaling()),this.hasLostContext=!0,this.width=r.width,this.height=r.height}s||this.elements.setCSSDimensions(e),this.calcOffset()}setDimensions(e,t){this._setDimensionsImpl(e,t),t&&t.cssOnly||this.requestRenderAll()}getZoom(){return this.viewportTransform[0]}setViewportTransform(e){this.viewportTransform=e,this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll()}zoomToPoint(e,t){const s=e,r=[...this.viewportTransform],i=Ce(e,ze(r));r[0]=t,r[3]=t;const a=Ce(i,r);r[4]+=s.x-a.x,r[5]+=s.y-a.y,this.setViewportTransform(r)}setZoom(e){this.zoomToPoint(new _(0,0),e)}absolutePan(e){const t=[...this.viewportTransform];return t[4]=-e.x,t[5]=-e.y,this.setViewportTransform(t)}relativePan(e){return this.absolutePan(new _(-e.x-this.viewportTransform[4],-e.y-this.viewportTransform[5]))}getElement(){return this.elements.lower.el}clearContext(e){e.clearRect(0,0,this.width,this.height)}getContext(){return this.elements.lower.ctx}clear(){this.remove(...this.getObjects()),this.backgroundImage=void 0,this.overlayImage=void 0,this.backgroundColor="",this.overlayColor="",this.clearContext(this.getContext()),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll()}renderAll(){this.cancelRequestedRender(),this.destroyed||this.renderCanvas(this.getContext(),this._objects)}renderAndReset(){this.nextRenderHandle=0,this.renderAll()}requestRenderAll(){this.nextRenderHandle||this.disposed||this.destroyed||(this.nextRenderHandle=Er((()=>this.renderAndReset())))}calcViewportBoundaries(){const e=this.width,t=this.height,s=ze(this.viewportTransform),r=Ce({x:0,y:0},s),i=Ce({x:e,y:t},s),a=r.min(i),o=r.max(i);return this.vptCoords={tl:a,tr:new _(o.x,a.y),bl:new _(a.x,o.y),br:o}}cancelRequestedRender(){this.nextRenderHandle&&(ql(this.nextRenderHandle),this.nextRenderHandle=0)}drawControls(e){}renderCanvas(e,t){if(this.destroyed)return;const s=this.viewportTransform,r=this.clipPath;this.calcViewportBoundaries(),this.clearContext(e),e.imageSmoothingEnabled=this.imageSmoothingEnabled,e.patternQuality="best",this.fire("before:render",{ctx:e}),this._renderBackground(e),e.save(),e.transform(s[0],s[1],s[2],s[3],s[4],s[5]),this._renderObjects(e,t),e.restore(),this.controlsAboveOverlay||this.skipControlsDrawing||this.drawControls(e),r&&(r._set("canvas",this),r.shouldCache(),r._transformDone=!0,r.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(e,r)),this._renderOverlay(e),this.controlsAboveOverlay&&!this.skipControlsDrawing&&this.drawControls(e),this.fire("after:render",{ctx:e}),this.__cleanupTask&&(this.__cleanupTask(),this.__cleanupTask=void 0)}drawClipPathOnCanvas(e,t){const s=this.viewportTransform;e.save(),e.transform(...s),e.globalCompositeOperation="destination-in",t.transform(e),e.scale(1/t.zoomX,1/t.zoomY),e.drawImage(t._cacheCanvas,-t.cacheTranslationX,-t.cacheTranslationY),e.restore()}_renderObjects(e,t){for(let s=0,r=t.length;s<r;++s)t[s]&&t[s].render(e)}_renderBackgroundOrOverlay(e,t){const s=this["".concat(t,"Color")],r=this["".concat(t,"Image")],i=this.viewportTransform,a=this["".concat(t,"Vpt")];if(!s&&!r)return;const o=Ae(s);if(s){if(e.save(),e.beginPath(),e.moveTo(0,0),e.lineTo(this.width,0),e.lineTo(this.width,this.height),e.lineTo(0,this.height),e.closePath(),e.fillStyle=o?s.toLive(e):s,a&&e.transform(...i),o){e.transform(1,0,0,1,s.offsetX||0,s.offsetY||0);const l=s.gradientTransform||s.patternTransform;l&&e.transform(...l)}e.fill(),e.restore()}if(r){e.save();const{skipOffscreen:l}=this;this.skipOffscreen=a,a&&e.transform(...i),r.render(e),this.skipOffscreen=l,e.restore()}}_renderBackground(e){this._renderBackgroundOrOverlay(e,"background")}_renderOverlay(e){this._renderBackgroundOrOverlay(e,"overlay")}getCenter(){return{top:this.height/2,left:this.width/2}}getCenterPoint(){return new _(this.width/2,this.height/2)}centerObjectH(e){return this._centerObject(e,new _(this.getCenterPoint().x,e.getCenterPoint().y))}centerObjectV(e){return this._centerObject(e,new _(e.getCenterPoint().x,this.getCenterPoint().y))}centerObject(e){return this._centerObject(e,this.getCenterPoint())}viewportCenterObject(e){return this._centerObject(e,this.getVpCenter())}viewportCenterObjectH(e){return this._centerObject(e,new _(this.getVpCenter().x,e.getCenterPoint().y))}viewportCenterObjectV(e){return this._centerObject(e,new _(e.getCenterPoint().x,this.getVpCenter().y))}getVpCenter(){return Ce(this.getCenterPoint(),ze(this.viewportTransform))}_centerObject(e,t){e.setXY(t,z,z),e.setCoords(),this.renderOnAddRemove&&this.requestRenderAll()}toDatalessJSON(e){return this.toDatalessObject(e)}toObject(e){return this._toObjectMethod("toObject",e)}toJSON(){return this.toObject()}toDatalessObject(e){return this._toObjectMethod("toDatalessObject",e)}_toObjectMethod(e,t){const s=this.clipPath,r=s&&!s.excludeFromExport?this._toObject(s,e,t):null;return v(v(v({version:Vi},us(this,t)),{},{objects:this._objects.filter((i=>!i.excludeFromExport)).map((i=>this._toObject(i,e,t)))},this.__serializeBgOverlay(e,t)),r?{clipPath:r}:null)}_toObject(e,t,s){let r;this.includeDefaultValues||(r=e.includeDefaultValues,e.includeDefaultValues=!1);const i=e[t](s);return this.includeDefaultValues||(e.includeDefaultValues=!!r),i}__serializeBgOverlay(e,t){const s={},r=this.backgroundImage,i=this.overlayImage,a=this.backgroundColor,o=this.overlayColor;return Ae(a)?a.excludeFromExport||(s.background=a.toObject(t)):a&&(s.background=a),Ae(o)?o.excludeFromExport||(s.overlay=o.toObject(t)):o&&(s.overlay=o),r&&!r.excludeFromExport&&(s.backgroundImage=this._toObject(r,e,t)),i&&!i.excludeFromExport&&(s.overlayImage=this._toObject(i,e,t)),s}toSVG(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;e.reviver=t;const s=[];return this._setSVGPreamble(s,e),this._setSVGHeader(s,e),this.clipPath&&s.push('<g clip-path="url(#'.concat(this.clipPath.clipPathId,`)" >
`)),this._setSVGBgOverlayColor(s,"background"),this._setSVGBgOverlayImage(s,"backgroundImage",t),this._setSVGObjects(s,t),this.clipPath&&s.push(`</g>
`),this._setSVGBgOverlayColor(s,"overlay"),this._setSVGBgOverlayImage(s,"overlayImage",t),s.push("</svg>"),s.join("")}_setSVGPreamble(e,t){t.suppressPreamble||e.push('<?xml version="1.0" encoding="',t.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)}_setSVGHeader(e,t){const s=t.width||"".concat(this.width),r=t.height||"".concat(this.height),i=U.NUM_FRACTION_DIGITS,a=t.viewBox;let o;if(a)o='viewBox="'.concat(a.x," ").concat(a.y," ").concat(a.width," ").concat(a.height,'" ');else if(this.svgViewportTransformation){const l=this.viewportTransform;o='viewBox="'.concat(J(-l[4]/l[0],i)," ").concat(J(-l[5]/l[3],i)," ").concat(J(this.width/l[0],i)," ").concat(J(this.height/l[3],i),'" ')}else o='viewBox="0 0 '.concat(this.width," ").concat(this.height,'" ');e.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',s,'" ','height="',r,'" ',o,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",Vi,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(t),`</defs>
`)}createSVGClipPathMarkup(e){const t=this.clipPath;return t?(t.clipPathId="CLIPPATH_".concat(St()),'<clipPath id="'.concat(t.clipPathId,`" >
`).concat(t.toClipPathSVG(e.reviver),`</clipPath>
`)):""}createSVGRefElementsMarkup(){return["background","overlay"].map((e=>{const t=this["".concat(e,"Color")];if(Ae(t)){const s=this["".concat(e,"Vpt")],r=this.viewportTransform,i={isType:()=>!1,width:this.width/(s?r[0]:1),height:this.height/(s?r[3]:1)};return t.toSVG(i,{additionalTransform:s?Rs(r):""})}})).join("")}createSVGFontFacesMarkup(){const e=[],t={},s=U.fontPaths;this._objects.forEach((function i(a){e.push(a),Ar(a)&&a._objects.forEach(i)})),e.forEach((i=>{if(!(a=i)||typeof a._renderText!="function")return;var a;const{styles:o,fontFamily:l}=i;!t[l]&&s[l]&&(t[l]=!0,o&&Object.values(o).forEach((c=>{Object.values(c).forEach((h=>{let{fontFamily:d=""}=h;!t[d]&&s[d]&&(t[d]=!0)}))})))}));const r=Object.keys(t).map((i=>`		@font-face {
			font-family: '`.concat(i,`';
			src: url('`).concat(s[i],`');
		}
`))).join("");return r?`	<style type="text/css"><![CDATA[
`.concat(r,`]]></style>
`):""}_setSVGObjects(e,t){this.forEachObject((s=>{s.excludeFromExport||this._setSVGObject(e,s,t)}))}_setSVGObject(e,t,s){e.push(t.toSVG(s))}_setSVGBgOverlayImage(e,t,s){const r=this[t];r&&!r.excludeFromExport&&r.toSVG&&e.push(r.toSVG(s))}_setSVGBgOverlayColor(e,t){const s=this["".concat(t,"Color")];if(s)if(Ae(s)){const r=s.repeat||"",i=this.width,a=this.height,o=this["".concat(t,"Vpt")]?Rs(ze(this.viewportTransform)):"";e.push('<rect transform="'.concat(o," translate(").concat(i/2,",").concat(a/2,')" x="').concat(s.offsetX-i/2,'" y="').concat(s.offsetY-a/2,'" width="').concat(r!=="repeat-y"&&r!=="no-repeat"||!Un(s)?i:s.source.width,'" height="').concat(r!=="repeat-x"&&r!=="no-repeat"||!Un(s)?a:s.source.height,'" fill="url(#SVGID_').concat(s.id,`)"></rect>
`))}else e.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',s,'"',`></rect>
`)}loadFromJSON(e,t){let{signal:s}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!e)return Promise.reject(new Je("`json` is undefined"));const r=typeof e=="string"?JSON.parse(e):e,{objects:i=[],backgroundImage:a,background:o,overlayImage:l,overlay:c,clipPath:h}=r,d=this.renderOnAddRemove;return this.renderOnAddRemove=!1,Promise.all([Fs(i,{reviver:t,signal:s}),oi({backgroundImage:a,backgroundColor:o,overlayImage:l,overlayColor:c,clipPath:h},{signal:s})]).then((u=>{let[g,f]=u;return this.clear(),this.add(...g),this.set(r),this.set(f),this.renderOnAddRemove=d,this}))}clone(e){const t=this.toObject(e);return this.cloneWithoutData().loadFromJSON(t)}cloneWithoutData(){const e=Pe(this);return new this.constructor(e)}toDataURL(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{format:t="png",quality:s=1,multiplier:r=1,enableRetinaScaling:i=!1}=e,a=r*(i?this.getRetinaScaling():1);return Ya(this.toCanvasElement(a,e),t,s)}toBlob(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{format:t="png",quality:s=1,multiplier:r=1,enableRetinaScaling:i=!1}=e,a=r*(i?this.getRetinaScaling():1);return Ua(this.toCanvasElement(a,e),t,s)}toCanvasElement(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,{width:t,height:s,left:r,top:i,filter:a}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o=(t||this.width)*e,l=(s||this.height)*e,c=this.getZoom(),h=this.width,d=this.height,u=this.skipControlsDrawing,g=c*e,f=this.viewportTransform,p=[g,0,0,g,(f[4]-(r||0))*e,(f[5]-(i||0))*e],y=this.enableRetinaScaling,x=Pe({width:o,height:l}),b=a?this._objects.filter((O=>a(O))):this._objects;return this.enableRetinaScaling=!1,this.viewportTransform=p,this.width=o,this.height=l,this.skipControlsDrawing=!0,this.calcViewportBoundaries(),this.renderCanvas(x.getContext("2d"),b),this.viewportTransform=f,this.width=h,this.height=d,this.calcViewportBoundaries(),this.enableRetinaScaling=y,this.skipControlsDrawing=u,x}dispose(){return!this.disposed&&this.elements.cleanupDOM({width:this.width,height:this.height}),Vr.cancelByCanvas(this),this.disposed=!0,new Promise(((e,t)=>{const s=()=>{this.destroy(),e(!0)};s.kill=t,this.__cleanupTask&&this.__cleanupTask.kill("aborted"),this.destroyed?e(!1):this.nextRenderHandle?this.__cleanupTask=s:s()}))}destroy(){this.destroyed=!0,this.cancelRequestedRender(),this.forEachObject((e=>e.dispose())),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose(),this.backgroundImage=void 0,this.overlayImage&&this.overlayImage.dispose(),this.overlayImage=void 0,this.elements.dispose()}toString(){return"#<Canvas (".concat(this.complexity(),"): { objects: ").concat(this._objects.length," }>")}}m(rr,"ownDefaults",tc);const sc=["touchstart","touchmove","touchend"],rc=n=>{const e=qa(n.target),t=(function(s){const r=s.changedTouches;return r&&r[0]?r[0]:s})(n);return new _(t.clientX+e.left,t.clientY+e.top)},Xi=n=>sc.includes(n.type)||n.pointerType==="touch",Hn=n=>{n.preventDefault(),n.stopPropagation()},dt=n=>{let e=0,t=0,s=0,r=0;for(let i=0,a=n.length;i<a;i++){const{x:o,y:l}=n[i];(o>s||!i)&&(s=o),(o<e||!i)&&(e=o),(l>r||!i)&&(r=l),(l<t||!i)&&(t=l)}return{left:e,top:t,width:s-e,height:r-t}},ic=["translateX","translateY","scaleX","scaleY"],nc=(n,e)=>Wr(n,pe(e,n.calcOwnMatrix())),Wr=(n,e)=>{const t=zr(e),{translateX:s,translateY:r,scaleX:i,scaleY:a}=t,o=Q(t,ic),l=new _(s,r);n.flipX=!1,n.flipY=!1,Object.assign(n,o),n.set({scaleX:i,scaleY:a}),n.setPositionByOrigin(l,z,z)},ac=n=>{n.scaleX=1,n.scaleY=1,n.skewX=0,n.skewY=0,n.flipX=!1,n.flipY=!1,n.rotate(0)},eo=n=>({scaleX:n.scaleX,scaleY:n.scaleY,skewX:n.skewX,skewY:n.skewY,angle:n.angle,left:n.left,flipX:n.flipX,flipY:n.flipY,top:n.top}),yn=(n,e,t)=>{const s=n/2,r=e/2,i=[new _(-s,-r),new _(s,-r),new _(-s,r),new _(s,r)].map((o=>o.transform(t))),a=dt(i);return new _(a.width,a.height)},li=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:_e;return pe(ze(arguments.length>1&&arguments[1]!==void 0?arguments[1]:_e),n)},Qt=function(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_e,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:_e;return n.transform(li(e,t))},oc=function(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_e,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:_e;return n.transform(li(e,t),!0)},lc=(n,e,t)=>{const s=li(e,t);return Wr(n,pe(s,n.calcOwnMatrix())),s},to=(n,e)=>{var t;const{transform:{target:s}}=e;(t=s.canvas)===null||t===void 0||t.fire("object:".concat(n),v(v({},e),{},{target:s})),s.fire(n,e)},cc={left:-.5,top:-.5,center:0,bottom:.5,right:.5},ne=n=>typeof n=="string"?cc[n]:n-.5,Xr="not-allowed";function so(n){return ne(n.originX)===ne(z)&&ne(n.originY)===ne(z)}function Zn(n){return .5-ne(n)}const Xe=(n,e)=>n[e],ro=(n,e,t,s)=>({e:n,transform:e,pointer:new _(t,s)});function io(n,e){const t=n.getTotalAngle()+mt(Math.atan2(e.y,e.x))+360;return Math.round(t%360/45)}function _n(n,e,t,s,r){var i;let{target:a,corner:o}=n;const l=a.controls[o],c=((i=a.canvas)===null||i===void 0?void 0:i.getZoom())||1,h=a.padding/c,d=(function(u,g,f,p){const y=u.getRelativeCenterPoint(),x=f!==void 0&&p!==void 0?u.translateToGivenOrigin(y,z,z,f,p):new _(u.left,u.top);return(u.angle?g.rotate(-re(u.angle),y):g).subtract(x)})(a,new _(s,r),e,t);return d.x>=h&&(d.x-=h),d.x<=-h&&(d.x+=h),d.y>=h&&(d.y-=h),d.y<=h&&(d.y+=h),d.x-=l.offsetX,d.y-=l.offsetY,d}const hc=(n,e,t,s)=>{const{target:r,offsetX:i,offsetY:a}=e,o=t-i,l=s-a,c=!Xe(r,"lockMovementX")&&r.left!==o,h=!Xe(r,"lockMovementY")&&r.top!==l;return c&&r.set(H,o),h&&r.set(Se,l),(c||h)&&to(Na,ro(n,e,t,s)),c||h},$n={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#0FF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000",blanchedalmond:"#FFEBCD",blue:"#00F",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#0FF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#F0F",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#0F0",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#F0F",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#639",red:"#F00",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFF",whitesmoke:"#F5F5F5",yellow:"#FF0",yellowgreen:"#9ACD32"},Si=(n,e,t)=>(t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+6*(e-n)*t:t<.5?e:t<2/3?n+(e-n)*(2/3-t)*6:n),qn=(n,e,t,s)=>{n/=255,e/=255,t/=255;const r=Math.max(n,e,t),i=Math.min(n,e,t);let a,o;const l=(r+i)/2;if(r===i)a=o=0;else{const c=r-i;switch(o=l>.5?c/(2-r-i):c/(r+i),r){case n:a=(e-t)/c+(e<t?6:0);break;case e:a=(t-n)/c+2;break;case t:a=(n-e)/c+4}a/=6}return[Math.round(360*a),Math.round(100*o),Math.round(100*l),s]},Kn=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"1";return parseFloat(n)/(n.endsWith("%")?100:1)},nr=n=>Math.min(Math.round(n),255).toString(16).toUpperCase().padStart(2,"0"),Jn=n=>{let[e,t,s,r=1]=n;const i=Math.round(.3*e+.59*t+.11*s);return[i,i,i,r]};class ${constructor(e){if(m(this,"isUnrecognised",!1),e)if(e instanceof $)this.setSource([...e._source]);else if(Array.isArray(e)){const[t,s,r,i=1]=e;this.setSource([t,s,r,i])}else this.setSource(this._tryParsingColor(e));else this.setSource([0,0,0,1])}_tryParsingColor(e){return(e=e.toLowerCase())in $n&&(e=$n[e]),e==="transparent"?[255,255,255,0]:$.sourceFromHex(e)||$.sourceFromRgb(e)||$.sourceFromHsl(e)||(this.isUnrecognised=!0)&&[0,0,0,1]}getSource(){return this._source}setSource(e){this._source=e}toRgb(){const[e,t,s]=this.getSource();return"rgb(".concat(e,",").concat(t,",").concat(s,")")}toRgba(){return"rgba(".concat(this.getSource().join(","),")")}toHsl(){const[e,t,s]=qn(...this.getSource());return"hsl(".concat(e,",").concat(t,"%,").concat(s,"%)")}toHsla(){const[e,t,s,r]=qn(...this.getSource());return"hsla(".concat(e,",").concat(t,"%,").concat(s,"%,").concat(r,")")}toHex(){return this.toHexa().slice(0,6)}toHexa(){const[e,t,s,r]=this.getSource();return"".concat(nr(e)).concat(nr(t)).concat(nr(s)).concat(nr(Math.round(255*r)))}getAlpha(){return this.getSource()[3]}setAlpha(e){return this._source[3]=e,this}toGrayscale(){return this.setSource(Jn(this.getSource())),this}toBlackWhite(e){const[t,,,s]=Jn(this.getSource()),r=t<(e||127)?0:255;return this.setSource([r,r,r,s]),this}overlayWith(e){e instanceof $||(e=new $(e));const t=this.getSource(),s=e.getSource(),[r,i,a]=t.map(((o,l)=>Math.round(.5*o+.5*s[l])));return this.setSource([r,i,a,t[3]]),this}static fromRgb(e){return $.fromRgba(e)}static fromRgba(e){return new $($.sourceFromRgb(e))}static sourceFromRgb(e){const t=e.match(/^rgba?\(\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d{0,3}(?:\.\d+)?%?)\s*)?\)$/i);if(t){const[s,r,i]=t.slice(1,4).map((a=>{const o=parseFloat(a);return a.endsWith("%")?Math.round(2.55*o):o}));return[s,r,i,Kn(t[4])]}}static fromHsl(e){return $.fromHsla(e)}static fromHsla(e){return new $($.sourceFromHsl(e))}static sourceFromHsl(e){const t=e.match(/^hsla?\(\s*([+-]?\d{0,3}(?:\.\d+)?(?:deg|turn|rad)?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d*(?:\.\d+)?%?)\s*)?\)$/i);if(!t)return;const s=($.parseAngletoDegrees(t[1])%360+360)%360/360,r=parseFloat(t[2])/100,i=parseFloat(t[3])/100;let a,o,l;if(r===0)a=o=l=i;else{const c=i<=.5?i*(r+1):i+r-i*r,h=2*i-c;a=Si(h,c,s+1/3),o=Si(h,c,s),l=Si(h,c,s-1/3)}return[Math.round(255*a),Math.round(255*o),Math.round(255*l),Kn(t[4])]}static fromHex(e){return new $($.sourceFromHex(e))}static sourceFromHex(e){if(e.match(/^#?(([0-9a-f]){3,4}|([0-9a-f]{2}){3,4})$/i)){const t=e.slice(e.indexOf("#")+1);let s;s=t.length<=4?t.split("").map((l=>l+l)):t.match(/.{2}/g);const[r,i,a,o=255]=s.map((l=>parseInt(l,16)));return[r,i,a,o/255]}}static parseAngletoDegrees(e){const t=e.toLowerCase(),s=parseFloat(t);return t.includes("rad")?mt(s):t.includes("turn")?360*s:s}}const es=function(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:un;const t=/\D{0,2}$/.exec(n),s=parseFloat(n),r=U.DPI;switch(t?.[0]){case"mm":return s*r/25.4;case"cm":return s*r/2.54;case"in":return s*r;case"pt":return s*r/72;case"pc":return s*r/72*12;case"em":return s*e;default:return s}},uc=n=>{const[e,t]=n.trim().split(" "),[s,r]=(i=e)&&i!==Te?[i.slice(1,4),i.slice(5,8)]:i===Te?[i,i]:["Mid","Mid"];var i;return{meetOrSlice:t||"meet",alignX:s,alignY:r}},Ls=function(n,e){let t,s,r=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];if(e)if(e.toLive)t="url(#SVGID_".concat(e.id,")");else{const i=new $(e),a=i.getAlpha();t=i.toRgb(),a!==1&&(s=a.toString())}else t="none";return r?"".concat(n,": ").concat(t,"; ").concat(s?"".concat(n,"-opacity: ").concat(s,"; "):""):"".concat(n,'="').concat(t,'" ').concat(s?"".concat(n,'-opacity="').concat(s,'" '):"")};class no{getSvgStyles(e){const t=this.fillRule?this.fillRule:"nonzero",s=this.strokeWidth?this.strokeWidth:"0",r=this.strokeDashArray?this.strokeDashArray.join(" "):Te,i=this.strokeDashOffset?this.strokeDashOffset:"0",a=this.strokeLineCap?this.strokeLineCap:"butt",o=this.strokeLineJoin?this.strokeLineJoin:"miter",l=this.strokeMiterLimit?this.strokeMiterLimit:"4",c=this.opacity!==void 0?this.opacity:"1",h=this.visible?"":" visibility: hidden;",d=e?"":this.getSvgFilter(),u=Ls(le,this.fill);return[Ls(Oe,this.stroke),"stroke-width: ",s,"; ","stroke-dasharray: ",r,"; ","stroke-linecap: ",a,"; ","stroke-dashoffset: ",i,"; ","stroke-linejoin: ",o,"; ","stroke-miterlimit: ",l,"; ",u,"fill-rule: ",t,"; ","opacity: ",c,";",d,h].join("")}getSvgFilter(){return this.shadow?"filter: url(#SVGID_".concat(this.shadow.id,");"):""}getSvgCommons(){return[this.id?'id="'.concat(this.id,'" '):"",this.clipPath?'clip-path="url(#'.concat(this.clipPath.clipPathId,')" '):""].join("")}getSvgTransform(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const s=e?this.calcTransformMatrix():this.calcOwnMatrix(),r='transform="'.concat(Rs(s));return"".concat(r).concat(t,'" ')}_toSVG(e){return[""]}toSVG(e){return this._createBaseSVGMarkup(this._toSVG(e),{reviver:e})}toClipPathSVG(e){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(e),{reviver:e})}_createBaseClipPathSVGMarkup(e){let{reviver:t,additionalTransform:s=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=[this.getSvgTransform(!0,s),this.getSvgCommons()].join(""),i=e.indexOf("COMMON_PARTS");return e[i]=r,t?t(e.join("")):e.join("")}_createBaseSVGMarkup(e){let{noStyle:t,reviver:s,withShadow:r,additionalTransform:i}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const a=t?"":'style="'.concat(this.getSvgStyles(),'" '),o=r?'style="'.concat(this.getSvgFilter(),'" '):"",l=this.clipPath,c=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",h=l&&l.absolutePositioned,d=this.stroke,u=this.fill,g=this.shadow,f=[],p=e.indexOf("COMMON_PARTS");let y;l&&(l.clipPathId="CLIPPATH_".concat(St()),y='<clipPath id="'.concat(l.clipPathId,`" >
`).concat(l.toClipPathSVG(s),`</clipPath>
`)),h&&f.push("<g ",o,this.getSvgCommons(),` >
`),f.push("<g ",this.getSvgTransform(!1),h?"":o+this.getSvgCommons(),` >
`);const x=[a,c,t?"":this.addPaintOrder()," ",i?'transform="'.concat(i,'" '):""].join("");return e[p]=x,Ae(u)&&f.push(u.toSVG(this)),Ae(d)&&f.push(d.toSVG(this)),g&&f.push(g.toSVG(this)),l&&f.push(y),f.push(e.join("")),f.push(`</g>
`),h&&f.push(`</g>
`),s?s(f.join("")):f.join("")}addPaintOrder(){return this.paintFirst!==le?' paint-order="'.concat(this.paintFirst,'" '):""}}function ci(n){return new RegExp("^("+n.join("|")+")\\b","i")}const Nt="textDecorationThickness",ao=["fontSize","fontWeight","fontFamily","fontStyle"],oo=["underline","overline","linethrough"],lo=[...ao,"lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],co=[...lo,...oo,"textBackgroundColor","direction",Nt],dc=[...ao,...oo,Oe,"strokeWidth",le,"deltaY","textBackgroundColor",Nt],gc={_reNewline:dn,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:H,fontStyle:"normal",lineHeight:1.16,textBackgroundColor:"",stroke:null,shadow:null,path:void 0,pathStartOffset:0,pathSide:H,pathAlign:"baseline",charSpacing:0,deltaY:0,direction:"ltr",CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.28167,overline:-.81333},_fontSizeMult:1.13,[Nt]:66.667},Ke="justify",Yr="justify-left",Ms="justify-right",As="justify-center";var Qn,ea,ta;const We=String.raw(Qn||(Qn=rt(["[-+]?(?:d*.d+|d+.?)(?:[eE][-+]?d+)?"],["[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?"]))),Ti=String.raw(ea||(ea=rt(["(?:s*,?s+|s*,s*)"],["(?:\\s*,?\\s+|\\s*,\\s*)"]))),fc=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+We+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+We+"))?\\s+(.*)"),pc={cx:H,x:H,r:"radius",cy:Se,y:Se,display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing","text-decoration-thickness":Nt},Oi="font-size",ki="clip-path";ci(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]);ci(["symbol","image","marker","pattern","view","svg"]);const sa=ci(["symbol","g","a","svg","clipPath","defs"]);new RegExp(String.raw(ta||(ta=rt(["^s*(",")","(",")","(",")","(",")s*$"],["^\\s*(",")","(",")","(",")","(",")\\s*$"])),We,Ti,We,Ti,We,Ti,We));const mc=new _(1,0),ho=new _,uo=(n,e)=>n.rotate(e),Yi=(n,e)=>new _(e).subtract(n),Ui=n=>n.distanceFrom(ho),Gi=(n,e)=>Math.atan2(Es(n,e),yc(n,e)),vc=n=>Gi(mc,n),xn=n=>n.eq(ho)?n:n.scalarDivide(Ui(n)),go=function(n){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return xn(new _(-n.y,n.x).scalarMultiply(e?1:-1))},Es=(n,e)=>n.x*e.y-n.y*e.x,yc=(n,e)=>n.x*e.x+n.y*e.y,ra=(n,e,t)=>{if(n.eq(e)||n.eq(t))return!0;const s=Es(e,t),r=Es(e,n),i=Es(t,n);return s>=0?r>=0&&i<=0:!(r<=0&&i>=0)},ia="(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?",na=new RegExp("(?:\\s|^)"+ia+ia+"("+We+"?(?:px)?)?(?:\\s?|$)(?:$|\\s)");class Qe{constructor(e){const t=typeof e=="string"?Qe.parseShadow(e):e;Object.assign(this,Qe.ownDefaults,t),this.id=St()}static parseShadow(e){const t=e.trim(),[,s=0,r=0,i=0]=(na.exec(t)||[]).map((a=>parseFloat(a)||0));return{color:(t.replace(na,"")||"rgb(0,0,0)").trim(),offsetX:s,offsetY:r,blur:i}}toString(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")}toSVG(e){const t=uo(new _(this.offsetX,this.offsetY),re(-e.angle)),s=new $(this.color);let r=40,i=40;return e.width&&e.height&&(r=100*J((Math.abs(t.x)+this.blur)/e.width,U.NUM_FRACTION_DIGITS)+20,i=100*J((Math.abs(t.y)+this.blur)/e.height,U.NUM_FRACTION_DIGITS)+20),e.flipX&&(t.x*=-1),e.flipY&&(t.y*=-1),'<filter id="SVGID_'.concat(this.id,'" y="-').concat(i,'%" height="').concat(100+2*i,'%" x="-').concat(r,'%" width="').concat(100+2*r,`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`).concat(J(this.blur?this.blur/2:0,U.NUM_FRACTION_DIGITS),`"></feGaussianBlur>
	<feOffset dx="`).concat(J(t.x,U.NUM_FRACTION_DIGITS),'" dy="').concat(J(t.y,U.NUM_FRACTION_DIGITS),`" result="oBlur" ></feOffset>
	<feFlood flood-color="`).concat(s.toRgb(),'" flood-opacity="').concat(s.getAlpha(),`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`)}toObject(){const e={color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling,type:this.constructor.type},t=Qe.ownDefaults;return this.includeDefaultValues?e:vn(e,((s,r)=>s!==t[r]))}static async fromObject(e){return new this(e)}}m(Qe,"ownDefaults",{color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1}),m(Qe,"type","shadow"),A.setClass(Qe,"shadow");const ss=(n,e,t)=>Math.max(n,Math.min(e,t)),_c=[Se,H,ke,Ee,"flipX","flipY","originX","originY","angle","opacity","globalCompositeOperation","shadow","visible",ls,cs],yt=[le,Oe,"strokeWidth","strokeDashArray","width","height","paintFirst","strokeUniform","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","backgroundColor","clipPath"],xc={top:0,left:0,width:0,height:0,angle:0,flipX:!1,flipY:!1,scaleX:1,scaleY:1,minScaleLimit:0,skewX:0,skewY:0,originX:H,originY:Se,strokeWidth:1,strokeUniform:!1,padding:0,opacity:1,paintFirst:le,fill:"rgb(0,0,0)",fillRule:"nonzero",stroke:null,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,globalCompositeOperation:"source-over",backgroundColor:"",shadow:null,visible:!0,includeDefaultValues:!0,excludeFromExport:!1,objectCaching:!0,clipPath:void 0,inverted:!1,absolutePositioned:!1,centeredRotation:!0,centeredScaling:!1,dirty:!0},bc=(n,e,t,s)=>-t*Math.cos(n/s*tr)+t+e,wc=()=>!1;class bn{constructor(e){let{startValue:t,byValue:s,duration:r=500,delay:i=0,easing:a=bc,onStart:o=Mr,onChange:l=Mr,onComplete:c=Mr,abort:h=wc,target:d}=e;m(this,"_state","pending"),m(this,"durationProgress",0),m(this,"valueProgress",0),this.tick=this.tick.bind(this),this.duration=r,this.delay=i,this.easing=a,this._onStart=o,this._onChange=l,this._onComplete=c,this._abort=h,this.target=d,this.startValue=t,this.byValue=s,this.value=this.startValue,this.endValue=Object.freeze(this.calculate(this.duration).value)}get state(){return this._state}isDone(){return this._state==="aborted"||this._state==="completed"}start(){const e=t=>{this._state==="pending"&&(this.startTime=t||+new Date,this._state="running",this._onStart(),this.tick(this.startTime))};this.register(),this.delay>0?setTimeout((()=>Er(e)),this.delay):Er(e)}tick(e){const t=(e||+new Date)-this.startTime,s=Math.min(t,this.duration);this.durationProgress=s/this.duration;const{value:r,valueProgress:i}=this.calculate(s);this.value=Object.freeze(r),this.valueProgress=i,this._state!=="aborted"&&(this._abort(this.value,this.valueProgress,this.durationProgress)?(this._state="aborted",this.unregister()):t>=this.duration?(this.durationProgress=this.valueProgress=1,this._onChange(this.endValue,this.valueProgress,this.durationProgress),this._state="completed",this._onComplete(this.endValue,this.valueProgress,this.durationProgress),this.unregister()):(this._onChange(this.value,this.valueProgress,this.durationProgress),Er(this.tick)))}register(){Vr.push(this)}unregister(){Vr.remove(this)}abort(){this._state="aborted",this.unregister()}}const Cc=["startValue","endValue"];class Sc extends bn{constructor(e){let{startValue:t=0,endValue:s=100}=e;super(v(v({},Q(e,Cc)),{},{startValue:t,byValue:s-t}))}calculate(e){const t=this.easing(e,this.startValue,this.byValue,this.duration);return{value:t,valueProgress:Math.abs((t-this.startValue)/this.byValue)}}}const Tc=["startValue","endValue"];class Oc extends bn{constructor(e){let{startValue:t=[0],endValue:s=[100]}=e;super(v(v({},Q(e,Tc)),{},{startValue:t,byValue:s.map(((r,i)=>r-t[i]))}))}calculate(e){const t=this.startValue.map(((s,r)=>this.easing(e,s,this.byValue[r],this.duration,r)));return{value:t,valueProgress:Math.abs((t[0]-this.startValue[0])/this.byValue[0])}}}const kc=["startValue","endValue","easing","onChange","onComplete","abort"],Dc=(n,e,t,s)=>e+t*(1-Math.cos(n/s*tr)),Di=n=>n&&((e,t,s)=>n(new $(e).toRgba(),t,s));class jc extends bn{constructor(e){let{startValue:t,endValue:s,easing:r=Dc,onChange:i,onComplete:a,abort:o}=e,l=Q(e,kc);const c=new $(t).getSource(),h=new $(s).getSource();super(v(v({},l),{},{startValue:c,byValue:h.map(((d,u)=>d-c[u])),easing:r,onChange:Di(i),onComplete:Di(a),abort:Di(o)}))}calculate(e){const[t,s,r,i]=this.startValue.map(((o,l)=>this.easing(e,o,this.byValue[l],this.duration,l))),a=[...[t,s,r].map(Math.round),ss(0,i,1)];return{value:a,valueProgress:a.map(((o,l)=>this.byValue[l]!==0?Math.abs((o-this.startValue[l])/this.byValue[l]):0)).find((o=>o!==0))||0}}}function fo(n){const e=(t=>Array.isArray(t.startValue)||Array.isArray(t.endValue))(n)?new Oc(n):new Sc(n);return e.start(),e}function Mc(n){const e=new jc(n);return e.start(),e}class ee{constructor(e){this.status=e,this.points=[]}includes(e){return this.points.some((t=>t.eq(e)))}append(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return this.points=this.points.concat(t.filter((r=>!this.includes(r)))),this}static isPointContained(e,t,s){let r=arguments.length>3&&arguments[3]!==void 0&&arguments[3];if(t.eq(s))return e.eq(t);if(t.x===s.x)return e.x===t.x&&(r||e.y>=Math.min(t.y,s.y)&&e.y<=Math.max(t.y,s.y));if(t.y===s.y)return e.y===t.y&&(r||e.x>=Math.min(t.x,s.x)&&e.x<=Math.max(t.x,s.x));{const i=Yi(t,s),a=Yi(t,e).divide(i);return r?Math.abs(a.x)===Math.abs(a.y):a.x===a.y&&a.x>=0&&a.x<=1}}static isPointInPolygon(e,t){const s=new _(e).setX(Math.min(e.x-1,...t.map((i=>i.x))));let r=0;for(let i=0;i<t.length;i++){const a=this.intersectSegmentSegment(t[i],t[(i+1)%t.length],e,s);if(a.includes(e))return!0;r+=+(a.status==="Intersection")}return r%2==1}static intersectLineLine(e,t,s,r){let i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4],a=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5];const o=t.x-e.x,l=t.y-e.y,c=r.x-s.x,h=r.y-s.y,d=e.x-s.x,u=e.y-s.y,g=c*u-h*d,f=o*u-l*d,p=h*o-c*l;if(p!==0){const y=g/p,x=f/p;return(i||0<=y&&y<=1)&&(a||0<=x&&x<=1)?new ee("Intersection").append(new _(e.x+y*o,e.y+y*l)):new ee}if(g===0||f===0){const y=i||a||ee.isPointContained(e,s,r)||ee.isPointContained(t,s,r)||ee.isPointContained(s,e,t)||ee.isPointContained(r,e,t);return new ee(y?"Coincident":void 0)}return new ee("Parallel")}static intersectSegmentLine(e,t,s,r){return ee.intersectLineLine(e,t,s,r,!1,!0)}static intersectSegmentSegment(e,t,s,r){return ee.intersectLineLine(e,t,s,r,!1,!1)}static intersectLinePolygon(e,t,s){let r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];const i=new ee,a=s.length;for(let o,l,c,h=0;h<a;h++){if(o=s[h],l=s[(h+1)%a],c=ee.intersectLineLine(e,t,o,l,r,!1),c.status==="Coincident")return c;i.append(...c.points)}return i.points.length>0&&(i.status="Intersection"),i}static intersectSegmentPolygon(e,t,s){return ee.intersectLinePolygon(e,t,s,!1)}static intersectPolygonPolygon(e,t){const s=new ee,r=e.length,i=[];for(let a=0;a<r;a++){const o=e[a],l=e[(a+1)%r],c=ee.intersectSegmentPolygon(o,l,t);c.status==="Coincident"?(i.push(c),s.append(o,l)):s.append(...c.points)}return i.length>0&&i.length===e.length?new ee("Coincident"):(s.points.length>0&&(s.status="Intersection"),s)}static intersectPolygonRectangle(e,t,s){const r=t.min(s),i=t.max(s),a=new _(i.x,r.y),o=new _(r.x,i.y);return ee.intersectPolygonPolygon(e,[r,a,i,o])}}class Ac extends Xa{getX(){return this.getXY().x}setX(e){this.setXY(this.getXY().setX(e))}getY(){return this.getXY().y}setY(e){this.setXY(this.getXY().setY(e))}getRelativeX(){return this.left}setRelativeX(e){this.left=e}getRelativeY(){return this.top}setRelativeY(e){this.top=e}getXY(){const e=this.getRelativeXY();return this.group?Ce(e,this.group.calcTransformMatrix()):e}setXY(e,t,s){this.group&&(e=Ce(e,ze(this.group.calcTransformMatrix()))),this.setRelativeXY(e,t,s)}getRelativeXY(){return new _(this.left,this.top)}setRelativeXY(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.originX,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.originY;this.setPositionByOrigin(e,t,s)}isStrokeAccountedForInDimensions(){return!1}getCoords(){const{tl:e,tr:t,br:s,bl:r}=this.aCoords||(this.aCoords=this.calcACoords()),i=[e,t,s,r];if(this.group){const a=this.group.calcTransformMatrix();return i.map((o=>Ce(o,a)))}return i}intersectsWithRect(e,t){return ee.intersectPolygonRectangle(this.getCoords(),e,t).status==="Intersection"}intersectsWithObject(e){const t=ee.intersectPolygonPolygon(this.getCoords(),e.getCoords());return t.status==="Intersection"||t.status==="Coincident"||e.isContainedWithinObject(this)||this.isContainedWithinObject(e)}isContainedWithinObject(e){return this.getCoords().every((t=>e.containsPoint(t)))}isContainedWithinRect(e,t){const{left:s,top:r,width:i,height:a}=this.getBoundingRect();return s>=e.x&&s+i<=t.x&&r>=e.y&&r+a<=t.y}isOverlapping(e){return this.intersectsWithObject(e)||this.isContainedWithinObject(e)||e.isContainedWithinObject(this)}containsPoint(e){return ee.isPointInPolygon(e,this.getCoords())}isOnScreen(){if(!this.canvas)return!1;const{tl:e,br:t}=this.canvas.vptCoords;return!!this.getCoords().some((s=>s.x<=t.x&&s.x>=e.x&&s.y<=t.y&&s.y>=e.y))||!!this.intersectsWithRect(e,t)||this.containsPoint(e.midPointFrom(t))}isPartiallyOnScreen(){if(!this.canvas)return!1;const{tl:e,br:t}=this.canvas.vptCoords;return this.intersectsWithRect(e,t)?!0:this.getCoords().every((s=>(s.x>=t.x||s.x<=e.x)&&(s.y>=t.y||s.y<=e.y)))&&this.containsPoint(e.midPointFrom(t))}getBoundingRect(){return dt(this.getCoords())}getScaledWidth(){return this._getTransformedDimensions().x}getScaledHeight(){return this._getTransformedDimensions().y}scale(e){this._set(ke,e),this._set(Ee,e),this.setCoords()}scaleToWidth(e){const t=this.getBoundingRect().width/this.getScaledWidth();return this.scale(e/this.width/t)}scaleToHeight(e){const t=this.getBoundingRect().height/this.getScaledHeight();return this.scale(e/this.height/t)}getCanvasRetinaScaling(){var e;return((e=this.canvas)===null||e===void 0?void 0:e.getRetinaScaling())||1}getTotalAngle(){return this.group?mt(Ga(this.calcTransformMatrix())):this.angle}getViewportTransform(){var e;return((e=this.canvas)===null||e===void 0?void 0:e.viewportTransform)||_e.concat()}calcACoords(){const e=hs({angle:this.angle}),{x:t,y:s}=this.getRelativeCenterPoint(),r=sr(t,s),i=pe(r,e),a=this._getTransformedDimensions(),o=a.x/2,l=a.y/2;return{tl:Ce({x:-o,y:-l},i),tr:Ce({x:o,y:-l},i),bl:Ce({x:-o,y:l},i),br:Ce({x:o,y:l},i)}}setCoords(){this.aCoords=this.calcACoords()}transformMatrixKey(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],t=[];return!e&&this.group&&(t=this.group.transformMatrixKey(e)),t.push(this.top,this.left,this.width,this.height,this.scaleX,this.scaleY,this.angle,this.strokeWidth,this.skewX,this.skewY,+this.flipX,+this.flipY,ne(this.originX),ne(this.originY)),t}calcTransformMatrix(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],t=this.calcOwnMatrix();if(e||!this.group)return t;const s=this.transformMatrixKey(e),r=this.matrixCache;return r&&r.key.every(((i,a)=>i===s[a]))?r.value:(this.group&&(t=pe(this.group.calcTransformMatrix(!1),t)),this.matrixCache={key:s,value:t},t)}calcOwnMatrix(){const e=this.transformMatrixKey(!0),t=this.ownMatrixCache;if(t&&t.key===e)return t.value;const s=this.getRelativeCenterPoint(),r={angle:this.angle,translateX:s.x,translateY:s.y,scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY},i=ec(r);return this.ownMatrixCache={key:e,value:i},i}_getNonTransformedDimensions(){return new _(this.width,this.height).scalarAdd(this.strokeWidth)}_calculateCurrentDimensions(e){return this._getTransformedDimensions(e).transform(this.getViewportTransform(),!0).scalarAdd(2*this.padding)}_getTransformedDimensions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=v({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,width:this.width,height:this.height,strokeWidth:this.strokeWidth},e),s=t.strokeWidth;let r=s,i=0;this.strokeUniform&&(r=0,i=s);const a=t.width+r,o=t.height+r;let l;return l=t.skewX===0&&t.skewY===0?new _(a*t.scaleX,o*t.scaleY):yn(a,o,ai(t)),l.scalarAdd(i)}translateToGivenOrigin(e,t,s,r,i){let a=e.x,o=e.y;const l=ne(r)-ne(t),c=ne(i)-ne(s);if(l||c){const h=this._getTransformedDimensions();a+=l*h.x,o+=c*h.y}return new _(a,o)}translateToCenterPoint(e,t,s){if(t===z&&s===z)return e;const r=this.translateToGivenOrigin(e,t,s,z,z);return this.angle?r.rotate(re(this.angle),e):r}translateToOriginPoint(e,t,s){const r=this.translateToGivenOrigin(e,z,z,t,s);return this.angle?r.rotate(re(this.angle),e):r}getCenterPoint(){const e=this.getRelativeCenterPoint();return this.group?Ce(e,this.group.calcTransformMatrix()):e}getRelativeCenterPoint(){return this.translateToCenterPoint(new _(this.left,this.top),this.originX,this.originY)}getPointByOrigin(e,t){return this.translateToOriginPoint(this.getRelativeCenterPoint(),e,t)}setPositionByOrigin(e,t,s){const r=this.translateToCenterPoint(e,t,s),i=this.translateToOriginPoint(r,this.originX,this.originY);this.set({left:i.x,top:i.y})}_getLeftTopCoords(){return this.translateToOriginPoint(this.getRelativeCenterPoint(),H,Se)}}const Ec=["type"],Pc=["extraParam"];let nt=class Fr extends Ac{static getDefaults(){return Fr.ownDefaults}get type(){const e=this.constructor.type;return e==="FabricObject"?"object":e.toLowerCase()}set type(e){Ct("warn","Setting type has no effect",e)}constructor(e){super(),m(this,"_cacheContext",null),Object.assign(this,Fr.ownDefaults),this.setOptions(e)}_createCacheCanvas(){this._cacheCanvas=pt(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0}_limitCacheSize(e){const t=e.width,s=e.height,r=U.maxCacheSideLimit,i=U.minCacheSideLimit;if(t<=r&&s<=r&&t*s<=U.perfLimitSizeTotal)return t<i&&(e.width=i),s<i&&(e.height=i),e;const a=t/s,[o,l]=js.limitDimsByArea(a),c=ss(i,o,r),h=ss(i,l,r);return t>c&&(e.zoomX/=t/c,e.width=c,e.capped=!0),s>h&&(e.zoomY/=s/h,e.height=h,e.capped=!0),e}_getCacheCanvasDimensions(){const e=this.getTotalObjectScaling(),t=this._getTransformedDimensions({skewX:0,skewY:0}),s=t.x*e.x/this.scaleX,r=t.y*e.y/this.scaleY;return{width:Math.ceil(s+2),height:Math.ceil(r+2),zoomX:e.x,zoomY:e.y,x:s,y:r}}_updateCacheCanvas(){const e=this._cacheCanvas,t=this._cacheContext,{width:s,height:r,zoomX:i,zoomY:a,x:o,y:l}=this._limitCacheSize(this._getCacheCanvasDimensions()),c=s!==e.width||r!==e.height,h=this.zoomX!==i||this.zoomY!==a;if(!e||!t)return!1;if(c||h){s!==e.width||r!==e.height?(e.width=s,e.height=r):(t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height));const d=o/2,u=l/2;return this.cacheTranslationX=Math.round(e.width/2-d)+d,this.cacheTranslationY=Math.round(e.height/2-u)+u,t.translate(this.cacheTranslationX,this.cacheTranslationY),t.scale(i,a),this.zoomX=i,this.zoomY=a,!0}return!1}setOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setOptions(e)}transform(e){const t=this.group&&!this.group._transformDone||this.group&&this.canvas&&e===this.canvas.contextTop,s=this.calcTransformMatrix(!t);e.transform(s[0],s[1],s[2],s[3],s[4],s[5])}getObjectScaling(){if(!this.group)return new _(Math.abs(this.scaleX),Math.abs(this.scaleY));const e=zr(this.calcTransformMatrix());return new _(Math.abs(e.scaleX),Math.abs(e.scaleY))}getTotalObjectScaling(){const e=this.getObjectScaling();if(this.canvas){const t=this.canvas.getZoom(),s=this.getCanvasRetinaScaling();return e.scalarMultiply(t*s)}return e}getObjectOpacity(){let e=this.opacity;return this.group&&(e*=this.group.getObjectOpacity()),e}_constrainScale(e){return Math.abs(e)<this.minScaleLimit?e<0?-this.minScaleLimit:this.minScaleLimit:e===0?1e-4:e}_set(e,t){e!==ke&&e!==Ee||(t=this._constrainScale(t)),e===ke&&t<0?(this.flipX=!this.flipX,t*=-1):e==="scaleY"&&t<0?(this.flipY=!this.flipY,t*=-1):e!=="shadow"||!t||t instanceof Qe||(t=new Qe(t));const s=this[e]!==t;return this[e]=t,s&&this.constructor.cacheProperties.includes(e)&&(this.dirty=!0),this.parent&&(this.dirty||s&&this.constructor.stateProperties.includes(e))&&this.parent._set("dirty",!0),this}isNotVisible(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible}render(e){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(e.save(),this._setupCompositeOperation(e),this.drawSelectionBackground(e),this.transform(e),this._setOpacity(e),this._setShadow(e),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(e)):(this._removeCacheCanvas(),this.drawObject(e,!1,{}),this.dirty=!1),e.restore())}drawSelectionBackground(e){}renderCache(e){if(e=e||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&this._cacheContext){const{zoomX:t,zoomY:s,cacheTranslationX:r,cacheTranslationY:i}=this,{width:a,height:o}=this._cacheCanvas;this.drawObject(this._cacheContext,e.forClipping,{zoomX:t,zoomY:s,cacheTranslationX:r,cacheTranslationY:i,width:a,height:o,parentClipPaths:[]}),this.dirty=!1}}_removeCacheCanvas(){this._cacheCanvas=void 0,this._cacheContext=null}hasStroke(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0}hasFill(){return this.fill&&this.fill!=="transparent"}needsItsOwnCache(){return!!(this.paintFirst===Oe&&this.hasFill()&&this.hasStroke()&&this.shadow)||!!this.clipPath}shouldCache(){return this.ownCaching=this.objectCaching&&(!this.parent||!this.parent.isOnACache())||this.needsItsOwnCache(),this.ownCaching}willDrawShadow(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)}drawClipPathOnCache(e,t,s){e.save(),t.inverted?e.globalCompositeOperation="destination-out":e.globalCompositeOperation="destination-in",e.setTransform(1,0,0,1,0,0),e.drawImage(s,0,0),e.restore()}drawObject(e,t,s){const r=this.fill,i=this.stroke;t?(this.fill="black",this.stroke="",this._setClippingProperties(e)):this._renderBackground(e),this._render(e),this._drawClipPath(e,this.clipPath,s),this.fill=r,this.stroke=i}createClipPathLayer(e,t){const s=Pe(t),r=s.getContext("2d");if(r.translate(t.cacheTranslationX,t.cacheTranslationY),r.scale(t.zoomX,t.zoomY),e._cacheCanvas=s,t.parentClipPaths.forEach((i=>{i.transform(r)})),t.parentClipPaths.push(e),e.absolutePositioned){const i=ze(this.calcTransformMatrix());r.transform(i[0],i[1],i[2],i[3],i[4],i[5])}return e.transform(r),e.drawObject(r,!0,t),s}_drawClipPath(e,t,s){if(!t)return;t._transformDone=!0;const r=this.createClipPathLayer(t,s);this.drawClipPathOnCache(e,t,r)}drawCacheOnCanvas(e){e.scale(1/this.zoomX,1/this.zoomY),e.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)}isCacheDirty(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];if(this.isNotVisible())return!1;const t=this._cacheCanvas,s=this._cacheContext;return!(!t||!s||e||!this._updateCacheCanvas())||!!(this.dirty||this.clipPath&&this.clipPath.absolutePositioned)&&(t&&s&&!e&&(s.save(),s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,t.width,t.height),s.restore()),!0)}_renderBackground(e){if(!this.backgroundColor)return;const t=this._getNonTransformedDimensions();e.fillStyle=this.backgroundColor,e.fillRect(-t.x/2,-t.y/2,t.x,t.y),this._removeShadow(e)}_setOpacity(e){this.group&&!this.group._transformDone?e.globalAlpha=this.getObjectOpacity():e.globalAlpha*=this.opacity}_setStrokeStyles(e,t){const s=t.stroke;s&&(e.lineWidth=t.strokeWidth,e.lineCap=t.strokeLineCap,e.lineDashOffset=t.strokeDashOffset,e.lineJoin=t.strokeLineJoin,e.miterLimit=t.strokeMiterLimit,Ae(s)?s.gradientUnits==="percentage"||s.gradientTransform||s.patternTransform?this._applyPatternForTransformedGradient(e,s):(e.strokeStyle=s.toLive(e),this._applyPatternGradientTransform(e,s)):e.strokeStyle=t.stroke)}_setFillStyles(e,t){let{fill:s}=t;s&&(Ae(s)?(e.fillStyle=s.toLive(e),this._applyPatternGradientTransform(e,s)):e.fillStyle=s)}_setClippingProperties(e){e.globalAlpha=1,e.strokeStyle="transparent",e.fillStyle="#000000"}_setLineDash(e,t){t&&t.length!==0&&e.setLineDash(t)}_setShadow(e){if(!this.shadow)return;const t=this.shadow,s=this.canvas,r=this.getCanvasRetinaScaling(),[i,,,a]=s?.viewportTransform||_e,o=i*r,l=a*r,c=t.nonScaling?new _(1,1):this.getObjectScaling();e.shadowColor=t.color,e.shadowBlur=t.blur*U.browserShadowBlurConstant*(o+l)*(c.x+c.y)/4,e.shadowOffsetX=t.offsetX*o*c.x,e.shadowOffsetY=t.offsetY*l*c.y}_removeShadow(e){this.shadow&&(e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0)}_applyPatternGradientTransform(e,t){if(!Ae(t))return{offsetX:0,offsetY:0};const s=t.gradientTransform||t.patternTransform,r=-this.width/2+t.offsetX||0,i=-this.height/2+t.offsetY||0;return t.gradientUnits==="percentage"?e.transform(this.width,0,0,this.height,r,i):e.transform(1,0,0,1,r,i),s&&e.transform(s[0],s[1],s[2],s[3],s[4],s[5]),{offsetX:r,offsetY:i}}_renderPaintInOrder(e){this.paintFirst===Oe?(this._renderStroke(e),this._renderFill(e)):(this._renderFill(e),this._renderStroke(e))}_render(e){}_renderFill(e){this.fill&&(e.save(),this._setFillStyles(e,this),this.fillRule==="evenodd"?e.fill("evenodd"):e.fill(),e.restore())}_renderStroke(e){if(this.stroke&&this.strokeWidth!==0){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this.strokeUniform){const t=this.getObjectScaling();e.scale(1/t.x,1/t.y)}this._setLineDash(e,this.strokeDashArray),this._setStrokeStyles(e,this),e.stroke(),e.restore()}}_applyPatternForTransformedGradient(e,t){var s;const r=this._limitCacheSize(this._getCacheCanvasDimensions()),i=this.getCanvasRetinaScaling(),a=r.x/this.scaleX/i,o=r.y/this.scaleY/i,l=Pe({width:Math.ceil(a),height:Math.ceil(o)}),c=l.getContext("2d");c&&(c.beginPath(),c.moveTo(0,0),c.lineTo(a,0),c.lineTo(a,o),c.lineTo(0,o),c.closePath(),c.translate(a/2,o/2),c.scale(r.zoomX/this.scaleX/i,r.zoomY/this.scaleY/i),this._applyPatternGradientTransform(c,t),c.fillStyle=t.toLive(e),c.fill(),e.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),e.scale(i*this.scaleX/r.zoomX,i*this.scaleY/r.zoomY),e.strokeStyle=(s=c.createPattern(l,"no-repeat"))!==null&&s!==void 0?s:"")}_findCenterFromElement(){return new _(this.left+this.width/2,this.top+this.height/2)}clone(e){const t=this.toObject(e);return this.constructor.fromObject(t)}cloneAsImage(e){const t=this.toCanvasElement(e);return new(A.getClass("image"))(t)}toCanvasElement(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=eo(this),s=this.group,r=this.shadow,i=Math.abs,a=e.enableRetinaScaling?Ba():1,o=(e.multiplier||1)*a,l=e.canvasProvider||(b=>new rr(b,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1}));delete this.group,e.withoutTransform&&ac(this),e.withoutShadow&&(this.shadow=null),e.viewportTransform&&lc(this,this.getViewportTransform()),this.setCoords();const c=pt(),h=this.getBoundingRect(),d=this.shadow,u=new _;if(d){const b=d.blur,O=d.nonScaling?new _(1,1):this.getObjectScaling();u.x=2*Math.round(i(d.offsetX)+b)*i(O.x),u.y=2*Math.round(i(d.offsetY)+b)*i(O.y)}const g=h.width+u.x,f=h.height+u.y;c.width=Math.ceil(g),c.height=Math.ceil(f);const p=l(c);e.format==="jpeg"&&(p.backgroundColor="#fff"),this.setPositionByOrigin(new _(p.width/2,p.height/2),z,z);const y=this.canvas;p._objects=[this],this.set("canvas",p),this.setCoords();const x=p.toCanvasElement(o||1,e);return this.set("canvas",y),this.shadow=r,s&&(this.group=s),this.set(t),this.setCoords(),p._objects=[],p.destroy(),x}toDataURL(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Ya(this.toCanvasElement(e),e.format||"png",e.quality||1)}toBlob(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Ua(this.toCanvasElement(e),e.format||"png",e.quality||1)}isType(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.includes(this.constructor.type)||t.includes(this.type)}complexity(){return 1}toJSON(){return this.toObject()}rotate(e){const{centeredRotation:t,originX:s,originY:r}=this;if(t){const{x:i,y:a}=this.getRelativeCenterPoint();this.originX=z,this.originY=z,this.left=i,this.top=a}if(this.set("angle",e),t){const{x:i,y:a}=this.translateToOriginPoint(this.getRelativeCenterPoint(),s,r);this.left=i,this.top=a,this.originX=s,this.originY=r}}setOnGroup(){}_setupCompositeOperation(e){this.globalCompositeOperation&&(e.globalCompositeOperation=this.globalCompositeOperation)}dispose(){Vr.cancelByTarget(this),this.off(),this._set("canvas",void 0),this._cacheCanvas&&tt().dispose(this._cacheCanvas),this._cacheCanvas=void 0,this._cacheContext=null}animate(e,t){return Object.entries(e).reduce(((s,r)=>{let[i,a]=r;return s[i]=this._animate(i,a,t),s}),{})}_animate(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=e.split("."),i=this.constructor.colorProperties.includes(r[r.length-1]),{abort:a,startValue:o,onChange:l,onComplete:c}=s,h=v(v({},s),{},{target:this,startValue:o??r.reduce(((d,u)=>d[u]),this),endValue:t,abort:a?.bind(this),onChange:(d,u,g)=>{r.reduce(((f,p,y)=>(y===r.length-1&&(f[p]=d),f[p])),this),l&&l(d,u,g)},onComplete:(d,u,g)=>{this.setCoords(),c&&c(d,u,g)}});return i?Mc(h):fo(h)}isDescendantOf(e){const{parent:t,group:s}=this;return t===e||s===e||!!t&&t.isDescendantOf(e)||!!s&&s!==t&&s.isDescendantOf(e)}getAncestors(){const e=[];let t=this;do t=t.parent,t&&e.push(t);while(t);return e}findCommonAncestors(e){if(this===e)return{fork:[],otherFork:[],common:[this,...this.getAncestors()]};const t=this.getAncestors(),s=e.getAncestors();if(t.length===0&&s.length>0&&this===s[s.length-1])return{fork:[],otherFork:[e,...s.slice(0,s.length-1)],common:[this]};for(let r,i=0;i<t.length;i++){if(r=t[i],r===e)return{fork:[this,...t.slice(0,i)],otherFork:[],common:t.slice(i)};for(let a=0;a<s.length;a++){if(this===s[a])return{fork:[],otherFork:[e,...s.slice(0,a)],common:[this,...t]};if(r===s[a])return{fork:[this,...t.slice(0,i)],otherFork:[e,...s.slice(0,a)],common:t.slice(i)}}}return{fork:[this,...t],otherFork:[e,...s],common:[]}}hasCommonAncestors(e){const t=this.findCommonAncestors(e);return t&&!!t.common.length}isInFrontOf(e){if(this===e)return;const t=this.findCommonAncestors(e);if(t.fork.includes(e))return!0;if(t.otherFork.includes(this))return!1;const s=t.common[0]||this.canvas;if(!s)return;const r=t.fork.pop(),i=t.otherFork.pop(),a=s._objects.indexOf(r),o=s._objects.indexOf(i);return a>-1&&a>o}toObject(){const e=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).concat(Fr.customProperties,this.constructor.customProperties||[]);let t;const s=U.NUM_FRACTION_DIGITS,{clipPath:r,fill:i,stroke:a,shadow:o,strokeDashArray:l,left:c,top:h,originX:d,originY:u,width:g,height:f,strokeWidth:p,strokeLineCap:y,strokeDashOffset:x,strokeLineJoin:b,strokeUniform:O,strokeMiterLimit:C,scaleX:k,scaleY:F,angle:D,flipX:R,flipY:W,opacity:K,visible:E,backgroundColor:G,fillRule:Z,paintFirst:Y,globalCompositeOperation:ae,skewX:ie,skewY:oe}=this;r&&!r.excludeFromExport&&(t=r.toObject(e.concat("inverted","absolutePositioned")));const q=ge=>J(ge,s),be=v(v({},us(this,e)),{},{type:this.constructor.type,version:Vi,originX:d,originY:u,left:q(c),top:q(h),width:q(g),height:q(f),fill:Yn(i)?i.toObject():i,stroke:Yn(a)?a.toObject():a,strokeWidth:q(p),strokeDashArray:l&&l.concat(),strokeLineCap:y,strokeDashOffset:x,strokeLineJoin:b,strokeUniform:O,strokeMiterLimit:q(C),scaleX:q(k),scaleY:q(F),angle:q(D),flipX:R,flipY:W,opacity:q(K),shadow:o&&o.toObject(),visible:E,backgroundColor:G,fillRule:Z,paintFirst:Y,globalCompositeOperation:ae,skewX:q(ie),skewY:q(oe)},t?{clipPath:t}:null);return this.includeDefaultValues?be:this._removeDefaultValues(be)}toDatalessObject(e){return this.toObject(e)}_removeDefaultValues(e){const t=this.constructor.getDefaults(),s=Object.keys(t).length>0?t:Object.getPrototypeOf(this);return vn(e,((r,i)=>{if(i===H||i===Se||i==="type")return!0;const a=s[i];return r!==a&&!(Array.isArray(r)&&Array.isArray(a)&&r.length===0&&a.length===0)}))}toString(){return"#<".concat(this.constructor.type,">")}static _fromObject(e){let t=Q(e,Ec),s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{extraParam:r}=s,i=Q(s,Pc);return oi(t,i).then((a=>r?(delete a[r],new this(t[r],a)):new this(a)))}static fromObject(e,t){return this._fromObject(e,t)}};m(nt,"stateProperties",_c),m(nt,"cacheProperties",yt),m(nt,"ownDefaults",xc),m(nt,"type","FabricObject"),m(nt,"colorProperties",[le,Oe,"backgroundColor"]),m(nt,"customProperties",[]),A.setClass(nt),A.setClass(nt,"object");const ds=(n,e,t)=>(s,r,i,a)=>{const o=e(s,r,i,a);return o&&to(n,v(v({},ro(s,r,i,a)),t)),o};function gs(n){return(e,t,s,r)=>{const{target:i,originX:a,originY:o}=t,l=i.getRelativeCenterPoint(),c=i.translateToOriginPoint(l,a,o),h=n(e,t,s,r);return i.setPositionByOrigin(c,t.originX,t.originY),h}}const aa=ds(Ps,gs(((n,e,t,s)=>{const r=_n(e,e.originX,e.originY,t,s);if(ne(e.originX)===ne(z)||ne(e.originX)===ne(se)&&r.x<0||ne(e.originX)===ne(H)&&r.x>0){const{target:i}=e,a=i.strokeWidth/(i.strokeUniform?i.scaleX:1),o=so(e)?2:1,l=i.width,c=Math.abs(r.x*o/i.scaleX)-a;return i.set("width",Math.max(c,1)),l!==i.width}return!1})));function Fc(n,e,t,s,r){s=s||{};const i=this.sizeX||s.cornerSize||r.cornerSize,a=this.sizeY||s.cornerSize||r.cornerSize,o=s.transparentCorners!==void 0?s.transparentCorners:r.transparentCorners,l=o?Oe:le,c=!o&&(s.cornerStrokeColor||r.cornerStrokeColor);let h,d=e,u=t;n.save(),n.fillStyle=s.cornerColor||r.cornerColor||"",n.strokeStyle=s.cornerStrokeColor||r.cornerStrokeColor||"",i>a?(h=i,n.scale(1,a/i),u=t*i/a):a>i?(h=a,n.scale(i/a,1),d=e*a/i):h=i,n.beginPath(),n.arc(d,u,h/2,0,Ir,!1),n[l](),c&&n.stroke(),n.restore()}function Rc(n,e,t,s,r){s=s||{};const i=this.sizeX||s.cornerSize||r.cornerSize,a=this.sizeY||s.cornerSize||r.cornerSize,o=s.transparentCorners!==void 0?s.transparentCorners:r.transparentCorners,l=o?Oe:le,c=!o&&(s.cornerStrokeColor||r.cornerStrokeColor),h=i/2,d=a/2;n.save(),n.fillStyle=s.cornerColor||r.cornerColor||"",n.strokeStyle=s.cornerStrokeColor||r.cornerStrokeColor||"",n.translate(e,t);const u=r.getTotalAngle();n.rotate(re(u)),n["".concat(l,"Rect")](-h,-d,i,a),c&&n.strokeRect(-h,-d,i,a),n.restore()}class Ie{constructor(e){m(this,"visible",!0),m(this,"actionName",ni),m(this,"angle",0),m(this,"x",0),m(this,"y",0),m(this,"offsetX",0),m(this,"offsetY",0),m(this,"sizeX",0),m(this,"sizeY",0),m(this,"touchSizeX",0),m(this,"touchSizeY",0),m(this,"cursorStyle","crosshair"),m(this,"withConnection",!1),Object.assign(this,e)}shouldActivate(e,t,s,r){var i;let{tl:a,tr:o,br:l,bl:c}=r;return((i=t.canvas)===null||i===void 0?void 0:i.getActiveObject())===t&&t.isControlVisible(e)&&ee.isPointInPolygon(s,[a,o,l,c])}getActionHandler(e,t,s){return this.actionHandler}getMouseDownHandler(e,t,s){return this.mouseDownHandler}getMouseUpHandler(e,t,s){return this.mouseUpHandler}cursorStyleHandler(e,t,s){return t.cursorStyle}getActionName(e,t,s){return t.actionName}getVisibility(e,t){var s,r;return(s=(r=e._controlsVisibility)===null||r===void 0?void 0:r[t])!==null&&s!==void 0?s:this.visible}setVisibility(e,t,s){this.visible=e}positionHandler(e,t,s,r){return new _(this.x*e.x+this.offsetX,this.y*e.y+this.offsetY).transform(t)}calcCornerCoords(e,t,s,r,i,a){const o=pn([sr(s,r),hs({angle:e}),mn((i?this.touchSizeX:this.sizeX)||t,(i?this.touchSizeY:this.sizeY)||t)]);return{tl:new _(-.5,-.5).transform(o),tr:new _(.5,-.5).transform(o),br:new _(.5,.5).transform(o),bl:new _(-.5,.5).transform(o)}}render(e,t,s,r,i){((r=r||{}).cornerStyle||i.cornerStyle)==="circle"?Fc.call(this,e,t,s,r,i):Rc.call(this,e,t,s,r,i)}}const Lc=(n,e,t)=>t.lockRotation?Xr:e.cursorStyle,Ic=ds(Va,gs(((n,e,t,s)=>{let{target:r,ex:i,ey:a,theta:o,originX:l,originY:c}=e;const h=r.translateToOriginPoint(r.getRelativeCenterPoint(),l,c);if(Xe(r,"lockRotation"))return!1;const d=Math.atan2(a-h.y,i-h.x),u=Math.atan2(s-h.y,t-h.x);let g=mt(u-d+o);if(r.snapAngle&&r.snapAngle>0){const p=r.snapAngle,y=r.snapThreshold||p,x=Math.ceil(g/p)*p,b=Math.floor(g/p)*p;Math.abs(g-b)<y?g=b:Math.abs(g-x)<y&&(g=x)}g<0&&(g=360+g),g%=360;const f=r.angle!==g;return r.angle=g,f})));function po(n,e){const t=e.canvas,s=n[t.uniScaleKey];return t.uniformScaling&&!s||!t.uniformScaling&&s}function mo(n,e,t){const s=Xe(n,"lockScalingX"),r=Xe(n,"lockScalingY");if(s&&r||!e&&(s||r)&&t||s&&e==="x"||r&&e==="y")return!0;const{width:i,height:a,strokeWidth:o}=n;return i===0&&o===0&&e!=="y"||a===0&&o===0&&e!=="x"}const Bc=["e","se","s","sw","w","nw","n","ne","e"],Ss=(n,e,t)=>{const s=po(n,t);if(mo(t,e.x!==0&&e.y===0?"x":e.x===0&&e.y!==0?"y":"",s))return Xr;const r=io(t,e);return"".concat(Bc[r],"-resize")};function wn(n,e,t,s){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};const i=e.target,a=r.by,o=po(n,i);let l,c,h,d,u,g;if(mo(i,a,o))return!1;if(e.gestureScale)c=e.scaleX*e.gestureScale,h=e.scaleY*e.gestureScale;else{if(l=_n(e,e.originX,e.originY,t,s),u=a!=="y"?Math.sign(l.x||e.signX||1):1,g=a!=="x"?Math.sign(l.y||e.signY||1):1,e.signX||(e.signX=u),e.signY||(e.signY=g),Xe(i,"lockScalingFlip")&&(e.signX!==u||e.signY!==g))return!1;if(d=i._getTransformedDimensions(),o&&!a){const y=Math.abs(l.x)+Math.abs(l.y),{original:x}=e,b=y/(Math.abs(d.x*x.scaleX/i.scaleX)+Math.abs(d.y*x.scaleY/i.scaleY));c=x.scaleX*b,h=x.scaleY*b}else c=Math.abs(l.x*i.scaleX/d.x),h=Math.abs(l.y*i.scaleY/d.y);so(e)&&(c*=2,h*=2),e.signX!==u&&a!=="y"&&(e.originX=Zn(e.originX),c*=-1,e.signX=u),e.signY!==g&&a!=="x"&&(e.originY=Zn(e.originY),h*=-1,e.signY=g)}const f=i.scaleX,p=i.scaleY;return a?(a==="x"&&i.set(ke,c),a==="y"&&i.set(Ee,h)):(!Xe(i,"lockScalingX")&&i.set(ke,c),!Xe(i,"lockScalingY")&&i.set(Ee,h)),f!==i.scaleX||p!==i.scaleY}const ar=ds(ii,gs(((n,e,t,s)=>wn(n,e,t,s)))),Nc=ds(ii,gs(((n,e,t,s)=>wn(n,e,t,s,{by:"x"})))),Vc=ds(ii,gs(((n,e,t,s)=>wn(n,e,t,s,{by:"y"})))),zc=["target","ex","ey","skewingSide"],ji={x:{counterAxis:"y",scale:ke,skew:ls,lockSkewing:"lockSkewingX",origin:"originX",flip:"flipX"},y:{counterAxis:"x",scale:Ee,skew:cs,lockSkewing:"lockSkewingY",origin:"originY",flip:"flipY"}},Wc=["ns","nesw","ew","nwse"],Xc=(n,e,t)=>{if(e.x!==0&&Xe(t,"lockSkewingY")||e.y!==0&&Xe(t,"lockSkewingX"))return Xr;const s=io(t,e)%4;return"".concat(Wc[s],"-resize")};function vo(n,e,t,s,r){const{target:i}=t,{counterAxis:a,origin:o,lockSkewing:l,skew:c,flip:h}=ji[n];if(Xe(i,l))return!1;const{origin:d,flip:u}=ji[a],g=ne(t[d])*(i[u]?-1:1),f=-Math.sign(g)*(i[h]?-1:1),p=.5*-((i[c]===0&&_n(t,z,z,s,r)[n]>0||i[c]>0?1:-1)*f)+.5;return ds(za,gs(((x,b,O,C)=>(function(k,F,D){let{target:R,ex:W,ey:K,skewingSide:E}=F,G=Q(F,zc);const{skew:Z}=ji[k],Y=D.subtract(new _(W,K)).divide(new _(R.scaleX,R.scaleY))[k],ae=R[Z],ie=G[Z],oe=Math.tan(re(ie)),q=k==="y"?R._getTransformedDimensions({scaleX:1,scaleY:1,skewX:0}).x:R._getTransformedDimensions({scaleX:1,scaleY:1}).y,be=2*Y*E/Math.max(q,1)+oe,ge=mt(Math.atan(be));R.set(Z,ge);const Xt=ae!==R[Z];if(Xt&&k==="y"){const{skewX:vs,scaleX:Dt}=R,Ge=R._getTransformedDimensions({skewY:ae}),Yt=R._getTransformedDimensions(),it=vs!==0?Ge.x/Yt.x:1;it!==1&&R.set(ke,it*Dt)}return Xt})(n,b,new _(O,C)))))(e,v(v({},t),{},{[o]:p,skewingSide:f}),s,r)}const Yc=(n,e,t,s)=>vo("x",n,e,t,s),Uc=(n,e,t,s)=>vo("y",n,e,t,s);function hi(n,e){return n[e.canvas.altActionKey]}const or=(n,e,t)=>{const s=hi(n,t);return e.x===0?s?ls:Ee:e.y===0?s?cs:ke:""},$t=(n,e,t)=>hi(n,t)?Xc(0,e,t):Ss(n,e,t),oa=(n,e,t,s)=>hi(n,e.target)?Uc(n,e,t,s):Nc(n,e,t,s),la=(n,e,t,s)=>hi(n,e.target)?Yc(n,e,t,s):Vc(n,e,t,s),yo=()=>({ml:new Ie({x:-.5,y:0,cursorStyleHandler:$t,actionHandler:oa,getActionName:or}),mr:new Ie({x:.5,y:0,cursorStyleHandler:$t,actionHandler:oa,getActionName:or}),mb:new Ie({x:0,y:.5,cursorStyleHandler:$t,actionHandler:la,getActionName:or}),mt:new Ie({x:0,y:-.5,cursorStyleHandler:$t,actionHandler:la,getActionName:or}),tl:new Ie({x:-.5,y:-.5,cursorStyleHandler:Ss,actionHandler:ar}),tr:new Ie({x:.5,y:-.5,cursorStyleHandler:Ss,actionHandler:ar}),bl:new Ie({x:-.5,y:.5,cursorStyleHandler:Ss,actionHandler:ar}),br:new Ie({x:.5,y:.5,cursorStyleHandler:Ss,actionHandler:ar}),mtr:new Ie({x:0,y:-.5,actionHandler:Ic,cursorStyleHandler:Lc,offsetY:-40,withConnection:!0,actionName:gn})}),Gc=()=>({mr:new Ie({x:.5,y:0,actionHandler:aa,cursorStyleHandler:$t,actionName:Ps}),ml:new Ie({x:-.5,y:0,actionHandler:aa,cursorStyleHandler:$t,actionName:Ps})}),Hc=()=>v(v({},yo()),Gc());class Is extends nt{static getDefaults(){return v(v({},super.getDefaults()),Is.ownDefaults)}constructor(e){super(),Object.assign(this,this.constructor.createControls(),Is.ownDefaults),this.setOptions(e)}static createControls(){return{controls:yo()}}_updateCacheCanvas(){const e=this.canvas;if(this.noScaleCache&&e&&e._currentTransform){const t=e._currentTransform,s=t.target,r=t.action;if(this===s&&r&&r.startsWith(ni))return!1}return super._updateCacheCanvas()}getActiveControl(){const e=this.__corner;return e?{key:e,control:this.controls[e],coord:this.oCoords[e]}:void 0}findControl(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!this.hasControls||!this.canvas)return;this.__corner=void 0;const s=Object.entries(this.oCoords);for(let r=s.length-1;r>=0;r--){const[i,a]=s[r],o=this.controls[i];if(o.shouldActivate(i,this,e,t?a.touchCorner:a.corner))return this.__corner=i,{key:i,control:o,coord:this.oCoords[i]}}}calcOCoords(){const e=this.getViewportTransform(),t=this.getCenterPoint(),s=sr(t.x,t.y),r=hs({angle:this.getTotalAngle()-(this.group&&this.flipX?180:0)}),i=pe(s,r),a=pe(e,i),o=pe(a,[1/e[0],0,0,1/e[3],0,0]),l=this.group?zr(this.calcTransformMatrix()):void 0;l&&(l.scaleX=Math.abs(l.scaleX),l.scaleY=Math.abs(l.scaleY));const c=this._calculateCurrentDimensions(l),h={};return this.forEachControl(((d,u)=>{const g=d.positionHandler(c,o,this,d);h[u]=Object.assign(g,this._calcCornerCoords(d,g))})),h}_calcCornerCoords(e,t){const s=this.getTotalAngle();return{corner:e.calcCornerCoords(s,this.cornerSize,t.x,t.y,!1,this),touchCorner:e.calcCornerCoords(s,this.touchCornerSize,t.x,t.y,!0,this)}}setCoords(){super.setCoords(),this.canvas&&(this.oCoords=this.calcOCoords())}forEachControl(e){for(const t in this.controls)e(this.controls[t],t,this)}drawSelectionBackground(e){if(!this.selectionBackgroundColor||this.canvas&&this.canvas._activeObject!==this)return;e.save();const t=this.getRelativeCenterPoint(),s=this._calculateCurrentDimensions(),r=this.getViewportTransform();e.translate(t.x,t.y),e.scale(1/r[0],1/r[3]),e.rotate(re(this.angle)),e.fillStyle=this.selectionBackgroundColor,e.fillRect(-s.x/2,-s.y/2,s.x,s.y),e.restore()}strokeBorders(e,t){e.strokeRect(-t.x/2,-t.y/2,t.x,t.y)}_drawBorders(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=v({hasControls:this.hasControls,borderColor:this.borderColor,borderDashArray:this.borderDashArray},s);e.save(),e.strokeStyle=r.borderColor,this._setLineDash(e,r.borderDashArray),this.strokeBorders(e,t),r.hasControls&&this.drawControlsConnectingLines(e,t),e.restore()}_renderControls(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{hasBorders:s,hasControls:r}=this,i=v({hasBorders:s,hasControls:r},t),a=this.getViewportTransform(),o=i.hasBorders,l=i.hasControls,c=pe(a,this.calcTransformMatrix()),h=zr(c);e.save(),e.translate(h.translateX,h.translateY),e.lineWidth=this.borderScaleFactor,this.group===this.parent&&(e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(h.angle-=180),e.rotate(re(this.group?h.angle:this.angle)),o&&this.drawBorders(e,h,t),l&&this.drawControls(e,t),e.restore()}drawBorders(e,t,s){let r;if(s&&s.forActiveSelection||this.group){const i=yn(this.width,this.height,ai(t)),a=this.isStrokeAccountedForInDimensions()?fn:(this.strokeUniform?new _().scalarAdd(this.canvas?this.canvas.getZoom():1):new _(t.scaleX,t.scaleY)).scalarMultiply(this.strokeWidth);r=i.add(a).scalarAdd(this.borderScaleFactor).scalarAdd(2*this.padding)}else r=this._calculateCurrentDimensions().scalarAdd(this.borderScaleFactor);this._drawBorders(e,r,s)}drawControlsConnectingLines(e,t){let s=!1;e.beginPath(),this.forEachControl(((r,i)=>{r.withConnection&&r.getVisibility(this,i)&&(s=!0,e.moveTo(r.x*t.x,r.y*t.y),e.lineTo(r.x*t.x+r.offsetX,r.y*t.y+r.offsetY))})),s&&e.stroke()}drawControls(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.save();const s=this.getCanvasRetinaScaling(),{cornerStrokeColor:r,cornerDashArray:i,cornerColor:a}=this,o=v({cornerStrokeColor:r,cornerDashArray:i,cornerColor:a},t);e.setTransform(s,0,0,s,0,0),e.strokeStyle=e.fillStyle=o.cornerColor,this.transparentCorners||(e.strokeStyle=o.cornerStrokeColor),this._setLineDash(e,o.cornerDashArray),this.forEachControl(((l,c)=>{if(l.getVisibility(this,c)){const h=this.oCoords[c];l.render(e,h.x,h.y,o,this)}})),e.restore()}isControlVisible(e){return this.controls[e]&&this.controls[e].getVisibility(this,e)}setControlVisible(e,t){this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[e]=t}setControlsVisibility(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.entries(e).forEach((t=>{let[s,r]=t;return this.setControlVisible(s,r)}))}clearContextTop(e){if(!this.canvas)return;const t=this.canvas.contextTop;if(!t)return;const s=this.canvas.viewportTransform;t.save(),t.transform(s[0],s[1],s[2],s[3],s[4],s[5]),this.transform(t);const r=this.width+4,i=this.height+4;return t.clearRect(-r/2,-i/2,r,i),e||t.restore(),t}onDeselect(e){return!1}onSelect(e){return!1}shouldStartDragging(e){return!1}onDragStart(e){return!1}canDrop(e){return!1}renderDragSourceEffect(e){}renderDropTargetEffect(e){}}function _o(n,e){return e.forEach((t=>{Object.getOwnPropertyNames(t.prototype).forEach((s=>{s!=="constructor"&&Object.defineProperty(n.prototype,s,Object.getOwnPropertyDescriptor(t.prototype,s)||Object.create(null))}))})),n}m(Is,"ownDefaults",{noScaleCache:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,cornerSize:13,touchCornerSize:24,transparentCorners:!0,cornerColor:"rgb(178,204,255)",cornerStrokeColor:"",cornerStyle:"rect",cornerDashArray:null,hasControls:!0,borderColor:"rgb(178,204,255)",borderDashArray:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,hasBorders:!0,selectionBackgroundColor:"",selectable:!0,evented:!0,perPixelTargetFind:!1,activeOn:"down",hoverCursor:null,moveCursor:null});class de extends Is{}_o(de,[no]),A.setClass(de),A.setClass(de,"object");const Zc=(n,e,t,s)=>{const r=2*(s=Math.round(s))+1,{data:i}=n.getImageData(e-s,t-s,r,r);for(let a=3;a<i.length;a+=4)if(i[a]>0)return!1;return!0};class xo{constructor(e){this.options=e,this.strokeProjectionMagnitude=this.options.strokeWidth/2,this.scale=new _(this.options.scaleX,this.options.scaleY),this.strokeUniformScalar=this.options.strokeUniform?new _(1/this.options.scaleX,1/this.options.scaleY):new _(1,1)}createSideVector(e,t){const s=Yi(e,t);return this.options.strokeUniform?s.multiply(this.scale):s}projectOrthogonally(e,t,s){return this.applySkew(e.add(this.calcOrthogonalProjection(e,t,s)))}isSkewed(){return this.options.skewX!==0||this.options.skewY!==0}applySkew(e){const t=new _(e);return t.y+=t.x*Math.tan(re(this.options.skewY)),t.x+=t.y*Math.tan(re(this.options.skewX)),t}scaleUnitVector(e,t){return e.multiply(this.strokeUniformScalar).scalarMultiply(t)}}const $c=new _;class ts extends xo{static getOrthogonalRotationFactor(e,t){const s=t?Gi(e,t):vc(e);return Math.abs(s)<tr?-1:1}constructor(e,t,s,r){super(r),m(this,"AB",void 0),m(this,"AC",void 0),m(this,"alpha",void 0),m(this,"bisector",void 0),this.A=new _(e),this.B=new _(t),this.C=new _(s),this.AB=this.createSideVector(this.A,this.B),this.AC=this.createSideVector(this.A,this.C),this.alpha=Gi(this.AB,this.AC),this.bisector=xn(uo(this.AB.eq($c)?this.AC:this.AB,this.alpha/2))}calcOrthogonalProjection(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.strokeProjectionMagnitude;const r=this.createSideVector(e,t),i=go(r),a=ts.getOrthogonalRotationFactor(i,this.bisector);return this.scaleUnitVector(i,s*a)}projectBevel(){const e=[];return(this.alpha%Ir==0?[this.B]:[this.B,this.C]).forEach((t=>{e.push(this.projectOrthogonally(this.A,t)),e.push(this.projectOrthogonally(this.A,t,-this.strokeProjectionMagnitude))})),e}projectMiter(){const e=[],t=Math.abs(this.alpha),s=1/Math.sin(t/2),r=this.scaleUnitVector(this.bisector,-this.strokeProjectionMagnitude*s),i=this.options.strokeUniform?Ui(this.scaleUnitVector(this.bisector,this.options.strokeMiterLimit)):this.options.strokeMiterLimit;return Ui(r)/this.strokeProjectionMagnitude<=i&&e.push(this.applySkew(this.A.add(r))),e.push(...this.projectBevel()),e}projectRoundNoSkew(e,t){const s=[],r=new _(ts.getOrthogonalRotationFactor(this.bisector),ts.getOrthogonalRotationFactor(new _(this.bisector.y,this.bisector.x)));return[new _(1,0).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(r),new _(0,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(r)].forEach((i=>{ra(i,e,t)&&s.push(this.A.add(i))})),s}projectRoundWithSkew(e,t){const s=[],{skewX:r,skewY:i,scaleX:a,scaleY:o,strokeUniform:l}=this.options,c=new _(Math.tan(re(r)),Math.tan(re(i))),h=this.strokeProjectionMagnitude,d=l?h/o/Math.sqrt(1/o**2+1/a**2*c.y**2):h/Math.sqrt(1+c.y**2),u=new _(Math.sqrt(Math.max(h**2-d**2,0)),d),g=l?h/Math.sqrt(1+c.x**2*(1/o)**2/(1/a+1/a*c.x*c.y)**2):h/Math.sqrt(1+c.x**2/(1+c.x*c.y)**2),f=new _(g,Math.sqrt(Math.max(h**2-g**2,0)));return[f,f.scalarMultiply(-1),u,u.scalarMultiply(-1)].map((p=>this.applySkew(l?p.multiply(this.strokeUniformScalar):p))).forEach((p=>{ra(p,e,t)&&s.push(this.applySkew(this.A).add(p))})),s}projectRound(){const e=[];e.push(...this.projectBevel());const t=this.alpha%Ir==0,s=this.applySkew(this.A),r=e[t?0:2].subtract(s),i=e[t?1:0].subtract(s),a=t?this.applySkew(this.AB.scalarMultiply(-1)):this.applySkew(this.bisector.multiply(this.strokeUniformScalar).scalarMultiply(-1)),o=Es(r,a)>0,l=o?r:i,c=o?i:r;return this.isSkewed()?e.push(...this.projectRoundWithSkew(l,c)):e.push(...this.projectRoundNoSkew(l,c)),e}projectPoints(){switch(this.options.strokeLineJoin){case"miter":return this.projectMiter();case"round":return this.projectRound();default:return this.projectBevel()}}project(){return this.projectPoints().map((e=>({originPoint:this.A,projectedPoint:e,angle:this.alpha,bisector:this.bisector})))}}class ca extends xo{constructor(e,t,s){super(s),this.A=new _(e),this.T=new _(t)}calcOrthogonalProjection(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.strokeProjectionMagnitude;const r=this.createSideVector(e,t);return this.scaleUnitVector(go(r),s)}projectButt(){return[this.projectOrthogonally(this.A,this.T,this.strokeProjectionMagnitude),this.projectOrthogonally(this.A,this.T,-this.strokeProjectionMagnitude)]}projectRound(){const e=[];if(!this.isSkewed()&&this.A.eq(this.T)){const t=new _(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);e.push(this.applySkew(this.A.add(t)),this.applySkew(this.A.subtract(t)))}else e.push(...new ts(this.A,this.T,this.T,this.options).projectRound());return e}projectSquare(){const e=[];if(this.A.eq(this.T)){const t=new _(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);e.push(this.A.add(t),this.A.subtract(t))}else{const t=this.calcOrthogonalProjection(this.A,this.T,this.strokeProjectionMagnitude),s=this.scaleUnitVector(xn(this.createSideVector(this.A,this.T)),-this.strokeProjectionMagnitude),r=this.A.add(s);e.push(r.add(t),r.subtract(t))}return e.map((t=>this.applySkew(t)))}projectPoints(){switch(this.options.strokeLineCap){case"round":return this.projectRound();case"square":return this.projectSquare();default:return this.projectButt()}}project(){return this.projectPoints().map((e=>({originPoint:this.A,projectedPoint:e})))}}const qc=function(n,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const s=[];if(n.length===0)return s;const r=n.reduce(((i,a)=>(i[i.length-1].eq(a)||i.push(new _(a)),i)),[new _(n[0])]);if(r.length===1)t=!0;else if(!t){const i=r[0],a=((o,l)=>{for(let c=o.length-1;c>=0;c--)if(l(o[c],c,o))return c;return-1})(r,(o=>!o.eq(i)));r.splice(a+1)}return r.forEach(((i,a,o)=>{let l,c;a===0?(c=o[1],l=t?i:o[o.length-1]):a===o.length-1?(l=o[a-1],c=t?i:o[0]):(l=o[a-1],c=o[a+1]),t&&o.length===1?s.push(...new ca(i,i,e).project()):!t||a!==0&&a!==o.length-1?s.push(...new ts(i,l,c,e).project()):s.push(...new ca(i,a===0?c:l,e).project())})),s},Cn=n=>{const e={};return Object.keys(n).forEach((t=>{e[t]={},Object.keys(n[t]).forEach((s=>{e[t][s]=v({},n[t][s])}))})),e},Kc=n=>n.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;");let xs;const Sn=n=>{if(xs||xs||(xs="Intl"in ri()&&"Segmenter"in Intl&&new Intl.Segmenter(void 0,{granularity:"grapheme"})),xs){const e=xs.segment(n);return Array.from(e).map((t=>{let{segment:s}=t;return s}))}return Jc(n)},Jc=n=>{const e=[];for(let t,s=0;s<n.length;s++)(t=Qc(n,s))!==!1&&e.push(t);return e},Qc=(n,e)=>{const t=n.charCodeAt(e);if(isNaN(t))return"";if(t<55296||t>57343)return n.charAt(e);if(55296<=t&&t<=56319){if(n.length<=e+1)throw"High surrogate without following low surrogate";const r=n.charCodeAt(e+1);if(56320>r||r>57343)throw"High surrogate without following low surrogate";return n.charAt(e)+n.charAt(e+1)}if(e===0)throw"Low surrogate without preceding high surrogate";const s=n.charCodeAt(e-1);if(55296>s||s>56319)throw"Low surrogate without preceding high surrogate";return!1},Tn=function(n,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];return n.fill!==e.fill||n.stroke!==e.stroke||n.strokeWidth!==e.strokeWidth||n.fontSize!==e.fontSize||n.fontFamily!==e.fontFamily||n.fontWeight!==e.fontWeight||n.fontStyle!==e.fontStyle||n.textDecorationThickness!==e.textDecorationThickness||n.textBackgroundColor!==e.textBackgroundColor||n.deltaY!==e.deltaY||t&&(n.overline!==e.overline||n.underline!==e.underline||n.linethrough!==e.linethrough)},eh=(n,e)=>{const t=e.split(`
`),s=[];let r=-1,i={};n=Cn(n);for(let a=0;a<t.length;a++){const o=Sn(t[a]);if(n[a])for(let l=0;l<o.length;l++){r++;const c=n[a][l];c&&Object.keys(c).length>0&&(Tn(i,c,!0)?s.push({start:r,end:r+1,style:c}):s[s.length-1].end++),i=c||{}}else r+=o.length,i={}}return s},th=(n,e)=>{if(!Array.isArray(n))return Cn(n);const t=e.split(dn),s={};let r=-1,i=0;for(let a=0;a<t.length;a++){const o=Sn(t[a]);for(let l=0;l<o.length;l++)r++,n[i]&&n[i].start<=r&&r<n[i].end&&(s[a]=s[a]||{},s[a][l]=v({},n[i].style),r===n[i].end-1&&i++)}return s},kt=["display","transform",le,"fill-opacity","fill-rule","opacity",Oe,"stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];function ha(n,e){const t=n.nodeName,s=n.getAttribute("class"),r=n.getAttribute("id"),i="(?![a-zA-Z\\-]+)";let a;if(a=new RegExp("^"+t,"i"),e=e.replace(a,""),r&&e.length&&(a=new RegExp("#"+r+i,"i"),e=e.replace(a,"")),s&&e.length){const o=s.split(" ");for(let l=o.length;l--;)a=new RegExp("\\."+o[l]+i,"i"),e=e.replace(a,"")}return e.length===0}function sh(n,e){let t=!0;const s=ha(n,e.pop());return s&&e.length&&(t=(function(r,i){let a,o=!0;for(;r.parentElement&&r.parentElement.nodeType===1&&i.length;)o&&(a=i.pop()),o=ha(r=r.parentElement,a);return i.length===0})(n,e)),s&&t&&e.length===0}const rh=n=>{var e;return(e=pc[n])!==null&&e!==void 0?e:n},ih=new RegExp("(".concat(We,")"),"gi"),nh=n=>n.replace(ih," $1 ").replace(/,/gi," ").replace(/\s+/gi," ");var ua,da,ga,fa,pa,ma,va;const ye="(".concat(We,")"),ah=String.raw(ua||(ua=rt(["(skewX)(",")"],["(skewX)\\(","\\)"])),ye),oh=String.raw(da||(da=rt(["(skewY)(",")"],["(skewY)\\(","\\)"])),ye),lh=String.raw(ga||(ga=rt(["(rotate)(","(?: "," ",")?)"],["(rotate)\\(","(?: "," ",")?\\)"])),ye,ye,ye),ch=String.raw(fa||(fa=rt(["(scale)(","(?: ",")?)"],["(scale)\\(","(?: ",")?\\)"])),ye,ye),hh=String.raw(pa||(pa=rt(["(translate)(","(?: ",")?)"],["(translate)\\(","(?: ",")?\\)"])),ye,ye),uh=String.raw(ma||(ma=rt(["(matrix)("," "," "," "," "," ",")"],["(matrix)\\("," "," "," "," "," ","\\)"])),ye,ye,ye,ye,ye,ye),On="(?:".concat(uh,"|").concat(hh,"|").concat(lh,"|").concat(ch,"|").concat(ah,"|").concat(oh,")"),dh="(?:".concat(On,"*)"),gh=String.raw(va||(va=rt(["^s*(?:","?)s*$"],["^\\s*(?:","?)\\s*$"])),dh),fh=new RegExp(gh),ph=new RegExp(On),mh=new RegExp(On,"g");function Hi(n){const e=[];if(!(n=nh(n).replace(/\s*([()])\s*/gi,"$1"))||n&&!fh.test(n))return[..._e];for(const t of n.matchAll(mh)){const s=ph.exec(t[0]);if(!s)continue;let r=_e;const i=s.filter((f=>!!f)),[,a,...o]=i,[l,c,h,d,u,g]=o.map((f=>parseFloat(f)));switch(a){case"translate":r=sr(l,c);break;case gn:r=hs({angle:l},{x:c,y:h});break;case ni:r=mn(l,c);break;case ls:r=Za(l);break;case cs:r=$a(l);break;case"matrix":r=[l,c,h,d,u,g]}e.push(r)}return pn(e)}function vh(n,e,t,s){const r=Array.isArray(e);let i,a=e;if(n!==le&&n!==Oe||e!==Te){if(n==="strokeUniform")return e==="non-scaling-stroke";if(n==="strokeDashArray")a=e===Te?null:e.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(n==="transformMatrix")a=t&&t.transformMatrix?pe(t.transformMatrix,Hi(e)):Hi(e);else if(n==="visible")a=e!==Te&&e!=="hidden",t&&t.visible===!1&&(a=!1);else if(n==="opacity")a=parseFloat(e),t&&t.opacity!==void 0&&(a*=t.opacity);else if(n==="textAnchor")a=e==="start"?H:e==="end"?se:z;else if(n==="charSpacing"||n===Nt)i=es(e,s)/s*1e3;else if(n==="paintFirst"){const o=e.indexOf(le),l=e.indexOf(Oe);a=le,(o>-1&&l>-1&&l<o||o===-1&&l>-1)&&(a=Oe)}else{if(n==="href"||n==="xlink:href"||n==="font"||n==="id")return e;if(n==="imageSmoothing")return e==="optimizeQuality";i=r?e.map(es):es(e,s)}}else a="";return!r&&isNaN(i)?a:i}function yh(n,e){const t=n.match(fc);if(!t)return;const s=t[1],r=t[3],i=t[4],a=t[5],o=t[6];s&&(e.fontStyle=s),r&&(e.fontWeight=isNaN(parseFloat(r))?r:parseFloat(r)),i&&(e.fontSize=es(i)),o&&(e.fontFamily=o),a&&(e.lineHeight=a==="normal"?1:a)}function _h(n,e){n.replace(/;\s*$/,"").split(";").forEach((t=>{if(!t)return;const[s,r]=t.split(":");e[s.trim().toLowerCase()]=r.trim()}))}function xh(n){const e={},t=n.getAttribute("style");return t&&(typeof t=="string"?_h(t,e):(function(s,r){Object.entries(s).forEach((i=>{let[a,o]=i;o!==void 0&&(r[a.toLowerCase()]=o)}))})(t,e)),e}const bh={stroke:"strokeOpacity",fill:"fillOpacity"};function _t(n,e,t){if(!n)return{};let s,r={},i=un;n.parentNode&&sa.test(n.parentNode.nodeName)&&(r=_t(n.parentElement,e,t),r.fontSize&&(s=i=es(r.fontSize)));const a=v(v(v({},e.reduce(((c,h)=>{const d=n.getAttribute(h);return d&&(c[h]=d),c}),{})),(function(c){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d={};for(const u in h)sh(c,u.split(" "))&&(d=v(v({},d),h[u]));return d})(n,t)),xh(n));a[ki]&&n.setAttribute(ki,a[ki]),a[Oi]&&(s=es(a[Oi],i),a[Oi]="".concat(s));const o={};for(const c in a){const h=rh(c),d=vh(h,a[c],r,s);o[h]=d}o&&o.font&&yh(o.font,o);const l=v(v({},r),o);return sa.test(n.nodeName)?l:(function(c){const h=de.getDefaults();return Object.entries(bh).forEach((d=>{let[u,g]=d;if(c[g]===void 0||c[u]==="")return;if(c[u]===void 0){if(!h[u])return;c[u]=h[u]}if(c[u].indexOf("url(")===0)return;const f=new $(c[u]);c[u]=f.setAlpha(J(f.getAlpha()*c[g],2)).toRgba()})),c})(l)}const wh=["left","top","width","height","visible"],bo=["rx","ry"];class qe extends de{static getDefaults(){return v(v({},super.getDefaults()),qe.ownDefaults)}constructor(e){super(),Object.assign(this,qe.ownDefaults),this.setOptions(e),this._initRxRy()}_initRxRy(){const{rx:e,ry:t}=this;e&&!t?this.ry=e:t&&!e&&(this.rx=t)}_render(e){const{width:t,height:s}=this,r=-t/2,i=-s/2,a=this.rx?Math.min(this.rx,t/2):0,o=this.ry?Math.min(this.ry,s/2):0,l=a!==0||o!==0;e.beginPath(),e.moveTo(r+a,i),e.lineTo(r+t-a,i),l&&e.bezierCurveTo(r+t-bt*a,i,r+t,i+bt*o,r+t,i+o),e.lineTo(r+t,i+s-o),l&&e.bezierCurveTo(r+t,i+s-bt*o,r+t-bt*a,i+s,r+t-a,i+s),e.lineTo(r+a,i+s),l&&e.bezierCurveTo(r+bt*a,i+s,r,i+s-bt*o,r,i+s-o),e.lineTo(r,i+o),l&&e.bezierCurveTo(r,i+bt*o,r+bt*a,i,r+a,i),e.closePath(),this._renderPaintInOrder(e)}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...bo,...e])}_toSVG(){const{width:e,height:t,rx:s,ry:r}=this;return["<rect ","COMMON_PARTS",'x="'.concat(-e/2,'" y="').concat(-t/2,'" rx="').concat(s,'" ry="').concat(r,'" width="').concat(e,'" height="').concat(t,`" />
`)]}static async fromElement(e,t,s){const r=_t(e,this.ATTRIBUTE_NAMES,s),{left:i=0,top:a=0,width:o=0,height:l=0,visible:c=!0}=r,h=Q(r,wh);return new this(v(v(v({},t),h),{},{left:i,top:a,width:o,height:l,visible:!!(c&&o&&l)}))}}m(qe,"type","Rect"),m(qe,"cacheProperties",[...yt,...bo]),m(qe,"ownDefaults",{rx:0,ry:0}),m(qe,"ATTRIBUTE_NAMES",[...kt,"x","y","rx","ry","width","height"]),A.setClass(qe),A.setSVGClass(qe);const ht="initialization",Ur="added",kn="removed",Gr="imperative",wo=(n,e)=>{const{strokeUniform:t,strokeWidth:s,width:r,height:i,group:a}=e,o=a&&a!==n?li(a.calcTransformMatrix(),n.calcTransformMatrix()):null,l=o?e.getRelativeCenterPoint().transform(o):e.getRelativeCenterPoint(),c=!e.isStrokeAccountedForInDimensions(),h=t&&c?oc(new _(s,s),void 0,n.calcTransformMatrix()):fn,d=!t&&c?s:0,u=yn(r+d,i+d,pn([o,e.calcOwnMatrix()],!0)).add(h).scalarDivide(2);return[l.subtract(u),l.add(u)]};class ui{calcLayoutResult(e,t){if(this.shouldPerformLayout(e))return this.calcBoundingBox(t,e)}shouldPerformLayout(e){let{type:t,prevStrategy:s,strategy:r}=e;return t===ht||t===Gr||!!s&&r!==s}shouldLayoutClipPath(e){let{type:t,target:{clipPath:s}}=e;return t!==ht&&s&&!s.absolutePositioned}getInitialSize(e,t){return t.size}calcBoundingBox(e,t){const{type:s,target:r}=t;if(s===Gr&&t.overrides)return t.overrides;if(e.length===0)return;const{left:i,top:a,width:o,height:l}=dt(e.map((d=>wo(r,d))).reduce(((d,u)=>d.concat(u)),[])),c=new _(o,l),h=new _(i,a).add(c.scalarDivide(2));if(s===ht){const d=this.getInitialSize(t,{size:c,center:h});return{center:h,relativeCorrection:new _(0,0),size:d}}return{center:h.transform(r.calcOwnMatrix()),size:c}}}m(ui,"type","strategy");class Zi extends ui{shouldPerformLayout(e){return!0}}m(Zi,"type","fit-content"),A.setClass(Zi);const Ch=["strategy"],Sh=["target","strategy","bubbles","prevStrategy"],Co="layoutManager";class Bs{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Zi;m(this,"strategy",void 0),this.strategy=e,this._subscriptions=new Map}performLayout(e){const t=v(v({bubbles:!0,strategy:this.strategy},e),{},{prevStrategy:this._prevLayoutStrategy,stopPropagation(){this.bubbles=!1}});this.onBeforeLayout(t);const s=this.getLayoutResult(t);s&&this.commitLayout(t,s),this.onAfterLayout(t,s),this._prevLayoutStrategy=t.strategy}attachHandlers(e,t){const{target:s}=t;return[Nr,Na,Ps,Va,ii,za,Br,Hl,Zl].map((r=>e.on(r,(i=>this.performLayout(r===Nr?{type:"object_modified",trigger:r,e:i,target:s}:{type:"object_modifying",trigger:r,e:i,target:s})))))}subscribe(e,t){this.unsubscribe(e,t);const s=this.attachHandlers(e,t);this._subscriptions.set(e,s)}unsubscribe(e,t){(this._subscriptions.get(e)||[]).forEach((s=>s())),this._subscriptions.delete(e)}unsubscribeTargets(e){e.targets.forEach((t=>this.unsubscribe(t,e)))}subscribeTargets(e){e.targets.forEach((t=>this.subscribe(t,e)))}onBeforeLayout(e){const{target:t,type:s}=e,{canvas:r}=t;if(s===ht||s===Ur?this.subscribeTargets(e):s===kn&&this.unsubscribeTargets(e),t.fire("layout:before",{context:e}),r&&r.fire("object:layout:before",{target:t,context:e}),s===Gr&&e.deep){const i=Q(e,Ch);t.forEachObject((a=>a.layoutManager&&a.layoutManager.performLayout(v(v({},i),{},{bubbles:!1,target:a}))))}}getLayoutResult(e){const{target:t,strategy:s,type:r}=e,i=s.calcLayoutResult(e,t.getObjects());if(!i)return;const a=r===ht?new _:t.getRelativeCenterPoint(),{center:o,correction:l=new _,relativeCorrection:c=new _}=i,h=a.subtract(o).add(l).transform(r===ht?_e:ze(t.calcOwnMatrix()),!0).add(c);return{result:i,prevCenter:a,nextCenter:o,offset:h}}commitLayout(e,t){const{target:s}=e,{result:{size:r},nextCenter:i}=t;var a,o;s.set({width:r.x,height:r.y}),this.layoutObjects(e,t),e.type===ht?s.set({left:(a=e.x)!==null&&a!==void 0?a:i.x+r.x*ne(s.originX),top:(o=e.y)!==null&&o!==void 0?o:i.y+r.y*ne(s.originY)}):(s.setPositionByOrigin(i,z,z),s.setCoords(),s.set("dirty",!0))}layoutObjects(e,t){const{target:s}=e;s.forEachObject((r=>{r.group===s&&this.layoutObject(e,t,r)})),e.strategy.shouldLayoutClipPath(e)&&this.layoutObject(e,t,s.clipPath)}layoutObject(e,t,s){let{offset:r}=t;s.set({left:s.left+r.x,top:s.top+r.y})}onAfterLayout(e,t){const{target:s,strategy:r,bubbles:i,prevStrategy:a}=e,o=Q(e,Sh),{canvas:l}=s;s.fire("layout:after",{context:e,result:t}),l&&l.fire("object:layout:after",{context:e,result:t,target:s});const c=s.parent;i&&c!=null&&c.layoutManager&&((o.path||(o.path=[])).push(s),c.layoutManager.performLayout(v(v({},o),{},{target:c}))),s.set("dirty",!0)}dispose(){const{_subscriptions:e}=this;e.forEach((t=>t.forEach((s=>s())))),e.clear()}toObject(){return{type:Co,strategy:this.strategy.constructor.type}}toJSON(){return this.toObject()}}A.setClass(Bs,Co);const Th=["type","objects","layoutManager"];class Oh extends Bs{performLayout(){}}class It extends Wa(de){static getDefaults(){return v(v({},super.getDefaults()),It.ownDefaults)}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),m(this,"_activeObjects",[]),m(this,"__objectSelectionTracker",void 0),m(this,"__objectSelectionDisposer",void 0),Object.assign(this,It.ownDefaults),this.setOptions(t),this.groupInit(e,t)}groupInit(e,t){var s;this._objects=[...e],this.__objectSelectionTracker=this.__objectSelectionMonitor.bind(this,!0),this.__objectSelectionDisposer=this.__objectSelectionMonitor.bind(this,!1),this.forEachObject((r=>{this.enterGroup(r,!1)})),this.layoutManager=(s=t.layoutManager)!==null&&s!==void 0?s:new Bs,this.layoutManager.performLayout({type:ht,target:this,targets:[...e],x:t.left,y:t.top})}canEnterGroup(e){return e===this||this.isDescendantOf(e)?(Ct("error","Group: circular object trees are not supported, this call has no effect"),!1):this._objects.indexOf(e)===-1||(Ct("error","Group: duplicate objects are not supported inside group, this call has no effect"),!1)}_filterObjectsBeforeEnteringGroup(e){return e.filter(((t,s,r)=>this.canEnterGroup(t)&&r.indexOf(t)===s))}add(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];const r=this._filterObjectsBeforeEnteringGroup(t),i=super.add(...r);return this._onAfterObjectsChange(Ur,r),i}insertAt(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];const i=this._filterObjectsBeforeEnteringGroup(s),a=super.insertAt(e,...i);return this._onAfterObjectsChange(Ur,i),a}remove(){const e=super.remove(...arguments);return this._onAfterObjectsChange(kn,e),e}_onObjectAdded(e){this.enterGroup(e,!0),this.fire("object:added",{target:e}),e.fire("added",{target:this})}_onObjectRemoved(e,t){this.exitGroup(e,t),this.fire("object:removed",{target:e}),e.fire("removed",{target:this})}_onAfterObjectsChange(e,t){this.layoutManager.performLayout({type:e,targets:t,target:this})}_onStackOrderChanged(){this._set("dirty",!0)}_set(e,t){const s=this[e];return super._set(e,t),e==="canvas"&&s!==t&&(this._objects||[]).forEach((r=>{r._set(e,t)})),this}_shouldSetNestedCoords(){return this.subTargetCheck}removeAll(){return this._activeObjects=[],this.remove(...this._objects)}__objectSelectionMonitor(e,t){let{target:s}=t;const r=this._activeObjects;if(e)r.push(s),this._set("dirty",!0);else if(r.length>0){const i=r.indexOf(s);i>-1&&(r.splice(i,1),this._set("dirty",!0))}}_watchObject(e,t){e&&this._watchObject(!1,t),e?(t.on("selected",this.__objectSelectionTracker),t.on("deselected",this.__objectSelectionDisposer)):(t.off("selected",this.__objectSelectionTracker),t.off("deselected",this.__objectSelectionDisposer))}enterGroup(e,t){e.group&&e.group.remove(e),e._set("parent",this),this._enterGroup(e,t)}_enterGroup(e,t){t&&Wr(e,pe(ze(this.calcTransformMatrix()),e.calcTransformMatrix())),this._shouldSetNestedCoords()&&e.setCoords(),e._set("group",this),e._set("canvas",this.canvas),this._watchObject(!0,e);const s=this.canvas&&this.canvas.getActiveObject&&this.canvas.getActiveObject();s&&(s===e||e.isDescendantOf(s))&&this._activeObjects.push(e)}exitGroup(e,t){this._exitGroup(e,t),e._set("parent",void 0),e._set("canvas",void 0)}_exitGroup(e,t){e._set("group",void 0),t||(Wr(e,pe(this.calcTransformMatrix(),e.calcTransformMatrix())),e.setCoords()),this._watchObject(!1,e);const s=this._activeObjects.length>0?this._activeObjects.indexOf(e):-1;s>-1&&this._activeObjects.splice(s,1)}shouldCache(){const e=de.prototype.shouldCache.call(this);if(e){for(let t=0;t<this._objects.length;t++)if(this._objects[t].willDrawShadow())return this.ownCaching=!1,!1}return e}willDrawShadow(){if(super.willDrawShadow())return!0;for(let e=0;e<this._objects.length;e++)if(this._objects[e].willDrawShadow())return!0;return!1}isOnACache(){return this.ownCaching||!!this.parent&&this.parent.isOnACache()}drawObject(e,t,s){this._renderBackground(e);for(let i=0;i<this._objects.length;i++){var r;const a=this._objects[i];(r=this.canvas)!==null&&r!==void 0&&r.preserveObjectStacking&&a.group!==this?(e.save(),e.transform(...ze(this.calcTransformMatrix())),a.render(e),e.restore()):a.group===this&&a.render(e)}this._drawClipPath(e,this.clipPath,s)}setCoords(){super.setCoords(),this._shouldSetNestedCoords()&&this.forEachObject((e=>e.setCoords()))}triggerLayout(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.layoutManager.performLayout(v({target:this,type:Gr},e))}render(e){this._transformDone=!0,super.render(e),this._transformDone=!1}__serializeObjects(e,t){const s=this.includeDefaultValues;return this._objects.filter((function(r){return!r.excludeFromExport})).map((function(r){const i=r.includeDefaultValues;r.includeDefaultValues=s;const a=r[e||"toObject"](t);return r.includeDefaultValues=i,a}))}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=this.layoutManager.toObject();return v(v(v({},super.toObject(["subTargetCheck","interactive",...e])),t.strategy!=="fit-content"||this.includeDefaultValues?{layoutManager:t}:{}),{},{objects:this.__serializeObjects("toObject",e)})}toString(){return"#<Group: (".concat(this.complexity(),")>")}dispose(){this.layoutManager.unsubscribeTargets({targets:this.getObjects(),target:this}),this._activeObjects=[],this.forEachObject((e=>{this._watchObject(!1,e),e.dispose()})),super.dispose()}_createSVGBgRect(e){if(!this.backgroundColor)return"";const t=qe.prototype._toSVG.call(this),s=t.indexOf("COMMON_PARTS");t[s]='for="group" ';const r=t.join("");return e?e(r):r}_toSVG(e){const t=["<g ","COMMON_PARTS",` >
`],s=this._createSVGBgRect(e);s&&t.push("		",s);for(let r=0;r<this._objects.length;r++)t.push("		",this._objects[r].toSVG(e));return t.push(`</g>
`),t}getSvgStyles(){const e=this.opacity!==void 0&&this.opacity!==1?"opacity: ".concat(this.opacity,";"):"",t=this.visible?"":" visibility: hidden;";return[e,this.getSvgFilter(),t].join("")}toClipPathSVG(e){const t=[],s=this._createSVGBgRect(e);s&&t.push("	",s);for(let r=0;r<this._objects.length;r++)t.push("	",this._objects[r].toClipPathSVG(e));return this._createBaseClipPathSVGMarkup(t,{reviver:e})}static fromObject(e,t){let{type:s,objects:r=[],layoutManager:i}=e,a=Q(e,Th);return Promise.all([Fs(r,t),oi(a,t)]).then((o=>{let[l,c]=o;const h=new this(l,v(v(v({},a),c),{},{layoutManager:new Oh}));if(i){const d=A.getClass(i.type),u=A.getClass(i.strategy);h.layoutManager=new d(new u)}else h.layoutManager=new Bs;return h.layoutManager.subscribeTargets({type:ht,target:h,targets:h.getObjects()}),h.setCoords(),h}))}}m(It,"type","Group"),m(It,"ownDefaults",{strokeWidth:0,subTargetCheck:!1,interactive:!1}),A.setClass(It);const kh=(n,e)=>Math.min(e.width/n.width,e.height/n.height),Dh=(n,e)=>Math.max(e.width/n.width,e.height/n.height),$i="\\s*,?\\s*",bs="".concat($i,"(").concat(We,")"),jh="".concat(bs).concat(bs).concat(bs).concat($i,"([01])").concat($i,"([01])").concat(bs).concat(bs),Mh={m:"l",M:"L"},Ah=(n,e,t,s,r,i,a,o,l,c,h)=>{const d=gt(n),u=ft(n),g=gt(e),f=ft(e),p=t*r*g-s*i*f+a,y=s*r*g+t*i*f+o;return["C",c+l*(-t*r*u-s*i*d),h+l*(-s*r*u+t*i*d),p+l*(t*r*f+s*i*g),y+l*(s*r*f-t*i*g),p,y]},ya=(n,e,t,s)=>{const r=Math.atan2(e,n),i=Math.atan2(s,t);return i>=r?i-r:2*Math.PI-(r-i)};function _a(n,e,t,s,r,i,a,o){let l;if(U.cachesBoundsOfCurve&&(l=[...arguments].join(),js.boundsOfCurveCache[l]))return js.boundsOfCurveCache[l];const c=Math.sqrt,h=Math.abs,d=[],u=[[0,0],[0,0]];let g=6*n-12*t+6*r,f=-3*n+9*t-9*r+3*a,p=3*t-3*n;for(let C=0;C<2;++C){if(C>0&&(g=6*e-12*s+6*i,f=-3*e+9*s-9*i+3*o,p=3*s-3*e),h(f)<1e-12){if(h(g)<1e-12)continue;const W=-p/g;0<W&&W<1&&d.push(W);continue}const k=g*g-4*p*f;if(k<0)continue;const F=c(k),D=(-g+F)/(2*f);0<D&&D<1&&d.push(D);const R=(-g-F)/(2*f);0<R&&R<1&&d.push(R)}let y=d.length;const x=y,b=So(n,e,t,s,r,i,a,o);for(;y--;){const{x:C,y:k}=b(d[y]);u[0][y]=C,u[1][y]=k}u[0][x]=n,u[1][x]=e,u[0][x+1]=a,u[1][x+1]=o;const O=[new _(Math.min(...u[0]),Math.min(...u[1])),new _(Math.max(...u[0]),Math.max(...u[1]))];return U.cachesBoundsOfCurve&&(js.boundsOfCurveCache[l]=O),O}const Eh=(n,e,t)=>{let[s,r,i,a,o,l,c,h]=t;const d=((u,g,f,p,y,x,b)=>{if(f===0||p===0)return[];let O=0,C=0,k=0;const F=Math.PI,D=b*hn,R=ft(D),W=gt(D),K=.5*(-W*u-R*g),E=.5*(-W*g+R*u),G=f**2,Z=p**2,Y=E**2,ae=K**2,ie=G*Z-G*Y-Z*ae;let oe=Math.abs(f),q=Math.abs(p);if(ie<0){const He=Math.sqrt(1-ie/(G*Z));oe*=He,q*=He}else k=(y===x?-1:1)*Math.sqrt(ie/(G*Y+Z*ae));const be=k*oe*E/q,ge=-k*q*K/oe,Xt=W*be-R*ge+.5*u,vs=R*be+W*ge+.5*g;let Dt=ya(1,0,(K-be)/oe,(E-ge)/q),Ge=ya((K-be)/oe,(E-ge)/q,(-K-be)/oe,(-E-ge)/q);x===0&&Ge>0?Ge-=2*F:x===1&&Ge<0&&(Ge+=2*F);const Yt=Math.ceil(Math.abs(Ge/F*2)),it=[],jt=Ge/Yt,yi=8/3*Math.sin(jt/4)*Math.sin(jt/4)/Math.sin(jt/2);let ys=Dt+jt;for(let He=0;He<Yt;He++)it[He]=Ah(Dt,ys,W,R,oe,q,Xt,vs,yi,O,C),O=it[He][5],C=it[He][6],Dt=ys,ys+=jt;return it})(c-n,h-e,r,i,o,l,a);for(let u=0,g=d.length;u<g;u++)d[u][1]+=n,d[u][2]+=e,d[u][3]+=n,d[u][4]+=e,d[u][5]+=n,d[u][6]+=e;return d},Ph=n=>{let e=0,t=0,s=0,r=0;const i=[];let a,o=0,l=0;for(const c of n){const h=[...c];let d;switch(h[0]){case"l":h[1]+=e,h[2]+=t;case"L":e=h[1],t=h[2],d=["L",e,t];break;case"h":h[1]+=e;case"H":e=h[1],d=["L",e,t];break;case"v":h[1]+=t;case"V":t=h[1],d=["L",e,t];break;case"m":h[1]+=e,h[2]+=t;case"M":e=h[1],t=h[2],s=h[1],r=h[2],d=["M",e,t];break;case"c":h[1]+=e,h[2]+=t,h[3]+=e,h[4]+=t,h[5]+=e,h[6]+=t;case"C":o=h[3],l=h[4],e=h[5],t=h[6],d=["C",h[1],h[2],o,l,e,t];break;case"s":h[1]+=e,h[2]+=t,h[3]+=e,h[4]+=t;case"S":a==="C"?(o=2*e-o,l=2*t-l):(o=e,l=t),e=h[3],t=h[4],d=["C",o,l,h[1],h[2],e,t],o=d[3],l=d[4];break;case"q":h[1]+=e,h[2]+=t,h[3]+=e,h[4]+=t;case"Q":o=h[1],l=h[2],e=h[3],t=h[4],d=["Q",o,l,e,t];break;case"t":h[1]+=e,h[2]+=t;case"T":a==="Q"?(o=2*e-o,l=2*t-l):(o=e,l=t),e=h[1],t=h[2],d=["Q",o,l,e,t];break;case"a":h[6]+=e,h[7]+=t;case"A":Eh(e,t,h).forEach((u=>i.push(u))),e=h[6],t=h[7];break;case"z":case"Z":e=s,t=r,d=["Z"]}d?(i.push(d),a=d[0]):a=""}return i},Hr=(n,e,t,s)=>Math.sqrt((t-n)**2+(s-e)**2),So=(n,e,t,s,r,i,a,o)=>l=>{const c=l**3,h=(g=>3*g**2*(1-g))(l),d=(g=>3*g*(1-g)**2)(l),u=(g=>(1-g)**3)(l);return new _(a*c+r*h+t*d+n*u,o*c+i*h+s*d+e*u)},To=n=>n**2,Oo=n=>2*n*(1-n),ko=n=>(1-n)**2,Fh=(n,e,t,s,r,i,a,o)=>l=>{const c=To(l),h=Oo(l),d=ko(l),u=3*(d*(t-n)+h*(r-t)+c*(a-r)),g=3*(d*(s-e)+h*(i-s)+c*(o-i));return Math.atan2(g,u)},Rh=(n,e,t,s,r,i)=>a=>{const o=To(a),l=Oo(a),c=ko(a);return new _(r*o+t*l+n*c,i*o+s*l+e*c)},Lh=(n,e,t,s,r,i)=>a=>{const o=1-a,l=2*(o*(t-n)+a*(r-t)),c=2*(o*(s-e)+a*(i-s));return Math.atan2(c,l)},xa=(n,e,t)=>{let s=new _(e,t),r=0;for(let i=1;i<=100;i+=1){const a=n(i/100);r+=Hr(s.x,s.y,a.x,a.y),s=a}return r},Ih=(n,e)=>{let t,s=0,r=0,i={x:n.x,y:n.y},a=v({},i),o=.01,l=0;const c=n.iterator,h=n.angleFinder;for(;r<e&&o>1e-4;)a=c(s),l=s,t=Hr(i.x,i.y,a.x,a.y),t+r>e?(s-=o,o/=2):(i=a,s+=o,r+=t);return v(v({},a),{},{angle:h(l)})},Do=n=>{let e,t,s=0,r=0,i=0,a=0,o=0;const l=[];for(const c of n){const h={x:r,y:i,command:c[0],length:0};switch(c[0]){case"M":t=h,t.x=a=r=c[1],t.y=o=i=c[2];break;case"L":t=h,t.length=Hr(r,i,c[1],c[2]),r=c[1],i=c[2];break;case"C":e=So(r,i,c[1],c[2],c[3],c[4],c[5],c[6]),t=h,t.iterator=e,t.angleFinder=Fh(r,i,c[1],c[2],c[3],c[4],c[5],c[6]),t.length=xa(e,r,i),r=c[5],i=c[6];break;case"Q":e=Rh(r,i,c[1],c[2],c[3],c[4]),t=h,t.iterator=e,t.angleFinder=Lh(r,i,c[1],c[2],c[3],c[4]),t.length=xa(e,r,i),r=c[3],i=c[4];break;case"Z":t=h,t.destX=a,t.destY=o,t.length=Hr(r,i,a,o),r=a,i=o}s+=t.length,l.push(t)}return l.push({length:s,x:r,y:i}),l},Bh=function(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Do(n),s=0;for(;e-t[s].length>0&&s<t.length-2;)e-=t[s].length,s++;const r=t[s],i=e/r.length,a=n[s];switch(r.command){case"M":return{x:r.x,y:r.y,angle:0};case"Z":return v(v({},new _(r.x,r.y).lerp(new _(r.destX,r.destY),i)),{},{angle:Math.atan2(r.destY-r.y,r.destX-r.x)});case"L":return v(v({},new _(r.x,r.y).lerp(new _(a[1],a[2]),i)),{},{angle:Math.atan2(a[2]-r.y,a[1]-r.x)});case"C":case"Q":return Ih(r,e)}},Nh=new RegExp("[mzlhvcsqta][^mzlhvcsqta]*","gi"),ba=new RegExp(jh,"g"),Vh=new RegExp(We,"gi"),zh={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},Wh=n=>{var e;const t=[],s=(e=n.match(Nh))!==null&&e!==void 0?e:[];for(const r of s){const i=r[0];if(i==="z"||i==="Z"){t.push([i]);continue}const a=zh[i.toLowerCase()];let o=[];if(i==="a"||i==="A"){ba.lastIndex=0;for(let l=null;l=ba.exec(r);)o.push(...l.slice(1))}else o=r.match(Vh)||[];for(let l=0;l<o.length;l+=a){const c=new Array(a),h=Mh[i];c[0]=l>0&&h?h:i;for(let d=0;d<a;d++)c[d+1]=parseFloat(o[l+d]);t.push(c)}}return t},Xh=(n,e)=>n.map((t=>t.map(((s,r)=>r===0||e===void 0?s:J(s,e))).join(" "))).join(" ");function qi(n,e){const t=n.style;t&&e&&(typeof e=="string"?t.cssText+=";"+e:Object.entries(e).forEach((s=>{let[r,i]=s;return t.setProperty(r,i)})))}class Yh extends Qa{constructor(e){let{allowTouchScrolling:t=!1,containerClass:s=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e),m(this,"upper",void 0),m(this,"container",void 0);const{el:r}=this.lower,i=this.createUpperCanvas();this.upper={el:i,ctx:i.getContext("2d")},this.applyCanvasStyle(r,{allowTouchScrolling:t}),this.applyCanvasStyle(i,{allowTouchScrolling:t,styles:{position:"absolute",left:"0",top:"0"}});const a=this.createContainerElement();a.classList.add(s),r.parentNode&&r.parentNode.replaceChild(a,r),a.append(r,i),this.container=a}createUpperCanvas(){const{el:e}=this.lower,t=pt();return t.className=e.className,t.classList.remove("lower-canvas"),t.classList.add("upper-canvas"),t.setAttribute("data-fabric","top"),t.style.cssText=e.style.cssText,t.setAttribute("draggable","true"),t}createContainerElement(){const e=os().createElement("div");return e.setAttribute("data-fabric","wrapper"),qi(e,{position:"relative"}),Gn(e),e}applyCanvasStyle(e,t){const{styles:s,allowTouchScrolling:r}=t;qi(e,v(v({},s),{},{"touch-action":r?"manipulation":Te})),Gn(e)}setDimensions(e,t){super.setDimensions(e,t);const{el:s,ctx:r}=this.upper;Ja(s,r,e,t)}setCSSDimensions(e){super.setCSSDimensions(e),Wi(this.upper.el,e),Wi(this.container,e)}cleanupDOM(e){const t=this.container,{el:s}=this.lower,{el:r}=this.upper;super.cleanupDOM(e),t.removeChild(r),t.removeChild(s),t.parentNode&&t.parentNode.replaceChild(s,t)}dispose(){super.dispose(),tt().dispose(this.upper.el),delete this.upper,delete this.container}}class di extends rr{constructor(){super(...arguments),m(this,"targets",[]),m(this,"_hoveredTargets",[]),m(this,"_objectsToRender",void 0),m(this,"_currentTransform",null),m(this,"_groupSelector",null),m(this,"contextTopDirty",!1)}static getDefaults(){return v(v({},super.getDefaults()),di.ownDefaults)}get upperCanvasEl(){var e;return(e=this.elements.upper)===null||e===void 0?void 0:e.el}get contextTop(){var e;return(e=this.elements.upper)===null||e===void 0?void 0:e.ctx}get wrapperEl(){return this.elements.container}initElements(e){this.elements=new Yh(e,{allowTouchScrolling:this.allowTouchScrolling,containerClass:this.containerClass}),this._createCacheCanvas()}_onObjectAdded(e){this._objectsToRender=void 0,super._onObjectAdded(e)}_onObjectRemoved(e){this._objectsToRender=void 0,e===this._activeObject&&(this.fire("before:selection:cleared",{deselected:[e]}),this._discardActiveObject(),this.fire("selection:cleared",{deselected:[e]}),e.fire("deselected",{target:e})),e===this._hoveredTarget&&(this._hoveredTarget=void 0,this._hoveredTargets=[]),super._onObjectRemoved(e)}_onStackOrderChanged(){this._objectsToRender=void 0,super._onStackOrderChanged()}_chooseObjectsToRender(){const e=this._activeObject;return!this.preserveObjectStacking&&e?this._objects.filter((t=>!t.group&&t!==e)).concat(e):this._objects}renderAll(){this.cancelRequestedRender(),this.destroyed||(!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),!this._objectsToRender&&(this._objectsToRender=this._chooseObjectsToRender()),this.renderCanvas(this.getContext(),this._objectsToRender))}renderTopLayer(e){e.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(e),this.contextTopDirty=!0),e.restore()}renderTop(){const e=this.contextTop;this.clearContext(e),this.renderTopLayer(e),this.fire("after:render",{ctx:e})}setTargetFindTolerance(e){e=Math.round(e),this.targetFindTolerance=e;const t=this.getRetinaScaling(),s=Math.ceil((2*e+1)*t);this.pixelFindCanvasEl.width=this.pixelFindCanvasEl.height=s,this.pixelFindContext.scale(t,t)}isTargetTransparent(e,t,s){const r=this.targetFindTolerance,i=this.pixelFindContext;this.clearContext(i),i.save(),i.translate(-t+r,-s+r),i.transform(...this.viewportTransform);const a=e.selectionBackgroundColor;e.selectionBackgroundColor="",e.render(i),e.selectionBackgroundColor=a,i.restore();const o=Math.round(r*this.getRetinaScaling());return Zc(i,o,o,o)}_isSelectionKeyPressed(e){const t=this.selectionKey;return!!t&&(Array.isArray(t)?!!t.find((s=>!!s&&e[s]===!0)):e[t])}_shouldClearSelection(e,t){const s=this.getActiveObjects(),r=this._activeObject;return!!(!t||t&&r&&s.length>1&&s.indexOf(t)===-1&&r!==t&&!this._isSelectionKeyPressed(e)||t&&!t.evented||t&&!t.selectable&&r&&r!==t)}_shouldCenterTransform(e,t,s){if(!e)return;let r;return t===ni||t===ke||t===Ee||t===Ps?r=this.centeredScaling||e.centeredScaling:t===gn&&(r=this.centeredRotation||e.centeredRotation),r?!s:s}_getOriginFromCorner(e,t){const s={x:e.originX,y:e.originY};return t&&(["ml","tl","bl"].includes(t)?s.x=se:["mr","tr","br"].includes(t)&&(s.x=H),["tl","mt","tr"].includes(t)?s.y=zi:["bl","mb","br"].includes(t)&&(s.y=Se)),s}_setupCurrentTransform(e,t,s){var r;const i=t.group?Qt(this.getScenePoint(e),void 0,t.group.calcTransformMatrix()):this.getScenePoint(e),{key:a="",control:o}=t.getActiveControl()||{},l=s&&o?(r=o.getActionHandler(e,t,o))===null||r===void 0?void 0:r.bind(o):hc,c=((g,f,p,y)=>{if(!f||!g)return"drag";const x=y.controls[f];return x.getActionName(p,x,y)})(s,a,e,t),h=e[this.centeredKey],d=this._shouldCenterTransform(t,c,h)?{x:z,y:z}:this._getOriginFromCorner(t,a),u={target:t,action:c,actionHandler:l,actionPerformed:!1,corner:a,scaleX:t.scaleX,scaleY:t.scaleY,skewX:t.skewX,skewY:t.skewY,offsetX:i.x-t.left,offsetY:i.y-t.top,originX:d.x,originY:d.y,ex:i.x,ey:i.y,lastX:i.x,lastY:i.y,theta:re(t.angle),width:t.width,height:t.height,shiftKey:e.shiftKey,altKey:h,original:v(v({},eo(t)),{},{originX:d.x,originY:d.y})};this._currentTransform=u,this.fire("before:transform",{e,transform:u})}setCursor(e){this.upperCanvasEl.style.cursor=e}_drawSelection(e){const{x:t,y:s,deltaX:r,deltaY:i}=this._groupSelector,a=new _(t,s).transform(this.viewportTransform),o=new _(t+r,s+i).transform(this.viewportTransform),l=this.selectionLineWidth/2;let c=Math.min(a.x,o.x),h=Math.min(a.y,o.y),d=Math.max(a.x,o.x),u=Math.max(a.y,o.y);this.selectionColor&&(e.fillStyle=this.selectionColor,e.fillRect(c,h,d-c,u-h)),this.selectionLineWidth&&this.selectionBorderColor&&(e.lineWidth=this.selectionLineWidth,e.strokeStyle=this.selectionBorderColor,c+=l,h+=l,d-=l,u-=l,de.prototype._setLineDash.call(this,e,this.selectionDashArray),e.strokeRect(c,h,d-c,u-h))}findTarget(e){if(this.skipTargetFind)return;const t=this.getViewportPoint(e),s=this._activeObject,r=this.getActiveObjects();if(this.targets=[],s&&r.length>=1){if(s.findControl(t,Xi(e))||r.length>1&&this.searchPossibleTargets([s],t))return s;if(s===this.searchPossibleTargets([s],t)){if(this.preserveObjectStacking){const i=this.targets;this.targets=[];const a=this.searchPossibleTargets(this._objects,t);return e[this.altSelectionKey]&&a&&a!==s?(this.targets=i,s):a}return s}}return this.searchPossibleTargets(this._objects,t)}_pointIsInObjectSelectionArea(e,t){let s=e.getCoords();const r=this.getZoom(),i=e.padding/r;if(i){const[a,o,l,c]=s,h=Math.atan2(o.y-a.y,o.x-a.x),d=gt(h)*i,u=ft(h)*i,g=d+u,f=d-u;s=[new _(a.x-f,a.y-g),new _(o.x+g,o.y-f),new _(l.x+f,l.y+g),new _(c.x-g,c.y+f)]}return ee.isPointInPolygon(t,s)}_checkTarget(e,t){return!!(e&&e.visible&&e.evented&&this._pointIsInObjectSelectionArea(e,Qt(t,void 0,this.viewportTransform))&&(!this.perPixelTargetFind&&!e.perPixelTargetFind||e.isEditing||!this.isTargetTransparent(e,t.x,t.y)))}_searchPossibleTargets(e,t){let s=e.length;for(;s--;){const r=e[s];if(this._checkTarget(r,t)){if(Ar(r)&&r.subTargetCheck){const i=this._searchPossibleTargets(r._objects,t);i&&this.targets.push(i)}return r}}}searchPossibleTargets(e,t){const s=this._searchPossibleTargets(e,t);if(s&&Ar(s)&&s.interactive&&this.targets[0]){const r=this.targets;for(let i=r.length-1;i>0;i--){const a=r[i];if(!Ar(a)||!a.interactive)return a}return r[0]}return s}getViewportPoint(e){return this._pointer?this._pointer:this.getPointer(e,!0)}getScenePoint(e){return this._absolutePointer?this._absolutePointer:this.getPointer(e)}getPointer(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=this.upperCanvasEl,r=s.getBoundingClientRect();let i=rc(e),a=r.width||0,o=r.height||0;a&&o||(Se in r&&zi in r&&(o=Math.abs(r.top-r.bottom)),se in r&&H in r&&(a=Math.abs(r.right-r.left))),this.calcOffset(),i.x=i.x-this._offset.left,i.y=i.y-this._offset.top,t||(i=Qt(i,void 0,this.viewportTransform));const l=this.getRetinaScaling();l!==1&&(i.x/=l,i.y/=l);const c=a===0||o===0?new _(1,1):new _(s.width/a,s.height/o);return i.multiply(c)}_setDimensionsImpl(e,t){this._resetTransformEventData(),super._setDimensionsImpl(e,t),this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop)}_createCacheCanvas(){this.pixelFindCanvasEl=pt(),this.pixelFindContext=this.pixelFindCanvasEl.getContext("2d",{willReadFrequently:!0}),this.setTargetFindTolerance(this.targetFindTolerance)}getTopContext(){return this.elements.upper.ctx}getSelectionContext(){return this.elements.upper.ctx}getSelectionElement(){return this.elements.upper.el}getActiveObject(){return this._activeObject}getActiveObjects(){const e=this._activeObject;return At(e)?e.getObjects():e?[e]:[]}_fireSelectionEvents(e,t){let s=!1,r=!1;const i=this.getActiveObjects(),a=[],o=[];e.forEach((l=>{i.includes(l)||(s=!0,l.fire("deselected",{e:t,target:l}),o.push(l))})),i.forEach((l=>{e.includes(l)||(s=!0,l.fire("selected",{e:t,target:l}),a.push(l))})),e.length>0&&i.length>0?(r=!0,s&&this.fire("selection:updated",{e:t,selected:a,deselected:o})):i.length>0?(r=!0,this.fire("selection:created",{e:t,selected:a})):e.length>0&&(r=!0,this.fire("selection:cleared",{e:t,deselected:o})),r&&(this._objectsToRender=void 0)}setActiveObject(e,t){const s=this.getActiveObjects(),r=this._setActiveObject(e,t);return this._fireSelectionEvents(s,t),r}_setActiveObject(e,t){const s=this._activeObject;return s!==e&&!(!this._discardActiveObject(t,e)&&this._activeObject)&&!e.onSelect({e:t})&&(this._activeObject=e,At(e)&&s!==e&&e.set("canvas",this),e.setCoords(),!0)}_discardActiveObject(e,t){const s=this._activeObject;return!!s&&!s.onDeselect({e,object:t})&&(this._currentTransform&&this._currentTransform.target===s&&this.endCurrentTransform(e),At(s)&&s===this._hoveredTarget&&(this._hoveredTarget=void 0),this._activeObject=void 0,!0)}discardActiveObject(e){const t=this.getActiveObjects(),s=this.getActiveObject();t.length&&this.fire("before:selection:cleared",{e,deselected:[s]});const r=this._discardActiveObject(e);return this._fireSelectionEvents(t,e),r}endCurrentTransform(e){const t=this._currentTransform;this._finalizeCurrentTransform(e),t&&t.target&&(t.target.isMoving=!1),this._currentTransform=null}_finalizeCurrentTransform(e){const t=this._currentTransform,s=t.target,r={e,target:s,transform:t,action:t.action};s._scaling&&(s._scaling=!1),s.setCoords(),t.actionPerformed&&(this.fire("object:modified",r),s.fire(Nr,r))}setViewportTransform(e){super.setViewportTransform(e);const t=this._activeObject;t&&t.setCoords()}destroy(){const e=this._activeObject;At(e)&&(e.removeAll(),e.dispose()),delete this._activeObject,super.destroy(),this.pixelFindContext=null,this.pixelFindCanvasEl=void 0}clear(){this.discardActiveObject(),this._activeObject=void 0,this.clearContext(this.contextTop),super.clear()}drawControls(e){const t=this._activeObject;t&&t._renderControls(e)}_toObject(e,t,s){const r=this._realizeGroupTransformOnObject(e),i=super._toObject(e,t,s);return e.set(r),i}_realizeGroupTransformOnObject(e){const{group:t}=e;if(t&&At(t)&&this._activeObject===t){const s=us(e,["angle","flipX","flipY",H,ke,Ee,ls,cs,Se]);return nc(e,t.calcOwnMatrix()),s}return{}}_setSVGObject(e,t,s){const r=this._realizeGroupTransformOnObject(t);super._setSVGObject(e,t,s),t.set(r)}}m(di,"ownDefaults",{uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",selection:!0,selectionKey:"shiftKey",selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,enablePointerEvents:!1,containerClass:"canvas-container",preserveObjectStacking:!1});class Uh{constructor(e){m(this,"targets",[]),m(this,"__disposer",void 0);const t=()=>{const{hiddenTextarea:r}=e.getActiveObject()||{};r&&r.focus()},s=e.upperCanvasEl;s.addEventListener("click",t),this.__disposer=()=>s.removeEventListener("click",t)}exitTextEditing(){this.target=void 0,this.targets.forEach((e=>{e.isEditing&&e.exitEditing()}))}add(e){this.targets.push(e)}remove(e){this.unregister(e),Ht(this.targets,e)}register(e){this.target=e}unregister(e){e===this.target&&(this.target=void 0)}onMouseMove(e){var t;!((t=this.target)===null||t===void 0)&&t.isEditing&&this.target.updateSelectionOnMouseMove(e)}clear(){this.targets=[],this.target=void 0}dispose(){this.clear(),this.__disposer(),delete this.__disposer}}const Gh=["target","oldTarget","fireCanvas","e"],je={passive:!1},Gt=(n,e)=>{const t=n.getViewportPoint(e),s=n.getScenePoint(e);return{viewportPoint:t,scenePoint:s,pointer:t,absolutePointer:s}},wt=function(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];return n.addEventListener(...t)},Me=function(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];return n.removeEventListener(...t)},Hh={mouse:{in:"over",out:"out",targetIn:"mouseover",targetOut:"mouseout",canvasIn:"mouse:over",canvasOut:"mouse:out"},drag:{in:"enter",out:"leave",targetIn:"dragenter",targetOut:"dragleave",canvasIn:"drag:enter",canvasOut:"drag:leave"}};class Ki extends di{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}),m(this,"_isClick",void 0),m(this,"textEditingManager",new Uh(this)),["_onMouseDown","_onTouchStart","_onMouseMove","_onMouseUp","_onTouchEnd","_onResize","_onMouseWheel","_onMouseOut","_onMouseEnter","_onContextMenu","_onClick","_onDragStart","_onDragEnd","_onDragProgress","_onDragOver","_onDragEnter","_onDragLeave","_onDrop"].forEach((t=>{this[t]=this[t].bind(this)})),this.addOrRemove(wt,"add")}_getEventPrefix(){return this.enablePointerEvents?"pointer":"mouse"}addOrRemove(e,t){const s=this.upperCanvasEl,r=this._getEventPrefix();e(Ka(s),"resize",this._onResize),e(s,r+"down",this._onMouseDown),e(s,"".concat(r,"move"),this._onMouseMove,je),e(s,"".concat(r,"out"),this._onMouseOut),e(s,"".concat(r,"enter"),this._onMouseEnter),e(s,"wheel",this._onMouseWheel),e(s,"contextmenu",this._onContextMenu),e(s,"click",this._onClick),e(s,"dblclick",this._onClick),e(s,"dragstart",this._onDragStart),e(s,"dragend",this._onDragEnd),e(s,"dragover",this._onDragOver),e(s,"dragenter",this._onDragEnter),e(s,"dragleave",this._onDragLeave),e(s,"drop",this._onDrop),this.enablePointerEvents||e(s,"touchstart",this._onTouchStart,je)}removeListeners(){this.addOrRemove(Me,"remove");const e=this._getEventPrefix(),t=Ve(this.upperCanvasEl);Me(t,"".concat(e,"up"),this._onMouseUp),Me(t,"touchend",this._onTouchEnd,je),Me(t,"".concat(e,"move"),this._onMouseMove,je),Me(t,"touchmove",this._onMouseMove,je),clearTimeout(this._willAddMouseDown)}_onMouseWheel(e){this.__onMouseWheel(e)}_onMouseOut(e){const t=this._hoveredTarget,s=v({e},Gt(this,e));this.fire("mouse:out",v(v({},s),{},{target:t})),this._hoveredTarget=void 0,t&&t.fire("mouseout",v({},s)),this._hoveredTargets.forEach((r=>{this.fire("mouse:out",v(v({},s),{},{target:r})),r&&r.fire("mouseout",v({},s))})),this._hoveredTargets=[]}_onMouseEnter(e){this._currentTransform||this.findTarget(e)||(this.fire("mouse:over",v({e},Gt(this,e))),this._hoveredTarget=void 0,this._hoveredTargets=[])}_onDragStart(e){this._isClick=!1;const t=this.getActiveObject();if(t&&t.onDragStart(e)){this._dragSource=t;const s={e,target:t};return this.fire("dragstart",s),t.fire("dragstart",s),void wt(this.upperCanvasEl,"drag",this._onDragProgress)}Hn(e)}_renderDragEffects(e,t,s){let r=!1;const i=this._dropTarget;i&&i!==t&&i!==s&&(i.clearContextTop(),r=!0),t?.clearContextTop(),s!==t&&s?.clearContextTop();const a=this.contextTop;a.save(),a.transform(...this.viewportTransform),t&&(a.save(),t.transform(a),t.renderDragSourceEffect(e),a.restore(),r=!0),s&&(a.save(),s.transform(a),s.renderDropTargetEffect(e),a.restore(),r=!0),a.restore(),r&&(this.contextTopDirty=!0)}_onDragEnd(e){const t=!!e.dataTransfer&&e.dataTransfer.dropEffect!==Te,s=t?this._activeObject:void 0,r={e,target:this._dragSource,subTargets:this.targets,dragSource:this._dragSource,didDrop:t,dropTarget:s};Me(this.upperCanvasEl,"drag",this._onDragProgress),this.fire("dragend",r),this._dragSource&&this._dragSource.fire("dragend",r),delete this._dragSource,this._onMouseUp(e)}_onDragProgress(e){const t={e,target:this._dragSource,dragSource:this._dragSource,dropTarget:this._draggedoverTarget};this.fire("drag",t),this._dragSource&&this._dragSource.fire("drag",t)}findDragTargets(e){return this.targets=[],{target:this._searchPossibleTargets(this._objects,this.getViewportPoint(e)),targets:[...this.targets]}}_onDragOver(e){const t="dragover",{target:s,targets:r}=this.findDragTargets(e),i=this._dragSource,a={e,target:s,subTargets:r,dragSource:i,canDrop:!1,dropTarget:void 0};let o;this.fire(t,a),this._fireEnterLeaveEvents(s,a),s&&(s.canDrop(e)&&(o=s),s.fire(t,a));for(let l=0;l<r.length;l++){const c=r[l];c.canDrop(e)&&(o=c),c.fire(t,a)}this._renderDragEffects(e,i,o),this._dropTarget=o}_onDragEnter(e){const{target:t,targets:s}=this.findDragTargets(e),r={e,target:t,subTargets:s,dragSource:this._dragSource};this.fire("dragenter",r),this._fireEnterLeaveEvents(t,r)}_onDragLeave(e){const t={e,target:this._draggedoverTarget,subTargets:this.targets,dragSource:this._dragSource};this.fire("dragleave",t),this._fireEnterLeaveEvents(void 0,t),this._renderDragEffects(e,this._dragSource),this._dropTarget=void 0,this.targets=[],this._hoveredTargets=[]}_onDrop(e){const{target:t,targets:s}=this.findDragTargets(e),r=this._basicEventHandler("drop:before",v({e,target:t,subTargets:s,dragSource:this._dragSource},Gt(this,e)));r.didDrop=!1,r.dropTarget=void 0,this._basicEventHandler("drop",r),this.fire("drop:after",r)}_onContextMenu(e){const t=this.findTarget(e),s=this.targets||[],r=this._basicEventHandler("contextmenu:before",{e,target:t,subTargets:s});return this.stopContextMenu&&Hn(e),this._basicEventHandler("contextmenu",r),!1}_onClick(e){const t=e.detail;t>3||t<2||(this._cacheTransformEventData(e),t==2&&e.type==="dblclick"&&this._handleEvent(e,"dblclick"),t==3&&this._handleEvent(e,"tripleclick"),this._resetTransformEventData())}getPointerId(e){const t=e.changedTouches;return t?t[0]&&t[0].identifier:this.enablePointerEvents?e.pointerId:-1}_isMainEvent(e){return e.isPrimary===!0||e.isPrimary!==!1&&(e.type==="touchend"&&e.touches.length===0||!e.changedTouches||e.changedTouches[0].identifier===this.mainTouchId)}_onTouchStart(e){let t=!this.allowTouchScrolling;const s=this._activeObject;this.mainTouchId===void 0&&(this.mainTouchId=this.getPointerId(e)),this.__onMouseDown(e),(this.isDrawingMode||s&&this._target===s)&&(t=!0),t&&e.preventDefault(),this._resetTransformEventData();const r=this.upperCanvasEl,i=this._getEventPrefix(),a=Ve(r);wt(a,"touchend",this._onTouchEnd,je),t&&wt(a,"touchmove",this._onMouseMove,je),Me(r,"".concat(i,"down"),this._onMouseDown)}_onMouseDown(e){this.__onMouseDown(e),this._resetTransformEventData();const t=this.upperCanvasEl,s=this._getEventPrefix();Me(t,"".concat(s,"move"),this._onMouseMove,je);const r=Ve(t);wt(r,"".concat(s,"up"),this._onMouseUp),wt(r,"".concat(s,"move"),this._onMouseMove,je)}_onTouchEnd(e){if(e.touches.length>0)return;this.__onMouseUp(e),this._resetTransformEventData(),delete this.mainTouchId;const t=this._getEventPrefix(),s=Ve(this.upperCanvasEl);Me(s,"touchend",this._onTouchEnd,je),Me(s,"touchmove",this._onMouseMove,je),this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout((()=>{wt(this.upperCanvasEl,"".concat(t,"down"),this._onMouseDown),this._willAddMouseDown=0}),400)}_onMouseUp(e){this.__onMouseUp(e),this._resetTransformEventData();const t=this.upperCanvasEl,s=this._getEventPrefix();if(this._isMainEvent(e)){const r=Ve(this.upperCanvasEl);Me(r,"".concat(s,"up"),this._onMouseUp),Me(r,"".concat(s,"move"),this._onMouseMove,je),wt(t,"".concat(s,"move"),this._onMouseMove,je)}}_onMouseMove(e){const t=this.getActiveObject();!this.allowTouchScrolling&&(!t||!t.shouldStartDragging(e))&&e.preventDefault&&e.preventDefault(),this.__onMouseMove(e)}_onResize(){this.calcOffset(),this._resetTransformEventData()}_shouldRender(e){const t=this.getActiveObject();return!!t!=!!e||t&&e&&t!==e}__onMouseUp(e){var t;this._cacheTransformEventData(e),this._handleEvent(e,"up:before");const s=this._currentTransform,r=this._isClick,i=this._target,{button:a}=e;if(a)return(this.fireMiddleClick&&a===1||this.fireRightClick&&a===2)&&this._handleEvent(e,"up"),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(e);if(!this._isMainEvent(e))return;let o,l,c=!1;if(s&&(this._finalizeCurrentTransform(e),c=s.actionPerformed),!r){const h=i===this._activeObject;this.handleSelection(e),c||(c=this._shouldRender(i)||!h&&i===this._activeObject)}if(i){const h=i.findControl(this.getViewportPoint(e),Xi(e)),{key:d,control:u}=h||{};if(l=d,i.selectable&&i!==this._activeObject&&i.activeOn==="up")this.setActiveObject(i,e),c=!0;else if(u){const g=u.getMouseUpHandler(e,i,u);g&&(o=this.getScenePoint(e),g.call(u,e,s,o.x,o.y))}i.isMoving=!1}if(s&&(s.target!==i||s.corner!==l)){const h=s.target&&s.target.controls[s.corner],d=h&&h.getMouseUpHandler(e,s.target,h);o=o||this.getScenePoint(e),d&&d.call(h,e,s,o.x,o.y)}this._setCursorFromEvent(e,i),this._handleEvent(e,"up"),this._groupSelector=null,this._currentTransform=null,i&&(i.__corner=void 0),c?this.requestRenderAll():r||(t=this._activeObject)!==null&&t!==void 0&&t.isEditing||this.renderTop()}_basicEventHandler(e,t){const{target:s,subTargets:r=[]}=t;this.fire(e,t),s&&s.fire(e,t);for(let i=0;i<r.length;i++)r[i]!==s&&r[i].fire(e,t);return t}_handleEvent(e,t,s){const r=this._target,i=this.targets||[],a=v(v(v({e,target:r,subTargets:i},Gt(this,e)),{},{transform:this._currentTransform},t==="up:before"||t==="up"?{isClick:this._isClick,currentTarget:this.findTarget(e),currentSubTargets:this.targets}:{}),t==="down:before"||t==="down"?s:{});this.fire("mouse:".concat(t),a),r&&r.fire("mouse".concat(t),a);for(let o=0;o<i.length;o++)i[o]!==r&&i[o].fire("mouse".concat(t),a)}_onMouseDownInDrawingMode(e){this._isCurrentlyDrawing=!0,this.getActiveObject()&&(this.discardActiveObject(e),this.requestRenderAll());const t=this.getScenePoint(e);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseDown(t,{e,pointer:t}),this._handleEvent(e,"down",{alreadySelected:!1})}_onMouseMoveInDrawingMode(e){if(this._isCurrentlyDrawing){const t=this.getScenePoint(e);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseMove(t,{e,pointer:t})}this.setCursor(this.freeDrawingCursor),this._handleEvent(e,"move")}_onMouseUpInDrawingMode(e){const t=this.getScenePoint(e);this.freeDrawingBrush?this._isCurrentlyDrawing=!!this.freeDrawingBrush.onMouseUp({e,pointer:t}):this._isCurrentlyDrawing=!1,this._handleEvent(e,"up")}__onMouseDown(e){this._isClick=!0,this._cacheTransformEventData(e),this._handleEvent(e,"down:before");let t=this._target,s=!!t&&t===this._activeObject;const{button:r}=e;if(r)return(this.fireMiddleClick&&r===1||this.fireRightClick&&r===2)&&this._handleEvent(e,"down",{alreadySelected:s}),void this._resetTransformEventData();if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(e);if(!this._isMainEvent(e)||this._currentTransform)return;let i=this._shouldRender(t),a=!1;if(this.handleMultiSelection(e,t)?(t=this._activeObject,a=!0,i=!0):this._shouldClearSelection(e,t)&&this.discardActiveObject(e),this.selection&&(!t||!t.selectable&&!t.isEditing&&t!==this._activeObject)){const o=this.getScenePoint(e);this._groupSelector={x:o.x,y:o.y,deltaY:0,deltaX:0}}if(s=!!t&&t===this._activeObject,t){t.selectable&&t.activeOn==="down"&&this.setActiveObject(t,e);const o=t.findControl(this.getViewportPoint(e),Xi(e));if(t===this._activeObject&&(o||!a)){this._setupCurrentTransform(e,t,s);const l=o?o.control:void 0,c=this.getScenePoint(e),h=l&&l.getMouseDownHandler(e,t,l);h&&h.call(l,e,this._currentTransform,c.x,c.y)}}i&&(this._objectsToRender=void 0),this._handleEvent(e,"down",{alreadySelected:s}),i&&this.requestRenderAll()}_resetTransformEventData(){this._target=this._pointer=this._absolutePointer=void 0}_cacheTransformEventData(e){this._resetTransformEventData(),this._pointer=this.getViewportPoint(e),this._absolutePointer=Qt(this._pointer,void 0,this.viewportTransform),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(e)}__onMouseMove(e){if(this._isClick=!1,this._cacheTransformEventData(e),this._handleEvent(e,"move:before"),this.isDrawingMode)return void this._onMouseMoveInDrawingMode(e);if(!this._isMainEvent(e))return;const t=this._groupSelector;if(t){const s=this.getScenePoint(e);t.deltaX=s.x-t.x,t.deltaY=s.y-t.y,this.renderTop()}else if(this._currentTransform)this._transformObject(e);else{const s=this.findTarget(e);this._setCursorFromEvent(e,s),this._fireOverOutEvents(e,s)}this.textEditingManager.onMouseMove(e),this._handleEvent(e,"move"),this._resetTransformEventData()}_fireOverOutEvents(e,t){const s=this._hoveredTarget,r=this._hoveredTargets,i=this.targets,a=Math.max(r.length,i.length);this.fireSyntheticInOutEvents("mouse",{e,target:t,oldTarget:s,fireCanvas:!0});for(let o=0;o<a;o++)this.fireSyntheticInOutEvents("mouse",{e,target:i[o],oldTarget:r[o]});this._hoveredTarget=t,this._hoveredTargets=this.targets.concat()}_fireEnterLeaveEvents(e,t){const s=this._draggedoverTarget,r=this._hoveredTargets,i=this.targets,a=Math.max(r.length,i.length);this.fireSyntheticInOutEvents("drag",v(v({},t),{},{target:e,oldTarget:s,fireCanvas:!0}));for(let o=0;o<a;o++)this.fireSyntheticInOutEvents("drag",v(v({},t),{},{target:i[o],oldTarget:r[o]}));this._draggedoverTarget=e}fireSyntheticInOutEvents(e,t){let{target:s,oldTarget:r,fireCanvas:i,e:a}=t,o=Q(t,Gh);const{targetIn:l,targetOut:c,canvasIn:h,canvasOut:d}=Hh[e],u=r!==s;if(r&&u){const g=v(v({},o),{},{e:a,target:r,nextTarget:s},Gt(this,a));i&&this.fire(d,g),r.fire(c,g)}if(s&&u){const g=v(v({},o),{},{e:a,target:s,previousTarget:r},Gt(this,a));i&&this.fire(h,g),s.fire(l,g)}}__onMouseWheel(e){this._cacheTransformEventData(e),this._handleEvent(e,"wheel"),this._resetTransformEventData()}_transformObject(e){const t=this.getScenePoint(e),s=this._currentTransform,r=s.target,i=r.group?Qt(t,void 0,r.group.calcTransformMatrix()):t;s.shiftKey=e.shiftKey,s.altKey=!!this.centeredKey&&e[this.centeredKey],this._performTransformAction(e,s,i),s.actionPerformed&&this.requestRenderAll()}_performTransformAction(e,t,s){const{action:r,actionHandler:i,target:a}=t,o=!!i&&i(e,t,s.x,s.y);o&&a.setCoords(),r==="drag"&&o&&(t.target.isMoving=!0,this.setCursor(t.target.moveCursor||this.moveCursor)),t.actionPerformed=t.actionPerformed||o}_setCursorFromEvent(e,t){if(!t)return void this.setCursor(this.defaultCursor);let s=t.hoverCursor||this.hoverCursor;const r=At(this._activeObject)?this._activeObject:null,i=(!r||t.group!==r)&&t.findControl(this.getViewportPoint(e));if(i){const a=i.control;this.setCursor(a.cursorStyleHandler(e,a,t))}else t.subTargetCheck&&this.targets.concat().reverse().map((a=>{s=a.hoverCursor||s})),this.setCursor(s)}handleMultiSelection(e,t){const s=this._activeObject,r=At(s);if(s&&this._isSelectionKeyPressed(e)&&this.selection&&t&&t.selectable&&(s!==t||r)&&(r||!t.isDescendantOf(s)&&!s.isDescendantOf(t))&&!t.onSelect({e})&&!s.getActiveControl()){if(r){const i=s.getObjects();if(t===s){const a=this.getViewportPoint(e);if(!(t=this.searchPossibleTargets(i,a)||this.searchPossibleTargets(this._objects,a))||!t.selectable)return!1}t.group===s?(s.remove(t),this._hoveredTarget=t,this._hoveredTargets=[...this.targets],s.size()===1&&this._setActiveObject(s.item(0),e)):(s.multiSelectAdd(t),this._hoveredTarget=s,this._hoveredTargets=[...this.targets]),this._fireSelectionEvents(i,e)}else{s.isEditing&&s.exitEditing();const i=new(A.getClass("ActiveSelection"))([],{canvas:this});i.multiSelectAdd(s,t),this._hoveredTarget=i,this._setActiveObject(i,e),this._fireSelectionEvents([s],e)}return!0}return!1}handleSelection(e){if(!this.selection||!this._groupSelector)return!1;const{x:t,y:s,deltaX:r,deltaY:i}=this._groupSelector,a=new _(t,s),o=a.add(new _(r,i)),l=a.min(o),c=a.max(o).subtract(l),h=this.collectObjects({left:l.x,top:l.y,width:c.x,height:c.y},{includeIntersecting:!this.selectionFullyContained}),d=a.eq(o)?h[0]?[h[0]]:[]:h.length>1?h.filter((u=>!u.onSelect({e}))).reverse():h;if(d.length===1)this.setActiveObject(d[0],e);else if(d.length>1){const u=A.getClass("ActiveSelection");this.setActiveObject(new u(d,{canvas:this}),e)}return this._groupSelector=null,!0}clear(){this.textEditingManager.clear(),super.clear()}destroy(){this.removeListeners(),this.textEditingManager.dispose(),super.destroy()}}const jo={x1:0,y1:0,x2:0,y2:0},Zh=v(v({},jo),{},{r1:0,r2:0}),qt=(n,e)=>isNaN(n)&&typeof e=="number"?e:n,$h=/^(\d+\.\d+)%|(\d+)%$/;function Mo(n){return n&&$h.test(n)}function Ao(n,e){const t=typeof n=="number"?n:typeof n=="string"?parseFloat(n)/(Mo(n)?100:1):NaN;return ss(0,qt(t,e),1)}const qh=/\s*;\s*/,Kh=/\s*:\s*/;function Jh(n,e){let t,s;const r=n.getAttribute("style");if(r){const a=r.split(qh);a[a.length-1]===""&&a.pop();for(let o=a.length;o--;){const[l,c]=a[o].split(Kh).map((h=>h.trim()));l==="stop-color"?t=c:l==="stop-opacity"&&(s=c)}}const i=new $(t||n.getAttribute("stop-color")||"rgb(0,0,0)");return{offset:Ao(n.getAttribute("offset"),0),color:i.toRgb(),opacity:qt(parseFloat(s||n.getAttribute("stop-opacity")||""),1)*i.getAlpha()*e}}function Qh(n,e){const t=[],s=n.getElementsByTagName("stop"),r=Ao(e,1);for(let i=s.length;i--;)t.push(Jh(s[i],r));return t}function Eo(n){return n.nodeName==="linearGradient"||n.nodeName==="LINEARGRADIENT"?"linear":"radial"}function Po(n){return n.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage"}function Re(n,e){return n.getAttribute(e)}function eu(n,e){return(function(t,s){let r,{width:i,height:a,gradientUnits:o}=s;return Object.keys(t).reduce(((l,c)=>{const h=t[c];return h==="Infinity"?r=1:h==="-Infinity"?r=0:(r=typeof h=="string"?parseFloat(h):h,typeof h=="string"&&Mo(h)&&(r*=.01,o==="pixels"&&(c!=="x1"&&c!=="x2"&&c!=="r2"||(r*=i),c!=="y1"&&c!=="y2"||(r*=a)))),l[c]=r,l}),{})})(Eo(n)==="linear"?(function(t){return{x1:Re(t,"x1")||0,y1:Re(t,"y1")||0,x2:Re(t,"x2")||"100%",y2:Re(t,"y2")||0}})(n):(function(t){return{x1:Re(t,"fx")||Re(t,"cx")||"50%",y1:Re(t,"fy")||Re(t,"cy")||"50%",r1:0,x2:Re(t,"cx")||"50%",y2:Re(t,"cy")||"50%",r2:Re(t,"r")||"50%"}})(n),v(v({},e),{},{gradientUnits:Po(n)}))}class lr{constructor(e){const{type:t="linear",gradientUnits:s="pixels",coords:r={},colorStops:i=[],offsetX:a=0,offsetY:o=0,gradientTransform:l,id:c}=e||{};Object.assign(this,{type:t,gradientUnits:s,coords:v(v({},t==="radial"?Zh:jo),r),colorStops:i,offsetX:a,offsetY:o,gradientTransform:l,id:c?"".concat(c,"_").concat(St()):St()})}addColorStop(e){for(const t in e){const s=new $(e[t]);this.colorStops.push({offset:parseFloat(t),color:s.toRgb(),opacity:s.getAlpha()})}return this}toObject(e){return v(v({},us(this,e)),{},{type:this.type,coords:v({},this.coords),colorStops:this.colorStops.map((t=>v({},t))),offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?[...this.gradientTransform]:void 0})}toSVG(e){let{additionalTransform:t}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=[],r=this.gradientTransform?this.gradientTransform.concat():_e.concat(),i=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox",a=this.colorStops.map((d=>v({},d))).sort(((d,u)=>d.offset-u.offset));let o=-this.offsetX,l=-this.offsetY;var c;i==="objectBoundingBox"?(o/=e.width,l/=e.height):(o+=e.width/2,l+=e.height/2),(c=e)&&typeof c._renderPathCommands=="function"&&this.gradientUnits!=="percentage"&&(o-=e.pathOffset.x,l-=e.pathOffset.y),r[4]-=o,r[5]-=l;const h=['id="SVGID_'.concat(this.id,'"'),'gradientUnits="'.concat(i,'"'),'gradientTransform="'.concat(t?t+" ":"").concat(Rs(r),'"'),""].join(" ");if(this.type==="linear"){const{x1:d,y1:u,x2:g,y2:f}=this.coords;s.push("<linearGradient ",h,' x1="',d,'" y1="',u,'" x2="',g,'" y2="',f,`">
`)}else if(this.type==="radial"){const{x1:d,y1:u,x2:g,y2:f,r1:p,r2:y}=this.coords,x=p>y;s.push("<radialGradient ",h,' cx="',x?d:g,'" cy="',x?u:f,'" r="',x?p:y,'" fx="',x?g:d,'" fy="',x?f:u,`">
`),x&&(a.reverse(),a.forEach((O=>{O.offset=1-O.offset})));const b=Math.min(p,y);if(b>0){const O=b/Math.max(p,y);a.forEach((C=>{C.offset+=O*(1-C.offset)}))}}return a.forEach((d=>{let{color:u,offset:g,opacity:f}=d;s.push("<stop ",'offset="',100*g+"%",'" style="stop-color:',u,f!==void 0?";stop-opacity: "+f:";",`"/>
`)})),s.push(this.type==="linear"?"</linearGradient>":"</radialGradient>",`
`),s.join("")}toLive(e){const{x1:t,y1:s,x2:r,y2:i,r1:a,r2:o}=this.coords,l=this.type==="linear"?e.createLinearGradient(t,s,r,i):e.createRadialGradient(t,s,a,r,i,o);return this.colorStops.forEach((c=>{let{color:h,opacity:d,offset:u}=c;l.addColorStop(u,d!==void 0?new $(h).setAlpha(d).toRgba():h)})),l}static async fromObject(e){const{colorStops:t,gradientTransform:s}=e;return new this(v(v({},e),{},{colorStops:t?t.map((r=>v({},r))):void 0,gradientTransform:s?[...s]:void 0}))}static fromElement(e,t,s){const r=Po(e),i=t._findCenterFromElement();return new this(v({id:e.getAttribute("id")||void 0,type:Eo(e),coords:eu(e,{width:s.viewBoxWidth||s.width,height:s.viewBoxHeight||s.height}),colorStops:Qh(e,s.opacity),gradientUnits:r,gradientTransform:Hi(e.getAttribute("gradientTransform")||"")},r==="pixels"?{offsetX:t.width/2-i.x,offsetY:t.height/2-i.y}:{offsetX:0,offsetY:0}))}}m(lr,"type","Gradient"),A.setClass(lr,"gradient"),A.setClass(lr,"linear"),A.setClass(lr,"radial");const tu=["type","source","patternTransform"];class Mi{get type(){return"pattern"}set type(e){Ct("warn","Setting type has no effect",e)}constructor(e){m(this,"repeat","repeat"),m(this,"offsetX",0),m(this,"offsetY",0),m(this,"crossOrigin",""),this.id=St(),Object.assign(this,e)}isImageSource(){return!!this.source&&typeof this.source.src=="string"}isCanvasSource(){return!!this.source&&!!this.source.toDataURL}sourceToString(){return this.isImageSource()?this.source.src:this.isCanvasSource()?this.source.toDataURL():""}toLive(e){return this.source&&(!this.isImageSource()||this.source.complete&&this.source.naturalWidth!==0&&this.source.naturalHeight!==0)?e.createPattern(this.source,this.repeat):null}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const{repeat:t,crossOrigin:s}=this;return v(v({},us(this,e)),{},{type:"pattern",source:this.sourceToString(),repeat:t,crossOrigin:s,offsetX:J(this.offsetX,U.NUM_FRACTION_DIGITS),offsetY:J(this.offsetY,U.NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?[...this.patternTransform]:null})}toSVG(e){let{width:t,height:s}=e;const{source:r,repeat:i,id:a}=this,o=qt(this.offsetX/t,0),l=qt(this.offsetY/s,0),c=i==="repeat-y"||i==="no-repeat"?1+Math.abs(o||0):qt(r.width/t,0),h=i==="repeat-x"||i==="no-repeat"?1+Math.abs(l||0):qt(r.height/s,0);return['<pattern id="SVGID_'.concat(a,'" x="').concat(o,'" y="').concat(l,'" width="').concat(c,'" height="').concat(h,'">'),'<image x="0" y="0" width="'.concat(r.width,'" height="').concat(r.height,'" xlink:href="').concat(this.sourceToString(),'"></image>'),"</pattern>",""].join(`
`)}static async fromObject(e,t){let{type:s,source:r,patternTransform:i}=e,a=Q(e,tu);const o=await Pr(r,v(v({},t),{},{crossOrigin:a.crossOrigin}));return new this(v(v({},a),{},{patternTransform:i&&i.slice(0),source:o}))}}m(Mi,"type","Pattern"),A.setClass(Mi),A.setClass(Mi,"pattern");const su=["path","left","top"],ru=["d"];class Et extends de{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{path:s,left:r,top:i}=t,a=Q(t,su);super(),Object.assign(this,Et.ownDefaults),this.setOptions(a),this._setPath(e||[],!0),typeof r=="number"&&this.set(H,r),typeof i=="number"&&this.set(Se,i)}_setPath(e,t){this.path=Ph(Array.isArray(e)?e:Wh(e)),this.setBoundingBox(t)}_findCenterFromElement(){const e=this._calcBoundsFromPath();return new _(e.left+e.width/2,e.top+e.height/2)}_renderPathCommands(e){const t=-this.pathOffset.x,s=-this.pathOffset.y;e.beginPath();for(const r of this.path)switch(r[0]){case"L":e.lineTo(r[1]+t,r[2]+s);break;case"M":e.moveTo(r[1]+t,r[2]+s);break;case"C":e.bezierCurveTo(r[1]+t,r[2]+s,r[3]+t,r[4]+s,r[5]+t,r[6]+s);break;case"Q":e.quadraticCurveTo(r[1]+t,r[2]+s,r[3]+t,r[4]+s);break;case"Z":e.closePath()}}_render(e){this._renderPathCommands(e),this._renderPaintInOrder(e)}toString(){return"#<Path (".concat(this.complexity(),'): { "top": ').concat(this.top,', "left": ').concat(this.left," }>")}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return v(v({},super.toObject(e)),{},{path:this.path.map((t=>t.slice()))})}toDatalessObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=this.toObject(e);return this.sourcePath&&(delete t.path,t.sourcePath=this.sourcePath),t}_toSVG(){const e=Xh(this.path,U.NUM_FRACTION_DIGITS);return["<path ","COMMON_PARTS",'d="'.concat(e,`" stroke-linecap="round" />
`)]}_getOffsetTransform(){const e=U.NUM_FRACTION_DIGITS;return" translate(".concat(J(-this.pathOffset.x,e),", ").concat(J(-this.pathOffset.y,e),")")}toClipPathSVG(e){const t=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:e,additionalTransform:t})}toSVG(e){const t=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:e,additionalTransform:t})}complexity(){return this.path.length}setDimensions(){this.setBoundingBox()}setBoundingBox(e){const{width:t,height:s,pathOffset:r}=this._calcDimensions();this.set({width:t,height:s,pathOffset:r}),e&&this.setPositionByOrigin(r,z,z)}_calcBoundsFromPath(){const e=[];let t=0,s=0,r=0,i=0;for(const a of this.path)switch(a[0]){case"L":r=a[1],i=a[2],e.push({x:t,y:s},{x:r,y:i});break;case"M":r=a[1],i=a[2],t=r,s=i;break;case"C":e.push(..._a(r,i,a[1],a[2],a[3],a[4],a[5],a[6])),r=a[5],i=a[6];break;case"Q":e.push(..._a(r,i,a[1],a[2],a[1],a[2],a[3],a[4])),r=a[3],i=a[4];break;case"Z":r=t,i=s}return dt(e)}_calcDimensions(){const e=this._calcBoundsFromPath();return v(v({},e),{},{pathOffset:new _(e.left+e.width/2,e.top+e.height/2)})}static fromObject(e){return this._fromObject(e,{extraParam:"path"})}static async fromElement(e,t,s){const r=_t(e,this.ATTRIBUTE_NAMES,s),{d:i}=r;return new this(i,v(v(v({},Q(r,ru)),t),{},{left:void 0,top:void 0}))}}m(Et,"type","Path"),m(Et,"cacheProperties",[...yt,"path","fillRule"]),m(Et,"ATTRIBUTE_NAMES",[...kt,"d"]),A.setClass(Et),A.setSVGClass(Et);const iu=["left","top","radius"],Fo=["radius","startAngle","endAngle","counterClockwise"];class ot extends de{static getDefaults(){return v(v({},super.getDefaults()),ot.ownDefaults)}constructor(e){super(),Object.assign(this,ot.ownDefaults),this.setOptions(e)}_set(e,t){return super._set(e,t),e==="radius"&&this.setRadius(t),this}_render(e){e.beginPath(),e.arc(0,0,this.radius,re(this.startAngle),re(this.endAngle),this.counterClockwise),this._renderPaintInOrder(e)}getRadiusX(){return this.get("radius")*this.get(ke)}getRadiusY(){return this.get("radius")*this.get(Ee)}setRadius(e){this.radius=e,this.set({width:2*e,height:2*e})}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...Fo,...e])}_toSVG(){const e=(this.endAngle-this.startAngle)%360;if(e===0)return["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',"".concat(this.radius),`" />
`];{const{radius:t}=this,s=re(this.startAngle),r=re(this.endAngle),i=gt(s)*t,a=ft(s)*t,o=gt(r)*t,l=ft(r)*t,c=e>180?1:0,h=this.counterClockwise?0:1;return['<path d="M '.concat(i," ").concat(a," A ").concat(t," ").concat(t," 0 ").concat(c," ").concat(h," ").concat(o," ").concat(l,'" '),"COMMON_PARTS",` />
`]}}static async fromElement(e,t,s){const r=_t(e,this.ATTRIBUTE_NAMES,s),{left:i=0,top:a=0,radius:o=0}=r;return new this(v(v({},Q(r,iu)),{},{radius:o,left:i-o,top:a-o}))}static fromObject(e){return super._fromObject(e)}}m(ot,"type","Circle"),m(ot,"cacheProperties",[...yt,...Fo]),m(ot,"ownDefaults",{radius:0,startAngle:0,endAngle:360,counterClockwise:!1}),m(ot,"ATTRIBUTE_NAMES",["cx","cy","r",...kt]),A.setClass(ot),A.setSVGClass(ot);const nu=["x1","y1","x2","y2"],au=["x1","y1","x2","y2"],Ji=["x1","x2","y1","y2"];class Pt extends de{constructor(){let[e,t,s,r]=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0,0],i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,Pt.ownDefaults),this.setOptions(i),this.x1=e,this.x2=s,this.y1=t,this.y2=r,this._setWidthHeight();const{left:a,top:o}=i;typeof a=="number"&&this.set(H,a),typeof o=="number"&&this.set(Se,o)}_setWidthHeight(){const{x1:e,y1:t,x2:s,y2:r}=this;this.width=Math.abs(s-e),this.height=Math.abs(r-t);const{left:i,top:a,width:o,height:l}=dt([{x:e,y:t},{x:s,y:r}]),c=new _(i+o/2,a+l/2);this.setPositionByOrigin(c,z,z)}_set(e,t){return super._set(e,t),Ji.includes(e)&&this._setWidthHeight(),this}_render(e){e.beginPath();const t=this.calcLinePoints();e.moveTo(t.x1,t.y1),e.lineTo(t.x2,t.y2),e.lineWidth=this.strokeWidth;const s=e.strokeStyle;var r;Ae(this.stroke)?e.strokeStyle=this.stroke.toLive(e):e.strokeStyle=(r=this.stroke)!==null&&r!==void 0?r:e.fillStyle,this.stroke&&this._renderStroke(e),e.strokeStyle=s}_findCenterFromElement(){return new _((this.x1+this.x2)/2,(this.y1+this.y2)/2)}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return v(v({},super.toObject(e)),this.calcLinePoints())}_getNonTransformedDimensions(){const e=super._getNonTransformedDimensions();return this.strokeLineCap==="butt"&&(this.width===0&&(e.y-=this.strokeWidth),this.height===0&&(e.x-=this.strokeWidth)),e}calcLinePoints(){const{x1:e,x2:t,y1:s,y2:r,width:i,height:a}=this,o=e<=t?-1:1,l=s<=r?-1:1;return{x1:o*i/2,x2:o*-i/2,y1:l*a/2,y2:l*-a/2}}_toSVG(){const{x1:e,x2:t,y1:s,y2:r}=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="'.concat(e,'" y1="').concat(s,'" x2="').concat(t,'" y2="').concat(r,`" />
`)]}static async fromElement(e,t,s){const r=_t(e,this.ATTRIBUTE_NAMES,s),{x1:i=0,y1:a=0,x2:o=0,y2:l=0}=r;return new this([i,a,o,l],Q(r,nu))}static fromObject(e){let{x1:t,y1:s,x2:r,y2:i}=e,a=Q(e,au);return this._fromObject(v(v({},a),{},{points:[t,s,r,i]}),{extraParam:"points"})}}m(Pt,"type","Line"),m(Pt,"cacheProperties",[...yt,...Ji]),m(Pt,"ATTRIBUTE_NAMES",kt.concat(Ji)),A.setClass(Pt),A.setSVGClass(Pt);class Ft extends de{static getDefaults(){return v(v({},super.getDefaults()),Ft.ownDefaults)}constructor(e){super(),Object.assign(this,Ft.ownDefaults),this.setOptions(e)}_render(e){const t=this.width/2,s=this.height/2;e.beginPath(),e.moveTo(-t,s),e.lineTo(0,-s),e.lineTo(t,s),e.closePath(),this._renderPaintInOrder(e)}_toSVG(){const e=this.width/2,t=this.height/2;return["<polygon ","COMMON_PARTS",'points="',"".concat(-e," ").concat(t,",0 ").concat(-t,",").concat(e," ").concat(t),'" />']}}m(Ft,"type","Triangle"),m(Ft,"ownDefaults",{width:100,height:100}),A.setClass(Ft),A.setSVGClass(Ft);const Ro=["rx","ry"];class lt extends de{static getDefaults(){return v(v({},super.getDefaults()),lt.ownDefaults)}constructor(e){super(),Object.assign(this,lt.ownDefaults),this.setOptions(e)}_set(e,t){switch(super._set(e,t),e){case"rx":this.rx=t,this.set("width",2*t);break;case"ry":this.ry=t,this.set("height",2*t)}return this}getRx(){return this.get("rx")*this.get(ke)}getRy(){return this.get("ry")*this.get(Ee)}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...Ro,...e])}_toSVG(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" rx="'.concat(this.rx,'" ry="').concat(this.ry,`" />
`)]}_render(e){e.beginPath(),e.save(),e.transform(1,0,0,this.ry/this.rx,0,0),e.arc(0,0,this.rx,0,Ir,!1),e.restore(),this._renderPaintInOrder(e)}static async fromElement(e,t,s){const r=_t(e,this.ATTRIBUTE_NAMES,s);return r.left=(r.left||0)-r.rx,r.top=(r.top||0)-r.ry,new this(r)}}function ou(n){if(!n)return[];const e=n.replace(/,/g," ").trim().split(/\s+/),t=[];for(let s=0;s<e.length;s+=2)t.push({x:parseFloat(e[s]),y:parseFloat(e[s+1])});return t}m(lt,"type","Ellipse"),m(lt,"cacheProperties",[...yt,...Ro]),m(lt,"ownDefaults",{rx:0,ry:0}),m(lt,"ATTRIBUTE_NAMES",[...kt,"cx","cy","rx","ry"]),A.setClass(lt),A.setSVGClass(lt);const lu=["left","top"],Lo={exactBoundingBox:!1};class Ne extends de{static getDefaults(){return v(v({},super.getDefaults()),Ne.ownDefaults)}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),m(this,"strokeDiff",void 0),Object.assign(this,Ne.ownDefaults),this.setOptions(t),this.points=e;const{left:s,top:r}=t;this.initialized=!0,this.setBoundingBox(!0),typeof s=="number"&&this.set(H,s),typeof r=="number"&&this.set(Se,r)}isOpen(){return!0}_projectStrokeOnPoints(e){return qc(this.points,e,this.isOpen())}_calcDimensions(e){e=v({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:this.strokeMiterLimit,strokeUniform:this.strokeUniform,strokeWidth:this.strokeWidth},e||{});const t=this.exactBoundingBox?this._projectStrokeOnPoints(e).map((c=>c.projectedPoint)):this.points;if(t.length===0)return{left:0,top:0,width:0,height:0,pathOffset:new _,strokeOffset:new _,strokeDiff:new _};const s=dt(t),r=ai(v(v({},e),{},{scaleX:1,scaleY:1})),i=dt(this.points.map((c=>Ce(c,r,!0)))),a=new _(this.scaleX,this.scaleY);let o=s.left+s.width/2,l=s.top+s.height/2;return this.exactBoundingBox&&(o-=l*Math.tan(re(this.skewX)),l-=o*Math.tan(re(this.skewY))),v(v({},s),{},{pathOffset:new _(o,l),strokeOffset:new _(i.left,i.top).subtract(new _(s.left,s.top)).multiply(a),strokeDiff:new _(s.width,s.height).subtract(new _(i.width,i.height)).multiply(a)})}_findCenterFromElement(){const e=dt(this.points);return new _(e.left+e.width/2,e.top+e.height/2)}setDimensions(){this.setBoundingBox()}setBoundingBox(e){const{left:t,top:s,width:r,height:i,pathOffset:a,strokeOffset:o,strokeDiff:l}=this._calcDimensions();this.set({width:r,height:i,pathOffset:a,strokeOffset:o,strokeDiff:l}),e&&this.setPositionByOrigin(new _(t+r/2,s+i/2),z,z)}isStrokeAccountedForInDimensions(){return this.exactBoundingBox}_getNonTransformedDimensions(){return this.exactBoundingBox?new _(this.width,this.height):super._getNonTransformedDimensions()}_getTransformedDimensions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.exactBoundingBox){let a;if(Object.keys(e).some((o=>this.strokeUniform||this.constructor.layoutProperties.includes(o)))){var t,s;const{width:o,height:l}=this._calcDimensions(e);a=new _((t=e.width)!==null&&t!==void 0?t:o,(s=e.height)!==null&&s!==void 0?s:l)}else{var r,i;a=new _((r=e.width)!==null&&r!==void 0?r:this.width,(i=e.height)!==null&&i!==void 0?i:this.height)}return a.multiply(new _(e.scaleX||this.scaleX,e.scaleY||this.scaleY))}return super._getTransformedDimensions(e)}_set(e,t){const s=this.initialized&&this[e]!==t,r=super._set(e,t);return this.exactBoundingBox&&s&&((e===ke||e===Ee)&&this.strokeUniform&&this.constructor.layoutProperties.includes("strokeUniform")||this.constructor.layoutProperties.includes(e))&&this.setDimensions(),r}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return v(v({},super.toObject(e)),{},{points:this.points.map((t=>{let{x:s,y:r}=t;return{x:s,y:r}}))})}_toSVG(){const e=[],t=this.pathOffset.x,s=this.pathOffset.y,r=U.NUM_FRACTION_DIGITS;for(let i=0,a=this.points.length;i<a;i++)e.push(J(this.points[i].x-t,r),",",J(this.points[i].y-s,r)," ");return["<".concat(this.constructor.type.toLowerCase()," "),"COMMON_PARTS",'points="'.concat(e.join(""),`" />
`)]}_render(e){const t=this.points.length,s=this.pathOffset.x,r=this.pathOffset.y;if(t&&!isNaN(this.points[t-1].y)){e.beginPath(),e.moveTo(this.points[0].x-s,this.points[0].y-r);for(let i=0;i<t;i++){const a=this.points[i];e.lineTo(a.x-s,a.y-r)}!this.isOpen()&&e.closePath(),this._renderPaintInOrder(e)}}complexity(){return this.points.length}static async fromElement(e,t,s){return new this(ou(e.getAttribute("points")),v(v({},Q(_t(e,this.ATTRIBUTE_NAMES,s),lu)),t))}static fromObject(e){return this._fromObject(e,{extraParam:"points"})}}m(Ne,"ownDefaults",Lo),m(Ne,"type","Polyline"),m(Ne,"layoutProperties",[ls,cs,"strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeWidth","strokeUniform","points"]),m(Ne,"cacheProperties",[...yt,"points"]),m(Ne,"ATTRIBUTE_NAMES",[...kt]),A.setClass(Ne),A.setSVGClass(Ne);class cr extends Ne{isOpen(){return!1}}m(cr,"ownDefaults",Lo),m(cr,"type","Polygon"),A.setClass(cr),A.setSVGClass(cr);class Io extends de{isEmptyStyles(e){if(!this.styles||e!==void 0&&!this.styles[e])return!0;const t=e===void 0?this.styles:{line:this.styles[e]};for(const s in t)for(const r in t[s])for(const i in t[s][r])return!1;return!0}styleHas(e,t){if(!this.styles||t!==void 0&&!this.styles[t])return!1;const s=t===void 0?this.styles:{0:this.styles[t]};for(const r in s)for(const i in s[r])if(s[r][i][e]!==void 0)return!0;return!1}cleanStyle(e){if(!this.styles)return!1;const t=this.styles;let s,r,i=0,a=!0,o=0;for(const l in t){s=0;for(const c in t[l]){const h=t[l][c]||{};i++,h[e]!==void 0?(r?h[e]!==r&&(a=!1):r=h[e],h[e]===this[e]&&delete h[e]):a=!1,Object.keys(h).length!==0?s++:delete t[l][c]}s===0&&delete t[l]}for(let l=0;l<this._textLines.length;l++)o+=this._textLines[l].length;a&&i===o&&(this[e]=r,this.removeStyle(e))}removeStyle(e){if(!this.styles)return;const t=this.styles;let s,r,i;for(r in t){for(i in s=t[r],s)delete s[i][e],Object.keys(s[i]).length===0&&delete s[i];Object.keys(s).length===0&&delete t[r]}}_extendStyles(e,t){const{lineIndex:s,charIndex:r}=this.get2DCursorLocation(e);this._getLineStyle(s)||this._setLineStyle(s);const i=vn(v(v({},this._getStyleDeclaration(s,r)),t),(a=>a!==void 0));this._setStyleDeclaration(s,r,i)}getSelectionStyles(e,t,s){const r=[];for(let i=e;i<(t||e);i++)r.push(this.getStyleAtPosition(i,s));return r}getStyleAtPosition(e,t){const{lineIndex:s,charIndex:r}=this.get2DCursorLocation(e);return t?this.getCompleteStyleDeclaration(s,r):this._getStyleDeclaration(s,r)}setSelectionStyles(e,t,s){for(let r=t;r<(s||t);r++)this._extendStyles(r,e);this._forceClearCache=!0}_getStyleDeclaration(e,t){var s;const r=this.styles&&this.styles[e];return r&&(s=r[t])!==null&&s!==void 0?s:{}}getCompleteStyleDeclaration(e,t){return v(v({},us(this,this.constructor._styleProperties)),this._getStyleDeclaration(e,t))}_setStyleDeclaration(e,t,s){this.styles[e][t]=s}_deleteStyleDeclaration(e,t){delete this.styles[e][t]}_getLineStyle(e){return!!this.styles[e]}_setLineStyle(e){this.styles[e]={}}_deleteLineStyle(e){delete this.styles[e]}}m(Io,"_styleProperties",dc);const cu=/  +/g,hu=/"/g;function Ai(n,e,t,s,r){return"		".concat((function(i,a){let{left:o,top:l,width:c,height:h}=a,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:U.NUM_FRACTION_DIGITS;const u=Ls(le,i,!1),[g,f,p,y]=[o,l,c,h].map((x=>J(x,d)));return"<rect ".concat(u,' x="').concat(g,'" y="').concat(f,'" width="').concat(p,'" height="').concat(y,'"></rect>')})(n,{left:e,top:t,width:s,height:r}),`
`)}const uu=["textAnchor","textDecoration","dx","dy","top","left","fontSize","strokeWidth"];let Ei;class ue extends Io{static getDefaults(){return v(v({},super.getDefaults()),ue.ownDefaults)}constructor(e,t){super(),m(this,"__charBounds",[]),Object.assign(this,ue.ownDefaults),this.setOptions(t),this.styles||(this.styles={}),this.text=e,this.initialized=!0,this.path&&this.setPathInfo(),this.initDimensions(),this.setCoords()}setPathInfo(){const e=this.path;e&&(e.segmentsInfo=Do(e.path))}_splitText(){const e=this._splitTextIntoLines(this.text);return this.textLines=e.lines,this._textLines=e.graphemeLines,this._unwrappedTextLines=e._unwrappedLines,this._text=e.graphemeText,e}initDimensions(){this._splitText(),this._clearCache(),this.dirty=!0,this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.includes(Ke)&&this.enlargeSpaces()}enlargeSpaces(){let e,t,s,r,i,a,o;for(let l=0,c=this._textLines.length;l<c;l++)if((this.textAlign===Ke||l!==c-1&&!this.isEndOfWrapping(l))&&(r=0,i=this._textLines[l],t=this.getLineWidth(l),t<this.width&&(o=this.textLines[l].match(this._reSpacesAndTabs)))){s=o.length,e=(this.width-t)/s;for(let h=0;h<=i.length;h++)a=this.__charBounds[l][h],this._reSpaceAndTab.test(i[h])?(a.width+=e,a.kernedWidth+=e,a.left+=r,r+=e):a.left+=r}}isEndOfWrapping(e){return e===this._textLines.length-1}missingNewlineOffset(e){return 1}get2DCursorLocation(e,t){const s=t?this._unwrappedTextLines:this._textLines;let r;for(r=0;r<s.length;r++){if(e<=s[r].length)return{lineIndex:r,charIndex:e};e-=s[r].length+this.missingNewlineOffset(r,t)}return{lineIndex:r-1,charIndex:s[r-1].length<e?s[r-1].length:e}}toString(){return"#<Text (".concat(this.complexity(),'): { "text": "').concat(this.text,'", "fontFamily": "').concat(this.fontFamily,'" }>')}_getCacheCanvasDimensions(){const e=super._getCacheCanvasDimensions(),t=this.fontSize;return e.width+=t*e.zoomX,e.height+=t*e.zoomY,e}_render(e){const t=this.path;t&&!t.isNotVisible()&&t._render(e),this._setTextStyles(e),this._renderTextLinesBackground(e),this._renderTextDecoration(e,"underline"),this._renderText(e),this._renderTextDecoration(e,"overline"),this._renderTextDecoration(e,"linethrough")}_renderText(e){this.paintFirst===Oe?(this._renderTextStroke(e),this._renderTextFill(e)):(this._renderTextFill(e),this._renderTextStroke(e))}_setTextStyles(e,t,s){if(e.textBaseline="alphabetic",this.path)switch(this.pathAlign){case z:e.textBaseline="middle";break;case"ascender":e.textBaseline=Se;break;case"descender":e.textBaseline=zi}e.font=this._getFontDeclaration(t,s)}calcTextWidth(){let e=this.getLineWidth(0);for(let t=1,s=this._textLines.length;t<s;t++){const r=this.getLineWidth(t);r>e&&(e=r)}return e}_renderTextLine(e,t,s,r,i,a){this._renderChars(e,t,s,r,i,a)}_renderTextLinesBackground(e){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))return;const t=e.fillStyle,s=this._getLeftOffset();let r=this._getTopOffset();for(let i=0,a=this._textLines.length;i<a;i++){const o=this.getHeightOfLine(i);if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",i)){r+=o;continue}const l=this._textLines[i].length,c=this._getLineLeftOffset(i);let h,d,u=0,g=0,f=this.getValueOfPropertyAt(i,0,"textBackgroundColor");for(let p=0;p<l;p++){const y=this.__charBounds[i][p];d=this.getValueOfPropertyAt(i,p,"textBackgroundColor"),this.path?(e.save(),e.translate(y.renderLeft,y.renderTop),e.rotate(y.angle),e.fillStyle=d,d&&e.fillRect(-y.width/2,-o/this.lineHeight*(1-this._fontSizeFraction),y.width,o/this.lineHeight),e.restore()):d!==f?(h=s+c+g,this.direction==="rtl"&&(h=this.width-h-u),e.fillStyle=f,f&&e.fillRect(h,r,u,o/this.lineHeight),g=y.left,u=y.width,f=d):u+=y.kernedWidth}d&&!this.path&&(h=s+c+g,this.direction==="rtl"&&(h=this.width-h-u),e.fillStyle=d,e.fillRect(h,r,u,o/this.lineHeight)),r+=o}e.fillStyle=t,this._removeShadow(e)}_measureChar(e,t,s,r){const i=js.getFontCache(t),a=this._getFontDeclaration(t),o=s+e,l=s&&a===this._getFontDeclaration(r),c=t.fontSize/this.CACHE_FONT_SIZE;let h,d,u,g;if(s&&i[s]!==void 0&&(u=i[s]),i[e]!==void 0&&(g=h=i[e]),l&&i[o]!==void 0&&(d=i[o],g=d-u),h===void 0||u===void 0||d===void 0){const f=(function(){return Ei||(Ei=Pe({width:0,height:0}).getContext("2d")),Ei})();this._setTextStyles(f,t,!0),h===void 0&&(g=h=f.measureText(e).width,i[e]=h),u===void 0&&l&&s&&(u=f.measureText(s).width,i[s]=u),l&&d===void 0&&(d=f.measureText(o).width,i[o]=d,g=d-u)}return{width:h*c,kernedWidth:g*c}}getHeightOfChar(e,t){return this.getValueOfPropertyAt(e,t,"fontSize")}measureLine(e){const t=this._measureLine(e);return this.charSpacing!==0&&(t.width-=this._getWidthOfCharSpacing()),t.width<0&&(t.width=0),t}_measureLine(e){let t,s,r=0;const i=this.pathSide===se,a=this.path,o=this._textLines[e],l=o.length,c=new Array(l);this.__charBounds[e]=c;for(let h=0;h<l;h++){const d=o[h];s=this._getGraphemeBox(d,e,h,t),c[h]=s,r+=s.kernedWidth,t=d}if(c[l]={left:s?s.left+s.width:0,width:0,kernedWidth:0,height:this.fontSize,deltaY:0},a&&a.segmentsInfo){let h=0;const d=a.segmentsInfo[a.segmentsInfo.length-1].length;switch(this.textAlign){case H:h=i?d-r:0;break;case z:h=(d-r)/2;break;case se:h=i?0:d-r}h+=this.pathStartOffset*(i?-1:1);for(let u=i?l-1:0;i?u>=0:u<l;i?u--:u++)s=c[u],h>d?h%=d:h<0&&(h+=d),this._setGraphemeOnPath(h,s),h+=s.kernedWidth}return{width:r,numOfSpaces:0}}_setGraphemeOnPath(e,t){const s=e+t.kernedWidth/2,r=this.path,i=Bh(r.path,s,r.segmentsInfo);t.renderLeft=i.x-r.pathOffset.x,t.renderTop=i.y-r.pathOffset.y,t.angle=i.angle+(this.pathSide===se?Math.PI:0)}_getGraphemeBox(e,t,s,r,i){const a=this.getCompleteStyleDeclaration(t,s),o=r?this.getCompleteStyleDeclaration(t,s-1):{},l=this._measureChar(e,a,r,o);let c,h=l.kernedWidth,d=l.width;this.charSpacing!==0&&(c=this._getWidthOfCharSpacing(),d+=c,h+=c);const u={width:d,left:0,height:a.fontSize,kernedWidth:h,deltaY:a.deltaY};if(s>0&&!i){const g=this.__charBounds[t][s-1];u.left=g.left+g.width+l.kernedWidth-l.width}return u}getHeightOfLine(e){if(this.__lineHeights[e])return this.__lineHeights[e];let t=this.getHeightOfChar(e,0);for(let s=1,r=this._textLines[e].length;s<r;s++)t=Math.max(this.getHeightOfChar(e,s),t);return this.__lineHeights[e]=t*this.lineHeight*this._fontSizeMult}calcTextHeight(){let e,t=0;for(let s=0,r=this._textLines.length;s<r;s++)e=this.getHeightOfLine(s),t+=s===r-1?e/this.lineHeight:e;return t}_getLeftOffset(){return this.direction==="ltr"?-this.width/2:this.width/2}_getTopOffset(){return-this.height/2}_renderTextCommon(e,t){e.save();let s=0;const r=this._getLeftOffset(),i=this._getTopOffset();for(let a=0,o=this._textLines.length;a<o;a++){const l=this.getHeightOfLine(a),c=l/this.lineHeight,h=this._getLineLeftOffset(a);this._renderTextLine(t,e,this._textLines[a],r+h,i+s+c,a),s+=l}e.restore()}_renderTextFill(e){(this.fill||this.styleHas(le))&&this._renderTextCommon(e,"fillText")}_renderTextStroke(e){(this.stroke&&this.strokeWidth!==0||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this._setLineDash(e,this.strokeDashArray),e.beginPath(),this._renderTextCommon(e,"strokeText"),e.closePath(),e.restore())}_renderChars(e,t,s,r,i,a){const o=this.getHeightOfLine(a),l=this.textAlign.includes(Ke),c=this.path,h=!l&&this.charSpacing===0&&this.isEmptyStyles(a)&&!c,d=this.direction==="ltr",u=this.direction==="ltr"?1:-1,g=t.direction;let f,p,y,x,b,O="",C=0;if(t.save(),g!==this.direction&&(t.canvas.setAttribute("dir",d?"ltr":"rtl"),t.direction=d?"ltr":"rtl",t.textAlign=d?H:se),i-=o*this._fontSizeFraction/this.lineHeight,h)return this._renderChar(e,t,a,0,s.join(""),r,i),void t.restore();for(let k=0,F=s.length-1;k<=F;k++)x=k===F||this.charSpacing||c,O+=s[k],y=this.__charBounds[a][k],C===0?(r+=u*(y.kernedWidth-y.width),C+=y.width):C+=y.kernedWidth,l&&!x&&this._reSpaceAndTab.test(s[k])&&(x=!0),x||(f=f||this.getCompleteStyleDeclaration(a,k),p=this.getCompleteStyleDeclaration(a,k+1),x=Tn(f,p,!1)),x&&(c?(t.save(),t.translate(y.renderLeft,y.renderTop),t.rotate(y.angle),this._renderChar(e,t,a,k,O,-C/2,0),t.restore()):(b=r,this._renderChar(e,t,a,k,O,b,i)),O="",f=p,r+=u*C,C=0);t.restore()}_applyPatternGradientTransformText(e){const t=this.width+this.strokeWidth,s=this.height+this.strokeWidth,r=Pe({width:t,height:s}),i=r.getContext("2d");return r.width=t,r.height=s,i.beginPath(),i.moveTo(0,0),i.lineTo(t,0),i.lineTo(t,s),i.lineTo(0,s),i.closePath(),i.translate(t/2,s/2),i.fillStyle=e.toLive(i),this._applyPatternGradientTransform(i,e),i.fill(),i.createPattern(r,"no-repeat")}handleFiller(e,t,s){let r,i;return Ae(s)?s.gradientUnits==="percentage"||s.gradientTransform||s.patternTransform?(r=-this.width/2,i=-this.height/2,e.translate(r,i),e[t]=this._applyPatternGradientTransformText(s),{offsetX:r,offsetY:i}):(e[t]=s.toLive(e),this._applyPatternGradientTransform(e,s)):(e[t]=s,{offsetX:0,offsetY:0})}_setStrokeStyles(e,t){let{stroke:s,strokeWidth:r}=t;return e.lineWidth=r,e.lineCap=this.strokeLineCap,e.lineDashOffset=this.strokeDashOffset,e.lineJoin=this.strokeLineJoin,e.miterLimit=this.strokeMiterLimit,this.handleFiller(e,"strokeStyle",s)}_setFillStyles(e,t){let{fill:s}=t;return this.handleFiller(e,"fillStyle",s)}_renderChar(e,t,s,r,i,a,o){const l=this._getStyleDeclaration(s,r),c=this.getCompleteStyleDeclaration(s,r),h=e==="fillText"&&c.fill,d=e==="strokeText"&&c.stroke&&c.strokeWidth;if(d||h){if(t.save(),t.font=this._getFontDeclaration(c),l.textBackgroundColor&&this._removeShadow(t),l.deltaY&&(o+=l.deltaY),h){const u=this._setFillStyles(t,c);t.fillText(i,a-u.offsetX,o-u.offsetY)}if(d){const u=this._setStrokeStyles(t,c);t.strokeText(i,a-u.offsetX,o-u.offsetY)}t.restore()}}setSuperscript(e,t){this._setScript(e,t,this.superscript)}setSubscript(e,t){this._setScript(e,t,this.subscript)}_setScript(e,t,s){const r=this.get2DCursorLocation(e,!0),i=this.getValueOfPropertyAt(r.lineIndex,r.charIndex,"fontSize"),a=this.getValueOfPropertyAt(r.lineIndex,r.charIndex,"deltaY"),o={fontSize:i*s.size,deltaY:a+i*s.baseline};this.setSelectionStyles(o,e,t)}_getLineLeftOffset(e){const t=this.getLineWidth(e),s=this.width-t,r=this.textAlign,i=this.direction,a=this.isEndOfWrapping(e);let o=0;return r===Ke||r===As&&!a||r===Ms&&!a||r===Yr&&!a?0:(r===z&&(o=s/2),r===se&&(o=s),r===As&&(o=s/2),r===Ms&&(o=s),i==="rtl"&&(r===se||r===Ke||r===Ms?o=0:r===H||r===Yr?o=-s:r!==z&&r!==As||(o=-s/2)),o)}_clearCache(){this._forceClearCache=!1,this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]}getLineWidth(e){if(this.__lineWidths[e]!==void 0)return this.__lineWidths[e];const{width:t}=this.measureLine(e);return this.__lineWidths[e]=t,t}_getWidthOfCharSpacing(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0}getValueOfPropertyAt(e,t,s){var r;return(r=this._getStyleDeclaration(e,t)[s])!==null&&r!==void 0?r:this[s]}_renderTextDecoration(e,t){if(!this[t]&&!this.styleHas(t))return;let s=this._getTopOffset();const r=this._getLeftOffset(),i=this.path,a=this._getWidthOfCharSpacing(),o=t==="linethrough"?.5:t==="overline"?1:0,l=this.offsets[t];for(let c=0,h=this._textLines.length;c<h;c++){const d=this.getHeightOfLine(c);if(!this[t]&&!this.styleHas(t,c)){s+=d;continue}const u=this._textLines[c],g=d/this.lineHeight,f=this._getLineLeftOffset(c);let p=0,y=0,x=this.getValueOfPropertyAt(c,0,t),b=this.getValueOfPropertyAt(c,0,le),O=this.getValueOfPropertyAt(c,0,Nt),C=x,k=b,F=O;const D=s+g*(1-this._fontSizeFraction);let R=this.getHeightOfChar(c,0),W=this.getValueOfPropertyAt(c,0,"deltaY");for(let G=0,Z=u.length;G<Z;G++){const Y=this.__charBounds[c][G];C=this.getValueOfPropertyAt(c,G,t),k=this.getValueOfPropertyAt(c,G,le),F=this.getValueOfPropertyAt(c,G,Nt);const ae=this.getHeightOfChar(c,G),ie=this.getValueOfPropertyAt(c,G,"deltaY");if(i&&C&&k){const oe=this.fontSize*F/1e3;e.save(),e.fillStyle=b,e.translate(Y.renderLeft,Y.renderTop),e.rotate(Y.angle),e.fillRect(-Y.kernedWidth/2,l*ae+ie-o*oe,Y.kernedWidth,oe),e.restore()}else if((C!==x||k!==b||ae!==R||F!==O||ie!==W)&&y>0){const oe=this.fontSize*O/1e3;let q=r+f+p;this.direction==="rtl"&&(q=this.width-q-y),x&&b&&O&&(e.fillStyle=b,e.fillRect(q,D+l*R+W-o*oe,y,oe)),p=Y.left,y=Y.width,x=C,O=F,b=k,R=ae,W=ie}else y+=Y.kernedWidth}let K=r+f+p;this.direction==="rtl"&&(K=this.width-K-y),e.fillStyle=k;const E=this.fontSize*F/1e3;C&&k&&F&&e.fillRect(K,D+l*R+W-o*E,y-a,E),s+=d}this._removeShadow(e)}_getFontDeclaration(){let{fontFamily:e=this.fontFamily,fontStyle:t=this.fontStyle,fontWeight:s=this.fontWeight,fontSize:r=this.fontSize}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;const a=e.includes("'")||e.includes('"')||e.includes(",")||ue.genericFonts.includes(e.toLowerCase())?e:'"'.concat(e,'"');return[t,s,"".concat(i?this.CACHE_FONT_SIZE:r,"px"),a].join(" ")}render(e){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._forceClearCache&&this.initDimensions(),super.render(e)))}graphemeSplit(e){return Sn(e)}_splitTextIntoLines(e){const t=e.split(this._reNewline),s=new Array(t.length),r=[`
`];let i=[];for(let a=0;a<t.length;a++)s[a]=this.graphemeSplit(t[a]),i=i.concat(s[a],r);return i.pop(),{_unwrappedLines:s,lines:t,graphemeText:i,graphemeLines:s}}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return v(v({},super.toObject([...co,...e])),{},{styles:eh(this.styles,this.text)},this.path?{path:this.path.toObject()}:{})}set(e,t){const{textLayoutProperties:s}=this.constructor;super.set(e,t);let r=!1,i=!1;if(typeof e=="object")for(const a in e)a==="path"&&this.setPathInfo(),r=r||s.includes(a),i=i||a==="path";else r=s.includes(e),i=e==="path";return i&&this.setPathInfo(),r&&this.initialized&&(this.initDimensions(),this.setCoords()),this}complexity(){return 1}static async fromElement(e,t,s){const r=_t(e,ue.ATTRIBUTE_NAMES,s),i=v(v({},t),r),{textAnchor:a=H,textDecoration:o="",dx:l=0,dy:c=0,top:h=0,left:d=0,fontSize:u=un,strokeWidth:g=1}=i,f=Q(i,uu),p=new this((e.textContent||"").replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),v({left:d+l,top:h+c,underline:o.includes("underline"),overline:o.includes("overline"),linethrough:o.includes("line-through"),strokeWidth:0,fontSize:u},f)),y=p.getScaledHeight()/p.height,x=((p.height+p.strokeWidth)*p.lineHeight-p.height)*y,b=p.getScaledHeight()+x;let O=0;return a===z&&(O=p.getScaledWidth()/2),a===se&&(O=p.getScaledWidth()),p.set({left:p.left-O,top:p.top-(b-p.fontSize*(.07+p._fontSizeFraction))/p.lineHeight,strokeWidth:g}),p}static fromObject(e){return this._fromObject(v(v({},e),{},{styles:th(e.styles||{},e.text)}),{extraParam:"text"})}}m(ue,"textLayoutProperties",lo),m(ue,"cacheProperties",[...yt,...co]),m(ue,"ownDefaults",gc),m(ue,"type","Text"),m(ue,"genericFonts",["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),m(ue,"ATTRIBUTE_NAMES",kt.concat("x","y","dx","dy","font-family","font-style","font-weight","font-size","letter-spacing","text-decoration","text-anchor")),_o(ue,[class extends no{_toSVG(){const n=this._getSVGLeftTopOffsets(),e=this._getSVGTextAndBg(n.textTop,n.textLeft);return this._wrapSVGTextAndBg(e)}toSVG(n){const e=this._createBaseSVGMarkup(this._toSVG(),{reviver:n,noStyle:!0,withShadow:!0}),t=this.path;return t?e+t._createBaseSVGMarkup(t._toSVG(),{reviver:n,withShadow:!0,additionalTransform:Rs(this.calcOwnMatrix())}):e}_getSVGLeftTopOffsets(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}}_wrapSVGTextAndBg(n){let{textBgRects:e,textSpans:t}=n;const s=this.getSvgTextDecoration(this);return[e.join(""),'		<text xml:space="preserve" ','font-family="'.concat(this.fontFamily.replace(hu,"'"),'" '),'font-size="'.concat(this.fontSize,'" '),this.fontStyle?'font-style="'.concat(this.fontStyle,'" '):"",this.fontWeight?'font-weight="'.concat(this.fontWeight,'" '):"",s?'text-decoration="'.concat(s,'" '):"",this.direction==="rtl"?'direction="'.concat(this.direction,'" '):"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",t.join(""),`</text>
`]}_getSVGTextAndBg(n,e){const t=[],s=[];let r,i=n;this.backgroundColor&&s.push(...Ai(this.backgroundColor,-this.width/2,-this.height/2,this.width,this.height));for(let a=0,o=this._textLines.length;a<o;a++)r=this._getLineLeftOffset(a),this.direction==="rtl"&&(r+=this.width),(this.textBackgroundColor||this.styleHas("textBackgroundColor",a))&&this._setSVGTextLineBg(s,a,e+r,i),this._setSVGTextLineText(t,a,e+r,i),i+=this.getHeightOfLine(a);return{textSpans:t,textBgRects:s}}_createTextCharSpan(n,e,t,s,r){const i=U.NUM_FRACTION_DIGITS,a=this.getSvgSpanStyles(e,n!==n.trim()||!!n.match(cu)),o=a?'style="'.concat(a,'"'):"",l=e.deltaY,c=l?' dy="'.concat(J(l,i),'" '):"",{angle:h,renderLeft:d,renderTop:u,width:g}=r;let f="";if(d!==void 0){const p=g/2;h&&(f=' rotate="'.concat(J(mt(h),i),'"'));const y=hs({angle:mt(h)});y[4]=d,y[5]=u;const x=new _(-p,0).transform(y);t=x.x,s=x.y}return'<tspan x="'.concat(J(t,i),'" y="').concat(J(s,i),'" ').concat(c).concat(f).concat(o,">").concat(Kc(n),"</tspan>")}_setSVGTextLineText(n,e,t,s){const r=this.getHeightOfLine(e),i=this.textAlign.includes(Ke),a=this._textLines[e];let o,l,c,h,d,u="",g=0;s+=r*(1-this._fontSizeFraction)/this.lineHeight;for(let f=0,p=a.length-1;f<=p;f++)d=f===p||this.charSpacing||this.path,u+=a[f],c=this.__charBounds[e][f],g===0?(t+=c.kernedWidth-c.width,g+=c.width):g+=c.kernedWidth,i&&!d&&this._reSpaceAndTab.test(a[f])&&(d=!0),d||(o=o||this.getCompleteStyleDeclaration(e,f),l=this.getCompleteStyleDeclaration(e,f+1),d=Tn(o,l,!0)),d&&(h=this._getStyleDeclaration(e,f),n.push(this._createTextCharSpan(u,h,t,s,c)),u="",o=l,this.direction==="rtl"?t-=g:t+=g,g=0)}_setSVGTextLineBg(n,e,t,s){const r=this._textLines[e],i=this.getHeightOfLine(e)/this.lineHeight;let a,o=0,l=0,c=this.getValueOfPropertyAt(e,0,"textBackgroundColor");for(let h=0;h<r.length;h++){const{left:d,width:u,kernedWidth:g}=this.__charBounds[e][h];a=this.getValueOfPropertyAt(e,h,"textBackgroundColor"),a!==c?(c&&n.push(...Ai(c,t+l,s,o,i)),l=d,o=u,c=a):o+=g}a&&n.push(...Ai(c,t+l,s,o,i))}_getSVGLineTopOffset(n){let e,t=0;for(e=0;e<n;e++)t+=this.getHeightOfLine(e);const s=this.getHeightOfLine(e);return{lineTop:t,offset:(this._fontSizeMult-this._fontSizeFraction)*s/(this.lineHeight*this._fontSizeMult)}}getSvgStyles(n){return"".concat(super.getSvgStyles(n)," text-decoration-thickness: ").concat(J(this.textDecorationThickness*this.getObjectScaling().y/10,U.NUM_FRACTION_DIGITS),"%; white-space: pre;")}getSvgSpanStyles(n,e){const{fontFamily:t,strokeWidth:s,stroke:r,fill:i,fontSize:a,fontStyle:o,fontWeight:l,deltaY:c,textDecorationThickness:h,linethrough:d,overline:u,underline:g}=n,f=this.getSvgTextDecoration({underline:g??this.underline,overline:u??this.overline,linethrough:d??this.linethrough}),p=h||this.textDecorationThickness;return[r?Ls(Oe,r):"",s?"stroke-width: ".concat(s,"; "):"",t?"font-family: ".concat(t.includes("'")||t.includes('"')?t:"'".concat(t,"'"),"; "):"",a?"font-size: ".concat(a,"px; "):"",o?"font-style: ".concat(o,"; "):"",l?"font-weight: ".concat(l,"; "):"",f?"text-decoration: ".concat(f,"; text-decoration-thickness: ").concat(J(p*this.getObjectScaling().y/10,U.NUM_FRACTION_DIGITS),"%; "):"",i?Ls(le,i):"",c?"baseline-shift: ".concat(-c,"; "):"",e?"white-space: pre; ":""].join("")}getSvgTextDecoration(n){return["overline","underline","line-through"].filter((e=>n[e.replace("-","")])).join(" ")}}]),A.setClass(ue),A.setSVGClass(ue);class du{constructor(e){m(this,"target",void 0),m(this,"__mouseDownInPlace",!1),m(this,"__dragStartFired",!1),m(this,"__isDraggingOver",!1),m(this,"__dragStartSelection",void 0),m(this,"__dragImageDisposer",void 0),m(this,"_dispose",void 0),this.target=e;const t=[this.target.on("dragenter",this.dragEnterHandler.bind(this)),this.target.on("dragover",this.dragOverHandler.bind(this)),this.target.on("dragleave",this.dragLeaveHandler.bind(this)),this.target.on("dragend",this.dragEndHandler.bind(this)),this.target.on("drop",this.dropHandler.bind(this))];this._dispose=()=>{t.forEach((s=>s())),this._dispose=void 0}}isPointerOverSelection(e){const t=this.target,s=t.getSelectionStartFromPointer(e);return t.isEditing&&s>=t.selectionStart&&s<=t.selectionEnd&&t.selectionStart<t.selectionEnd}start(e){return this.__mouseDownInPlace=this.isPointerOverSelection(e)}isActive(){return this.__mouseDownInPlace}end(e){const t=this.isActive();return t&&!this.__dragStartFired&&(this.target.setCursorByClick(e),this.target.initDelayedCursor(!0)),this.__mouseDownInPlace=!1,this.__dragStartFired=!1,this.__isDraggingOver=!1,t}getDragStartSelection(){return this.__dragStartSelection}setDragImage(e,t){var s;let{selectionStart:r,selectionEnd:i}=t;const a=this.target,o=a.canvas,l=new _(a.flipX?-1:1,a.flipY?-1:1),c=a._getCursorBoundaries(r),h=new _(c.left+c.leftOffset,c.top+c.topOffset).multiply(l).transform(a.calcTransformMatrix()),d=o.getScenePoint(e).subtract(h),u=a.getCanvasRetinaScaling(),g=a.getBoundingRect(),f=h.subtract(new _(g.left,g.top)),p=o.viewportTransform,y=f.add(d).transform(p,!0),x=a.backgroundColor,b=Cn(a.styles);a.backgroundColor="";const O={stroke:"transparent",fill:"transparent",textBackgroundColor:"transparent"};a.setSelectionStyles(O,0,r),a.setSelectionStyles(O,i,a.text.length),a.dirty=!0;const C=a.toCanvasElement({enableRetinaScaling:o.enableRetinaScaling,viewportTransform:!0});a.backgroundColor=x,a.styles=b,a.dirty=!0,qi(C,{position:"fixed",left:"".concat(-C.width,"px"),border:Te,width:"".concat(C.width/u,"px"),height:"".concat(C.height/u,"px")}),this.__dragImageDisposer&&this.__dragImageDisposer(),this.__dragImageDisposer=()=>{C.remove()},Ve(e.target||this.target.hiddenTextarea).body.appendChild(C),(s=e.dataTransfer)===null||s===void 0||s.setDragImage(C,y.x,y.y)}onDragStart(e){this.__dragStartFired=!0;const t=this.target,s=this.isActive();if(s&&e.dataTransfer){const r=this.__dragStartSelection={selectionStart:t.selectionStart,selectionEnd:t.selectionEnd},i=t._text.slice(r.selectionStart,r.selectionEnd).join(""),a=v({text:t.text,value:i},r);e.dataTransfer.setData("text/plain",i),e.dataTransfer.setData("application/fabric",JSON.stringify({value:i,styles:t.getSelectionStyles(r.selectionStart,r.selectionEnd,!0)})),e.dataTransfer.effectAllowed="copyMove",this.setDragImage(e,a)}return t.abortCursorAnimation(),s}canDrop(e){if(this.target.editable&&!this.target.getActiveControl()&&!e.defaultPrevented){if(this.isActive()&&this.__dragStartSelection){const t=this.target.getSelectionStartFromPointer(e),s=this.__dragStartSelection;return t<s.selectionStart||t>s.selectionEnd}return!0}return!1}targetCanDrop(e){return this.target.canDrop(e)}dragEnterHandler(e){let{e:t}=e;const s=this.targetCanDrop(t);!this.__isDraggingOver&&s&&(this.__isDraggingOver=!0)}dragOverHandler(e){const{e:t}=e,s=this.targetCanDrop(t);!this.__isDraggingOver&&s?this.__isDraggingOver=!0:this.__isDraggingOver&&!s&&(this.__isDraggingOver=!1),this.__isDraggingOver&&(t.preventDefault(),e.canDrop=!0,e.dropTarget=this.target)}dragLeaveHandler(){(this.__isDraggingOver||this.isActive())&&(this.__isDraggingOver=!1)}dropHandler(e){var t;const{e:s}=e,r=s.defaultPrevented;this.__isDraggingOver=!1,s.preventDefault();let i=(t=s.dataTransfer)===null||t===void 0?void 0:t.getData("text/plain");if(i&&!r){const a=this.target,o=a.canvas;let l=a.getSelectionStartFromPointer(s);const{styles:c}=s.dataTransfer.types.includes("application/fabric")?JSON.parse(s.dataTransfer.getData("application/fabric")):{},h=i[Math.max(0,i.length-1)],d=0;if(this.__dragStartSelection){const u=this.__dragStartSelection.selectionStart,g=this.__dragStartSelection.selectionEnd;l>u&&l<=g?l=u:l>g&&(l-=g-u),a.removeChars(u,g),delete this.__dragStartSelection}a._reNewline.test(h)&&(a._reNewline.test(a._text[l])||l===a._text.length)&&(i=i.trimEnd()),e.didDrop=!0,e.dropTarget=a,a.insertChars(i,c,l),o.setActiveObject(a),a.enterEditing(s),a.selectionStart=Math.min(l+d,a._text.length),a.selectionEnd=Math.min(a.selectionStart+i.length,a._text.length),a.hiddenTextarea.value=a.text,a._updateTextarea(),a.hiddenTextarea.focus(),a.fire(Br,{index:l+d,action:"drop"}),o.fire("text:changed",{target:a}),o.contextTopDirty=!0,o.requestRenderAll()}}dragEndHandler(e){let{e:t}=e;if(this.isActive()&&this.__dragStartFired&&this.__dragStartSelection){var s;const r=this.target,i=this.target.canvas,{selectionStart:a,selectionEnd:o}=this.__dragStartSelection,l=((s=t.dataTransfer)===null||s===void 0?void 0:s.dropEffect)||Te;l===Te?(r.selectionStart=a,r.selectionEnd=o,r._updateTextarea(),r.hiddenTextarea.focus()):(r.clearContextTop(),l==="move"&&(r.removeChars(a,o),r.selectionStart=r.selectionEnd=a,r.hiddenTextarea&&(r.hiddenTextarea.value=r.text),r._updateTextarea(),r.fire(Br,{index:a,action:"dragend"}),i.fire("text:changed",{target:r}),i.requestRenderAll()),r.exitEditing())}this.__dragImageDisposer&&this.__dragImageDisposer(),delete this.__dragImageDisposer,delete this.__dragStartSelection,this.__isDraggingOver=!1}dispose(){this._dispose&&this._dispose()}}const wa=/[ \n\.,;!\?\-]/;class gu extends ue{constructor(){super(...arguments),m(this,"_currentCursorOpacity",1)}initBehavior(){this._tick=this._tick.bind(this),this._onTickComplete=this._onTickComplete.bind(this),this.updateSelectionOnMouseMove=this.updateSelectionOnMouseMove.bind(this)}onDeselect(e){return this.isEditing&&this.exitEditing(),this.selected=!1,super.onDeselect(e)}_animateCursor(e){let{toValue:t,duration:s,delay:r,onComplete:i}=e;return fo({startValue:this._currentCursorOpacity,endValue:t,duration:s,delay:r,onComplete:i,abort:()=>!this.canvas||this.selectionStart!==this.selectionEnd,onChange:a=>{this._currentCursorOpacity=a,this.renderCursorOrSelection()}})}_tick(e){this._currentTickState=this._animateCursor({toValue:0,duration:this.cursorDuration/2,delay:Math.max(e||0,100),onComplete:this._onTickComplete})}_onTickComplete(){var e;(e=this._currentTickCompleteState)===null||e===void 0||e.abort(),this._currentTickCompleteState=this._animateCursor({toValue:1,duration:this.cursorDuration,onComplete:this._tick})}initDelayedCursor(e){this.abortCursorAnimation(),this._tick(e?0:this.cursorDelay)}abortCursorAnimation(){let e=!1;[this._currentTickState,this._currentTickCompleteState].forEach((t=>{t&&!t.isDone()&&(e=!0,t.abort())})),this._currentCursorOpacity=1,e&&this.clearContextTop()}restartCursorIfNeeded(){[this._currentTickState,this._currentTickCompleteState].some((e=>!e||e.isDone()))&&this.initDelayedCursor()}selectAll(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this}cmdAll(){this.selectAll(),this.renderCursorOrSelection()}getSelectedText(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")}findWordBoundaryLeft(e){let t=0,s=e-1;if(this._reSpace.test(this._text[s]))for(;this._reSpace.test(this._text[s]);)t++,s--;for(;/\S/.test(this._text[s])&&s>-1;)t++,s--;return e-t}findWordBoundaryRight(e){let t=0,s=e;if(this._reSpace.test(this._text[s]))for(;this._reSpace.test(this._text[s]);)t++,s++;for(;/\S/.test(this._text[s])&&s<this._text.length;)t++,s++;return e+t}findLineBoundaryLeft(e){let t=0,s=e-1;for(;!/\n/.test(this._text[s])&&s>-1;)t++,s--;return e-t}findLineBoundaryRight(e){let t=0,s=e;for(;!/\n/.test(this._text[s])&&s<this._text.length;)t++,s++;return e+t}searchWordBoundary(e,t){const s=this._text;let r=e>0&&this._reSpace.test(s[e])&&(t===-1||!dn.test(s[e-1]))?e-1:e,i=s[r];for(;r>0&&r<s.length&&!wa.test(i);)r+=t,i=s[r];return t===-1&&wa.test(i)&&r++,r}selectWord(e){var t;e=(t=e)!==null&&t!==void 0?t:this.selectionStart;const s=this.searchWordBoundary(e,-1),r=Math.max(s,this.searchWordBoundary(e,1));this.selectionStart=s,this.selectionEnd=r,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()}selectLine(e){var t;e=(t=e)!==null&&t!==void 0?t:this.selectionStart;const s=this.findLineBoundaryLeft(e),r=this.findLineBoundaryRight(e);this.selectionStart=s,this.selectionEnd=r,this._fireSelectionChanged(),this._updateTextarea()}enterEditing(e){!this.isEditing&&this.editable&&(this.enterEditingImpl(),this.fire("editing:entered",e?{e}:void 0),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this,e}),this.canvas.requestRenderAll()))}enterEditingImpl(){this.canvas&&(this.canvas.calcOffset(),this.canvas.textEditingManager.exitTextEditing()),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick()}updateSelectionOnMouseMove(e){if(this.getActiveControl())return;const t=this.hiddenTextarea;Ve(t).activeElement!==t&&t.focus();const s=this.getSelectionStartFromPointer(e),r=this.selectionStart,i=this.selectionEnd;(s===this.__selectionStartOnMouseDown&&r!==i||r!==s&&i!==s)&&(s>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=s):(this.selectionStart=s,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===r&&this.selectionEnd===i||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}_setEditingProps(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0}fromStringToGraphemeSelection(e,t,s){const r=s.slice(0,e),i=this.graphemeSplit(r).length;if(e===t)return{selectionStart:i,selectionEnd:i};const a=s.slice(e,t);return{selectionStart:i,selectionEnd:i+this.graphemeSplit(a).length}}fromGraphemeToStringSelection(e,t,s){const r=s.slice(0,e).join("").length;return e===t?{selectionStart:r,selectionEnd:r}:{selectionStart:r,selectionEnd:r+s.slice(e,t).join("").length}}_updateTextarea(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){const e=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=e.selectionStart,this.hiddenTextarea.selectionEnd=e.selectionEnd}this.updateTextareaPosition()}}updateFromTextArea(){if(!this.hiddenTextarea)return;this.cursorOffsetCache={};const e=this.hiddenTextarea;this.text=e.value,this.set("dirty",!0),this.initDimensions(),this.setCoords();const t=this.fromStringToGraphemeSelection(e.selectionStart,e.selectionEnd,e.value);this.selectionEnd=this.selectionStart=t.selectionEnd,this.inCompositionMode||(this.selectionStart=t.selectionStart),this.updateTextareaPosition()}updateTextareaPosition(){if(this.selectionStart===this.selectionEnd){const e=this._calcTextareaPosition();this.hiddenTextarea.style.left=e.left,this.hiddenTextarea.style.top=e.top}}_calcTextareaPosition(){if(!this.canvas)return{left:"1px",top:"1px"};const e=this.inCompositionMode?this.compositionStart:this.selectionStart,t=this._getCursorBoundaries(e),s=this.get2DCursorLocation(e),r=s.lineIndex,i=s.charIndex,a=this.getValueOfPropertyAt(r,i,"fontSize")*this.lineHeight,o=t.leftOffset,l=this.getCanvasRetinaScaling(),c=this.canvas.upperCanvasEl,h=c.width/l,d=c.height/l,u=h-a,g=d-a,f=new _(t.left+o,t.top+t.topOffset+a).transform(this.calcTransformMatrix()).transform(this.canvas.viewportTransform).multiply(new _(c.clientWidth/h,c.clientHeight/d));return f.x<0&&(f.x=0),f.x>u&&(f.x=u),f.y<0&&(f.y=0),f.y>g&&(f.y=g),f.x+=this.canvas._offset.left,f.y+=this.canvas._offset.top,{left:"".concat(f.x,"px"),top:"".concat(f.y,"px"),fontSize:"".concat(a,"px"),charHeight:a}}_saveEditingProps(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}}_restoreEditingProps(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor||this.canvas.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor||this.canvas.moveCursor),delete this._savedProps)}_exitEditing(){const e=this.hiddenTextarea;this.selected=!1,this.isEditing=!1,e&&(e.blur&&e.blur(),e.parentNode&&e.parentNode.removeChild(e)),this.hiddenTextarea=null,this.abortCursorAnimation(),this.selectionStart!==this.selectionEnd&&this.clearContextTop()}exitEditingImpl(){this._exitEditing(),this.selectionEnd=this.selectionStart,this._restoreEditingProps(),this._forceClearCache&&(this.initDimensions(),this.setCoords())}exitEditing(){const e=this._textBeforeEdit!==this.text;return this.exitEditingImpl(),this.fire("editing:exited"),e&&this.fire(Nr),this.canvas&&(this.canvas.fire("text:editing:exited",{target:this}),e&&this.canvas.fire("object:modified",{target:this})),this}_removeExtraneousStyles(){for(const e in this.styles)this._textLines[e]||delete this.styles[e]}removeStyleFromTo(e,t){const{lineIndex:s,charIndex:r}=this.get2DCursorLocation(e,!0),{lineIndex:i,charIndex:a}=this.get2DCursorLocation(t,!0);if(s!==i){if(this.styles[s])for(let o=r;o<this._unwrappedTextLines[s].length;o++)delete this.styles[s][o];if(this.styles[i])for(let o=a;o<this._unwrappedTextLines[i].length;o++){const l=this.styles[i][o];l&&(this.styles[s]||(this.styles[s]={}),this.styles[s][r+o-a]=l)}for(let o=s+1;o<=i;o++)delete this.styles[o];this.shiftLineStyles(i,s-i)}else if(this.styles[s]){const o=this.styles[s],l=a-r;for(let c=r;c<a;c++)delete o[c];for(const c in this.styles[s]){const h=parseInt(c,10);h>=a&&(o[h-l]=o[c],delete o[c])}}}shiftLineStyles(e,t){const s=Object.assign({},this.styles);for(const r in this.styles){const i=parseInt(r,10);i>e&&(this.styles[i+t]=s[i],s[i-t]||delete this.styles[i])}}insertNewlineStyleObject(e,t,s,r){const i={},a=this._unwrappedTextLines[e].length,o=a===t;let l=!1;s||(s=1),this.shiftLineStyles(e,s);const c=this.styles[e]?this.styles[e][t===0?t:t-1]:void 0;for(const d in this.styles[e]){const u=parseInt(d,10);u>=t&&(l=!0,i[u-t]=this.styles[e][d],o&&t===0||delete this.styles[e][d])}let h=!1;for(l&&!o&&(this.styles[e+s]=i,h=!0),(h||a>t)&&s--;s>0;)r&&r[s-1]?this.styles[e+s]={0:v({},r[s-1])}:c?this.styles[e+s]={0:v({},c)}:delete this.styles[e+s],s--;this._forceClearCache=!0}insertCharStyleObject(e,t,s,r){this.styles||(this.styles={});const i=this.styles[e],a=i?v({},i):{};s||(s=1);for(const l in a){const c=parseInt(l,10);c>=t&&(i[c+s]=a[c],a[c-s]||delete i[c])}if(this._forceClearCache=!0,r){for(;s--;)Object.keys(r[s]).length&&(this.styles[e]||(this.styles[e]={}),this.styles[e][t+s]=v({},r[s]));return}if(!i)return;const o=i[t?t-1:1];for(;o&&s--;)this.styles[e][t+s]=v({},o)}insertNewStyleBlock(e,t,s){const r=this.get2DCursorLocation(t,!0),i=[0];let a,o=0;for(let l=0;l<e.length;l++)e[l]===`
`?(o++,i[o]=0):i[o]++;for(i[0]>0&&(this.insertCharStyleObject(r.lineIndex,r.charIndex,i[0],s),s=s&&s.slice(i[0]+1)),o&&this.insertNewlineStyleObject(r.lineIndex,r.charIndex+i[0],o),a=1;a<o;a++)i[a]>0?this.insertCharStyleObject(r.lineIndex+a,0,i[a],s):s&&this.styles[r.lineIndex+a]&&s[0]&&(this.styles[r.lineIndex+a][0]=s[0]),s=s&&s.slice(i[a]+1);i[a]>0&&this.insertCharStyleObject(r.lineIndex+a,0,i[a],s)}removeChars(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e+1;this.removeStyleFromTo(e,t),this._text.splice(e,t-e),this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}insertChars(e,t,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s;r>s&&this.removeStyleFromTo(s,r);const i=this.graphemeSplit(e);this.insertNewStyleBlock(i,s,t),this._text=[...this._text.slice(0,s),...i,...this._text.slice(r)],this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}setSelectionStartEndWithShift(e,t,s){s<=e?(t===e?this._selectionDirection=H:this._selectionDirection===se&&(this._selectionDirection=H,this.selectionEnd=e),this.selectionStart=s):s>e&&s<t?this._selectionDirection===se?this.selectionEnd=s:this.selectionStart=s:(t===e?this._selectionDirection=se:this._selectionDirection===H&&(this._selectionDirection=se,this.selectionStart=t),this.selectionEnd=s)}}class fu extends gu{initHiddenTextarea(){const e=this.canvas&&Ve(this.canvas.getElement())||os(),t=e.createElement("textarea");Object.entries({autocapitalize:"off",autocorrect:"off",autocomplete:"off",spellcheck:"false","data-fabric":"textarea",wrap:"off"}).map((a=>{let[o,l]=a;return t.setAttribute(o,l)}));const{top:s,left:r,fontSize:i}=this._calcTextareaPosition();t.style.cssText="position: absolute; top: ".concat(s,"; left: ").concat(r,"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: ").concat(i,";"),(this.hiddenTextareaContainer||e.body).appendChild(t),Object.entries({blur:"blur",keydown:"onKeyDown",keyup:"onKeyUp",input:"onInput",copy:"copy",cut:"copy",paste:"paste",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate",compositionend:"onCompositionEnd"}).map((a=>{let[o,l]=a;return t.addEventListener(o,this[l].bind(this))})),this.hiddenTextarea=t}blur(){this.abortCursorAnimation()}onKeyDown(e){if(!this.isEditing)return;const t=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(e.keyCode in t)this[t[e.keyCode]](e);else{if(!(e.keyCode in this.ctrlKeysMapDown)||!e.ctrlKey&&!e.metaKey)return;this[this.ctrlKeysMapDown[e.keyCode]](e)}e.stopImmediatePropagation(),e.preventDefault(),e.keyCode>=33&&e.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}onKeyUp(e){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:e.keyCode in this.ctrlKeysMapUp&&(e.ctrlKey||e.metaKey)&&(this[this.ctrlKeysMapUp[e.keyCode]](e),e.stopImmediatePropagation(),e.preventDefault(),this.canvas&&this.canvas.requestRenderAll())}onInput(e){const t=this.fromPaste,{value:s,selectionStart:r,selectionEnd:i}=this.hiddenTextarea;if(this.fromPaste=!1,e&&e.stopPropagation(),!this.isEditing)return;const a=()=>{this.updateFromTextArea(),this.fire(Br),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())};if(this.hiddenTextarea.value==="")return this.styles={},void a();const o=this._splitTextIntoLines(s).graphemeText,l=this._text.length,c=o.length,h=this.selectionStart,d=this.selectionEnd,u=h!==d;let g,f,p,y,x=c-l;const b=this.fromStringToGraphemeSelection(r,i,s),O=h>b.selectionStart;u?(f=this._text.slice(h,d),x+=d-h):c<l&&(f=O?this._text.slice(d+x,d):this._text.slice(h,h-x));const C=o.slice(b.selectionEnd-x,b.selectionEnd);if(f&&f.length&&(C.length&&(g=this.getSelectionStyles(h,h+1,!1),g=C.map((()=>g[0]))),u?(p=h,y=d):O?(p=d-f.length,y=d):(p=d,y=d+f.length),this.removeStyleFromTo(p,y)),C.length){const{copyPasteData:k}=tt();t&&C.join("")===k.copiedText&&!U.disableStyleCopyPaste&&(g=k.copiedTextStyle),this.insertNewStyleBlock(C,h,g)}a()}onCompositionStart(){this.inCompositionMode=!0}onCompositionEnd(){this.inCompositionMode=!1}onCompositionUpdate(e){let{target:t}=e;const{selectionStart:s,selectionEnd:r}=t;this.compositionStart=s,this.compositionEnd=r,this.updateTextareaPosition()}copy(){if(this.selectionStart===this.selectionEnd)return;const{copyPasteData:e}=tt();e.copiedText=this.getSelectedText(),U.disableStyleCopyPaste?e.copiedTextStyle=void 0:e.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0}paste(){this.fromPaste=!0}_getWidthBeforeCursor(e,t){let s,r=this._getLineLeftOffset(e);return t>0&&(s=this.__charBounds[e][t-1],r+=s.left+s.width),r}getDownCursorOffset(e,t){const s=this._getSelectionForOffset(e,t),r=this.get2DCursorLocation(s),i=r.lineIndex;if(i===this._textLines.length-1||e.metaKey||e.keyCode===34)return this._text.length-s;const a=r.charIndex,o=this._getWidthBeforeCursor(i,a),l=this._getIndexOnLine(i+1,o);return this._textLines[i].slice(a).length+l+1+this.missingNewlineOffset(i)}_getSelectionForOffset(e,t){return e.shiftKey&&this.selectionStart!==this.selectionEnd&&t?this.selectionEnd:this.selectionStart}getUpCursorOffset(e,t){const s=this._getSelectionForOffset(e,t),r=this.get2DCursorLocation(s),i=r.lineIndex;if(i===0||e.metaKey||e.keyCode===33)return-s;const a=r.charIndex,o=this._getWidthBeforeCursor(i,a),l=this._getIndexOnLine(i-1,o),c=this._textLines[i].slice(0,a),h=this.missingNewlineOffset(i-1);return-this._textLines[i-1].length+l-c.length+(1-h)}_getIndexOnLine(e,t){const s=this._textLines[e];let r,i,a=this._getLineLeftOffset(e),o=0;for(let l=0,c=s.length;l<c;l++)if(r=this.__charBounds[e][l].width,a+=r,a>t){i=!0;const h=a-r,d=a,u=Math.abs(h-t);o=Math.abs(d-t)<u?l:l-1;break}return i||(o=s.length-1),o}moveCursorDown(e){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",e)}moveCursorUp(e){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",e)}_moveCursorUpOrDown(e,t){const s=this["get".concat(e,"CursorOffset")](t,this._selectionDirection===se);if(t.shiftKey?this.moveCursorWithShift(s):this.moveCursorWithoutShift(s),s!==0){const r=this.text.length;this.selectionStart=ss(0,this.selectionStart,r),this.selectionEnd=ss(0,this.selectionEnd,r),this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea()}}moveCursorWithShift(e){const t=this._selectionDirection===H?this.selectionStart+e:this.selectionEnd+e;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,t),e!==0}moveCursorWithoutShift(e){return e<0?(this.selectionStart+=e,this.selectionEnd=this.selectionStart):(this.selectionEnd+=e,this.selectionStart=this.selectionEnd),e!==0}moveCursorLeft(e){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",e)}_move(e,t,s){let r;if(e.altKey)r=this["findWordBoundary".concat(s)](this[t]);else{if(!e.metaKey&&e.keyCode!==35&&e.keyCode!==36)return this[t]+=s==="Left"?-1:1,!0;r=this["findLineBoundary".concat(s)](this[t])}return r!==void 0&&this[t]!==r&&(this[t]=r,!0)}_moveLeft(e,t){return this._move(e,t,"Left")}_moveRight(e,t){return this._move(e,t,"Right")}moveCursorLeftWithoutShift(e){let t=!0;return this._selectionDirection=H,this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(t=this._moveLeft(e,"selectionStart")),this.selectionEnd=this.selectionStart,t}moveCursorLeftWithShift(e){return this._selectionDirection===se&&this.selectionStart!==this.selectionEnd?this._moveLeft(e,"selectionEnd"):this.selectionStart!==0?(this._selectionDirection=H,this._moveLeft(e,"selectionStart")):void 0}moveCursorRight(e){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",e)}_moveCursorLeftOrRight(e,t){const s="moveCursor".concat(e).concat(t.shiftKey?"WithShift":"WithoutShift");this._currentCursorOpacity=1,this[s](t)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())}moveCursorRightWithShift(e){return this._selectionDirection===H&&this.selectionStart!==this.selectionEnd?this._moveRight(e,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection=se,this._moveRight(e,"selectionEnd")):void 0}moveCursorRightWithoutShift(e){let t=!0;return this._selectionDirection=se,this.selectionStart===this.selectionEnd?(t=this._moveRight(e,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,t}}const Ca=n=>!!n.button;class pu extends fu{constructor(){super(...arguments),m(this,"draggableTextDelegate",void 0)}initBehavior(){this.on("mousedown",this._mouseDownHandler),this.on("mouseup",this.mouseUpHandler),this.on("mousedblclick",this.doubleClickHandler),this.on("mousetripleclick",this.tripleClickHandler),this.draggableTextDelegate=new du(this),super.initBehavior()}shouldStartDragging(){return this.draggableTextDelegate.isActive()}onDragStart(e){return this.draggableTextDelegate.onDragStart(e)}canDrop(e){return this.draggableTextDelegate.canDrop(e)}doubleClickHandler(e){this.isEditing&&(this.selectWord(this.getSelectionStartFromPointer(e.e)),this.renderCursorOrSelection())}tripleClickHandler(e){this.isEditing&&(this.selectLine(this.getSelectionStartFromPointer(e.e)),this.renderCursorOrSelection())}_mouseDownHandler(e){let{e:t,alreadySelected:s}=e;this.canvas&&this.editable&&!Ca(t)&&!this.getActiveControl()&&(this.draggableTextDelegate.start(t)||(this.canvas.textEditingManager.register(this),s&&(this.inCompositionMode=!1,this.setCursorByClick(t)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()),this.selected||(this.selected=s||this.isEditing)))}mouseUpHandler(e){let{e:t,transform:s}=e;const r=this.draggableTextDelegate.end(t);if(this.canvas){this.canvas.textEditingManager.unregister(this);const i=this.canvas._activeObject;if(i&&i!==this)return}!this.editable||this.group&&!this.group.interactive||s&&s.actionPerformed||Ca(t)||r||this.selected&&!this.getActiveControl()&&(this.enterEditing(t),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection())}setCursorByClick(e){const t=this.getSelectionStartFromPointer(e),s=this.selectionStart,r=this.selectionEnd;e.shiftKey?this.setSelectionStartEndWithShift(s,r,t):(this.selectionStart=t,this.selectionEnd=t),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())}getSelectionStartFromPointer(e){const t=this.canvas.getScenePoint(e).transform(ze(this.calcTransformMatrix())).add(new _(-this._getLeftOffset(),-this._getTopOffset()));let s=0,r=0,i=0;for(let c=0;c<this._textLines.length&&s<=t.y;c++)s+=this.getHeightOfLine(c),i=c,c>0&&(r+=this._textLines[c-1].length+this.missingNewlineOffset(c-1));let a=Math.abs(this._getLineLeftOffset(i));const o=this._textLines[i].length,l=this.__charBounds[i];for(let c=0;c<o;c++){const h=a+l[c].kernedWidth;if(t.x<=h){Math.abs(t.x-h)<=Math.abs(t.x-a)&&r++;break}a=h,r++}return Math.min(this.flipX?o-r:r,this._text.length)}}const hr="moveCursorUp",ur="moveCursorDown",dr="moveCursorLeft",gr="moveCursorRight",fr="exitEditing",Sa=(n,e)=>{const t=e.getRetinaScaling();n.setTransform(t,0,0,t,0,0);const s=e.viewportTransform;n.transform(s[0],s[1],s[2],s[3],s[4],s[5])},mu=v({selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,keysMap:{9:fr,27:fr,33:hr,34:ur,35:gr,36:dr,37:dr,38:hr,39:gr,40:ur},keysMapRtl:{9:fr,27:fr,33:hr,34:ur,35:dr,36:gr,37:gr,38:hr,39:dr,40:ur},ctrlKeysMapDown:{65:"cmdAll"},ctrlKeysMapUp:{67:"copy",88:"cut"}},{_selectionDirection:null,_reSpace:/\s|\r?\n/,inCompositionMode:!1});class ut extends pu{static getDefaults(){return v(v({},super.getDefaults()),ut.ownDefaults)}get type(){const e=super.type;return e==="itext"?"i-text":e}constructor(e,t){super(e,v(v({},ut.ownDefaults),t)),this.initBehavior()}_set(e,t){return this.isEditing&&this._savedProps&&e in this._savedProps?(this._savedProps[e]=t,this):(e==="canvas"&&(this.canvas instanceof Ki&&this.canvas.textEditingManager.remove(this),t instanceof Ki&&t.textEditingManager.add(this)),super._set(e,t))}setSelectionStart(e){e=Math.max(e,0),this._updateAndFire("selectionStart",e)}setSelectionEnd(e){e=Math.min(e,this.text.length),this._updateAndFire("selectionEnd",e)}_updateAndFire(e,t){this[e]!==t&&(this._fireSelectionChanged(),this[e]=t),this._updateTextarea()}_fireSelectionChanged(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})}initDimensions(){this.isEditing&&this.initDelayedCursor(),super.initDimensions()}getSelectionStyles(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart||0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.selectionEnd,s=arguments.length>2?arguments[2]:void 0;return super.getSelectionStyles(e,t,s)}setSelectionStyles(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.selectionStart||0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.selectionEnd;return super.setSelectionStyles(e,t,s)}get2DCursorLocation(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,t=arguments.length>1?arguments[1]:void 0;return super.get2DCursorLocation(e,t)}render(e){super.render(e),this.cursorOffsetCache={},this.renderCursorOrSelection()}toCanvasElement(e){const t=this.isEditing;this.isEditing=!1;const s=super.toCanvasElement(e);return this.isEditing=t,s}renderCursorOrSelection(){if(!this.isEditing||!this.canvas)return;const e=this.clearContextTop(!0);if(!e)return;const t=this._getCursorBoundaries(),s=this.findAncestorsWithClipPath(),r=s.length>0;let i,a=e;if(r){i=Pe(e.canvas),a=i.getContext("2d"),Sa(a,this.canvas);const o=this.calcTransformMatrix();a.transform(o[0],o[1],o[2],o[3],o[4],o[5])}if(this.selectionStart!==this.selectionEnd||this.inCompositionMode?this.renderSelection(a,t):this.renderCursor(a,t),r)for(const o of s){const l=o.clipPath,c=Pe(e.canvas),h=c.getContext("2d");if(Sa(h,this.canvas),!l.absolutePositioned){const d=o.calcTransformMatrix();h.transform(d[0],d[1],d[2],d[3],d[4],d[5])}l.transform(h),l.drawObject(h,!0,{}),this.drawClipPathOnCache(a,l,c)}r&&(e.setTransform(1,0,0,1,0,0),e.drawImage(i,0,0)),this.canvas.contextTopDirty=!0,e.restore()}findAncestorsWithClipPath(){const e=[];let t=this;for(;t;)t.clipPath&&e.push(t),t=t.parent;return e}_getCursorBoundaries(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,t=arguments.length>1?arguments[1]:void 0;const s=this._getLeftOffset(),r=this._getTopOffset(),i=this._getCursorBoundariesOffsets(e,t);return{left:s,top:r,leftOffset:i.left,topOffset:i.top}}_getCursorBoundariesOffsets(e,t){return t?this.__getCursorBoundariesOffsets(e):this.cursorOffsetCache&&"top"in this.cursorOffsetCache?this.cursorOffsetCache:this.cursorOffsetCache=this.__getCursorBoundariesOffsets(e)}__getCursorBoundariesOffsets(e){let t=0,s=0;const{charIndex:r,lineIndex:i}=this.get2DCursorLocation(e);for(let c=0;c<i;c++)t+=this.getHeightOfLine(c);const a=this._getLineLeftOffset(i),o=this.__charBounds[i][r];o&&(s=o.left),this.charSpacing!==0&&r===this._textLines[i].length&&(s-=this._getWidthOfCharSpacing());const l={top:t,left:a+(s>0?s:0)};return this.direction==="rtl"&&(this.textAlign===se||this.textAlign===Ke||this.textAlign===Ms?l.left*=-1:this.textAlign===H||this.textAlign===Yr?l.left=a-(s>0?s:0):this.textAlign!==z&&this.textAlign!==As||(l.left=a-(s>0?s:0))),l}renderCursorAt(e){this._renderCursor(this.canvas.contextTop,this._getCursorBoundaries(e,!0),e)}renderCursor(e,t){this._renderCursor(e,t,this.selectionStart)}getCursorRenderingData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this._getCursorBoundaries(e);const s=this.get2DCursorLocation(e),r=s.lineIndex,i=s.charIndex>0?s.charIndex-1:0,a=this.getValueOfPropertyAt(r,i,"fontSize"),o=this.getObjectScaling().x*this.canvas.getZoom(),l=this.cursorWidth/o,c=this.getValueOfPropertyAt(r,i,"deltaY"),h=t.topOffset+(1-this._fontSizeFraction)*this.getHeightOfLine(r)/this.lineHeight-a*(1-this._fontSizeFraction);return{color:this.cursorColor||this.getValueOfPropertyAt(r,i,"fill"),opacity:this._currentCursorOpacity,left:t.left+t.leftOffset-l/2,top:h+t.top+c,width:l,height:a}}_renderCursor(e,t,s){const{color:r,opacity:i,left:a,top:o,width:l,height:c}=this.getCursorRenderingData(s,t);e.fillStyle=r,e.globalAlpha=i,e.fillRect(a,o,l,c)}renderSelection(e,t){const s={selectionStart:this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd:this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd};this._renderSelection(e,s,t)}renderDragSourceEffect(){const e=this.draggableTextDelegate.getDragStartSelection();this._renderSelection(this.canvas.contextTop,e,this._getCursorBoundaries(e.selectionStart,!0))}renderDropTargetEffect(e){const t=this.getSelectionStartFromPointer(e);this.renderCursorAt(t)}_renderSelection(e,t,s){const r=t.selectionStart,i=t.selectionEnd,a=this.textAlign.includes(Ke),o=this.get2DCursorLocation(r),l=this.get2DCursorLocation(i),c=o.lineIndex,h=l.lineIndex,d=o.charIndex<0?0:o.charIndex,u=l.charIndex<0?0:l.charIndex;for(let g=c;g<=h;g++){const f=this._getLineLeftOffset(g)||0;let p=this.getHeightOfLine(g),y=0,x=0,b=0;if(g===c&&(x=this.__charBounds[c][d].left),g>=c&&g<h)b=a&&!this.isEndOfWrapping(g)?this.width:this.getLineWidth(g)||5;else if(g===h)if(u===0)b=this.__charBounds[h][u].left;else{const D=this._getWidthOfCharSpacing();b=this.__charBounds[h][u-1].left+this.__charBounds[h][u-1].width-D}y=p,(this.lineHeight<1||g===h&&this.lineHeight>1)&&(p/=this.lineHeight);let O=s.left+f+x,C=p,k=0;const F=b-x;this.inCompositionMode?(e.fillStyle=this.compositionColor||"black",C=1,k=p):e.fillStyle=this.selectionColor,this.direction==="rtl"&&(this.textAlign===se||this.textAlign===Ke||this.textAlign===Ms?O=this.width-O-F:this.textAlign===H||this.textAlign===Yr?O=s.left+f-b:this.textAlign!==z&&this.textAlign!==As||(O=s.left+f-b)),e.fillRect(O,s.top+s.topOffset+k,F,C),s.topOffset+=y}}getCurrentCharFontSize(){const e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fontSize")}getCurrentCharColor(){const e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,le)}_getCurrentCharIndex(){const e=this.get2DCursorLocation(this.selectionStart,!0),t=e.charIndex>0?e.charIndex-1:0;return{l:e.lineIndex,c:t}}dispose(){this.exitEditingImpl(),this.draggableTextDelegate.dispose(),super.dispose()}}m(ut,"ownDefaults",mu),m(ut,"type","IText"),A.setClass(ut),A.setClass(ut,"i-text");class Rt extends ut{static getDefaults(){return v(v({},super.getDefaults()),Rt.ownDefaults)}constructor(e,t){super(e,v(v({},Rt.ownDefaults),t))}static createControls(){return{controls:Hc()}}initDimensions(){this.initialized&&(this.isEditing&&this.initDelayedCursor(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.includes(Ke)&&this.enlargeSpaces(),this.height=this.calcTextHeight())}_generateStyleMap(e){let t=0,s=0,r=0;const i={};for(let a=0;a<e.graphemeLines.length;a++)e.graphemeText[r]===`
`&&a>0?(s=0,r++,t++):!this.splitByGrapheme&&this._reSpaceAndTab.test(e.graphemeText[r])&&a>0&&(s++,r++),i[a]={line:t,offset:s},r+=e.graphemeLines[a].length,s+=e.graphemeLines[a].length;return i}styleHas(e,t){if(this._styleMap&&!this.isWrapping){const s=this._styleMap[t];s&&(t=s.line)}return super.styleHas(e,t)}isEmptyStyles(e){if(!this.styles)return!0;let t,s=0,r=e+1,i=!1;const a=this._styleMap[e],o=this._styleMap[e+1];a&&(e=a.line,s=a.offset),o&&(r=o.line,i=r===e,t=o.offset);const l=e===void 0?this.styles:{line:this.styles[e]};for(const c in l)for(const h in l[c]){const d=parseInt(h,10);if(d>=s&&(!i||d<t))for(const u in l[c][h])return!1}return!0}_getStyleDeclaration(e,t){if(this._styleMap&&!this.isWrapping){const s=this._styleMap[e];if(!s)return{};e=s.line,t=s.offset+t}return super._getStyleDeclaration(e,t)}_setStyleDeclaration(e,t,s){const r=this._styleMap[e];super._setStyleDeclaration(r.line,r.offset+t,s)}_deleteStyleDeclaration(e,t){const s=this._styleMap[e];super._deleteStyleDeclaration(s.line,s.offset+t)}_getLineStyle(e){const t=this._styleMap[e];return!!this.styles[t.line]}_setLineStyle(e){const t=this._styleMap[e];super._setLineStyle(t.line)}_wrapText(e,t){this.isWrapping=!0;const s=this.getGraphemeDataForRender(e),r=[];for(let i=0;i<s.wordsData.length;i++)r.push(...this._wrapLine(i,t,s));return this.isWrapping=!1,r}getGraphemeDataForRender(e){const t=this.splitByGrapheme,s=t?"":" ";let r=0;return{wordsData:e.map(((i,a)=>{let o=0;const l=t?this.graphemeSplit(i):this.wordSplit(i);return l.length===0?[{word:[],width:0}]:l.map((c=>{const h=t?[c]:this.graphemeSplit(c),d=this._measureWord(h,a,o);return r=Math.max(d,r),o+=h.length+s.length,{word:h,width:d}}))})),largestWordWidth:r}}_measureWord(e,t){let s,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=0;for(let a=0,o=e.length;a<o;a++)i+=this._getGraphemeBox(e[a],t,a+r,s,!0).kernedWidth,s=e[a];return i}wordSplit(e){return e.split(this._wordJoiners)}_wrapLine(e,t,s){let{largestWordWidth:r,wordsData:i}=s,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const o=this._getWidthOfCharSpacing(),l=this.splitByGrapheme,c=[],h=l?"":" ";let d=0,u=[],g=0,f=0,p=!0;t-=a;const y=Math.max(t,r,this.dynamicMinWidth),x=i[e];let b;for(g=0,b=0;b<x.length;b++){const{word:O,width:C}=x[b];g+=O.length,d+=f+C-o,d>y&&!p?(c.push(u),u=[],d=C,p=!0):d+=o,p||l||u.push(h),u=u.concat(O),f=l?0:this._measureWord([h],e,g),g++,p=!1}return b&&c.push(u),r+a>this.dynamicMinWidth&&(this.dynamicMinWidth=r-o+a),c}isEndOfWrapping(e){return!this._styleMap[e+1]||this._styleMap[e+1].line!==this._styleMap[e].line}missingNewlineOffset(e,t){return this.splitByGrapheme&&!t?this.isEndOfWrapping(e)?1:0:1}_splitTextIntoLines(e){const t=super._splitTextIntoLines(e),s=this._wrapText(t.lines,this.width),r=new Array(s.length);for(let i=0;i<s.length;i++)r[i]=s[i].join("");return t.lines=r,t.graphemeLines=s,t}getMinWidth(){return Math.max(this.minWidth,this.dynamicMinWidth)}_removeExtraneousStyles(){const e=new Map;for(const t in this._styleMap){const s=parseInt(t,10);if(this._textLines[s]){const r=this._styleMap[t].line;e.set("".concat(r),!0)}}for(const t in this.styles)e.has(t)||delete this.styles[t]}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject(["minWidth","splitByGrapheme",...e])}}m(Rt,"type","Textbox"),m(Rt,"textLayoutProperties",[...ut.textLayoutProperties,"width"]),m(Rt,"ownDefaults",{minWidth:20,dynamicMinWidth:2,lockScalingFlip:!0,noScaleCache:!1,_wordJoiners:/[ \t\r]/,splitByGrapheme:!1}),A.setClass(Rt);class Ta extends ui{shouldPerformLayout(e){return!!e.target.clipPath&&super.shouldPerformLayout(e)}shouldLayoutClipPath(){return!1}calcLayoutResult(e,t){const{target:s}=e,{clipPath:r,group:i}=s;if(!r||!this.shouldPerformLayout(e))return;const{width:a,height:o}=dt(wo(s,r)),l=new _(a,o);if(r.absolutePositioned)return{center:Qt(r.getRelativeCenterPoint(),void 0,i?i.calcTransformMatrix():void 0),size:l};{const c=r.getRelativeCenterPoint().transform(s.calcOwnMatrix(),!0);if(this.shouldPerformLayout(e)){const{center:h=new _,correction:d=new _}=this.calcBoundingBox(t,e)||{};return{center:h.add(c),correction:d.subtract(c),size:l}}return{center:s.getRelativeCenterPoint().add(c),size:l}}}}m(Ta,"type","clip-path"),A.setClass(Ta);class Oa extends ui{getInitialSize(e,t){let{target:s}=e,{size:r}=t;return new _(s.width||r.x,s.height||r.y)}}m(Oa,"type","fixed"),A.setClass(Oa);class vu extends Bs{subscribeTargets(e){const t=e.target;e.targets.reduce(((s,r)=>(r.parent&&s.add(r.parent),s)),new Set).forEach((s=>{s.layoutManager.subscribeTargets({target:s,targets:[t]})}))}unsubscribeTargets(e){const t=e.target,s=t.getObjects();e.targets.reduce(((r,i)=>(i.parent&&r.add(i.parent),r)),new Set).forEach((r=>{!s.some((i=>i.parent===r))&&r.layoutManager.unsubscribeTargets({target:r,targets:[t]})}))}}class Lt extends It{static getDefaults(){return v(v({},super.getDefaults()),Lt.ownDefaults)}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,Lt.ownDefaults),this.setOptions(t);const{left:s,top:r,layoutManager:i}=t;this.groupInit(e,{left:s,top:r,layoutManager:i??new vu})}_shouldSetNestedCoords(){return!0}__objectSelectionMonitor(){}multiSelectAdd(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];this.multiSelectionStacking==="selection-order"?this.add(...t):t.forEach((r=>{const i=this._objects.findIndex((o=>o.isInFrontOf(r))),a=i===-1?this.size():i;this.insertAt(a,r)}))}canEnterGroup(e){return this.getObjects().some((t=>t.isDescendantOf(e)||e.isDescendantOf(t)))?(Ct("error","ActiveSelection: circular object trees are not supported, this call has no effect"),!1):super.canEnterGroup(e)}enterGroup(e,t){e.parent&&e.parent===e.group?e.parent._exitGroup(e):e.group&&e.parent!==e.group&&e.group.remove(e),this._enterGroup(e,t)}exitGroup(e,t){this._exitGroup(e,t),e.parent&&e.parent._enterGroup(e,!0)}_onAfterObjectsChange(e,t){super._onAfterObjectsChange(e,t);const s=new Set;t.forEach((r=>{const{parent:i}=r;i&&s.add(i)})),e===kn?s.forEach((r=>{r._onAfterObjectsChange(Ur,t)})):s.forEach((r=>{r._set("dirty",!0)}))}onDeselect(){return this.removeAll(),!1}toString(){return"#<ActiveSelection: (".concat(this.complexity(),")>")}shouldCache(){return!1}isOnACache(){return!1}_renderControls(e,t,s){e.save(),e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;const r=v(v({hasControls:!1},s),{},{forActiveSelection:!0});for(let i=0;i<this._objects.length;i++)this._objects[i]._renderControls(e,r);super._renderControls(e,t),e.restore()}}m(Lt,"type","ActiveSelection"),m(Lt,"ownDefaults",{multiSelectionStacking:"canvas-stacking"}),A.setClass(Lt),A.setClass(Lt,"activeSelection");class yu{constructor(){m(this,"resources",{})}applyFilters(e,t,s,r,i){const a=i.getContext("2d");if(!a)return;a.drawImage(t,0,0,s,r);const o={sourceWidth:s,sourceHeight:r,imageData:a.getImageData(0,0,s,r),originalEl:t,originalImageData:a.getImageData(0,0,s,r),canvasEl:i,ctx:a,filterBackend:this};e.forEach((c=>{c.applyTo(o)}));const{imageData:l}=o;return l.width===s&&l.height===r||(i.width=l.width,i.height=l.height),a.putImageData(l,0,0),o}}class Bo{constructor(){let{tileSize:e=U.textureSize}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};m(this,"aPosition",new Float32Array([0,0,0,1,1,0,1,1])),m(this,"resources",{}),this.tileSize=e,this.setupGLContext(e,e),this.captureGPUInfo()}setupGLContext(e,t){this.dispose(),this.createWebGLCanvas(e,t)}createWebGLCanvas(e,t){const s=Pe({width:e,height:t}),r=s.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1});r&&(r.clearColor(0,0,0,0),this.canvas=s,this.gl=r)}applyFilters(e,t,s,r,i,a){const o=this.gl,l=i.getContext("2d");if(!o||!l)return;let c;a&&(c=this.getCachedTexture(a,t));const h={originalWidth:t.width||t.naturalWidth||0,originalHeight:t.height||t.naturalHeight||0,sourceWidth:s,sourceHeight:r,destinationWidth:s,destinationHeight:r,context:o,sourceTexture:this.createTexture(o,s,r,c?void 0:t),targetTexture:this.createTexture(o,s,r),originalTexture:c||this.createTexture(o,s,r,c?void 0:t),passes:e.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:i},d=o.createFramebuffer();return o.bindFramebuffer(o.FRAMEBUFFER,d),e.forEach((u=>{u&&u.applyTo(h)})),(function(u){const g=u.targetCanvas,f=g.width,p=g.height,y=u.destinationWidth,x=u.destinationHeight;f===y&&p===x||(g.width=y,g.height=x)})(h),this.copyGLTo2D(o,h),o.bindTexture(o.TEXTURE_2D,null),o.deleteTexture(h.sourceTexture),o.deleteTexture(h.targetTexture),o.deleteFramebuffer(d),l.setTransform(1,0,0,1,0,0),h}dispose(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()}clearWebGLCaches(){this.programCache={},this.textureCache={}}createTexture(e,t,s,r,i){const{NEAREST:a,TEXTURE_2D:o,RGBA:l,UNSIGNED_BYTE:c,CLAMP_TO_EDGE:h,TEXTURE_MAG_FILTER:d,TEXTURE_MIN_FILTER:u,TEXTURE_WRAP_S:g,TEXTURE_WRAP_T:f}=e,p=e.createTexture();return e.bindTexture(o,p),e.texParameteri(o,d,i||a),e.texParameteri(o,u,i||a),e.texParameteri(o,g,h),e.texParameteri(o,f,h),r?e.texImage2D(o,0,l,l,c,r):e.texImage2D(o,0,l,t,s,0,l,c,null),p}getCachedTexture(e,t,s){const{textureCache:r}=this;if(r[e])return r[e];{const i=this.createTexture(this.gl,t.width,t.height,t,s);return i&&(r[e]=i),i}}evictCachesForKey(e){this.textureCache[e]&&(this.gl.deleteTexture(this.textureCache[e]),delete this.textureCache[e])}copyGLTo2D(e,t){const s=e.canvas,r=t.targetCanvas,i=r.getContext("2d");if(!i)return;i.translate(0,r.height),i.scale(1,-1);const a=s.height-r.height;i.drawImage(s,0,a,r.width,r.height,0,0,r.width,r.height)}copyGLTo2DPutImageData(e,t){const s=t.targetCanvas.getContext("2d"),r=t.destinationWidth,i=t.destinationHeight,a=r*i*4;if(!s)return;const o=new Uint8Array(this.imageBuffer,0,a),l=new Uint8ClampedArray(this.imageBuffer,0,a);e.readPixels(0,0,r,i,e.RGBA,e.UNSIGNED_BYTE,o);const c=new ImageData(l,r,i);s.putImageData(c,0,0)}captureGPUInfo(){if(this.gpuInfo)return this.gpuInfo;const e=this.gl,t={renderer:"",vendor:""};if(!e)return t;const s=e.getExtension("WEBGL_debug_renderer_info");if(s){const r=e.getParameter(s.UNMASKED_RENDERER_WEBGL),i=e.getParameter(s.UNMASKED_VENDOR_WEBGL);r&&(t.renderer=r.toLowerCase()),i&&(t.vendor=i.toLowerCase())}return this.gpuInfo=t,t}}let Pi;function _u(){const{WebGLProbe:n}=tt();return n.queryWebGL(pt()),U.enableGLFiltering&&n.isSupported(U.textureSize)?new Bo({tileSize:U.textureSize}):new yu}function Fi(){return!Pi&&(!(arguments.length>0&&arguments[0]!==void 0)||arguments[0])&&(Pi=_u()),Pi}const xu=["filters","resizeFilter","src","crossOrigin","type"],No=["cropX","cropY"];class ve extends de{static getDefaults(){return v(v({},super.getDefaults()),ve.ownDefaults)}constructor(e,t){super(),m(this,"_lastScaleX",1),m(this,"_lastScaleY",1),m(this,"_filterScalingX",1),m(this,"_filterScalingY",1),this.filters=[],Object.assign(this,ve.ownDefaults),this.setOptions(t),this.cacheKey="texture".concat(St()),this.setElement(typeof e=="string"?(this.canvas&&Ve(this.canvas.getElement())||os()).getElementById(e):e,t)}getElement(){return this._element}setElement(e){var t;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._element=e,this._originalElement=e,this._setWidthHeight(s),(t=e.classList)===null||t===void 0||t.add(ve.CSS_CANVAS),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters()}removeTexture(e){const t=Fi(!1);t instanceof Bo&&t.evictCachesForKey(e)}dispose(){super.dispose(),this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._cacheContext=null,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((e=>{const t=this[e];t&&tt().dispose(t),this[e]=void 0}))}getCrossOrigin(){return this._originalElement&&(this._originalElement.crossOrigin||null)}getOriginalSize(){const e=this.getElement();return e?{width:e.naturalWidth||e.width,height:e.naturalHeight||e.height}:{width:0,height:0}}_stroke(e){if(!this.stroke||this.strokeWidth===0)return;const t=this.width/2,s=this.height/2;e.beginPath(),e.moveTo(-t,-s),e.lineTo(t,-s),e.lineTo(t,s),e.lineTo(-t,s),e.lineTo(-t,-s),e.closePath()}toObject(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=[];return this.filters.forEach((s=>{s&&t.push(s.toObject())})),v(v({},super.toObject([...No,...e])),{},{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:t},this.resizeFilter?{resizeFilter:this.resizeFilter.toObject()}:{})}hasCrop(){return!!this.cropX||!!this.cropY||this.width<this._element.width||this.height<this._element.height}_toSVG(){const e=[],t=this._element,s=-this.width/2,r=-this.height/2;let i=[],a=[],o="",l="";if(!t)return[];if(this.hasCrop()){const c=St();i.push('<clipPath id="imageCrop_'+c+`">
`,'	<rect x="'+s+'" y="'+r+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),o=' clip-path="url(#imageCrop_'+c+')" '}if(this.imageSmoothing||(l=' image-rendering="optimizeSpeed"'),e.push("	<image ","COMMON_PARTS",'xlink:href="'.concat(this.getSvgSrc(!0),'" x="').concat(s-this.cropX,'" y="').concat(r-this.cropY,'" width="').concat(t.width||t.naturalWidth,'" height="').concat(t.height||t.naturalHeight,'"').concat(l).concat(o,`></image>
`)),this.stroke||this.strokeDashArray){const c=this.fill;this.fill=null,a=['	<rect x="'.concat(s,'" y="').concat(r,'" width="').concat(this.width,'" height="').concat(this.height,'" style="').concat(this.getSvgStyles(),`" />
`)],this.fill=c}return i=this.paintFirst!==le?i.concat(a,e):i.concat(e,a),i}getSrc(e){const t=e?this._element:this._originalElement;return t?t.toDataURL?t.toDataURL():this.srcFromAttribute?t.getAttribute("src")||"":t.src:this.src||""}getSvgSrc(e){return this.getSrc(e)}setSrc(e){let{crossOrigin:t,signal:s}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Pr(e,{crossOrigin:t,signal:s}).then((r=>{t!==void 0&&this.set({crossOrigin:t}),this.setElement(r)}))}toString(){return'#<Image: { src: "'.concat(this.getSrc(),'" }>')}applyResizeFilters(){const e=this.resizeFilter,t=this.minimumScaleTrigger,s=this.getTotalObjectScaling(),r=s.x,i=s.y,a=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!e||r>t&&i>t)return this._element=a,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=r,void(this._lastScaleY=i);const o=Pe(a),{width:l,height:c}=a;this._element=o,this._lastScaleX=e.scaleX=r,this._lastScaleY=e.scaleY=i,Fi().applyFilters([e],a,l,c,this._element),this._filterScalingX=o.width/this._originalElement.width,this._filterScalingY=o.height/this._originalElement.height}applyFilters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.filters||[];if(e=e.filter((i=>i&&!i.isNeutralState())),this.set("dirty",!0),this.removeTexture("".concat(this.cacheKey,"_filtered")),e.length===0)return this._element=this._originalElement,this._filteredEl=void 0,this._filterScalingX=1,void(this._filterScalingY=1);const t=this._originalElement,s=t.naturalWidth||t.width,r=t.naturalHeight||t.height;if(this._element===this._originalElement){const i=Pe({width:s,height:r});this._element=i,this._filteredEl=i}else this._filteredEl&&(this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,s,r),this._lastScaleX=1,this._lastScaleY=1);Fi().applyFilters(e,this._originalElement,s,r,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height)}_render(e){e.imageSmoothingEnabled=this.imageSmoothing,this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(e),this._renderPaintInOrder(e)}drawCacheOnCanvas(e){e.imageSmoothingEnabled=this.imageSmoothing,super.drawCacheOnCanvas(e)}shouldCache(){return this.needsItsOwnCache()}_renderFill(e){const t=this._element;if(!t)return;const s=this._filterScalingX,r=this._filterScalingY,i=this.width,a=this.height,o=Math.max(this.cropX,0),l=Math.max(this.cropY,0),c=t.naturalWidth||t.width,h=t.naturalHeight||t.height,d=o*s,u=l*r,g=Math.min(i*s,c-d),f=Math.min(a*r,h-u),p=-i/2,y=-a/2,x=Math.min(i,c/s-o),b=Math.min(a,h/r-l);t&&e.drawImage(t,d,u,g,f,p,y,x,b)}_needsResize(){const e=this.getTotalObjectScaling();return e.x!==this._lastScaleX||e.y!==this._lastScaleY}_resetWidthHeight(){this.set(this.getOriginalSize())}_setWidthHeight(){let{width:e,height:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const s=this.getOriginalSize();this.width=e||s.width,this.height=t||s.height}parsePreserveAspectRatioAttribute(){const e=uc(this.preserveAspectRatio||""),t=this.width,s=this.height,r={width:t,height:s};let i,a=this._element.width,o=this._element.height,l=1,c=1,h=0,d=0,u=0,g=0;return!e||e.alignX===Te&&e.alignY===Te?(l=t/a,c=s/o):(e.meetOrSlice==="meet"&&(l=c=kh(this._element,r),i=(t-a*l)/2,e.alignX==="Min"&&(h=-i),e.alignX==="Max"&&(h=i),i=(s-o*c)/2,e.alignY==="Min"&&(d=-i),e.alignY==="Max"&&(d=i)),e.meetOrSlice==="slice"&&(l=c=Dh(this._element,r),i=a-t/l,e.alignX==="Mid"&&(u=i/2),e.alignX==="Max"&&(u=i),i=o-s/c,e.alignY==="Mid"&&(g=i/2),e.alignY==="Max"&&(g=i),a=t/l,o=s/c)),{width:a,height:o,scaleX:l,scaleY:c,offsetLeft:h,offsetTop:d,cropX:u,cropY:g}}static fromObject(e,t){let{filters:s,resizeFilter:r,src:i,crossOrigin:a,type:o}=e,l=Q(e,xu);return Promise.all([Pr(i,v(v({},t),{},{crossOrigin:a})),s&&Fs(s,t),r&&Fs([r],t),oi(l,t)]).then((c=>{let[h,d=[],[u]=[],g={}]=c;return new this(h,v(v({},l),{},{src:i,filters:d,resizeFilter:u},g))}))}static fromURL(e){let{crossOrigin:t=null,signal:s}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;return Pr(e,{crossOrigin:t,signal:s}).then((i=>new this(i,r)))}static async fromElement(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;const r=_t(e,this.ATTRIBUTE_NAMES,s);return this.fromURL(r["xlink:href"]||r.href,t,r).catch((i=>(Ct("log","Unable to parse Image",i),null)))}}m(ve,"type","Image"),m(ve,"cacheProperties",[...yt,...No]),m(ve,"ownDefaults",{strokeWidth:0,srcFromAttribute:!1,minimumScaleTrigger:.5,cropX:0,cropY:0,imageSmoothing:!0}),m(ve,"CSS_CANVAS","canvas-img"),m(ve,"ATTRIBUTE_NAMES",[...kt,"x","y","width","height","preserveAspectRatio","xlink:href","href","crossOrigin","image-rendering"]),A.setClass(ve),A.setSVGClass(ve);ci(["pattern","defs","symbol","metadata","clipPath","mask","desc"]);const gi=n=>n.webgl!==void 0,Dn="precision highp float",bu=`
    `.concat(Dn,`;
    varying vec2 vTexCoord;
    uniform sampler2D uTexture;
    void main() {
      gl_FragColor = texture2D(uTexture, vTexCoord);
    }`),wu=["type"],Cu=["type"],Su=new RegExp(Dn,"g");class ce{get type(){return this.constructor.type}constructor(){let e=Q(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},wu);Object.assign(this,this.constructor.defaults,e)}getFragmentSource(){return bu}getVertexSource(){return`
    attribute vec2 aPosition;
    varying vec2 vTexCoord;
    void main() {
      vTexCoord = aPosition;
      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
    }`}createProgram(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getFragmentSource(),s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.getVertexSource();const{WebGLProbe:{GLPrecision:r="highp"}}=tt();r!=="highp"&&(t=t.replace(Su,Dn.replace("highp",r)));const i=e.createShader(e.VERTEX_SHADER),a=e.createShader(e.FRAGMENT_SHADER),o=e.createProgram();if(!i||!a||!o)throw new Je("Vertex, fragment shader or program creation error");if(e.shaderSource(i,s),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw new Je("Vertex shader compile error for ".concat(this.type,": ").concat(e.getShaderInfoLog(i)));if(e.shaderSource(a,t),e.compileShader(a),!e.getShaderParameter(a,e.COMPILE_STATUS))throw new Je("Fragment shader compile error for ".concat(this.type,": ").concat(e.getShaderInfoLog(a)));if(e.attachShader(o,i),e.attachShader(o,a),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw new Je('Shader link error for "'.concat(this.type,'" ').concat(e.getProgramInfoLog(o)));const l=this.getUniformLocations(e,o)||{};return l.uStepW=e.getUniformLocation(o,"uStepW"),l.uStepH=e.getUniformLocation(o,"uStepH"),{program:o,attributeLocations:this.getAttributeLocations(e,o),uniformLocations:l}}getAttributeLocations(e,t){return{aPosition:e.getAttribLocation(t,"aPosition")}}getUniformLocations(e,t){const s=this.constructor.uniformLocations,r={};for(let i=0;i<s.length;i++)r[s[i]]=e.getUniformLocation(t,s[i]);return r}sendAttributeData(e,t,s){const r=t.aPosition,i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.enableVertexAttribArray(r),e.vertexAttribPointer(r,2,e.FLOAT,!1,0,0),e.bufferData(e.ARRAY_BUFFER,s,e.STATIC_DRAW)}_setupFrameBuffer(e){const t=e.context;if(e.passes>1){const s=e.destinationWidth,r=e.destinationHeight;e.sourceWidth===s&&e.sourceHeight===r||(t.deleteTexture(e.targetTexture),e.targetTexture=e.filterBackend.createTexture(t,s,r)),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e.targetTexture,0)}else t.bindFramebuffer(t.FRAMEBUFFER,null),t.finish()}_swapTextures(e){e.passes--,e.pass++;const t=e.targetTexture;e.targetTexture=e.sourceTexture,e.sourceTexture=t}isNeutralState(e){return!1}applyTo(e){gi(e)?(this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)}applyTo2d(e){}getCacheKey(){return this.type}retrieveShader(e){const t=this.getCacheKey();return e.programCache[t]||(e.programCache[t]=this.createProgram(e.context)),e.programCache[t]}applyToWebGL(e){const t=e.context,s=this.retrieveShader(e);e.pass===0&&e.originalTexture?t.bindTexture(t.TEXTURE_2D,e.originalTexture):t.bindTexture(t.TEXTURE_2D,e.sourceTexture),t.useProgram(s.program),this.sendAttributeData(t,s.attributeLocations,e.aPosition),t.uniform1f(s.uniformLocations.uStepW,1/e.sourceWidth),t.uniform1f(s.uniformLocations.uStepH,1/e.sourceHeight),this.sendUniformData(t,s.uniformLocations),t.viewport(0,0,e.destinationWidth,e.destinationHeight),t.drawArrays(t.TRIANGLE_STRIP,0,4)}bindAdditionalTexture(e,t,s){e.activeTexture(s),e.bindTexture(e.TEXTURE_2D,t),e.activeTexture(e.TEXTURE0)}unbindAdditionalTexture(e,t){e.activeTexture(t),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE0)}sendUniformData(e,t){}createHelpLayer(e){if(!e.helpLayer){const{sourceWidth:t,sourceHeight:s}=e,r=Pe({width:t,height:s});e.helpLayer=r}}toObject(){const e=Object.keys(this.constructor.defaults||{});return v({type:this.type},e.reduce(((t,s)=>(t[s]=this[s],t)),{}))}toJSON(){return this.toObject()}static async fromObject(e,t){return new this(Q(e,Cu))}}m(ce,"type","BaseFilter"),m(ce,"uniformLocations",[]);const Tu={multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,difference:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`
    if (uColor.r < 0.5) {
      gl_FragColor.r *= 2.0 * uColor.r;
    } else {
      gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
    }
    if (uColor.g < 0.5) {
      gl_FragColor.g *= 2.0 * uColor.g;
    } else {
      gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
    }
    if (uColor.b < 0.5) {
      gl_FragColor.b *= 2.0 * uColor.b;
    } else {
      gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
    }
    `,tint:`
    gl_FragColor.rgb *= (1.0 - uColor.a);
    gl_FragColor.rgb += uColor.rgb;
    `};class pr extends ce{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return`
      precision highp float;
      uniform sampler2D uTexture;
      uniform vec4 uColor;
      varying vec2 vTexCoord;
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        gl_FragColor = color;
        if (color.a > 0.0) {
          `.concat(Tu[this.mode],`
        }
      }
      `)}applyTo2d(e){let{imageData:{data:t}}=e;const s=new $(this.color).getSource(),r=this.alpha,i=s[0]*r,a=s[1]*r,o=s[2]*r,l=1-r;for(let c=0;c<t.length;c+=4){const h=t[c],d=t[c+1],u=t[c+2];let g,f,p;switch(this.mode){case"multiply":g=h*i/255,f=d*a/255,p=u*o/255;break;case"screen":g=255-(255-h)*(255-i)/255,f=255-(255-d)*(255-a)/255,p=255-(255-u)*(255-o)/255;break;case"add":g=h+i,f=d+a,p=u+o;break;case"difference":g=Math.abs(h-i),f=Math.abs(d-a),p=Math.abs(u-o);break;case"subtract":g=h-i,f=d-a,p=u-o;break;case"darken":g=Math.min(h,i),f=Math.min(d,a),p=Math.min(u,o);break;case"lighten":g=Math.max(h,i),f=Math.max(d,a),p=Math.max(u,o);break;case"overlay":g=i<128?2*h*i/255:255-2*(255-h)*(255-i)/255,f=a<128?2*d*a/255:255-2*(255-d)*(255-a)/255,p=o<128?2*u*o/255:255-2*(255-u)*(255-o)/255;break;case"exclusion":g=i+h-2*i*h/255,f=a+d-2*a*d/255,p=o+u-2*o*u/255;break;case"tint":g=i+h*l,f=a+d*l,p=o+u*l}t[c]=g,t[c+1]=f,t[c+2]=p}}sendUniformData(e,t){const s=new $(this.color).getSource();s[0]=this.alpha*s[0]/255,s[1]=this.alpha*s[1]/255,s[2]=this.alpha*s[2]/255,s[3]=this.alpha,e.uniform4fv(t.uColor,s)}}m(pr,"defaults",{color:"#F95C63",mode:"multiply",alpha:1}),m(pr,"type","BlendColor"),m(pr,"uniformLocations",["uColor"]),A.setClass(pr);const Ou={multiply:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform sampler2D uImage;
    uniform vec4 uColor;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      vec4 color2 = texture2D(uImage, vTexCoord2);
      color.rgba *= color2.rgba;
      gl_FragColor = color;
    }
    `,mask:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform sampler2D uImage;
    uniform vec4 uColor;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      vec4 color2 = texture2D(uImage, vTexCoord2);
      color.a = color2.a;
      gl_FragColor = color;
    }
    `},ku=["type","image"];class mr extends ce{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return Ou[this.mode]}getVertexSource(){return`
    attribute vec2 aPosition;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    uniform mat3 uTransformMatrix;
    void main() {
      vTexCoord = aPosition;
      vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
    }
    `}applyToWebGL(e){const t=e.context,s=this.createTexture(e.filterBackend,this.image);this.bindAdditionalTexture(t,s,t.TEXTURE1),super.applyToWebGL(e),this.unbindAdditionalTexture(t,t.TEXTURE1)}createTexture(e,t){return e.getCachedTexture(t.cacheKey,t.getElement())}calculateMatrix(){const e=this.image,{width:t,height:s}=e.getElement();return[1/e.scaleX,0,0,0,1/e.scaleY,0,-e.left/t,-e.top/s,1]}applyTo2d(e){let{imageData:{data:t,width:s,height:r},filterBackend:{resources:i}}=e;const a=this.image;i.blendImage||(i.blendImage=pt());const o=i.blendImage,l=o.getContext("2d");o.width!==s||o.height!==r?(o.width=s,o.height=r):l.clearRect(0,0,s,r),l.setTransform(a.scaleX,0,0,a.scaleY,a.left,a.top),l.drawImage(a.getElement(),0,0,s,r);const c=l.getImageData(0,0,s,r).data;for(let h=0;h<t.length;h+=4){const d=t[h],u=t[h+1],g=t[h+2],f=t[h+3],p=c[h],y=c[h+1],x=c[h+2],b=c[h+3];switch(this.mode){case"multiply":t[h]=d*p/255,t[h+1]=u*y/255,t[h+2]=g*x/255,t[h+3]=f*b/255;break;case"mask":t[h+3]=b}}}sendUniformData(e,t){const s=this.calculateMatrix();e.uniform1i(t.uImage,1),e.uniformMatrix3fv(t.uTransformMatrix,!1,s)}toObject(){return v(v({},super.toObject()),{},{image:this.image&&this.image.toObject()})}static async fromObject(e,t){let{type:s,image:r}=e,i=Q(e,ku);return ve.fromObject(r,t).then((a=>new this(v(v({},i),{},{image:a}))))}}m(mr,"type","BlendImage"),m(mr,"defaults",{mode:"multiply",alpha:1}),m(mr,"uniformLocations",["uTransformMatrix","uImage"]),A.setClass(mr);class vr extends ce{getFragmentSource(){return`
    precision highp float;
    uniform sampler2D uTexture;
    uniform vec2 uDelta;
    varying vec2 vTexCoord;
    const float nSamples = 15.0;
    vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
    float random(vec3 scale) {
      /* use the fragment position for a different seed per-pixel */
      return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
    }
    void main() {
      vec4 color = vec4(0.0);
      float totalC = 0.0;
      float totalA = 0.0;
      float offset = random(v3offset);
      for (float t = -nSamples; t <= nSamples; t++) {
        float percent = (t + offset - 0.5) / nSamples;
        vec4 sample = texture2D(uTexture, vTexCoord + uDelta * percent);
        float weight = 1.0 - abs(percent);
        float alpha = weight * sample.a;
        color.rgb += sample.rgb * alpha;
        color.a += alpha;
        totalA += weight;
        totalC += alpha;
      }
      gl_FragColor.rgb = color.rgb / totalC;
      gl_FragColor.a = color.a / totalA;
    }
  `}applyTo(e){gi(e)?(this.aspectRatio=e.sourceWidth/e.sourceHeight,e.passes++,this._setupFrameBuffer(e),this.horizontal=!0,this.applyToWebGL(e),this._swapTextures(e),this._setupFrameBuffer(e),this.horizontal=!1,this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)}applyTo2d(e){let{imageData:{data:t,width:s,height:r}}=e;this.aspectRatio=s/r,this.horizontal=!0;let i=this.getBlurValue()*s;const a=new Uint8ClampedArray(t),o=15,l=4*s;for(let c=0;c<t.length;c+=4){let h=0,d=0,u=0,g=0,f=0;const p=c-c%l,y=p+l;for(let x=-14;x<o;x++){const b=x/o,O=4*Math.floor(i*b),C=1-Math.abs(b);let k=c+O;k<p?k=p:k>y&&(k=y);const F=t[k+3]*C;h+=t[k]*F,d+=t[k+1]*F,u+=t[k+2]*F,g+=F,f+=C}a[c]=h/g,a[c+1]=d/g,a[c+2]=u/g,a[c+3]=g/f}this.horizontal=!1,i=this.getBlurValue()*r;for(let c=0;c<a.length;c+=4){let h=0,d=0,u=0,g=0,f=0;const p=c%l,y=a.length-l+p;for(let x=-14;x<o;x++){const b=x/o,O=Math.floor(i*b)*l,C=1-Math.abs(b);let k=c+O;k<p?k=p:k>y&&(k=y);const F=a[k+3]*C;h+=a[k]*F,d+=a[k+1]*F,u+=a[k+2]*F,g+=F,f+=C}t[c]=h/g,t[c+1]=d/g,t[c+2]=u/g,t[c+3]=g/f}}sendUniformData(e,t){const s=this.chooseRightDelta();e.uniform2fv(t.uDelta,s)}isNeutralState(){return this.blur===0}getBlurValue(){let e=1;const{horizontal:t,aspectRatio:s}=this;return t?s>1&&(e=1/s):s<1&&(e=s),e*this.blur*.12}chooseRightDelta(){const e=this.getBlurValue();return this.horizontal?[e,0]:[0,e]}}m(vr,"type","Blur"),m(vr,"defaults",{blur:0}),m(vr,"uniformLocations",["uDelta"]),A.setClass(vr);class yr extends ce{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uBrightness;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color.rgb += uBrightness;
    gl_FragColor = color;
  }
`}applyTo2d(e){let{imageData:{data:t}}=e;const s=Math.round(255*this.brightness);for(let r=0;r<t.length;r+=4)t[r]+=s,t[r+1]+=s,t[r+2]+=s}isNeutralState(){return this.brightness===0}sendUniformData(e,t){e.uniform1f(t.uBrightness,this.brightness)}}m(yr,"type","Brightness"),m(yr,"defaults",{brightness:0}),m(yr,"uniformLocations",["uBrightness"]),A.setClass(yr);const Vo={matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],colorsOnly:!0};class Kt extends ce{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  varying vec2 vTexCoord;
  uniform mat4 uColorMatrix;
  uniform vec4 uConstants;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color *= uColorMatrix;
    color += uConstants;
    gl_FragColor = color;
  }`}applyTo2d(e){const t=e.imageData.data,s=this.matrix,r=this.colorsOnly;for(let i=0;i<t.length;i+=4){const a=t[i],o=t[i+1],l=t[i+2];if(t[i]=a*s[0]+o*s[1]+l*s[2]+255*s[4],t[i+1]=a*s[5]+o*s[6]+l*s[7]+255*s[9],t[i+2]=a*s[10]+o*s[11]+l*s[12]+255*s[14],!r){const c=t[i+3];t[i]+=c*s[3],t[i+1]+=c*s[8],t[i+2]+=c*s[13],t[i+3]=a*s[15]+o*s[16]+l*s[17]+c*s[18]+255*s[19]}}}sendUniformData(e,t){const s=this.matrix,r=[s[0],s[1],s[2],s[3],s[5],s[6],s[7],s[8],s[10],s[11],s[12],s[13],s[15],s[16],s[17],s[18]],i=[s[4],s[9],s[14],s[19]];e.uniformMatrix4fv(t.uColorMatrix,!1,r),e.uniform4fv(t.uConstants,i)}toObject(){return v(v({},super.toObject()),{},{matrix:[...this.matrix]})}}function Wt(n,e){var t;const s=(m(t=class extends Kt{toObject(){return{type:this.type,colorsOnly:this.colorsOnly}}},"type",n),m(t,"defaults",{colorsOnly:!1,matrix:e}),t);return A.setClass(s,n),s}m(Kt,"type","ColorMatrix"),m(Kt,"defaults",Vo),m(Kt,"uniformLocations",["uColorMatrix","uConstants"]),A.setClass(Kt);Wt("Brownie",[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0]);Wt("Vintage",[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0]);Wt("Kodachrome",[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0]);Wt("Technicolor",[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0]);Wt("Polaroid",[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]);Wt("Sepia",[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0]);Wt("BlackWhite",[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]);class ka extends ce{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(e),this.subFilters=e.subFilters||[]}applyTo(e){gi(e)&&(e.passes+=this.subFilters.length-1),this.subFilters.forEach((t=>{t.applyTo(e)}))}toObject(){return{type:this.type,subFilters:this.subFilters.map((e=>e.toObject()))}}isNeutralState(){return!this.subFilters.some((e=>!e.isNeutralState()))}static fromObject(e,t){return Promise.all((e.subFilters||[]).map((s=>A.getClass(s.type).fromObject(s,t)))).then((s=>new this({subFilters:s})))}}m(ka,"type","Composed"),A.setClass(ka);class _r extends ce{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uContrast;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
    color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
    gl_FragColor = color;
  }`}isNeutralState(){return this.contrast===0}applyTo2d(e){let{imageData:{data:t}}=e;const s=Math.floor(255*this.contrast),r=259*(s+255)/(255*(259-s));for(let i=0;i<t.length;i+=4)t[i]=r*(t[i]-128)+128,t[i+1]=r*(t[i+1]-128)+128,t[i+2]=r*(t[i+2]-128)+128}sendUniformData(e,t){e.uniform1f(t.uContrast,this.contrast)}}m(_r,"type","Contrast"),m(_r,"defaults",{contrast:0}),m(_r,"uniformLocations",["uContrast"]),A.setClass(_r);const Du={Convolute_3_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[9];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 3.0; h+=1.0) {
        for (float w = 0.0; w < 3.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_3_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[9];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 3.0; h+=1.0) {
        for (float w = 0.0; w < 3.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_5_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[25];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 5.0; h+=1.0) {
        for (float w = 0.0; w < 5.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_5_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[25];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 5.0; h+=1.0) {
        for (float w = 0.0; w < 5.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_7_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[49];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 7.0; h+=1.0) {
        for (float w = 0.0; w < 7.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_7_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[49];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 7.0; h+=1.0) {
        for (float w = 0.0; w < 7.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_9_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[81];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 9.0; h+=1.0) {
        for (float w = 0.0; w < 9.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_9_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[81];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 9.0; h+=1.0) {
        for (float w = 0.0; w < 9.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `};class xr extends ce{getCacheKey(){return"".concat(this.type,"_").concat(Math.sqrt(this.matrix.length),"_").concat(this.opaque?1:0)}getFragmentSource(){return Du[this.getCacheKey()]}applyTo2d(e){const t=e.imageData,s=t.data,r=this.matrix,i=Math.round(Math.sqrt(r.length)),a=Math.floor(i/2),o=t.width,l=t.height,c=e.ctx.createImageData(o,l),h=c.data,d=this.opaque?1:0;let u,g,f,p,y,x,b,O,C,k,F,D,R;for(F=0;F<l;F++)for(k=0;k<o;k++){for(y=4*(F*o+k),u=0,g=0,f=0,p=0,R=0;R<i;R++)for(D=0;D<i;D++)b=F+R-a,x=k+D-a,b<0||b>=l||x<0||x>=o||(O=4*(b*o+x),C=r[R*i+D],u+=s[O]*C,g+=s[O+1]*C,f+=s[O+2]*C,d||(p+=s[O+3]*C));h[y]=u,h[y+1]=g,h[y+2]=f,h[y+3]=d?s[y+3]:p}e.imageData=c}sendUniformData(e,t){e.uniform1fv(t.uMatrix,this.matrix)}toObject(){return v(v({},super.toObject()),{},{opaque:this.opaque,matrix:[...this.matrix]})}}m(xr,"type","Convolute"),m(xr,"defaults",{opaque:!1,matrix:[0,0,0,0,1,0,0,0,0]}),m(xr,"uniformLocations",["uMatrix","uOpaque","uHalfSize","uSize"]),A.setClass(xr);const zo="Gamma";class br extends ce{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform vec3 uGamma;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    vec3 correction = (1.0 / uGamma);
    color.r = pow(color.r, correction.r);
    color.g = pow(color.g, correction.g);
    color.b = pow(color.b, correction.b);
    gl_FragColor = color;
    gl_FragColor.rgb *= color.a;
  }
`}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(e),this.gamma=e.gamma||this.constructor.defaults.gamma.concat()}applyTo2d(e){let{imageData:{data:t}}=e;const s=this.gamma,r=1/s[0],i=1/s[1],a=1/s[2];this.rgbValues||(this.rgbValues={r:new Uint8Array(256),g:new Uint8Array(256),b:new Uint8Array(256)});const o=this.rgbValues;for(let l=0;l<256;l++)o.r[l]=255*Math.pow(l/255,r),o.g[l]=255*Math.pow(l/255,i),o.b[l]=255*Math.pow(l/255,a);for(let l=0;l<t.length;l+=4)t[l]=o.r[t[l]],t[l+1]=o.g[t[l+1]],t[l+2]=o.b[t[l+2]]}sendUniformData(e,t){e.uniform3fv(t.uGamma,this.gamma)}isNeutralState(){const{gamma:e}=this;return e[0]===1&&e[1]===1&&e[2]===1}toObject(){return{type:zo,gamma:this.gamma.concat()}}}m(br,"type",zo),m(br,"defaults",{gamma:[1,1,1]}),m(br,"uniformLocations",["uGamma"]),A.setClass(br);const ju={average:`
    precision highp float;
    uniform sampler2D uTexture;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      float average = (color.r + color.b + color.g) / 3.0;
      gl_FragColor = vec4(average, average, average, color.a);
    }
    `,lightness:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform int uMode;
    varying vec2 vTexCoord;
    void main() {
      vec4 col = texture2D(uTexture, vTexCoord);
      float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
      gl_FragColor = vec4(average, average, average, col.a);
    }
    `,luminosity:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform int uMode;
    varying vec2 vTexCoord;
    void main() {
      vec4 col = texture2D(uTexture, vTexCoord);
      float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
      gl_FragColor = vec4(average, average, average, col.a);
    }
    `};class wr extends ce{applyTo2d(e){let{imageData:{data:t}}=e;for(let s,r=0;r<t.length;r+=4){const i=t[r],a=t[r+1],o=t[r+2];switch(this.mode){case"average":s=(i+a+o)/3;break;case"lightness":s=(Math.min(i,a,o)+Math.max(i,a,o))/2;break;case"luminosity":s=.21*i+.72*a+.07*o}t[r+2]=t[r+1]=t[r]=s}}getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return ju[this.mode]}sendUniformData(e,t){e.uniform1i(t.uMode,1)}isNeutralState(){return!1}}m(wr,"type","Grayscale"),m(wr,"defaults",{mode:"average"}),m(wr,"uniformLocations",["uMode"]),A.setClass(wr);const Mu=v(v({},Vo),{},{rotation:0});class Ri extends Kt{calculateMatrix(){const e=this.rotation*Math.PI,t=gt(e),s=ft(e),r=1/3,i=Math.sqrt(r)*s,a=1-t;this.matrix=[t+a/3,r*a-i,r*a+i,0,0,r*a+i,t+r*a,r*a-i,0,0,r*a-i,r*a+i,t+r*a,0,0,0,0,0,1,0]}isNeutralState(){return this.rotation===0}applyTo(e){this.calculateMatrix(),super.applyTo(e)}toObject(){return{type:this.type,rotation:this.rotation}}}m(Ri,"type","HueRotation"),m(Ri,"defaults",Mu),A.setClass(Ri);class Cr extends ce{applyTo2d(e){let{imageData:{data:t}}=e;for(let s=0;s<t.length;s+=4)t[s]=255-t[s],t[s+1]=255-t[s+1],t[s+2]=255-t[s+2],this.alpha&&(t[s+3]=255-t[s+3])}getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform int uInvert;
  uniform int uAlpha;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    if (uInvert == 1) {
      if (uAlpha == 1) {
        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,1.0 -color.a);
      } else {
        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
      }
    } else {
      gl_FragColor = color;
    }
  }
`}isNeutralState(){return!this.invert}sendUniformData(e,t){e.uniform1i(t.uInvert,Number(this.invert)),e.uniform1i(t.uAlpha,Number(this.alpha))}}m(Cr,"type","Invert"),m(Cr,"defaults",{alpha:!1,invert:!0}),m(Cr,"uniformLocations",["uInvert","uAlpha"]),A.setClass(Cr);class Sr extends ce{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uStepH;
  uniform float uNoise;
  uniform float uSeed;
  varying vec2 vTexCoord;
  float rand(vec2 co, float seed, float vScale) {
    return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
  }
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
    gl_FragColor = color;
  }
`}applyTo2d(e){let{imageData:{data:t}}=e;const s=this.noise;for(let r=0;r<t.length;r+=4){const i=(.5-Math.random())*s;t[r]+=i,t[r+1]+=i,t[r+2]+=i}}sendUniformData(e,t){e.uniform1f(t.uNoise,this.noise/255),e.uniform1f(t.uSeed,Math.random())}isNeutralState(){return this.noise===0}}m(Sr,"type","Noise"),m(Sr,"defaults",{noise:0}),m(Sr,"uniformLocations",["uNoise","uSeed"]),A.setClass(Sr);class Tr extends ce{applyTo2d(e){let{imageData:{data:t,width:s,height:r}}=e;for(let i=0;i<r;i+=this.blocksize)for(let a=0;a<s;a+=this.blocksize){const o=4*i*s+4*a,l=t[o],c=t[o+1],h=t[o+2],d=t[o+3];for(let u=i;u<Math.min(i+this.blocksize,r);u++)for(let g=a;g<Math.min(a+this.blocksize,s);g++){const f=4*u*s+4*g;t[f]=l,t[f+1]=c,t[f+2]=h,t[f+3]=d}}}isNeutralState(){return this.blocksize===1}getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uBlocksize;
  uniform float uStepW;
  uniform float uStepH;
  varying vec2 vTexCoord;
  void main() {
    float blockW = uBlocksize * uStepW;
    float blockH = uBlocksize * uStepH;
    int posX = int(vTexCoord.x / blockW);
    int posY = int(vTexCoord.y / blockH);
    float fposX = float(posX);
    float fposY = float(posY);
    vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
    vec4 color = texture2D(uTexture, squareCoords);
    gl_FragColor = color;
  }
`}sendUniformData(e,t){e.uniform1f(t.uBlocksize,this.blocksize)}}m(Tr,"type","Pixelate"),m(Tr,"defaults",{blocksize:4}),m(Tr,"uniformLocations",["uBlocksize"]),A.setClass(Tr);class Or extends ce{getFragmentSource(){return`
precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
  gl_FragColor = texture2D(uTexture, vTexCoord);
  if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
    gl_FragColor.a = 0.0;
  }
}
`}applyTo2d(e){let{imageData:{data:t}}=e;const s=255*this.distance,r=new $(this.color).getSource(),i=[r[0]-s,r[1]-s,r[2]-s],a=[r[0]+s,r[1]+s,r[2]+s];for(let o=0;o<t.length;o+=4){const l=t[o],c=t[o+1],h=t[o+2];l>i[0]&&c>i[1]&&h>i[2]&&l<a[0]&&c<a[1]&&h<a[2]&&(t[o+3]=0)}}sendUniformData(e,t){const s=new $(this.color).getSource(),r=this.distance,i=[0+s[0]/255-r,0+s[1]/255-r,0+s[2]/255-r,1],a=[s[0]/255+r,s[1]/255+r,s[2]/255+r,1];e.uniform4fv(t.uLow,i),e.uniform4fv(t.uHigh,a)}}m(Or,"type","RemoveColor"),m(Or,"defaults",{color:"#FFFFFF",distance:.02,useAlpha:!1}),m(Or,"uniformLocations",["uLow","uHigh"]),A.setClass(Or);class kr extends ce{sendUniformData(e,t){e.uniform2fv(t.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),e.uniform1fv(t.uTaps,this.taps)}getFilterWindow(){const e=this.tempScale;return Math.ceil(this.lanczosLobes/e)}getCacheKey(){const e=this.getFilterWindow();return"".concat(this.type,"_").concat(e)}getFragmentSource(){const e=this.getFilterWindow();return this.generateShader(e)}getTaps(){const e=this.lanczosCreate(this.lanczosLobes),t=this.tempScale,s=this.getFilterWindow(),r=new Array(s);for(let i=1;i<=s;i++)r[i-1]=e(i*t);return r}generateShader(e){const t=new Array(e);for(let s=1;s<=e;s++)t[s-1]="".concat(s,".0 * uDelta");return`
      precision highp float;
      uniform sampler2D uTexture;
      uniform vec2 uDelta;
      varying vec2 vTexCoord;
      uniform float uTaps[`.concat(e,`];
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        float sum = 1.0;
        `).concat(t.map(((s,r)=>`
              color += texture2D(uTexture, vTexCoord + `.concat(s,") * uTaps[").concat(r,"] + texture2D(uTexture, vTexCoord - ").concat(s,") * uTaps[").concat(r,`];
              sum += 2.0 * uTaps[`).concat(r,`];
            `))).join(`
`),`
        gl_FragColor = color / sum;
      }
    `)}applyToForWebgl(e){e.passes++,this.width=e.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=e.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),e.destinationWidth=this.dW,super.applyTo(e),e.sourceWidth=e.destinationWidth,this.height=e.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),e.destinationHeight=this.dH,super.applyTo(e),e.sourceHeight=e.destinationHeight}applyTo(e){gi(e)?this.applyToForWebgl(e):this.applyTo2d(e)}isNeutralState(){return this.scaleX===1&&this.scaleY===1}lanczosCreate(e){return t=>{if(t>=e||t<=-e)return 0;if(t<11920929e-14&&t>-11920929e-14)return 1;const s=(t*=Math.PI)/e;return Math.sin(t)/t*Math.sin(s)/s}}applyTo2d(e){const t=e.imageData,s=this.scaleX,r=this.scaleY;this.rcpScaleX=1/s,this.rcpScaleY=1/r;const i=t.width,a=t.height,o=Math.round(i*s),l=Math.round(a*r);let c;c=this.resizeType==="sliceHack"?this.sliceByTwo(e,i,a,o,l):this.resizeType==="hermite"?this.hermiteFastResize(e,i,a,o,l):this.resizeType==="bilinear"?this.bilinearFiltering(e,i,a,o,l):this.resizeType==="lanczos"?this.lanczosResize(e,i,a,o,l):new ImageData(o,l),e.imageData=c}sliceByTwo(e,t,s,r,i){const a=e.imageData,o=.5;let l=!1,c=!1,h=t*o,d=s*o;const u=e.filterBackend.resources;let g=0,f=0;const p=t;let y=0;u.sliceByTwo||(u.sliceByTwo=pt());const x=u.sliceByTwo;(x.width<1.5*t||x.height<s)&&(x.width=1.5*t,x.height=s);const b=x.getContext("2d");for(b.clearRect(0,0,1.5*t,s),b.putImageData(a,0,0),r=Math.floor(r),i=Math.floor(i);!l||!c;)t=h,s=d,r<Math.floor(h*o)?h=Math.floor(h*o):(h=r,l=!0),i<Math.floor(d*o)?d=Math.floor(d*o):(d=i,c=!0),b.drawImage(x,g,f,t,s,p,y,h,d),g=p,f=y,y+=d;return b.getImageData(g,f,r,i)}lanczosResize(e,t,s,r,i){const a=e.imageData.data,o=e.ctx.createImageData(r,i),l=o.data,c=this.lanczosCreate(this.lanczosLobes),h=this.rcpScaleX,d=this.rcpScaleY,u=2/this.rcpScaleX,g=2/this.rcpScaleY,f=Math.ceil(h*this.lanczosLobes/2),p=Math.ceil(d*this.lanczosLobes/2),y={},x={x:0,y:0},b={x:0,y:0};return(function O(C){let k,F,D,R,W,K,E,G,Z,Y,ae;for(x.x=(C+.5)*h,b.x=Math.floor(x.x),k=0;k<i;k++){for(x.y=(k+.5)*d,b.y=Math.floor(x.y),W=0,K=0,E=0,G=0,Z=0,F=b.x-f;F<=b.x+f;F++)if(!(F<0||F>=t)){Y=Math.floor(1e3*Math.abs(F-x.x)),y[Y]||(y[Y]={});for(let ie=b.y-p;ie<=b.y+p;ie++)ie<0||ie>=s||(ae=Math.floor(1e3*Math.abs(ie-x.y)),y[Y][ae]||(y[Y][ae]=c(Math.sqrt(Math.pow(Y*u,2)+Math.pow(ae*g,2))/1e3)),D=y[Y][ae],D>0&&(R=4*(ie*t+F),W+=D,K+=D*a[R],E+=D*a[R+1],G+=D*a[R+2],Z+=D*a[R+3]))}R=4*(k*r+C),l[R]=K/W,l[R+1]=E/W,l[R+2]=G/W,l[R+3]=Z/W}return++C<r?O(C):o})(0)}bilinearFiltering(e,t,s,r,i){let a,o,l,c,h,d,u,g,f,p,y,x,b,O=0;const C=this.rcpScaleX,k=this.rcpScaleY,F=4*(t-1),D=e.imageData.data,R=e.ctx.createImageData(r,i),W=R.data;for(u=0;u<i;u++)for(g=0;g<r;g++)for(h=Math.floor(C*g),d=Math.floor(k*u),f=C*g-h,p=k*u-d,b=4*(d*t+h),y=0;y<4;y++)a=D[b+y],o=D[b+4+y],l=D[b+F+y],c=D[b+F+4+y],x=a*(1-f)*(1-p)+o*f*(1-p)+l*p*(1-f)+c*f*p,W[O++]=x;return R}hermiteFastResize(e,t,s,r,i){const a=this.rcpScaleX,o=this.rcpScaleY,l=Math.ceil(a/2),c=Math.ceil(o/2),h=e.imageData.data,d=e.ctx.createImageData(r,i),u=d.data;for(let g=0;g<i;g++)for(let f=0;f<r;f++){const p=4*(f+g*r);let y=0,x=0,b=0,O=0,C=0,k=0,F=0;const D=(g+.5)*o;for(let R=Math.floor(g*o);R<(g+1)*o;R++){const W=Math.abs(D-(R+.5))/c,K=(f+.5)*a,E=W*W;for(let G=Math.floor(f*a);G<(f+1)*a;G++){let Z=Math.abs(K-(G+.5))/l;const Y=Math.sqrt(E+Z*Z);Y>1&&Y<-1||(y=2*Y*Y*Y-3*Y*Y+1,y>0&&(Z=4*(G+R*t),F+=y*h[Z+3],b+=y,h[Z+3]<255&&(y=y*h[Z+3]/250),O+=y*h[Z],C+=y*h[Z+1],k+=y*h[Z+2],x+=y))}}u[p]=O/x,u[p+1]=C/x,u[p+2]=k/x,u[p+3]=F/b}return d}}m(kr,"type","Resize"),m(kr,"defaults",{resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3}),m(kr,"uniformLocations",["uDelta","uTaps"]),A.setClass(kr);class Dr extends ce{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uSaturation;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float rgMax = max(color.r, color.g);
    float rgbMax = max(rgMax, color.b);
    color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
    color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
    color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
    gl_FragColor = color;
  }
`}applyTo2d(e){let{imageData:{data:t}}=e;const s=-this.saturation;for(let r=0;r<t.length;r+=4){const i=t[r],a=t[r+1],o=t[r+2],l=Math.max(i,a,o);t[r]+=l!==i?(l-i)*s:0,t[r+1]+=l!==a?(l-a)*s:0,t[r+2]+=l!==o?(l-o)*s:0}}sendUniformData(e,t){e.uniform1f(t.uSaturation,-this.saturation)}isNeutralState(){return this.saturation===0}}m(Dr,"type","Saturation"),m(Dr,"defaults",{saturation:0}),m(Dr,"uniformLocations",["uSaturation"]),A.setClass(Dr);class jr extends ce{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uVibrance;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float max = max(color.r, max(color.g, color.b));
    float avg = (color.r + color.g + color.b) / 3.0;
    float amt = (abs(max - avg) * 2.0) * uVibrance;
    color.r += max != color.r ? (max - color.r) * amt : 0.00;
    color.g += max != color.g ? (max - color.g) * amt : 0.00;
    color.b += max != color.b ? (max - color.b) * amt : 0.00;
    gl_FragColor = color;
  }
`}applyTo2d(e){let{imageData:{data:t}}=e;const s=-this.vibrance;for(let r=0;r<t.length;r+=4){const i=t[r],a=t[r+1],o=t[r+2],l=Math.max(i,a,o),c=(i+a+o)/3,h=2*Math.abs(l-c)/255*s;t[r]+=l!==i?(l-i)*h:0,t[r+1]+=l!==a?(l-a)*h:0,t[r+2]+=l!==o?(l-o)*h:0}}sendUniformData(e,t){e.uniform1f(t.uVibrance,-this.vibrance)}isNeutralState(){return this.vibrance===0}}m(jr,"type","Vibrance"),m(jr,"defaults",{vibrance:0}),m(jr,"uniformLocations",["uVibrance"]),A.setClass(jr);const Au={class:"fixed inset-0 z-50 w-screen overflow-y-auto"},Eu={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},Pu={class:"bg-white dark:bg-neutral-700 px-4 pb-4 pt-5 sm:p-6 sm:pb-4"},Fu={class:"sm:flex sm:items-start"},Ru={class:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-brand-100 sm:mx-0 sm:h-10 sm:w-10"},Lu={class:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left"},Iu={class:"mt-2"},Bu={class:"text-sm text-brand-700 dark:text-neutral-300"},Nu={class:"bg-gray-50 dark:bg-neutral-700 px-4 py-3 flex flex-col-reverse sm:flex-row gap-2 justify-end"},Vu=Ia({__name:"UploadFileModal",props:Rn({confirmMessage:{},confirmIcon:{type:[Function,Object]},title:{},id:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:Rn(["confirm"],["update:modelValue"]),setup(n,{emit:e}){const t=bl(n,"modelValue"),s=e;return(r,i)=>(Ds(),Ln(Be(Dl),{as:"template",show:t.value},{default:$e(()=>[me(Be(wl),{as:"div",class:"relative z-40",onClose:i[2]||(i[2]=a=>t.value=!1)},{default:$e(()=>[me(Be(In),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:$e(()=>[...i[3]||(i[3]=[te("div",{class:"fixed inset-0 bg-dark-003/50 backdrop-blur-md"},null,-1)])]),_:1}),te("div",Au,[te("div",Eu,[me(Be(In),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:$e(()=>[me(Be(Cl),{class:"relative transform overflow-hidden rounded-2xl bg-white text-left shadow-xl transition-all sm:my-8 w-full sm:max-w-lg"},{default:$e(()=>[te("div",Pu,[te("div",Fu,[te("div",Ru,[(Ds(),Ln(Sl(n.confirmIcon),{class:"h-6 w-6 text-brand-600","aria-hidden":"true"}))]),te("div",Lu,[me(Be(Tl),{as:"h3",class:"text-base font-semibold leading-6 text-gray-900 dark:text-neutral-200"},{default:$e(()=>[xi(Ni(n.title??"Deletion Account"),1)]),_:1}),te("div",Iu,[te("p",Bu,[Ol(r.$slots,"default")])])])])]),te("div",Nu,[me(Bn,{onClick:i[0]||(i[0]=()=>{t.value=!1,s("confirm",!0)}),color:"brand",icon:n.confirmIcon},{default:$e(()=>[xi(Ni(n.confirmMessage??"Yes, Delete User!"),1)]),_:1},8,["icon"]),me(Bn,{onClick:i[1]||(i[1]=a=>t.value=!1),icon:Be(kl)},{default:$e(()=>[...i[4]||(i[4]=[xi("Cancel",-1)])]),_:1},8,["icon"])])]),_:3})]),_:3})])])]),_:3})]),_:3},8,["show"]))}});var zu=Object.create,Wo=Object.defineProperty,Wu=Object.getOwnPropertyDescriptor,Xo=Object.getOwnPropertyNames,Xu=Object.getPrototypeOf,Yu=Object.prototype.hasOwnProperty,jn=(n,e)=>function(){return e||(0,n[Xo(n)[0]])((e={exports:{}}).exports,e),e.exports},Uu=(n,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Xo(e))!Yu.call(n,r)&&r!==t&&Wo(n,r,{get:()=>e[r],enumerable:!(s=Wu(e,r))||s.enumerable});return n},fi=(n,e,t)=>(t=n!=null?zu(Xu(n)):{},Uu(!n||!n.__esModule?Wo(t,"default",{value:n,enumerable:!0}):t,n)),Gu=jn({"../../node_modules/.pnpm/iota-array@1.0.0/node_modules/iota-array/iota.js"(n,e){function t(s){for(var r=new Array(s),i=0;i<s;++i)r[i]=i;return r}e.exports=t}}),Hu=jn({"../../node_modules/.pnpm/is-buffer@1.1.6/node_modules/is-buffer/index.js"(n,e){e.exports=function(r){return r!=null&&(t(r)||s(r)||!!r._isBuffer)};function t(r){return!!r.constructor&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function s(r){return typeof r.readFloatLE=="function"&&typeof r.slice=="function"&&t(r.slice(0,0))}}}),pi=jn({"../../node_modules/.pnpm/ndarray@1.0.19/node_modules/ndarray/ndarray.js"(n,e){var t=Gu(),s=Hu(),r=typeof Float64Array<"u";function i(d,u){return d[0]-u[0]}function a(){var d=this.stride,u=new Array(d.length),g;for(g=0;g<u.length;++g)u[g]=[Math.abs(d[g]),g];u.sort(i);var f=new Array(u.length);for(g=0;g<f.length;++g)f[g]=u[g][1];return f}function o(d,u){var g=["View",u,"d",d].join("");u<0&&(g="View_Nil"+d);var f=d==="generic";if(u===-1){var p="function "+g+"(a){this.data=a;};var proto="+g+".prototype;proto.dtype='"+d+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+g+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+g+"(a){return new "+g+"(a);}",K=new Function(p);return K()}else if(u===0){var p="function "+g+"(a,d) {this.data = a;this.offset = d};var proto="+g+".prototype;proto.dtype='"+d+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+g+"_copy() {return new "+g+"(this.data,this.offset)};proto.pick=function "+g+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+g+"_get(){return "+(f?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+g+"_set(v){return "+(f?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+g+"(a,b,c,d){return new "+g+"(a,d)}",K=new Function("TrivialArray",p);return K(c[d][0])}var p=["'use strict'"],y=t(u),x=y.map(function(E){return"i"+E}),b="this.offset+"+y.map(function(E){return"this.stride["+E+"]*i"+E}).join("+"),O=y.map(function(E){return"b"+E}).join(","),C=y.map(function(E){return"c"+E}).join(",");p.push("function "+g+"(a,"+O+","+C+",d){this.data=a","this.shape=["+O+"]","this.stride=["+C+"]","this.offset=d|0}","var proto="+g+".prototype","proto.dtype='"+d+"'","proto.dimension="+u),p.push("Object.defineProperty(proto,'size',{get:function "+g+"_size(){return "+y.map(function(E){return"this.shape["+E+"]"}).join("*"),"}})"),u===1?p.push("proto.order=[0]"):(p.push("Object.defineProperty(proto,'order',{get:"),u<4?(p.push("function "+g+"_order(){"),u===2?p.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):u===3&&p.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):p.push("ORDER})")),p.push("proto.set=function "+g+"_set("+x.join(",")+",v){"),f?p.push("return this.data.set("+b+",v)}"):p.push("return this.data["+b+"]=v}"),p.push("proto.get=function "+g+"_get("+x.join(",")+"){"),f?p.push("return this.data.get("+b+")}"):p.push("return this.data["+b+"]}"),p.push("proto.index=function "+g+"_index(",x.join(),"){return "+b+"}"),p.push("proto.hi=function "+g+"_hi("+x.join(",")+"){return new "+g+"(this.data,"+y.map(function(E){return["(typeof i",E,"!=='number'||i",E,"<0)?this.shape[",E,"]:i",E,"|0"].join("")}).join(",")+","+y.map(function(E){return"this.stride["+E+"]"}).join(",")+",this.offset)}");var k=y.map(function(E){return"a"+E+"=this.shape["+E+"]"}),F=y.map(function(E){return"c"+E+"=this.stride["+E+"]"});p.push("proto.lo=function "+g+"_lo("+x.join(",")+"){var b=this.offset,d=0,"+k.join(",")+","+F.join(","));for(var D=0;D<u;++D)p.push("if(typeof i"+D+"==='number'&&i"+D+">=0){d=i"+D+"|0;b+=c"+D+"*d;a"+D+"-=d}");p.push("return new "+g+"(this.data,"+y.map(function(E){return"a"+E}).join(",")+","+y.map(function(E){return"c"+E}).join(",")+",b)}"),p.push("proto.step=function "+g+"_step("+x.join(",")+"){var "+y.map(function(E){return"a"+E+"=this.shape["+E+"]"}).join(",")+","+y.map(function(E){return"b"+E+"=this.stride["+E+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var D=0;D<u;++D)p.push("if(typeof i"+D+"==='number'){d=i"+D+"|0;if(d<0){c+=b"+D+"*(a"+D+"-1);a"+D+"=ceil(-a"+D+"/d)}else{a"+D+"=ceil(a"+D+"/d)}b"+D+"*=d}");p.push("return new "+g+"(this.data,"+y.map(function(E){return"a"+E}).join(",")+","+y.map(function(E){return"b"+E}).join(",")+",c)}");for(var R=new Array(u),W=new Array(u),D=0;D<u;++D)R[D]="a[i"+D+"]",W[D]="b[i"+D+"]";p.push("proto.transpose=function "+g+"_transpose("+x+"){"+x.map(function(E,G){return E+"=("+E+"===undefined?"+G+":"+E+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+g+"(this.data,"+R.join(",")+","+W.join(",")+",this.offset)}"),p.push("proto.pick=function "+g+"_pick("+x+"){var a=[],b=[],c=this.offset");for(var D=0;D<u;++D)p.push("if(typeof i"+D+"==='number'&&i"+D+">=0){c=(c+this.stride["+D+"]*i"+D+")|0}else{a.push(this.shape["+D+"]);b.push(this.stride["+D+"])}");p.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),p.push("return function construct_"+g+"(data,shape,stride,offset){return new "+g+"(data,"+y.map(function(E){return"shape["+E+"]"}).join(",")+","+y.map(function(E){return"stride["+E+"]"}).join(",")+",offset)}");var K=new Function("CTOR_LIST","ORDER",p.join(`
`));return K(c[d],a)}function l(d){if(s(d))return"buffer";if(r)switch(Object.prototype.toString.call(d)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(d)?"array":"generic"}var c={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};function h(d,u,g,f){if(d===void 0){var C=c.array[0];return C([])}else typeof d=="number"&&(d=[d]);u===void 0&&(u=[d.length]);var p=u.length;if(g===void 0){g=new Array(p);for(var y=p-1,x=1;y>=0;--y)g[y]=x,x*=u[y]}if(f===void 0){f=0;for(var y=0;y<p;++y)g[y]<0&&(f-=(u[y]-1)*g[y])}for(var b=l(d),O=c[b];O.length<=p+1;)O.push(o(b,O.length-1));var C=O[p+1];return C(d,u,g,f)}e.exports=h}}),Zu=typeof global=="object"&&global&&global.Object===Object&&global,$u=Zu,qu=typeof self=="object"&&self&&self.Object===Object&&self,Ku=$u||qu||Function("return this")(),Mn=Ku,Ju=Mn.Symbol,Zr=Ju,Yo=Object.prototype,Qu=Yo.hasOwnProperty,ed=Yo.toString,ws=Zr?Zr.toStringTag:void 0;function td(n){var e=Qu.call(n,ws),t=n[ws];try{n[ws]=void 0;var s=!0}catch{}var r=ed.call(n);return s&&(e?n[ws]=t:delete n[ws]),r}var sd=td,rd=Object.prototype,id=rd.toString;function nd(n){return id.call(n)}var ad=nd,od="[object Null]",ld="[object Undefined]",Da=Zr?Zr.toStringTag:void 0;function cd(n){return n==null?n===void 0?ld:od:Da&&Da in Object(n)?sd(n):ad(n)}var hd=cd;function ud(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var Uo=ud,dd="[object AsyncFunction]",gd="[object Function]",fd="[object GeneratorFunction]",pd="[object Proxy]";function md(n){if(!Uo(n))return!1;var e=hd(n);return e==gd||e==fd||e==dd||e==pd}var vd=md,yd=Mn["__core-js_shared__"],Li=yd,ja=(function(){var n=/[^.]+$/.exec(Li&&Li.keys&&Li.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""})();function _d(n){return!!ja&&ja in n}var xd=_d,bd=Function.prototype,wd=bd.toString;function Cd(n){if(n!=null){try{return wd.call(n)}catch{}try{return n+""}catch{}}return""}var Sd=Cd,Td=/[\\^$.*+?()[\]{}|]/g,Od=/^\[object .+?Constructor\]$/,kd=Function.prototype,Dd=Object.prototype,jd=kd.toString,Md=Dd.hasOwnProperty,Ad=RegExp("^"+jd.call(Md).replace(Td,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Ed(n){if(!Uo(n)||xd(n))return!1;var e=vd(n)?Ad:Od;return e.test(Sd(n))}var Pd=Ed;function Fd(n,e){return n?.[e]}var Rd=Fd;function Ld(n,e){var t=Rd(n,e);return Pd(t)?t:void 0}var Go=Ld,Id=Go(Object,"create"),Ns=Id;function Bd(){this.__data__=Ns?Ns(null):{},this.size=0}var Nd=Bd;function Vd(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}var zd=Vd,Wd="__lodash_hash_undefined__",Xd=Object.prototype,Yd=Xd.hasOwnProperty;function Ud(n){var e=this.__data__;if(Ns){var t=e[n];return t===Wd?void 0:t}return Yd.call(e,n)?e[n]:void 0}var Gd=Ud,Hd=Object.prototype,Zd=Hd.hasOwnProperty;function $d(n){var e=this.__data__;return Ns?e[n]!==void 0:Zd.call(e,n)}var qd=$d,Kd="__lodash_hash_undefined__";function Jd(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=Ns&&e===void 0?Kd:e,this}var Qd=Jd;function fs(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var s=n[e];this.set(s[0],s[1])}}fs.prototype.clear=Nd;fs.prototype.delete=zd;fs.prototype.get=Gd;fs.prototype.has=qd;fs.prototype.set=Qd;var Ma=fs;function eg(){this.__data__=[],this.size=0}var tg=eg;function sg(n,e){return n===e||n!==n&&e!==e}var rg=sg;function ig(n,e){for(var t=n.length;t--;)if(rg(n[t][0],e))return t;return-1}var mi=ig,ng=Array.prototype,ag=ng.splice;function og(n){var e=this.__data__,t=mi(e,n);if(t<0)return!1;var s=e.length-1;return t==s?e.pop():ag.call(e,t,1),--this.size,!0}var lg=og;function cg(n){var e=this.__data__,t=mi(e,n);return t<0?void 0:e[t][1]}var hg=cg;function ug(n){return mi(this.__data__,n)>-1}var dg=ug;function gg(n,e){var t=this.__data__,s=mi(t,n);return s<0?(++this.size,t.push([n,e])):t[s][1]=e,this}var fg=gg;function ps(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var s=n[e];this.set(s[0],s[1])}}ps.prototype.clear=tg;ps.prototype.delete=lg;ps.prototype.get=hg;ps.prototype.has=dg;ps.prototype.set=fg;var pg=ps,mg=Go(Mn,"Map"),vg=mg;function yg(){this.size=0,this.__data__={hash:new Ma,map:new(vg||pg),string:new Ma}}var _g=yg;function xg(n){var e=typeof n;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?n!=="__proto__":n===null}var bg=xg;function wg(n,e){var t=n.__data__;return bg(e)?t[typeof e=="string"?"string":"hash"]:t.map}var vi=wg;function Cg(n){var e=vi(this,n).delete(n);return this.size-=e?1:0,e}var Sg=Cg;function Tg(n){return vi(this,n).get(n)}var Og=Tg;function kg(n){return vi(this,n).has(n)}var Dg=kg;function jg(n,e){var t=vi(this,n),s=t.size;return t.set(n,e),this.size+=t.size==s?0:1,this}var Mg=jg;function ms(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var s=n[e];this.set(s[0],s[1])}}ms.prototype.clear=_g;ms.prototype.delete=Sg;ms.prototype.get=Og;ms.prototype.has=Dg;ms.prototype.set=Mg;var Ho=ms,Ag="Expected a function";function An(n,e){if(typeof n!="function"||e!=null&&typeof e!="function")throw new TypeError(Ag);var t=function(){var s=arguments,r=e?e.apply(this,s):s[0],i=t.cache;if(i.has(r))return i.get(r);var a=n.apply(this,s);return t.cache=i.set(r,a)||i,a};return t.cache=new(An.Cache||Ho),t}An.Cache=Ho;var Eg=An,En=fi(pi()),Zo=class Qi{constructor(e,t){this.type="application/octet-stream",this.params={},this.type=e,this.params=t}toString(){const e=[];for(const t in this.params){const s=this.params[t];e.push(`${t}=${s}`)}return[this.type,...e].join(";")}static create(e,t){return new Qi(e,t)}isIdentical(e){return this.type===e.type&&this.params===e.params}isEqual(e){return this.type===e.type}static fromString(e){const[t,...s]=e.split(";"),r={};for(const i of s){const[a,o]=i.split("=");r[a.trim()]=o.trim()}return new Qi(t,r)}},Ii=fi(pi());async function Pg(n){const e=Zo.fromString(n.type);switch(e.type){case"image/x-alpha8":{const t=parseInt(e.params.width),s=parseInt(e.params.height);return(0,Ii.default)(new Uint8Array(await n.arrayBuffer()),[s,t,1])}case"image/x-rgba8":{const t=parseInt(e.params.width),s=parseInt(e.params.height);return(0,Ii.default)(new Uint8Array(await n.arrayBuffer()),[s,t,4])}case"application/octet-stream":case"image/png":case"image/jpeg":case"image/jpg":case"image/webp":{const t=await createImageBitmap(n),s=Ig(t);return(0,Ii.default)(new Uint8Array(s.data),[s.height,s.width,4])}default:throw new Error(`Invalid format: ${e.type} with params: ${e.params}`)}}async function Fg(n,e=.8,t="image/png"){const[s,r,i]=n.shape;switch(t){case"image/x-alpha8":case"image/x-rgba8":{const l=Zo.create(t,{width:r.toString(),height:s.toString()});return new Blob([n.data],{type:l.toString()})}case"image/png":case"image/jpeg":case"image/webp":{const l=new ImageData(new Uint8ClampedArray(n.data),r,s);var a=$o(l.width,l.height),o=a.getContext("2d");return o.putImageData(l,0,0),a.convertToBlob({quality:e,type:t})}default:throw new Error(`Invalid format: ${t}`)}}function Rg(n){return new RegExp("^(?:[a-z+]+:)?//","i").test(n)}function Lg(n,e){return Rg(n)?n:new URL(n,e).href}function Ig(n){var e=$o(n.width,n.height),t=e.getContext("2d");return t.drawImage(n,0,0),t.getImageData(0,0,e.width,e.height)}function Bg(n){if(typeof Uint8Array<"u")return new Uint8Array(n);if(typeof Uint8ClampedArray<"u")return new Uint8ClampedArray(n);if(typeof Uint16Array<"u")return new Uint16Array(n);if(typeof Uint32Array<"u")return new Uint32Array(n);if(typeof Float32Array<"u")return new Float32Array(n);if(typeof Float64Array<"u")return new Float64Array(n);throw new Error("TypedArray not supported")}function Aa(n,e,t,s=!1){const[r,i,a]=n.shape;let o=i/e,l=r/t;s&&(o=l=Math.max(o,l)>1?Math.max(o,l):Math.min(o,l));const c=(0,En.default)(Bg(a*e*t),[t,e,a]);for(let h=0;h<t;h++)for(let d=0;d<e;d++){const u=d*o,g=h*l,f=Math.max(Math.floor(u),0),p=Math.min(Math.ceil(u),i-1),y=Math.max(Math.floor(g),0),x=Math.min(Math.ceil(g),r-1),b=u-f,O=g-y;for(let C=0;C<a;C++){const k=n.get(y,f,C),F=n.get(y,p,C),D=n.get(x,f,C),R=n.get(x,p,C),W=(1-b)*(1-O)*k+b*(1-O)*F+(1-b)*O*D+b*O*R;c.set(h,d,C,W)}}return c}function Ng(n,e=[128,128,128],t=[256,256,256]){var s=n.data;const[r,i,a]=n.shape,o=r*i,l=new Float32Array(3*o);for(let c=0,h=0;c<s.length;c+=4,h+=1)l[h]=(s[c]-e[0])/t[0],l[h+o]=(s[c+1]-e[1])/t[1],l[h+o+o]=(s[c+2]-e[2])/t[2];return(0,En.default)(l,[1,3,r,i])}async function Vg(n,e){return typeof n=="string"&&(n=Lg(n,e.publicPath),n=new URL(n)),n instanceof URL&&(n=await(await fetch(n,{})).blob()),(n instanceof ArrayBuffer||ArrayBuffer.isView(n))&&(n=new Blob([n])),n instanceof Blob&&(n=await Pg(n)),n}function zg(n){const e=new Uint8Array(n.data.length);for(let t=0;t<n.data.length;t++)e[t]=n.data[t]*255;return(0,En.default)(e,n.shape)}function $o(n,e){let t;if(typeof OffscreenCanvas<"u"?t=new OffscreenCanvas(n,e):t=document.createElement("canvas"),!t)throw new Error("Canvas nor OffscreenCanvas are available in the current context.");return t}var Wg=fi(pi()),qo=async()=>navigator.gpu===void 0?!1:await navigator.gpu.requestAdapter()!==null,Xg=()=>navigator.hardwareConcurrency??4;async function Ea(n,e){return URL.createObjectURL(await Ko(n,e))}async function Ko(n,e){const t=new URL("resources.json",e.publicPath),s=await fetch(t);if(!s.ok)throw new Error("Resource metadata not found. Ensure that the config.publicPath is configured correctly.");const i=(await s.json())[n];if(!i)throw new Error(`Resource ${n} not found. Ensure that the config.publicPath is configured correctly.`);const a=i.chunks;let o=0;const l=a.map(async d=>{const u=d.offsets[1]-d.offsets[0],g=e.publicPath?new URL(d.name,e.publicPath).toString():d.name,p=await(await fetch(g,e.fetchArgs)).blob();if(u!==p.size)throw new Error(`Failed to fetch ${n} with size ${u} but got ${p.size}`);return e.progress&&(o+=u,e.progress(`fetch:${n}`,o,i.size)),p}),c=await Promise.all(l),h=new Blob(c,{type:i.mime});if(h.size!==i.size)throw new Error(`Failed to fetch ${n} with size ${i.size} but got ${h.size}`);return h}var Cs=null,Jo=async n=>(Cs!==null||(n?Cs=(await Nn(async()=>{const{default:e}=await import("./ort.webgpu.bundle.min-D3RkTfSm.js");return{default:e}},[])).default:Cs=(await Nn(async()=>{const{default:e}=await import("./ort.bundle.min-BB_gNhy1.js");return{default:e}},[])).default),Cs);async function Yg(n,e){const t=e.device==="gpu"&&await qo(),s=t&&e.proxyToWorker,r=[t?"webgpu":"wasm"],i=await Jo(t);e.debug&&(console.debug("	Using WebGPU:",t),console.debug("	Proxy to Worker:",s),i.env.debug=!0,i.env.logLevel="verbose"),i.env.wasm.numThreads=Xg(),i.env.wasm.proxy=s;const a=t?"/onnxruntime-web/ort-wasm-simd-threaded.jsep":"/onnxruntime-web/ort-wasm-simd-threaded",o=await Ea(`${a}.wasm`,e),l=await Ea(`${a}.mjs`,e);i.env.wasm.wasmPaths={mjs:l,wasm:o},e.debug&&console.debug("ort.env.wasm:",i.env.wasm);const c={executionProviders:r,graphOptimizationLevel:"all",executionMode:"parallel",enableCpuMemArena:!0};return await i.InferenceSession.create(n,c).catch(d=>{throw new Error(`Failed to create session: "${d}". Please check if the publicPath is set correctly.`)})}async function Ug(n,e,t,s){const r=s.device==="gpu"&&await qo(),i=await Jo(r),a={};for(const[c,h]of e)a[c]=new i.Tensor("float32",new Float32Array(h.data),h.shape);const o=await n.run(a,{}),l=[];for(const c of t){const h=o[c],d=h.dims,u=h.data,g=(0,Wg.default)(u,d);l.push(g)}return l}var X;(function(n){n.assertEqual=r=>r;function e(r){}n.assertIs=e;function t(r){throw new Error}n.assertNever=t,n.arrayToEnum=r=>{const i={};for(const a of r)i[a]=a;return i},n.getValidEnumValues=r=>{const i=n.objectKeys(r).filter(o=>typeof r[r[o]]!="number"),a={};for(const o of i)a[o]=r[o];return n.objectValues(a)},n.objectValues=r=>n.objectKeys(r).map(function(i){return r[i]}),n.objectKeys=typeof Object.keys=="function"?r=>Object.keys(r):r=>{const i=[];for(const a in r)Object.prototype.hasOwnProperty.call(r,a)&&i.push(a);return i},n.find=(r,i)=>{for(const a of r)if(i(a))return a},n.isInteger=typeof Number.isInteger=="function"?r=>Number.isInteger(r):r=>typeof r=="number"&&isFinite(r)&&Math.floor(r)===r;function s(r,i=" | "){return r.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}n.joinValues=s,n.jsonStringifyReplacer=(r,i)=>typeof i=="bigint"?i.toString():i})(X||(X={}));var en;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(en||(en={}));var M=X.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ct=n=>{switch(typeof n){case"undefined":return M.undefined;case"string":return M.string;case"number":return isNaN(n)?M.nan:M.number;case"boolean":return M.boolean;case"function":return M.function;case"bigint":return M.bigint;case"symbol":return M.symbol;case"object":return Array.isArray(n)?M.array:n===null?M.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?M.promise:typeof Map<"u"&&n instanceof Map?M.map:typeof Set<"u"&&n instanceof Set?M.set:typeof Date<"u"&&n instanceof Date?M.date:M.object;default:return M.unknown}},w=X.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Gg=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:"),Ye=class Qo extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(i){return i.message},s={_errors:[]},r=i=>{for(const a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(r);else if(a.code==="invalid_return_type")r(a.returnTypeError);else if(a.code==="invalid_arguments")r(a.argumentsError);else if(a.path.length===0)s._errors.push(t(a));else{let o=s,l=0;for(;l<a.path.length;){const c=a.path[l];l===a.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(t(a))):o[c]=o[c]||{_errors:[]},o=o[c],l++}}};return r(this),s}static assert(e){if(!(e instanceof Qo))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,X.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},s=[];for(const r of this.issues)r.path.length>0?(t[r.path[0]]=t[r.path[0]]||[],t[r.path[0]].push(e(r))):s.push(e(r));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}};Ye.create=n=>new Ye(n);var rs=(n,e)=>{let t;switch(n.code){case w.invalid_type:n.received===M.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case w.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,X.jsonStringifyReplacer)}`;break;case w.unrecognized_keys:t=`Unrecognized key(s) in object: ${X.joinValues(n.keys,", ")}`;break;case w.invalid_union:t="Invalid input";break;case w.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${X.joinValues(n.options)}`;break;case w.invalid_enum_value:t=`Invalid enum value. Expected ${X.joinValues(n.options)}, received '${n.received}'`;break;case w.invalid_arguments:t="Invalid function arguments";break;case w.invalid_return_type:t="Invalid function return type";break;case w.invalid_date:t="Invalid date";break;case w.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:X.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case w.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case w.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case w.custom:t="Invalid input";break;case w.invalid_intersection_types:t="Intersection results could not be merged";break;case w.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case w.not_finite:t="Number must be finite";break;default:t=e.defaultError,X.assertNever(n)}return{message:t}},el=rs;function Hg(n){el=n}function $r(){return el}var qr=n=>{const{data:e,path:t,errorMaps:s,issueData:r}=n,i=[...t,...r.path||[]],a={...r,path:i};if(r.message!==void 0)return{...r,path:i,message:r.message};let o="";const l=s.filter(c=>!!c).slice().reverse();for(const c of l)o=c(a,{data:e,defaultError:o}).message;return{...r,path:i,message:o}},Zg=[];function j(n,e){const t=$r(),s=qr({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===rs?void 0:rs].filter(r=>!!r)});n.common.issues.push(s)}var De=class tl{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const s=[];for(const r of t){if(r.status==="aborted")return B;r.status==="dirty"&&e.dirty(),s.push(r.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){const s=[];for(const r of t){const i=await r.key,a=await r.value;s.push({key:i,value:a})}return tl.mergeObjectSync(e,s)}static mergeObjectSync(e,t){const s={};for(const r of t){const{key:i,value:a}=r;if(i.status==="aborted"||a.status==="aborted")return B;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value<"u"||r.alwaysSet)&&(s[i.value]=a.value)}return{status:e.value,value:s}}},B=Object.freeze({status:"aborted"}),Jt=n=>({status:"dirty",value:n}),xe=n=>({status:"valid",value:n}),tn=n=>n.status==="aborted",sn=n=>n.status==="dirty",Vt=n=>n.status==="valid",Vs=n=>typeof Promise<"u"&&n instanceof Promise;function Kr(n,e,t,s){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(n)}function sl(n,e,t,s,r){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t}var L;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e?.message})(L||(L={}));var Ts,Os,st=class{constructor(n,e,t,s){this._cachedPath=[],this.parent=n,this.data=e,this._path=t,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Pa=(n,e)=>{if(Vt(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Ye(n.common.issues);return this._error=t,this._error}}};function N(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:s,description:r}=n;if(e&&(t||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:r}:{errorMap:(a,o)=>{var l,c;const{message:h}=n;return a.code==="invalid_enum_value"?{message:h??o.defaultError}:typeof o.data>"u"?{message:(l=h??s)!==null&&l!==void 0?l:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(c=h??t)!==null&&c!==void 0?c:o.defaultError}},description:r}}var V=class{get description(){return this._def.description}_getType(n){return ct(n.data)}_getOrReturnCtx(n,e){return e||{common:n.parent.common,data:n.data,parsedType:ct(n.data),schemaErrorMap:this._def.errorMap,path:n.path,parent:n.parent}}_processInputParams(n){return{status:new De,ctx:{common:n.parent.common,data:n.data,parsedType:ct(n.data),schemaErrorMap:this._def.errorMap,path:n.path,parent:n.parent}}}_parseSync(n){const e=this._parse(n);if(Vs(e))throw new Error("Synchronous parse encountered promise.");return e}_parseAsync(n){const e=this._parse(n);return Promise.resolve(e)}parse(n,e){const t=this.safeParse(n,e);if(t.success)return t.data;throw t.error}safeParse(n,e){var t;const s={common:{issues:[],async:(t=e?.async)!==null&&t!==void 0?t:!1,contextualErrorMap:e?.errorMap},path:e?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:n,parsedType:ct(n)},r=this._parseSync({data:n,path:s.path,parent:s});return Pa(s,r)}"~validate"(n){var e,t;const s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:n,parsedType:ct(n)};if(!this["~standard"].async)try{const r=this._parseSync({data:n,path:[],parent:s});return Vt(r)?{value:r.value}:{issues:s.common.issues}}catch(r){!((t=(e=r?.message)===null||e===void 0?void 0:e.toLowerCase())===null||t===void 0)&&t.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:n,path:[],parent:s}).then(r=>Vt(r)?{value:r.value}:{issues:s.common.issues})}async parseAsync(n,e){const t=await this.safeParseAsync(n,e);if(t.success)return t.data;throw t.error}async safeParseAsync(n,e){const t={common:{issues:[],contextualErrorMap:e?.errorMap,async:!0},path:e?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:n,parsedType:ct(n)},s=this._parse({data:n,path:t.path,parent:t}),r=await(Vs(s)?s:Promise.resolve(s));return Pa(t,r)}refine(n,e){const t=s=>typeof e=="string"||typeof e>"u"?{message:e}:typeof e=="function"?e(s):e;return this._refinement((s,r)=>{const i=n(s),a=()=>r.addIssue({code:w.custom,...t(s)});return typeof Promise<"u"&&i instanceof Promise?i.then(o=>o?!0:(a(),!1)):i?!0:(a(),!1)})}refinement(n,e){return this._refinement((t,s)=>n(t)?!0:(s.addIssue(typeof e=="function"?e(t,s):e),!1))}_refinement(n){return new Ue({schema:this,typeName:I.ZodEffects,effect:{type:"refinement",refinement:n}})}superRefine(n){return this._refinement(n)}constructor(n){this.spa=this.safeParseAsync,this._def=n,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return et.create(this,this._def)}nullable(){return Ot.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return zt.create(this)}promise(){return as.create(this,this._def)}or(n){return Hs.create([this,n],this._def)}and(n){return Zs.create(this,n,this._def)}transform(n){return new Ue({...N(this._def),schema:this,typeName:I.ZodEffects,effect:{type:"transform",transform:n}})}default(n){const e=typeof n=="function"?n:()=>n;return new Js({...N(this._def),innerType:this,defaultValue:e,typeName:I.ZodDefault})}brand(){return new Pn({typeName:I.ZodBranded,type:this,...N(this._def)})}catch(n){const e=typeof n=="function"?n:()=>n;return new Qs({...N(this._def),innerType:this,catchValue:e,typeName:I.ZodCatch})}describe(n){const e=this.constructor;return new e({...this._def,description:n})}pipe(n){return Fn.create(this,n)}readonly(){return er.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},$g=/^c[^\s-]{8,}$/i,qg=/^[0-9a-z]+$/,Kg=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Jg=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Qg=/^[a-z0-9_-]{21}$/i,ef=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,tf=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,sf=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,rf="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Bi,nf=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,af=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,of=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,lf=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,cf=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,hf=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,rl="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",uf=new RegExp(`^${rl}$`);function il(n){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`),e}function df(n){return new RegExp(`^${il(n)}$`)}function nl(n){let e=`${rl}T${il(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function gf(n,e){return!!((e==="v4"||!e)&&nf.test(n)||(e==="v6"||!e)&&of.test(n))}function ff(n,e){if(!ef.test(n))return!1;try{const[t]=n.split("."),s=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),r=JSON.parse(atob(s));return!(typeof r!="object"||r===null||!r.typ||!r.alg||e&&r.alg!==e)}catch{return!1}}function pf(n,e){return!!((e==="v4"||!e)&&af.test(n)||(e==="v6"||!e)&&lf.test(n))}var is=class ks extends V{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==M.string){const i=this._getOrReturnCtx(e);return j(i,{code:w.invalid_type,expected:M.string,received:i.parsedType}),B}const s=new De;let r;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(r=this._getOrReturnCtx(e,r),j(r,{code:w.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="max")e.data.length>i.value&&(r=this._getOrReturnCtx(e,r),j(r,{code:w.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="length"){const a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(r=this._getOrReturnCtx(e,r),a?j(r,{code:w.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&j(r,{code:w.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),s.dirty())}else if(i.kind==="email")sf.test(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{validation:"email",code:w.invalid_string,message:i.message}),s.dirty());else if(i.kind==="emoji")Bi||(Bi=new RegExp(rf,"u")),Bi.test(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{validation:"emoji",code:w.invalid_string,message:i.message}),s.dirty());else if(i.kind==="uuid")Jg.test(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{validation:"uuid",code:w.invalid_string,message:i.message}),s.dirty());else if(i.kind==="nanoid")Qg.test(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{validation:"nanoid",code:w.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid")$g.test(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{validation:"cuid",code:w.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid2")qg.test(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{validation:"cuid2",code:w.invalid_string,message:i.message}),s.dirty());else if(i.kind==="ulid")Kg.test(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{validation:"ulid",code:w.invalid_string,message:i.message}),s.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{r=this._getOrReturnCtx(e,r),j(r,{validation:"url",code:w.invalid_string,message:i.message}),s.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{validation:"regex",code:w.invalid_string,message:i.message}),s.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(r=this._getOrReturnCtx(e,r),j(r,{code:w.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),s.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(r=this._getOrReturnCtx(e,r),j(r,{code:w.invalid_string,validation:{startsWith:i.value},message:i.message}),s.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(r=this._getOrReturnCtx(e,r),j(r,{code:w.invalid_string,validation:{endsWith:i.value},message:i.message}),s.dirty()):i.kind==="datetime"?nl(i).test(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{code:w.invalid_string,validation:"datetime",message:i.message}),s.dirty()):i.kind==="date"?uf.test(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{code:w.invalid_string,validation:"date",message:i.message}),s.dirty()):i.kind==="time"?df(i).test(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{code:w.invalid_string,validation:"time",message:i.message}),s.dirty()):i.kind==="duration"?tf.test(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{validation:"duration",code:w.invalid_string,message:i.message}),s.dirty()):i.kind==="ip"?gf(e.data,i.version)||(r=this._getOrReturnCtx(e,r),j(r,{validation:"ip",code:w.invalid_string,message:i.message}),s.dirty()):i.kind==="jwt"?ff(e.data,i.alg)||(r=this._getOrReturnCtx(e,r),j(r,{validation:"jwt",code:w.invalid_string,message:i.message}),s.dirty()):i.kind==="cidr"?pf(e.data,i.version)||(r=this._getOrReturnCtx(e,r),j(r,{validation:"cidr",code:w.invalid_string,message:i.message}),s.dirty()):i.kind==="base64"?cf.test(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{validation:"base64",code:w.invalid_string,message:i.message}),s.dirty()):i.kind==="base64url"?hf.test(e.data)||(r=this._getOrReturnCtx(e,r),j(r,{validation:"base64url",code:w.invalid_string,message:i.message}),s.dirty()):X.assertNever(i);return{status:s.value,value:e.data}}_regex(e,t,s){return this.refinement(r=>e.test(r),{validation:t,code:w.invalid_string,...L.errToObj(s)})}_addCheck(e){return new ks({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...L.errToObj(e)})}url(e){return this._addCheck({kind:"url",...L.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...L.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...L.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...L.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...L.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...L.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...L.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...L.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...L.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...L.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...L.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...L.errToObj(e)})}datetime(e){var t,s;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(t=e?.offset)!==null&&t!==void 0?t:!1,local:(s=e?.local)!==null&&s!==void 0?s:!1,...L.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...L.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...L.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...L.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...L.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...L.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...L.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...L.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...L.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...L.errToObj(t)})}nonempty(e){return this.min(1,L.errToObj(e))}trim(){return new ks({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ks({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ks({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};is.create=n=>{var e;return new is({checks:[],typeName:I.ZodString,coerce:(e=n?.coerce)!==null&&e!==void 0?e:!1,...N(n)})};function mf(n,e){const t=(n.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,r=t>s?t:s,i=parseInt(n.toFixed(r).replace(".","")),a=parseInt(e.toFixed(r).replace(".",""));return i%a/Math.pow(10,r)}var zs=class rn extends V{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==M.number){const i=this._getOrReturnCtx(e);return j(i,{code:w.invalid_type,expected:M.number,received:i.parsedType}),B}let s;const r=new De;for(const i of this._def.checks)i.kind==="int"?X.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),j(s,{code:w.invalid_type,expected:"integer",received:"float",message:i.message}),r.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),j(s,{code:w.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),j(s,{code:w.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):i.kind==="multipleOf"?mf(e.data,i.value)!==0&&(s=this._getOrReturnCtx(e,s),j(s,{code:w.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),j(s,{code:w.not_finite,message:i.message}),r.dirty()):X.assertNever(i);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,L.toString(t))}gt(e,t){return this.setLimit("min",e,!1,L.toString(t))}lte(e,t){return this.setLimit("max",e,!0,L.toString(t))}lt(e,t){return this.setLimit("max",e,!1,L.toString(t))}setLimit(e,t,s,r){return new rn({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:L.toString(r)}]})}_addCheck(e){return new rn({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:L.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:L.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:L.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:L.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:L.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&X.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(t===null||s.value>t)&&(t=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}};zs.create=n=>new zs({checks:[],typeName:I.ZodNumber,coerce:n?.coerce||!1,...N(n)});var Ws=class nn extends V{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==M.bigint)return this._getInvalidInput(e);let s;const r=new De;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),j(s,{code:w.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),r.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),j(s,{code:w.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),r.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),j(s,{code:w.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):X.assertNever(i);return{status:r.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return j(t,{code:w.invalid_type,expected:M.bigint,received:t.parsedType}),B}gte(e,t){return this.setLimit("min",e,!0,L.toString(t))}gt(e,t){return this.setLimit("min",e,!1,L.toString(t))}lte(e,t){return this.setLimit("max",e,!0,L.toString(t))}lt(e,t){return this.setLimit("max",e,!1,L.toString(t))}setLimit(e,t,s,r){return new nn({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:L.toString(r)}]})}_addCheck(e){return new nn({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:L.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:L.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:L.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:L.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:L.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};Ws.create=n=>{var e;return new Ws({checks:[],typeName:I.ZodBigInt,coerce:(e=n?.coerce)!==null&&e!==void 0?e:!1,...N(n)})};var Xs=class extends V{_parse(n){if(this._def.coerce&&(n.data=!!n.data),this._getType(n)!==M.boolean){const t=this._getOrReturnCtx(n);return j(t,{code:w.invalid_type,expected:M.boolean,received:t.parsedType}),B}return xe(n.data)}};Xs.create=n=>new Xs({typeName:I.ZodBoolean,coerce:n?.coerce||!1,...N(n)});var Ys=class al extends V{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==M.date){const i=this._getOrReturnCtx(e);return j(i,{code:w.invalid_type,expected:M.date,received:i.parsedType}),B}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return j(i,{code:w.invalid_date}),B}const s=new De;let r;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(r=this._getOrReturnCtx(e,r),j(r,{code:w.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),s.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(r=this._getOrReturnCtx(e,r),j(r,{code:w.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),s.dirty()):X.assertNever(i);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new al({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:L.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:L.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};Ys.create=n=>new Ys({checks:[],coerce:n?.coerce||!1,typeName:I.ZodDate,...N(n)});var Jr=class extends V{_parse(n){if(this._getType(n)!==M.symbol){const t=this._getOrReturnCtx(n);return j(t,{code:w.invalid_type,expected:M.symbol,received:t.parsedType}),B}return xe(n.data)}};Jr.create=n=>new Jr({typeName:I.ZodSymbol,...N(n)});var Us=class extends V{_parse(n){if(this._getType(n)!==M.undefined){const t=this._getOrReturnCtx(n);return j(t,{code:w.invalid_type,expected:M.undefined,received:t.parsedType}),B}return xe(n.data)}};Us.create=n=>new Us({typeName:I.ZodUndefined,...N(n)});var Gs=class extends V{_parse(n){if(this._getType(n)!==M.null){const t=this._getOrReturnCtx(n);return j(t,{code:w.invalid_type,expected:M.null,received:t.parsedType}),B}return xe(n.data)}};Gs.create=n=>new Gs({typeName:I.ZodNull,...N(n)});var ns=class extends V{constructor(){super(...arguments),this._any=!0}_parse(n){return xe(n.data)}};ns.create=n=>new ns({typeName:I.ZodAny,...N(n)});var Bt=class extends V{constructor(){super(...arguments),this._unknown=!0}_parse(n){return xe(n.data)}};Bt.create=n=>new Bt({typeName:I.ZodUnknown,...N(n)});var vt=class extends V{_parse(n){const e=this._getOrReturnCtx(n);return j(e,{code:w.invalid_type,expected:M.never,received:e.parsedType}),B}};vt.create=n=>new vt({typeName:I.ZodNever,...N(n)});var Qr=class extends V{_parse(n){if(this._getType(n)!==M.undefined){const t=this._getOrReturnCtx(n);return j(t,{code:w.invalid_type,expected:M.void,received:t.parsedType}),B}return xe(n.data)}};Qr.create=n=>new Qr({typeName:I.ZodVoid,...N(n)});var zt=class Rr extends V{_parse(e){const{ctx:t,status:s}=this._processInputParams(e),r=this._def;if(t.parsedType!==M.array)return j(t,{code:w.invalid_type,expected:M.array,received:t.parsedType}),B;if(r.exactLength!==null){const a=t.data.length>r.exactLength.value,o=t.data.length<r.exactLength.value;(a||o)&&(j(t,{code:a?w.too_big:w.too_small,minimum:o?r.exactLength.value:void 0,maximum:a?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),s.dirty())}if(r.minLength!==null&&t.data.length<r.minLength.value&&(j(t,{code:w.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),s.dirty()),r.maxLength!==null&&t.data.length>r.maxLength.value&&(j(t,{code:w.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>r.type._parseAsync(new st(t,a,t.path,o)))).then(a=>De.mergeArray(s,a));const i=[...t.data].map((a,o)=>r.type._parseSync(new st(t,a,t.path,o)));return De.mergeArray(s,i)}get element(){return this._def.type}min(e,t){return new Rr({...this._def,minLength:{value:e,message:L.toString(t)}})}max(e,t){return new Rr({...this._def,maxLength:{value:e,message:L.toString(t)}})}length(e,t){return new Rr({...this._def,exactLength:{value:e,message:L.toString(t)}})}nonempty(e){return this.min(1,e)}};zt.create=(n,e)=>new zt({type:n,minLength:null,maxLength:null,exactLength:null,typeName:I.ZodArray,...N(e)});function Zt(n){if(n instanceof Fe){const e={};for(const t in n.shape){const s=n.shape[t];e[t]=et.create(Zt(s))}return new Fe({...n._def,shape:()=>e})}else return n instanceof zt?new zt({...n._def,type:Zt(n.element)}):n instanceof et?et.create(Zt(n.unwrap())):n instanceof Ot?Ot.create(Zt(n.unwrap())):n instanceof Tt?Tt.create(n.items.map(e=>Zt(e))):n}var Fe=class Le extends V{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=X.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==M.object){const c=this._getOrReturnCtx(e);return j(c,{code:w.invalid_type,expected:M.object,received:c.parsedType}),B}const{status:s,ctx:r}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof vt&&this._def.unknownKeys==="strip"))for(const c in r.data)a.includes(c)||o.push(c);const l=[];for(const c of a){const h=i[c],d=r.data[c];l.push({key:{status:"valid",value:c},value:h._parse(new st(r,d,r.path,c)),alwaysSet:c in r.data})}if(this._def.catchall instanceof vt){const c=this._def.unknownKeys;if(c==="passthrough")for(const h of o)l.push({key:{status:"valid",value:h},value:{status:"valid",value:r.data[h]}});else if(c==="strict")o.length>0&&(j(r,{code:w.unrecognized_keys,keys:o}),s.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const h of o){const d=r.data[h];l.push({key:{status:"valid",value:h},value:c._parse(new st(r,d,r.path,h)),alwaysSet:h in r.data})}}return r.common.async?Promise.resolve().then(async()=>{const c=[];for(const h of l){const d=await h.key,u=await h.value;c.push({key:d,value:u,alwaysSet:h.alwaysSet})}return c}).then(c=>De.mergeObjectSync(s,c)):De.mergeObjectSync(s,l)}get shape(){return this._def.shape()}strict(e){return L.errToObj,new Le({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,s)=>{var r,i,a,o;const l=(a=(i=(r=this._def).errorMap)===null||i===void 0?void 0:i.call(r,t,s).message)!==null&&a!==void 0?a:s.defaultError;return t.code==="unrecognized_keys"?{message:(o=L.errToObj(e).message)!==null&&o!==void 0?o:l}:{message:l}}}:{}})}strip(){return new Le({...this._def,unknownKeys:"strip"})}passthrough(){return new Le({...this._def,unknownKeys:"passthrough"})}extend(e){return new Le({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Le({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:I.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Le({...this._def,catchall:e})}pick(e){const t={};return X.objectKeys(e).forEach(s=>{e[s]&&this.shape[s]&&(t[s]=this.shape[s])}),new Le({...this._def,shape:()=>t})}omit(e){const t={};return X.objectKeys(this.shape).forEach(s=>{e[s]||(t[s]=this.shape[s])}),new Le({...this._def,shape:()=>t})}deepPartial(){return Zt(this)}partial(e){const t={};return X.objectKeys(this.shape).forEach(s=>{const r=this.shape[s];e&&!e[s]?t[s]=r:t[s]=r.optional()}),new Le({...this._def,shape:()=>t})}required(e){const t={};return X.objectKeys(this.shape).forEach(s=>{if(e&&!e[s])t[s]=this.shape[s];else{let i=this.shape[s];for(;i instanceof et;)i=i._def.innerType;t[s]=i}}),new Le({...this._def,shape:()=>t})}keyof(){return dl(X.objectKeys(this.shape))}};Fe.create=(n,e)=>new Fe({shape:()=>n,unknownKeys:"strip",catchall:vt.create(),typeName:I.ZodObject,...N(e)});Fe.strictCreate=(n,e)=>new Fe({shape:()=>n,unknownKeys:"strict",catchall:vt.create(),typeName:I.ZodObject,...N(e)});Fe.lazycreate=(n,e)=>new Fe({shape:n,unknownKeys:"strip",catchall:vt.create(),typeName:I.ZodObject,...N(e)});var Hs=class extends V{_parse(n){const{ctx:e}=this._processInputParams(n),t=this._def.options;function s(r){for(const a of r)if(a.result.status==="valid")return a.result;for(const a of r)if(a.result.status==="dirty")return e.common.issues.push(...a.ctx.common.issues),a.result;const i=r.map(a=>new Ye(a.ctx.common.issues));return j(e,{code:w.invalid_union,unionErrors:i}),B}if(e.common.async)return Promise.all(t.map(async r=>{const i={...e,common:{...e.common,issues:[]},parent:null};return{result:await r._parseAsync({data:e.data,path:e.path,parent:i}),ctx:i}})).then(s);{let r;const i=[];for(const o of t){const l={...e,common:{...e.common,issues:[]},parent:null},c=o._parseSync({data:e.data,path:e.path,parent:l});if(c.status==="valid")return c;c.status==="dirty"&&!r&&(r={result:c,ctx:l}),l.common.issues.length&&i.push(l.common.issues)}if(r)return e.common.issues.push(...r.ctx.common.issues),r.result;const a=i.map(o=>new Ye(o));return j(e,{code:w.invalid_union,unionErrors:a}),B}}get options(){return this._def.options}};Hs.create=(n,e)=>new Hs({options:n,typeName:I.ZodUnion,...N(e)});var at=n=>n instanceof $s?at(n.schema):n instanceof Ue?at(n.innerType()):n instanceof qs?[n.value]:n instanceof ir?n.options:n instanceof Ks?X.objectValues(n.enum):n instanceof Js?at(n._def.innerType):n instanceof Us?[void 0]:n instanceof Gs?[null]:n instanceof et?[void 0,...at(n.unwrap())]:n instanceof Ot?[null,...at(n.unwrap())]:n instanceof Pn||n instanceof er?at(n.unwrap()):n instanceof Qs?at(n._def.innerType):[],ol=class ll extends V{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==M.object)return j(t,{code:w.invalid_type,expected:M.object,received:t.parsedType}),B;const s=this.discriminator,r=t.data[s],i=this.optionsMap.get(r);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(j(t,{code:w.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),B)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,s){const r=new Map;for(const i of t){const a=at(i.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of a){if(r.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);r.set(o,i)}}return new ll({typeName:I.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:r,...N(s)})}};function an(n,e){const t=ct(n),s=ct(e);if(n===e)return{valid:!0,data:n};if(t===M.object&&s===M.object){const r=X.objectKeys(e),i=X.objectKeys(n).filter(o=>r.indexOf(o)!==-1),a={...n,...e};for(const o of i){const l=an(n[o],e[o]);if(!l.valid)return{valid:!1};a[o]=l.data}return{valid:!0,data:a}}else if(t===M.array&&s===M.array){if(n.length!==e.length)return{valid:!1};const r=[];for(let i=0;i<n.length;i++){const a=n[i],o=e[i],l=an(a,o);if(!l.valid)return{valid:!1};r.push(l.data)}return{valid:!0,data:r}}else return t===M.date&&s===M.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}var Zs=class extends V{_parse(n){const{status:e,ctx:t}=this._processInputParams(n),s=(r,i)=>{if(tn(r)||tn(i))return B;const a=an(r.value,i.value);return a.valid?((sn(r)||sn(i))&&e.dirty(),{status:e.value,value:a.data}):(j(t,{code:w.invalid_intersection_types}),B)};return t.common.async?Promise.all([this._def.left._parseAsync({data:t.data,path:t.path,parent:t}),this._def.right._parseAsync({data:t.data,path:t.path,parent:t})]).then(([r,i])=>s(r,i)):s(this._def.left._parseSync({data:t.data,path:t.path,parent:t}),this._def.right._parseSync({data:t.data,path:t.path,parent:t}))}};Zs.create=(n,e,t)=>new Zs({left:n,right:e,typeName:I.ZodIntersection,...N(t)});var Tt=class cl extends V{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==M.array)return j(s,{code:w.invalid_type,expected:M.array,received:s.parsedType}),B;if(s.data.length<this._def.items.length)return j(s,{code:w.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),B;!this._def.rest&&s.data.length>this._def.items.length&&(j(s,{code:w.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...s.data].map((a,o)=>{const l=this._def.items[o]||this._def.rest;return l?l._parse(new st(s,a,s.path,o)):null}).filter(a=>!!a);return s.common.async?Promise.all(i).then(a=>De.mergeArray(t,a)):De.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new cl({...this._def,rest:e})}};Tt.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Tt({items:n,typeName:I.ZodTuple,rest:null,...N(e)})};var hl=class on extends V{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==M.object)return j(s,{code:w.invalid_type,expected:M.object,received:s.parsedType}),B;const r=[],i=this._def.keyType,a=this._def.valueType;for(const o in s.data)r.push({key:i._parse(new st(s,o,s.path,o)),value:a._parse(new st(s,s.data[o],s.path,o)),alwaysSet:o in s.data});return s.common.async?De.mergeObjectAsync(t,r):De.mergeObjectSync(t,r)}get element(){return this._def.valueType}static create(e,t,s){return t instanceof V?new on({keyType:e,valueType:t,typeName:I.ZodRecord,...N(s)}):new on({keyType:is.create(),valueType:e,typeName:I.ZodRecord,...N(t)})}},ei=class extends V{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(n){const{status:e,ctx:t}=this._processInputParams(n);if(t.parsedType!==M.map)return j(t,{code:w.invalid_type,expected:M.map,received:t.parsedType}),B;const s=this._def.keyType,r=this._def.valueType,i=[...t.data.entries()].map(([a,o],l)=>({key:s._parse(new st(t,a,t.path,[l,"key"])),value:r._parse(new st(t,o,t.path,[l,"value"]))}));if(t.common.async){const a=new Map;return Promise.resolve().then(async()=>{for(const o of i){const l=await o.key,c=await o.value;if(l.status==="aborted"||c.status==="aborted")return B;(l.status==="dirty"||c.status==="dirty")&&e.dirty(),a.set(l.value,c.value)}return{status:e.value,value:a}})}else{const a=new Map;for(const o of i){const l=o.key,c=o.value;if(l.status==="aborted"||c.status==="aborted")return B;(l.status==="dirty"||c.status==="dirty")&&e.dirty(),a.set(l.value,c.value)}return{status:e.value,value:a}}}};ei.create=(n,e,t)=>new ei({valueType:e,keyType:n,typeName:I.ZodMap,...N(t)});var ti=class ln extends V{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==M.set)return j(s,{code:w.invalid_type,expected:M.set,received:s.parsedType}),B;const r=this._def;r.minSize!==null&&s.data.size<r.minSize.value&&(j(s,{code:w.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),r.maxSize!==null&&s.data.size>r.maxSize.value&&(j(s,{code:w.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const i=this._def.valueType;function a(l){const c=new Set;for(const h of l){if(h.status==="aborted")return B;h.status==="dirty"&&t.dirty(),c.add(h.value)}return{status:t.value,value:c}}const o=[...s.data.values()].map((l,c)=>i._parse(new st(s,l,s.path,c)));return s.common.async?Promise.all(o).then(l=>a(l)):a(o)}min(e,t){return new ln({...this._def,minSize:{value:e,message:L.toString(t)}})}max(e,t){return new ln({...this._def,maxSize:{value:e,message:L.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};ti.create=(n,e)=>new ti({valueType:n,minSize:null,maxSize:null,typeName:I.ZodSet,...N(e)});var ul=class Lr extends V{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==M.function)return j(t,{code:w.invalid_type,expected:M.function,received:t.parsedType}),B;function s(o,l){return qr({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,$r(),rs].filter(c=>!!c),issueData:{code:w.invalid_arguments,argumentsError:l}})}function r(o,l){return qr({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,$r(),rs].filter(c=>!!c),issueData:{code:w.invalid_return_type,returnTypeError:l}})}const i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof as){const o=this;return xe(async function(...l){const c=new Ye([]),h=await o._def.args.parseAsync(l,i).catch(g=>{throw c.addIssue(s(l,g)),c}),d=await Reflect.apply(a,this,h);return await o._def.returns._def.type.parseAsync(d,i).catch(g=>{throw c.addIssue(r(d,g)),c})})}else{const o=this;return xe(function(...l){const c=o._def.args.safeParse(l,i);if(!c.success)throw new Ye([s(l,c.error)]);const h=Reflect.apply(a,this,c.data),d=o._def.returns.safeParse(h,i);if(!d.success)throw new Ye([r(h,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Lr({...this._def,args:Tt.create(e).rest(Bt.create())})}returns(e){return new Lr({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,s){return new Lr({args:e||Tt.create([]).rest(Bt.create()),returns:t||Bt.create(),typeName:I.ZodFunction,...N(s)})}},$s=class extends V{get schema(){return this._def.getter()}_parse(n){const{ctx:e}=this._processInputParams(n);return this._def.getter()._parse({data:e.data,path:e.path,parent:e})}};$s.create=(n,e)=>new $s({getter:n,typeName:I.ZodLazy,...N(e)});var qs=class extends V{_parse(n){if(n.data!==this._def.value){const e=this._getOrReturnCtx(n);return j(e,{received:e.data,code:w.invalid_literal,expected:this._def.value}),B}return{status:"valid",value:n.data}}get value(){return this._def.value}};qs.create=(n,e)=>new qs({value:n,typeName:I.ZodLiteral,...N(e)});function dl(n,e){return new ir({values:n,typeName:I.ZodEnum,...N(e)})}var ir=class cn extends V{constructor(){super(...arguments),Ts.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),s=this._def.values;return j(t,{expected:X.joinValues(s),received:t.parsedType,code:w.invalid_type}),B}if(Kr(this,Ts)||sl(this,Ts,new Set(this._def.values)),!Kr(this,Ts).has(e.data)){const t=this._getOrReturnCtx(e),s=this._def.values;return j(t,{received:t.data,code:w.invalid_enum_value,options:s}),B}return xe(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return cn.create(e,{...this._def,...t})}exclude(e,t=this._def){return cn.create(this.options.filter(s=>!e.includes(s)),{...this._def,...t})}};Ts=new WeakMap;ir.create=dl;var Ks=class extends V{constructor(){super(...arguments),Os.set(this,void 0)}_parse(n){const e=X.getValidEnumValues(this._def.values),t=this._getOrReturnCtx(n);if(t.parsedType!==M.string&&t.parsedType!==M.number){const s=X.objectValues(e);return j(t,{expected:X.joinValues(s),received:t.parsedType,code:w.invalid_type}),B}if(Kr(this,Os)||sl(this,Os,new Set(X.getValidEnumValues(this._def.values))),!Kr(this,Os).has(n.data)){const s=X.objectValues(e);return j(t,{received:t.data,code:w.invalid_enum_value,options:s}),B}return xe(n.data)}get enum(){return this._def.values}};Os=new WeakMap;Ks.create=(n,e)=>new Ks({values:n,typeName:I.ZodNativeEnum,...N(e)});var as=class extends V{unwrap(){return this._def.type}_parse(n){const{ctx:e}=this._processInputParams(n);if(e.parsedType!==M.promise&&e.common.async===!1)return j(e,{code:w.invalid_type,expected:M.promise,received:e.parsedType}),B;const t=e.parsedType===M.promise?e.data:Promise.resolve(e.data);return xe(t.then(s=>this._def.type.parseAsync(s,{path:e.path,errorMap:e.common.contextualErrorMap})))}};as.create=(n,e)=>new as({type:n,typeName:I.ZodPromise,...N(e)});var Ue=class extends V{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===I.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(n){const{status:e,ctx:t}=this._processInputParams(n),s=this._def.effect||null,r={addIssue:i=>{j(t,i),i.fatal?e.abort():e.dirty()},get path(){return t.path}};if(r.addIssue=r.addIssue.bind(r),s.type==="preprocess"){const i=s.transform(t.data,r);if(t.common.async)return Promise.resolve(i).then(async a=>{if(e.value==="aborted")return B;const o=await this._def.schema._parseAsync({data:a,path:t.path,parent:t});return o.status==="aborted"?B:o.status==="dirty"||e.value==="dirty"?Jt(o.value):o});{if(e.value==="aborted")return B;const a=this._def.schema._parseSync({data:i,path:t.path,parent:t});return a.status==="aborted"?B:a.status==="dirty"||e.value==="dirty"?Jt(a.value):a}}if(s.type==="refinement"){const i=a=>{const o=s.refinement(a,r);if(t.common.async)return Promise.resolve(o);if(o instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(t.common.async===!1){const a=this._def.schema._parseSync({data:t.data,path:t.path,parent:t});return a.status==="aborted"?B:(a.status==="dirty"&&e.dirty(),i(a.value),{status:e.value,value:a.value})}else return this._def.schema._parseAsync({data:t.data,path:t.path,parent:t}).then(a=>a.status==="aborted"?B:(a.status==="dirty"&&e.dirty(),i(a.value).then(()=>({status:e.value,value:a.value}))))}if(s.type==="transform")if(t.common.async===!1){const i=this._def.schema._parseSync({data:t.data,path:t.path,parent:t});if(!Vt(i))return i;const a=s.transform(i.value,r);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:e.value,value:a}}else return this._def.schema._parseAsync({data:t.data,path:t.path,parent:t}).then(i=>Vt(i)?Promise.resolve(s.transform(i.value,r)).then(a=>({status:e.value,value:a})):i);X.assertNever(s)}};Ue.create=(n,e,t)=>new Ue({schema:n,typeName:I.ZodEffects,effect:e,...N(t)});Ue.createWithPreprocess=(n,e,t)=>new Ue({schema:e,effect:{type:"preprocess",transform:n},typeName:I.ZodEffects,...N(t)});var et=class extends V{_parse(n){return this._getType(n)===M.undefined?xe(void 0):this._def.innerType._parse(n)}unwrap(){return this._def.innerType}};et.create=(n,e)=>new et({innerType:n,typeName:I.ZodOptional,...N(e)});var Ot=class extends V{_parse(n){return this._getType(n)===M.null?xe(null):this._def.innerType._parse(n)}unwrap(){return this._def.innerType}};Ot.create=(n,e)=>new Ot({innerType:n,typeName:I.ZodNullable,...N(e)});var Js=class extends V{_parse(n){const{ctx:e}=this._processInputParams(n);let t=e.data;return e.parsedType===M.undefined&&(t=this._def.defaultValue()),this._def.innerType._parse({data:t,path:e.path,parent:e})}removeDefault(){return this._def.innerType}};Js.create=(n,e)=>new Js({innerType:n,typeName:I.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...N(e)});var Qs=class extends V{_parse(n){const{ctx:e}=this._processInputParams(n),t={...e,common:{...e.common,issues:[]}},s=this._def.innerType._parse({data:t.data,path:t.path,parent:{...t}});return Vs(s)?s.then(r=>({status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new Ye(t.common.issues)},input:t.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Ye(t.common.issues)},input:t.data})}}removeCatch(){return this._def.innerType}};Qs.create=(n,e)=>new Qs({innerType:n,typeName:I.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...N(e)});var si=class extends V{_parse(n){if(this._getType(n)!==M.nan){const t=this._getOrReturnCtx(n);return j(t,{code:w.invalid_type,expected:M.nan,received:t.parsedType}),B}return{status:"valid",value:n.data}}};si.create=n=>new si({typeName:I.ZodNaN,...N(n)});var vf=Symbol("zod_brand"),Pn=class extends V{_parse(n){const{ctx:e}=this._processInputParams(n),t=e.data;return this._def.type._parse({data:t,path:e.path,parent:e})}unwrap(){return this._def.type}},Fn=class gl extends V{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return i.status==="aborted"?B:i.status==="dirty"?(t.dirty(),Jt(i.value)):this._def.out._parseAsync({data:i.value,path:s.path,parent:s})})();{const r=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return r.status==="aborted"?B:r.status==="dirty"?(t.dirty(),{status:"dirty",value:r.value}):this._def.out._parseSync({data:r.value,path:s.path,parent:s})}}static create(e,t){return new gl({in:e,out:t,typeName:I.ZodPipeline})}},er=class extends V{_parse(n){const e=this._def.innerType._parse(n),t=s=>(Vt(s)&&(s.value=Object.freeze(s.value)),s);return Vs(e)?e.then(s=>t(s)):t(e)}unwrap(){return this._def.innerType}};er.create=(n,e)=>new er({innerType:n,typeName:I.ZodReadonly,...N(e)});function Fa(n,e){const t=typeof n=="function"?n(e):typeof n=="string"?{message:n}:n;return typeof t=="string"?{message:t}:t}function fl(n,e={},t){return n?ns.create().superRefine((s,r)=>{var i,a;const o=n(s);if(o instanceof Promise)return o.then(l=>{var c,h;if(!l){const d=Fa(e,s),u=(h=(c=d.fatal)!==null&&c!==void 0?c:t)!==null&&h!==void 0?h:!0;r.addIssue({code:"custom",...d,fatal:u})}});if(!o){const l=Fa(e,s),c=(a=(i=l.fatal)!==null&&i!==void 0?i:t)!==null&&a!==void 0?a:!0;r.addIssue({code:"custom",...l,fatal:c})}}):ns.create()}var yf={object:Fe.lazycreate},I;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(I||(I={}));var _f=(n,e={message:`Input not instance of ${n.name}`})=>fl(t=>t instanceof n,e),pl=is.create,ml=zs.create,xf=si.create,bf=Ws.create,vl=Xs.create,wf=Ys.create,Cf=Jr.create,Sf=Us.create,Tf=Gs.create,Of=ns.create,kf=Bt.create,Df=vt.create,jf=Qr.create,Mf=zt.create,Af=Fe.create,Ef=Fe.strictCreate,Pf=Hs.create,Ff=ol.create,Rf=Zs.create,Lf=Tt.create,If=hl.create,Bf=ei.create,Nf=ti.create,Vf=ul.create,zf=$s.create,Wf=qs.create,Xf=ir.create,Yf=Ks.create,Uf=as.create,Ra=Ue.create,Gf=et.create,Hf=Ot.create,Zf=Ue.createWithPreprocess,$f=Fn.create,qf=()=>pl().optional(),Kf=()=>ml().optional(),Jf=()=>vl().optional(),Qf={string:n=>is.create({...n,coerce:!0}),number:n=>zs.create({...n,coerce:!0}),boolean:n=>Xs.create({...n,coerce:!0}),bigint:n=>Ws.create({...n,coerce:!0}),date:n=>Ys.create({...n,coerce:!0})},ep=B,fe=Object.freeze({__proto__:null,defaultErrorMap:rs,setErrorMap:Hg,getErrorMap:$r,makeIssue:qr,EMPTY_PATH:Zg,addIssueToContext:j,ParseStatus:De,INVALID:B,DIRTY:Jt,OK:xe,isAborted:tn,isDirty:sn,isValid:Vt,isAsync:Vs,get util(){return X},get objectUtil(){return en},ZodParsedType:M,getParsedType:ct,ZodType:V,datetimeRegex:nl,ZodString:is,ZodNumber:zs,ZodBigInt:Ws,ZodBoolean:Xs,ZodDate:Ys,ZodSymbol:Jr,ZodUndefined:Us,ZodNull:Gs,ZodAny:ns,ZodUnknown:Bt,ZodNever:vt,ZodVoid:Qr,ZodArray:zt,ZodObject:Fe,ZodUnion:Hs,ZodDiscriminatedUnion:ol,ZodIntersection:Zs,ZodTuple:Tt,ZodRecord:hl,ZodMap:ei,ZodSet:ti,ZodFunction:ul,ZodLazy:$s,ZodLiteral:qs,ZodEnum:ir,ZodNativeEnum:Ks,ZodPromise:as,ZodEffects:Ue,ZodTransformer:Ue,ZodOptional:et,ZodNullable:Ot,ZodDefault:Js,ZodCatch:Qs,ZodNaN:si,BRAND:vf,ZodBranded:Pn,ZodPipeline:Fn,ZodReadonly:er,custom:fl,Schema:V,ZodSchema:V,late:yf,get ZodFirstPartyTypeKind(){return I},coerce:Qf,any:Of,array:Mf,bigint:bf,boolean:vl,date:wf,discriminatedUnion:Ff,effect:Ra,enum:Xf,function:Vf,instanceof:_f,intersection:Rf,lazy:zf,literal:Wf,map:Bf,nan:xf,nativeEnum:Yf,never:Df,null:Tf,nullable:Hf,number:ml,object:Af,oboolean:Jf,onumber:Kf,optional:Gf,ostring:qf,pipeline:$f,preprocess:Zf,promise:Uf,record:If,set:Nf,strictObject:Ef,string:pl,symbol:Cf,transformer:Ra,tuple:Lf,undefined:Sf,union:Pf,unknown:kf,void:jf,NEVER:ep,ZodIssueCode:w,quotelessJson:Gg,ZodError:Ye}),La={name:"@imgly/background-removal",version:"1.7.0"},tp=fe.object({publicPath:fe.string().optional().describe("The public path to the wasm files and the onnx model.").default("https://staticimgly.com/@imgly/background-removal-data/${PACKAGE_VERSION}/dist/").transform(n=>n.replace("${PACKAGE_NAME}",La.name).replace("${PACKAGE_VERSION}",La.version)),debug:fe.boolean().default(!1).describe("Whether to enable debug logging."),rescale:fe.boolean().default(!0).describe("Whether to rescale the image."),device:fe.enum(["cpu","gpu"]).default("cpu").describe("The device to run the model on."),proxyToWorker:fe.boolean().default(!1).describe("Whether to proxy inference to a web worker."),fetchArgs:fe.any().default({}).describe("Arguments to pass to fetch when loading the model."),progress:fe.function().args(fe.string(),fe.number(),fe.number()).returns(fe.void()).describe("Progress callback.").optional(),model:fe.preprocess(n=>{switch(n){case"large":return"isnet";case"small":return"isnet_quint8";case"medium":return"isnet_fp16";default:return n}},fe.enum(["isnet","isnet_fp16","isnet_quint8"])).default("medium"),output:fe.object({format:fe.enum(["image/png","image/jpeg","image/webp","image/x-rgba8","image/x-alpha8"]).default("image/png"),quality:fe.number().default(.8)}).default({})}).default({}).transform(n=>(n.debug&&console.log("Config:",n),n.debug&&!n.progress&&(n.progress=n.progress??((e,t,s)=>{console.debug(`Downloading ${e}: ${t} of ${s}`)}),crossOriginIsolated||n.debug&&console.debug("Cross-Origin-Isolated is not enabled. Performance will be degraded. Please see  https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer.")),n));function sp(n){return tp.parse(n??{})}var rp=fi(pi());async function ip(n){n.debug&&console.debug("Loading model...",n.model);const e=n.model,s=await(await Ko(`/models/${e}`,n)).arrayBuffer();return await Yg(s,n)}async function np(n){n=sp(n);const e=await ip(n);return{config:n,session:{base:e}}}async function ap(n,e,t){const[r,i,a]=n.shape,o=!1;let l=Aa(n,1024,1024,o);const c=Ng(l);let h=await Ug(t.base,[["input",c]],["output"],e),d=(0,rp.default)(h[0].data,[1024,1024,1]),u=zg(d);return e.rescale?(u=Aa(u,i,r,o),[u,n]):[u,l]}var op=Eg(np,n=>JSON.stringify(n));async function lp(n,e){const{config:t,session:s}=await op(e);t.progress&&t.progress("compute:decode",0,4);const r=await Vg(n,t);t.progress?.("compute:inference",1,4);const[i,a]=await ap(r,t,s);t.progress?.("compute:mask",2,4);const o=a,[l,c]=o.shape,h=l*c;for(let u=0;u<h;u+=1)o.data[4*u+3]=i.data[u];t.progress?.("compute:encode",3,4);const d=await Fg(o,t.output.quality,t.output.format);return t.progress?.("compute:encode",4,4),d}/*! Bundled license information:

is-buffer/index.js:
  (*!
   * Determine if an object is a Buffer
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   *)
*/const cp={class:"flex flex-col relative w-full dark:bg-dark-001 gap-4"},hp={class:"flex flex-col xl:grid grid-cols-4 gap-4"},up={class:"flex flex-col gap-4"},dp={class:"flex flex-col col-span-2"},gp={class:"bg-white rounded-lg border border-brand-50 dark:border-gray-700",ref:"canvasContainerRef"},fp={id:"canvasId",ref:"canvasRef"},pp={key:0,ref:"aiLoading",class:"absolute bg-brand-800/50 top-0 h-full w-[630px] flex justify-center items-center"},mp={class:"font-semibold text-lg animate-pulse flex flex-col items-center text-white"},vp={key:0,class:"text-white"},yp={class:"flex flex-col gap-4"},_p={class:"flex flex-col justify-between gap-2 h-full w-full bg-transparent",ref:"qrCodeRef"},xp={class:"flex flex-col p-4"},Wp=Ia({__name:"(Edit)",props:{show_data:{},request_status_types:{}},setup(n){const e=bi("canvasContainerRef"),t=we(null),s=we(0),r=we(0),i=we(0),a=we(0),o=we(0),l=we(""),c=we([]),h=we(!1),d=we("");let u=null;const g=we(!1),f=we(""),p=jl(),y=bi("qrCodeRef"),x=we(null);bi("parentQr");const b=we(300);function O(S,T){return new Promise((P,he)=>{new FontFace(S,`url(${T})`).load().then(Ze=>{document.fonts.add(Ze),P()}).catch(he)})}function C(){if(e.value==null||!u)return;const S=e.value.offsetWidth,T=e.value.offsetHeight,P=1200,he=1800,xt=S/P,Ze=T/he,_i=Math.min(xt,Ze);u&&(u?.setZoom(_i),u?.setWidth(P*_i),u?.setHeight(he*_i),u?.renderAll())}function k(){t.value&&(t.value.set({width:Math.floor(s.value),height:Math.floor(r.value),left:Math.floor(a.value),top:Math.floor(o.value),scaleX:1,scaleY:1,angle:Math.floor(i.value)}),t.value.setCoords(),u?.renderAll())}function F(){u?.getActiveObject()?(u?.remove(Mt(t.value)),ge()):alert("no layer selected")}function D(){t.value&&t.value.type==="text"&&(t.value.set("text",l.value),t.value.set("layerName",l.value),u?.renderAll())}function R(S){if(!u){alert("no layer selected");return}t.value=S,s.value=S.width*S.scaleX,r.value=S.height*S.scaleY,a.value=S.left,o.value=S.top,i.value=S.angle,S.type==="text"&&(l.value=S.text),u?.setActiveObject(Mt(S)),ge()}function W(){t.value=null,s.value=0,r.value=0,a.value=0,o.value=0,i.value=0,l.value=""}async function K(){if(!t.value||t.value.type!=="image"){alert("Please select an image layer to remove the background.");return}h.value=!0;const S=Mt(t.value.getSrc());try{const T=await lp(S),P=new FileReader;P.onload=async he=>{const xt=he.target?.result,Ze=await ve.fromURL(xt,{crossOrigin:"anonymous",signal:new AbortController().signal},{left:t.value?.left,top:t.value?.top,scaleX:1,scaleY:1,selectable:!0,evented:!0,hasControls:!0,lockScalingX:!1,lockScalingY:!1,lockRotation:!1,originX:"center",originY:"center",layerName:`${t.value?.layerName} - no bg`,id:`layer-${Date.now()}`,shadow:new Qe({color:"rgba(0, 0, 0, 0.5)",blur:10,offsetX:5,offsetY:5,affectStroke:!1,includeDefaultValues:!1,nonScaling:!1})});u?.remove(Mt(t.value)),u?.add(Ze),t.value=Ze,ge()},P.readAsDataURL(T)}catch(T){console.error("Error removing background:",T),alert("Failed to remove background. Please try again.")}finally{h.value=!1}}function E(S){u&&(u?.sendObjectBackwards(Mt(S)),t.value=null)}function G(S){u&&(u?.bringObjectForward(Mt(S)),t.value=null)}function Z(){if(!u){alert("Canvas is not initialized.");return}const S=u.toDataURL({format:"jpeg",quality:1,multiplier:3}),T=document.createElement("a");T.href=S,T.download="canvas-image.jpg",T.click()}function Y(){if(!u){alert("Canvas is not initialized.");return}const S=u.toSVG(),T=new Blob([S],{type:"image/svg+xml;charset=utf-8"}),P=document.createElement("a");P.href=URL.createObjectURL(T),P.download="canvas-image.svg",P.click(),URL.revokeObjectURL(P.href)}function ae(){if(!u){alert("Canvas is not initialized.");return}const S=u.toJSON(),T=JSON.stringify(S);console.log("jsonString",T);const P=new Blob([T],{type:"application/json"}),he=document.createElement("a");he.href=URL.createObjectURL(P),he.download=`${_s(n.show_data)} - canvas-project.json`,he.click(),URL.revokeObjectURL(he.href)}function ie(S){const T=S.target.files?.[0];if(!T)return;const P=new FileReader;P.onload=he=>{f.value=he.target?.result},P.readAsText(T)}async function oe(){if(!u){alert("Canvas is not initialized.");return}if(f.value==""){alert("Please upload a JSON file first.");return}await u.loadFromJSON(f.value,()=>{ge()}),ge()}function q(){const S=["This may take a few moments. ","Just a little bit longer... "];let T=0;const P=setInterval(()=>{if(!h.value){clearInterval(P),d.value="";return}d.value=S[T%S.length],T++},5e3)}async function be(S,T){const P=await ve.fromURL(S,{crossOrigin:"anonymous",signal:new AbortController().signal},{left:T.left,top:T.top,scaleX:1,scaleY:1,selectable:T.selectable,evented:!0,hasControls:T.hasControl,lockScalingX:!1,lockScalingY:!1,lockRotation:!1,originX:"center",originY:"center",layerName:T.layerName});u&&(u.add(P),T.sendObjectToBack&&u.sendObjectToBack(P),T.sendObjectBackwards&&u.sendObjectBackwards(P))}function ge(){u&&(c.value=[],c.value=u.getObjects().reverse().map(S=>Mt(S)),u.renderAll())}function Xt(){const S=new ue(_s(n.show_data,!1),{top:1118,left:600,fill:"black",fontSize:70,textAlign:"center",originX:"center",originY:"center",fontWeight:"bold",fontFamily:"Open Sans",layerName:_s(n.show_data)});u?.add(S);const T=new ue(n.show_data.position.name.toUpperCase(),{top:1250,left:1200/2,fill:"black",fontSize:70,textAlign:"center",originX:"center",originY:"center",fontWeight:"bold",fontFamily:"Open Sans",layerName:n.show_data.position.name});u?.add(T);const P=new ue(n.show_data.department.name.toUpperCase(),{top:1320,left:1200/2,fill:"black",fontSize:40,textAlign:"center",originX:"center",originY:"center",fontWeight:"bold",fontFamily:"Open Sans",layerName:`${n.show_data.department.name}`});u?.add(P)}async function vs(){if(await be(`${p.props.base_url}/images/template-new-2025-06-18.jpg`,{top:1800/2,left:1200/2,selectable:!1,hasControl:!1,layerName:"Template",sendObjectToBack:!1,sendObjectBackwards:!1}),await be(`${p.props.base_url}${n.show_data.files[n.show_data.files.length-2].file_url}`,{top:800,left:1200/2,selectable:!0,hasControl:!0,layerName:`${_s(n.show_data)}`,sendObjectToBack:!1,sendObjectBackwards:!1}),y.value){const S=await Nl(y.value,{cacheBust:!0,backgroundColor:void 0});await be(S,{top:1477,left:1200/2,selectable:!0,hasControl:!0,layerName:"QR Code",sendObjectToBack:!1,sendObjectBackwards:!1})}}function Dt(){u&&(u.on("selection:created",S=>{t.value=S.selected[0],s.value=parseFloat((t.value.width*t.value.scaleX).toFixed(2)),r.value=parseFloat((t.value.height*t.value.scaleY).toFixed(2)),a.value=parseFloat(t.value.left.toFixed(2)),o.value=parseFloat(t.value.top.toFixed(2)),i.value=parseFloat(t.value.angle.toFixed(2)),t.value.type==="text"&&(l.value=t.value.text)}),u.on("selection:updated",S=>{R(S.selected[0])}),u.on("object:moving",S=>{a.value=parseFloat(t.value.left.toFixed(2)),o.value=parseFloat(t.value.top.toFixed(2))}),u.on("object:scaling",S=>{i.value=t.value.angle,s.value=parseFloat((t.value.width*t.value.scaleX).toFixed(2)),r.value=parseFloat((t.value.height*t.value.scaleY).toFixed(2))}),u.on("object:rotating",S=>{i.value=parseFloat(t.value.angle.toFixed(2))}),u.on("selection:cleared",()=>{W()}))}function Ge(){document.addEventListener("keydown",S=>{if(!u||!t.value&&S.key!=="o")return;const T=S.target;if(["INPUT","TEXTAREA"].includes(T.tagName)||T.isContentEditable)return;S.preventDefault();const P=2;switch(S.key){case"ArrowUp":t.value.top-=P;break;case"ArrowDown":t.value.top+=P;break;case"ArrowLeft":t.value.left-=P;break;case"ArrowRight":t.value.left+=P;break;case"Delete":F();break;case"o":S.ctrlKey&&(g.value=!0);break;default:return}t.value&&(t.value.setCoords(),u.renderAll(),a.value=parseFloat(t.value.left.toFixed(2)),o.value=parseFloat(t.value.top.toFixed(2)))})}function Yt(){if(u){const S=u.getActiveObject();S&&(S.set("flipY",!S.flipY),u.renderAll())}}function it(){if(u){const S=u.getActiveObject();S&&(S.set("flipX",!S.flipX),u.renderAll())}}function jt(){if(t.value&&t.value.type==="text"){const S=t.value.fontWeight;t.value.set("fontWeight",S==="bold"?"normal":"bold"),u?.renderAll()}}function yi(){if(t.value&&t.value.type==="text"){const S=t.value.fontStyle;t.value.set("fontStyle",S==="italic"?"normal":"italic"),u?.renderAll()}}async function ys(){if(!x.value)return;const S=await ve.fromURL(`${p.props.base_url}${x.value.file_url}`,{crossOrigin:"anonymous",signal:new AbortController().signal},{left:1200/2,top:1800/2,scaleX:1,scaleY:1,selectable:!0,evented:!0,hasControls:!0,lockScalingX:!1,lockScalingY:!1,lockRotation:!1,originX:"center",originY:"center",layerName:x.value.id});if(u){const T=u.width,P=u.height,he=T/S.width,xt=P/S.height,Ze=Math.min(he,xt);S.scale(Ze),u.add(S)}ge()}async function He(){if(!u){alert("Canvas is not initialized.");return}const S=u.toDataURL({format:"jpeg",quality:1,multiplier:3}),T=await(await fetch(S)).blob(),P=new FormData;P.append("file",T,"canvas-image.jpg"),P.append("type","upload-image"),P.append("_method","PUT"),Pl.post(route("dashboard.arta-id.update",{arta_id:n.show_data.id}),P,{preserveState:!0})}function yl(){if(!u)return;const S=u.getObjects("image").find(Ze=>Ze.layerName===_s(n.show_data));S&&(S.visible=!1,u.renderAll());const T=u.toDataURL({format:"jpeg",quality:1,multiplier:2});S&&(S.visible=!0,u.renderAll());const he=encodeURIComponent(JSON.stringify({files:[T],resources:["https://fontiko.com/system/uploads/font-files/93/OpenSans_Condensed-Bold.ttf"]}));console.log(he);const xt=`https://www.photopea.com#${he}`;window.open(xt,"_blank")?.focus()}function _l(){b.value=y.value?.clientWidth??300}return Ml(async()=>{if(_l(),await document.fonts.ready,await O("Open Sans","/fonts/OpenSans-SemiBold.ttf"),e.value&&(u=new Ki("canvasId",{width:e.value.clientWidth,height:1800,backgroundColor:"white"})),C(),de.prototype.toObject=(function(S){return function(){return Object.assign(S.call(this),{layerName:this.layerName||"",text:this.text||null})}})(de.prototype.toObject),!u){alert("canvas not initialized");return}await vs(),Xt(),Dt(),Ge(),setTimeout(()=>{u?.getObjects()&&ge()},500)}),Al(h,S=>{S&&q()}),(S,T)=>(Ds(),wi("div",cp,[me(Vl),te("div",hp,[te("div",up,[me(Fl,{removing_background:h.value,layers:c.value,selected_layer:t.value,onSelectLayer:R,onMoveBackward:E,onMoveForward:G,onShowImportModal:T[0]||(T[0]=P=>g.value=!0)},null,8,["removing_background","layers","selected_layer"]),me(Rl,{files:n.show_data.files,selected_file:x.value,onImportImage:ys,onSelectFile:T[1]||(T[1]=P=>x.value=P),selected_text_value:l.value,"onUpdate:selected_text_value":T[2]||(T[2]=P=>l.value=P)},null,8,["files","selected_file","selected_text_value"])]),te("div",dp,[te("div",gp,[te("canvas",fp,null,512),h.value?(Ds(),wi("div",pp,[te("div",mp,[me(Be(zl),{class:"size-8"}),T[19]||(T[19]=te("p",null,"Removing Background...",-1)),d.value?(Ds(),wi("p",vp,Ni(d.value),1)):Vn("",!0)])],512)):Vn("",!0)],512)]),te("div",yp,[me(Il,{selected_layer:t.value,id:n.show_data.id,removing_background:h.value,selected_text_value:l.value,"onUpdate:selected_text_value":T[3]||(T[3]=P=>l.value=P),selected_x:a.value,"onUpdate:selected_x":T[4]||(T[4]=P=>a.value=P),selected_y:o.value,"onUpdate:selected_y":T[5]||(T[5]=P=>o.value=P),selected_angle:i.value,"onUpdate:selected_angle":T[6]||(T[6]=P=>i.value=P),selected_height:r.value,"onUpdate:selected_height":T[7]||(T[7]=P=>r.value=P),selected_width:s.value,"onUpdate:selected_width":T[8]||(T[8]=P=>s.value=P),onUpdateObjectSize:k,onDeleteLayer:F,onUpdateTextValue:D,onToggleBold:jt,onToggleItalic:yi,onFlipHorizontal:T[9]||(T[9]=P=>it()),onFlipVertical:T[10]||(T[10]=P=>Yt()),onRemoveBg:T[11]||(T[11]=P=>K()),onExportAsJson:T[12]||(T[12]=P=>ae()),onExportAsJpg:T[13]||(T[13]=P=>Z()),onExportAsSvg:T[14]||(T[14]=P=>Y()),onSaveToOnlineFile:T[15]||(T[15]=P=>He()),onOpenToPhotopea:T[16]||(T[16]=P=>yl())},null,8,["selected_layer","id","removing_background","selected_text_value","selected_x","selected_y","selected_angle","selected_height","selected_width"]),me(xl,{title:"QR Code",description:"QR Code",icon:Be(El),ref:"parentQr"},{default:$e(()=>[te("div",_p,[me(Bl,{value:`${Be(p).props.base_url}/qr/${n.show_data.quick_response_codes[0].id}`,size:b.value,margin:1,level:"H",renderAs:"svg",background:"#dcdfda"},null,8,["value","size"])],512)]),_:1},8,["icon"]),me(Ll)])]),me(Vu,{modelValue:g.value,"onUpdate:modelValue":T[17]||(T[17]=P=>g.value=P),title:"Import JSON",id:"import_json",confirmIcon:Be(Wl),confirmMessage:"Import",onConfirm:T[18]||(T[18]=P=>oe())},{default:$e(()=>[te("div",xp,[te("input",{type:"file",onChange:ie,accept:".json",class:"bg-dark-001 p-4 rounded-xl hover:bg-dark-002 cursor-pointer w-full"},null,32)])]),_:1},8,["modelValue","confirmIcon"])]))}});export{Wp as default};
